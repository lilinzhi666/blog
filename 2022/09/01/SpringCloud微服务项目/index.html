<!DOCTYPE HTML>
<html lang="zh_CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="SpringCloud微服务项目, lilinzhi">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>SpringCloud微服务项目 | lilinzhi</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="lilinzhi" type="application/atom+xml">
</head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">lilinzhi</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>index</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>tags</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>Categories</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>Archives</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>About</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>Contact</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/music" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>music</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="Search" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">lilinzhi</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			index
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			tags
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			Categories
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			Archives
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			About
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			Contact
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/music" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			music
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/17.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">SpringCloud微服务项目</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                          <div class="article-tag">
                            <span class="chip bg-color">No tag</span>
                          </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>Publish Date:&nbsp;&nbsp;
                    2022-09-01
                </div>
                

                

                

                

                
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="前后端分离-微服务项目"><a href="#前后端分离-微服务项目" class="headerlink" title="前后端分离-微服务项目"></a>前后端分离-微服务项目</h1><h2 id="01-项目搭建与创作者接口-数据库创建"><a href="#01-项目搭建与创作者接口-数据库创建" class="headerlink" title="01-项目搭建与创作者接口-数据库创建"></a>01-项目搭建与创作者接口-数据库创建</h2><h3 id="创建数据库与表"><a href="#创建数据库与表" class="headerlink" title="创建数据库与表"></a>创建数据库与表</h3><p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822095704833.png" alt="image-20220822095704833"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `video_author` (</span><br><span class="line">	`id` <span class="type">CHAR</span> ( <span class="number">19</span> ) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创作者ID&#x27;</span>,</span><br><span class="line">	`name` <span class="type">VARCHAR</span> ( <span class="number">20</span> ) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创作者姓名&#x27;</span>,</span><br><span class="line">	`intro` <span class="type">VARCHAR</span> ( <span class="number">500</span> ) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;创作者简介&#x27;</span>,</span><br><span class="line">	`career` <span class="type">VARCHAR</span> ( <span class="number">500</span> ) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建者经历介绍&#x27;</span>,</span><br><span class="line">	`level` <span class="type">INT</span> ( <span class="number">10</span> ) UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;1:普通创作者 2:特约创作者&#x27;</span>,</span><br><span class="line">	`avatar` <span class="type">VARCHAR</span> ( <span class="number">255</span> ) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创作者头像&#x27;</span>,</span><br><span class="line">	`sort` <span class="type">INT</span> ( <span class="number">10</span> ) UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;排序&#x27;</span>,</span><br><span class="line">	`is_deleted` TINYINT ( <span class="number">1</span> ) UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;逻辑删除 1（true）已删除， 0（false）未删除&#x27;</span>,</span><br><span class="line">	`gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">	`gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">	<span class="keyword">PRIMARY</span> KEY ( `id` ),</span><br><span class="line"><span class="keyword">UNIQUE</span> KEY `uk_name` ( `name` ) </span><br><span class="line">) ENGINE <span class="operator">=</span> INNODB <span class="keyword">DEFAULT</span> CHARSET <span class="operator">=</span> utf8mb4 COMMENT <span class="operator">=</span> <span class="string">&#x27;创作者&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822095716706.png" alt="image-20220822095716706"></p>
<h3 id="数据库设计规范"><a href="#数据库设计规范" class="headerlink" title="数据库设计规范"></a>数据库设计规范</h3><blockquote>
<ul>
<li>数据库名称尽量与应用名称保存一致</li>
<li>表名：业务名称_表的作用，video_author</li>
<li>表名, 字段名必须使用小写, 禁止以数字开头, 不要使用关键字</li>
<li>表名起的时候, 尽量不要使用复数名称</li>
<li>表当中必备三个字段：id：主键，gmt_create：记录创建的时间，gmt_modified：记录修改时间</li>
<li>如果一个表当中记录比较多的时候，超过了500万条，或者容量超过了2G考虑做分库分表, 假设表的内容3年都达不到500万条数据, 不要做分库分表</li>
<li>数据库当中字段如果是表示，<code>是</code> 与 <code>否</code>，通常字段起名，<code>is_xxx</code> 数据类型 使用 <code>tinyint(1 表示真, 0表示假)</code></li>
<li>表示金钱的字段, 必须使用 decimal, 不能使用 float 或者 double, 有时候会都把小数类型统一使用 decimal</li>
<li>如果一个字段存储的内容几乎长度都相等，建议使用 char 类型，定长字符串类型</li>
<li>varhcar 可变字符串, 不预先分配存储空间, 如果长充超过 5000, 不建议使用 varchar, 建议使用 text，建议使用独立的一张表来进行存储, 全部都放到一起, 会影响查询速度</li>
<li>主索引, 起名: <code>uk_字段</code>, 普通索引, <code>idx_字段名称</code></li>
<li>如果两个表有外键 ,不要在数据库当中添加外键约束，在应用层进行处理外键，不利于 <code>分布式</code>, 不利于做 <code>并发</code> <code>集群</code></li>
</ul>
</blockquote>
<h2 id="02-项目搭建与创作者接口-父工程搭建"><a href="#02-项目搭建与创作者接口-父工程搭建" class="headerlink" title="02-项目搭建与创作者接口-父工程搭建"></a>02-项目搭建与创作者接口-父工程搭建</h2><h3 id="创建父工程"><a href="#创建父工程" class="headerlink" title="创建父工程"></a>创建父工程</h3><p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822095748482.png" alt="image-20220822095748482"></p>
<p>删除 src</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822095809554.png" alt="image-20220822095809554"></p>
<p>配置 maven 地址</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822095826023.png" alt="image-20220822095826023"></p>
<h3 id="导入依赖"><a href="#导入依赖" class="headerlink" title="导入依赖"></a>导入依赖</h3><p>配置父工程的打包方式为 <code>pom</code></p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822095849100.png" alt="image-20220822095849100"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="定义版本信息"><a href="#定义版本信息" class="headerlink" title="定义版本信息"></a>定义版本信息</h4><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202103/2105804-20210327111056673-219027945.png"><img src="https://img2020.cnblogs.com/blog/2105804/202103/2105804-20210327111056673-219027945.png" alt="img"></a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mybatis-plus.version</span>&gt;</span>3.0.5<span class="tag">&lt;/<span class="name">mybatis-plus.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">velocity.version</span>&gt;</span>2.0<span class="tag">&lt;/<span class="name">velocity.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">swagger.version</span>&gt;</span>2.7.0<span class="tag">&lt;/<span class="name">swagger.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aliyun.oss.version</span>&gt;</span>2.8.3<span class="tag">&lt;/<span class="name">aliyun.oss.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jodatime.version</span>&gt;</span>2.10.1<span class="tag">&lt;/<span class="name">jodatime.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">poi.version</span>&gt;</span>3.17<span class="tag">&lt;/<span class="name">poi.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">commons-fileupload.version</span>&gt;</span>1.3.1<span class="tag">&lt;/<span class="name">commons-fileupload.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">commons-io.version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">commons-io.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">httpclient.version</span>&gt;</span>4.5.1<span class="tag">&lt;/<span class="name">httpclient.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jwt.version</span>&gt;</span>0.7.0<span class="tag">&lt;/<span class="name">jwt.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aliyun-java-sdk-core.version</span>&gt;</span>4.3.3<span class="tag">&lt;/<span class="name">aliyun-java-sdk-core.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aliyun-sdk-oss.version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">aliyun-sdk-oss.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aliyun-java-sdk-vod.version</span>&gt;</span>2.15.2<span class="tag">&lt;/<span class="name">aliyun-java-sdk-vod.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aliyun-java-vod-upload.version</span>&gt;</span>1.4.11<span class="tag">&lt;/<span class="name">aliyun-java-vod-upload.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aliyun-sdk-vod-upload.version</span>&gt;</span>1.4.11<span class="tag">&lt;/<span class="name">aliyun-sdk-vod-upload.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fastjson.version</span>&gt;</span>1.2.28<span class="tag">&lt;/<span class="name">fastjson.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">gson.version</span>&gt;</span>2.8.2<span class="tag">&lt;/<span class="name">gson.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">json.version</span>&gt;</span>20170516<span class="tag">&lt;/<span class="name">json.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">commons-dbutils.version</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">commons-dbutils.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">canal.client.version</span>&gt;</span>1.1.0<span class="tag">&lt;/<span class="name">canal.client.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">docker.image.prefix</span>&gt;</span>zx<span class="tag">&lt;/<span class="name">docker.image.prefix</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">cloud-alibaba.version</span>&gt;</span>0.2.2.RELEASE<span class="tag">&lt;/<span class="name">cloud-alibaba.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="锁定依赖信息"><a href="#锁定依赖信息" class="headerlink" title="锁定依赖信息"></a>锁定依赖信息</h4><p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822095912525.png" alt="image-20220822095912525"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--Spring Cloud--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>Hoxton.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;cloud-alibaba.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--mybatis-plus 持久层--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis-plus.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- velocity 模板引擎, Mybatis Plus 代码生成器需要 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.velocity<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>velocity-engine-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;velocity.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--swagger--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;swagger.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--swagger ui--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;swagger.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--日期时间工具--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>joda-time<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>joda-time<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jodatime.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--xls--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;poi.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--xlsx--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi-ooxml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;poi.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--文件上传--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;commons-fileupload.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--commons-io--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;commons-io.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--httpclient--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;httpclient.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.code.gson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;gson.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- JWT --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jwt.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--aliyun--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-java-sdk-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;aliyun-java-sdk-core.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun.oss<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-sdk-oss<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;aliyun-sdk-oss.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-java-sdk-vod<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;aliyun-java-sdk-vod.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-java-vod-upload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;aliyun-java-vod-upload.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;fastjson.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.json<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>json<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;json.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-dbutils<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-dbutils<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;commons-dbutils.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.otter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>canal.client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;canal.client.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="03-项目搭建与创作者接口-创建-service-模块以及-service-video-子模块"><a href="#03-项目搭建与创作者接口-创建-service-模块以及-service-video-子模块" class="headerlink" title="03-项目搭建与创作者接口-创建 service 模块以及 service_video 子模块"></a>03-项目搭建与创作者接口-创建 service 模块以及 service_video 子模块</h2><p> 在父工程 video-parent 下面创建模块 service</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822100116379.png" alt="image-20220822100116379"></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202103/2105804-20210327112258267-1180895361.png"></a></p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822100136415.png" alt="image-20220822100136415"></p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822100151967.png" alt="image-20220822100151967"></p>
<p>打包方式改为 <code>pom</code></p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822100012312.png" alt="image-20220822100012312"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在 service 模块中添加项目需要的依赖，修改 service 模块的 pom.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--mybatis-plus--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--mysql--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- velocity 模板引擎, Mybatis Plus 代码生成器需要 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.velocity<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>velocity-engine-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--swagger--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--lombok用来简化实体类：需要安装lombok插件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--xls--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi-ooxml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--httpclient--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--commons-io--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--gson--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.code.gson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在父工程 service 模块下面创建子模块 service_video 创建方式同上只不过是创建之后的位置不同而已这个是 service 的子模块，service 模块的 <code>src</code> 也不需要删除</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822100236418.png" alt="image-20220822100236418"></p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822100251656.png" alt="image-20220822100251656"></p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822100310180.png" alt="image-20220822100310180"></p>
<h2 id="04-项目搭建与创作者接口-service-video工程"><a href="#04-项目搭建与创作者接口-service-video工程" class="headerlink" title="04-项目搭建与创作者接口-service-video工程"></a>04-项目搭建与创作者接口-service-video工程</h2><p>创建配置文件 <code>application.yml</code>, 添加配置信息，配置内容如下，需要改为你实际的信息，如下是我的</p>
<p>yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application-dev.yml</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8001</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">service-video</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/video_db?serverTimezone=GMT%2B8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">hikari:</span></span><br><span class="line">      <span class="attr">connection-test-query:</span> <span class="string">SELECT</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">connection-timeout:</span> <span class="number">60000</span></span><br><span class="line">      <span class="attr">idle-timeout:</span> <span class="number">500000</span></span><br><span class="line">      <span class="attr">max-lifetime:</span> <span class="number">540000</span></span><br><span class="line">      <span class="attr">maximum-pool-size:</span> <span class="number">12</span></span><br><span class="line">      <span class="attr">minimum-idle:</span> <span class="number">10</span></span><br><span class="line">      <span class="attr">pool-name:</span> <span class="string">HikariPool</span></span><br><span class="line">  <span class="attr">jackson:</span></span><br><span class="line">    <span class="attr">date-format:</span> <span class="string">yyyy-MM-dd</span> <span class="string">HH:mm:ss</span></span><br><span class="line">    <span class="attr">time-zone:</span> <span class="string">GMT+8</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="comment"># SQL打印</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br></pre></td></tr></table></figure>

<h3 id="使用代码生成器生成代码"><a href="#使用代码生成器生成代码" class="headerlink" title="使用代码生成器生成代码"></a>使用代码生成器生成代码</h3><p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822100404184.png" alt="image-20220822100404184"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CodeGeneratorTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">main1</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 1、创建代码生成器</span></span><br><span class="line">        <span class="type">AutoGenerator</span> <span class="variable">mpg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AutoGenerator</span>();</span><br><span class="line">        <span class="comment">// 2、全局配置</span></span><br><span class="line">        <span class="type">GlobalConfig</span> <span class="variable">gc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GlobalConfig</span>();</span><br><span class="line"></span><br><span class="line">        gc.setOutputDir(<span class="string">&quot;D:\\Develop\\IdeaPro\\video_parent\\service\\service_video\\src\\main\\java&quot;</span>);</span><br><span class="line">        gc.setAuthor(<span class="string">&quot;BNTang&quot;</span>);</span><br><span class="line">        <span class="comment">// 生成后是否打开资源管理器</span></span><br><span class="line">        gc.setOpen(<span class="literal">false</span>);</span><br><span class="line">        <span class="comment">// 重新生成时文件是否覆盖</span></span><br><span class="line">        gc.setFileOverride(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// mp生成 service 层代码，默认接口名称第一个字母有 I</span></span><br><span class="line">        gc.setControllerName(<span class="string">&quot;%sController&quot;</span>);</span><br><span class="line">        gc.setServiceName(<span class="string">&quot;%sService&quot;</span>);</span><br><span class="line">        gc.setServiceImplName(<span class="string">&quot;%sServiceImpl&quot;</span>);</span><br><span class="line">        gc.setMapperName(<span class="string">&quot;%sMapper&quot;</span>);</span><br><span class="line">        gc.setXmlName(<span class="string">&quot;%sMapper&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 主键策略</span></span><br><span class="line">        gc.setIdType(IdType.ID_WORKER_STR);</span><br><span class="line">        <span class="comment">// 定义生成的实体类中日期类型</span></span><br><span class="line">        gc.setDateType(DateType.ONLY_DATE);</span><br><span class="line">        <span class="comment">// 开启Swagger2模式</span></span><br><span class="line">        gc.setSwagger2(<span class="literal">true</span>);</span><br><span class="line">        mpg.setGlobalConfig(gc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、数据源配置</span></span><br><span class="line">        <span class="type">DataSourceConfig</span> <span class="variable">dsc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataSourceConfig</span>();</span><br><span class="line">        dsc.setUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/video_db?serverTimezone=GMT%2B8&quot;</span>);</span><br><span class="line">        dsc.setDriverName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">        dsc.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        dsc.setPassword(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        dsc.setDbType(DbType.MYSQL);</span><br><span class="line">        mpg.setDataSource(dsc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、包配置</span></span><br><span class="line">        <span class="type">PackageConfig</span> <span class="variable">pc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PackageConfig</span>();</span><br><span class="line">        <span class="comment">// 模块名</span></span><br><span class="line">        pc.setModuleName(<span class="string">&quot;service_video&quot;</span>);</span><br><span class="line">        pc.setParent(<span class="string">&quot;top.it6666&quot;</span>);</span><br><span class="line">        pc.setController(<span class="string">&quot;controller&quot;</span>);</span><br><span class="line">        pc.setEntity(<span class="string">&quot;entity&quot;</span>);</span><br><span class="line">        pc.setService(<span class="string">&quot;service&quot;</span>);</span><br><span class="line">        pc.setMapper(<span class="string">&quot;mapper&quot;</span>);</span><br><span class="line">        mpg.setPackageInfo(pc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5、策略配置</span></span><br><span class="line">        <span class="type">StrategyConfig</span> <span class="variable">strategy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StrategyConfig</span>();</span><br><span class="line">        strategy.setInclude(<span class="string">&quot;video_author&quot;</span>);</span><br><span class="line">        <span class="comment">// 数据库表映射到实体的命名策略,驼峰命名</span></span><br><span class="line">        strategy.setNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">        <span class="comment">// 生成实体时去掉表前缀</span></span><br><span class="line">        strategy.setTablePrefix(<span class="string">&quot;video_&quot;</span>);</span><br><span class="line">        <span class="comment">// 数据库表字段映射到实体的命名策略</span></span><br><span class="line">        strategy.setColumnNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">        <span class="comment">// lombok 模型 @Accessors(chain = true) setter链式操作</span></span><br><span class="line">        strategy.setEntityLombokModel(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">// restful api风格控制器</span></span><br><span class="line">        strategy.setRestControllerStyle(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">// url中驼峰转连字符</span></span><br><span class="line">        strategy.setControllerMappingHyphenStyle(<span class="literal">true</span>);</span><br><span class="line">        mpg.setStrategy(strategy);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6、执行</span></span><br><span class="line">        mpg.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如上的配置需要你自行修改为你自己的如上还是那句话是我的实际信息，配置完毕了之后运行启动即可完成生成, 生成完毕之后删除生成器的 <code>java</code> 文件即可</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822100439263.png" alt="image-20220822100439263"></p>
<h3 id="获取作者列表功能"><a href="#获取作者列表功能" class="headerlink" title="获取作者列表功能"></a>获取作者列表功能</h3><p>创建入口文件 <code>service_video</code> 模块启动类，需要注意的是存放的位置，只要按照我放的位置来放即可，原因很简单，扫描的时候会扫描当前层级的文件和子文件，如果你放在某一个包中那么其它包中的文件就会扫描不到了，所以我放到了所有文件的外面这样就可以全部扫描到了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VideoApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(VideoApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822100505743.png" alt="image-20220822100505743"></p>
<p>修改 application.yml 配置文件，小小的改动一下，添加一些额外的配置信息如下，你也可以复制我下面的直接替换之前的全部内容即可，改为你自己的实际信息即可</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822100519934.png" alt="image-20220822100519934"></p>
<p>yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application-dev.yml</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8001</span></span><br><span class="line"></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">pattern:</span></span><br><span class="line">    <span class="attr">console:</span> <span class="string">&quot;%clr(%5p) %clr(-)&#123;faint&#125; %clr(%-80.80logger&#123;79&#125;)&#123;cyan&#125; %clr(:) %m%n&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">service-video</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/video_db?serverTimezone=GMT%2B8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">hikari:</span></span><br><span class="line">      <span class="attr">connection-test-query:</span> <span class="string">SELECT</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">connection-timeout:</span> <span class="number">60000</span></span><br><span class="line">      <span class="attr">idle-timeout:</span> <span class="number">500000</span></span><br><span class="line">      <span class="attr">max-lifetime:</span> <span class="number">540000</span></span><br><span class="line">      <span class="attr">maximum-pool-size:</span> <span class="number">12</span></span><br><span class="line">      <span class="attr">minimum-idle:</span> <span class="number">10</span></span><br><span class="line">      <span class="attr">pool-name:</span> <span class="string">GuliHikariPool</span></span><br><span class="line">  <span class="attr">jackson:</span></span><br><span class="line">    <span class="attr">date-format:</span> <span class="string">yyyy-MM-dd</span> <span class="string">HH:mm:ss</span></span><br><span class="line">    <span class="attr">time-zone:</span> <span class="string">GMT+8</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="comment"># SQL打印</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br></pre></td></tr></table></figure>

<h3 id="配置-mybatis-plus"><a href="#配置-mybatis-plus" class="headerlink" title="配置 mybatis-plus"></a>配置 mybatis-plus</h3><p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822100543490.png" alt="image-20220822100543490"></p>
<h3 id="测试-Controller"><a href="#测试-Controller" class="headerlink" title="测试 Controller"></a>测试 Controller</h3><p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822100555214.png" alt="image-20220822100555214"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 创作者 前端控制器</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2021-03-27</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/service_video/author&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthorController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/getAuthorList&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAuthorList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;getAuthorList&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>启动访问接口，效果如下图</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822100618964.png" alt="image-20220822100618964"></p>
<p>修改 Controller 编写创建者接口</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822100642159.png" alt="image-20220822100642159"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 创作者 前端控制器</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2021-03-27</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/service_video/author&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthorController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用代码生成器生成的 service 当中已经有很多的基础服务，直接调用即可</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AuthorService authorService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AuthorController</span><span class="params">(AuthorService authorService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.authorService = authorService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/getAuthorList&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Author&gt; <span class="title function_">getAuthorList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> authorService.list(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在浏览器中测试接口如下图</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822100659062.png" alt="image-20220822100659062"></p>
<h3 id="逻辑删除"><a href="#逻辑删除" class="headerlink" title="逻辑删除"></a>逻辑删除</h3><p>配置逻辑删除 Bean</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822100713622.png" alt="image-20220822100713622"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 逻辑删除配置Bean</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ISqlInjector <span class="title function_">iSqlInjector</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LogicSqlInjector</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在实体类当中, 添加逻辑删除的注解</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822100824114.png" alt="image-20220822100824114"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TableLogic</span></span><br></pre></td></tr></table></figure>

<p>在控制当中，编写删除的方法</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822100836364.png" alt="image-20220822100836364"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 根据Id删除创作者</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@DeleteMapping(&quot;/deleteAuthor/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">deleteAuthor</span><span class="params">(<span class="meta">@PathVariable</span> String id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> authorService.removeById(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试，如下图</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822100902013.png" alt="image-20220822100902013"></p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822100913772.png" alt="image-20220822100913772"></p>
<h2 id="05-项目搭建与创作者接口-集成SWagger2"><a href="#05-项目搭建与创作者接口-集成SWagger2" class="headerlink" title="05-项目搭建与创作者接口-集成SWagger2"></a>05-项目搭建与创作者接口-集成SWagger2</h2><p>在工程当中创建一个公共模块 common 模块，并且修改打包方式为 <code>pom</code></p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822101101511.png" alt="image-20220822101101511"></p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822101115019.png" alt="image-20220822101115019"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>添加 swagger 依赖</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822101127906.png" alt="image-20220822101127906"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--swagger--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--lombok插件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>common 模块下的 <code>src</code> 删除不需要，在 common 下面创建子模块 <code>common_base</code> 模块</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822101143441.png" alt="image-20220822101143441"></p>
<p>在模块 common_base 中，创建 swagger 的配置类</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822101211665.png" alt="image-20220822101211665"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SwaggerConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Docket <span class="title function_">webApiConfig</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">                .groupName(<span class="string">&quot;webApi&quot;</span>)</span><br><span class="line">                .apiInfo(webApiInfo())</span><br><span class="line">                .select()</span><br><span class="line">                <span class="comment">// 排除指定的路径,不生成api</span></span><br><span class="line">                .paths(Predicates.not(PathSelectors.regex(<span class="string">&quot;/admin/.*&quot;</span>)))</span><br><span class="line">                .paths(Predicates.not(PathSelectors.regex(<span class="string">&quot;/error.*&quot;</span>)))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ApiInfo <span class="title function_">webApiInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ApiInfoBuilder</span>()</span><br><span class="line">                .title(<span class="string">&quot;视频中心API文档&quot;</span>)</span><br><span class="line">                .description(<span class="string">&quot;课程中心微服务接口&quot;</span>)</span><br><span class="line">                .version(<span class="string">&quot;1.0&quot;</span>)</span><br><span class="line">                .contact(<span class="keyword">new</span> <span class="title class_">Contact</span>(<span class="string">&quot;BNTang&quot;</span>, <span class="string">&quot;https://www.cnblogs.com/BNTang&quot;</span>, <span class="string">&quot;303158131@qq.com&quot;</span>))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在模块 service 模块中引入 common_base</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822101241994.png" alt="image-20220822101241994"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--common_base--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>top.it6666<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>common_base<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在 service_video 启动类上添加注解</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202103/2105804-20210327155529319-381022317.png"><img src="https://img2020.cnblogs.com/blog/2105804/202103/2105804-20210327155529319-381022317.png" alt="img"></a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan(basePackages = &#123;&quot;top.it6666&quot;&#125;)</span></span><br></pre></td></tr></table></figure>

<p>然后在 Controller 当中添加 api 注解</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822101305022.png" alt="image-20220822101305022"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 创作者 前端控制器</span></span><br><span class="line"><span class="comment"> * Api 注解代表：分组</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2021-03-27</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/service_video/author&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;作者组&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthorController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用代码生成器生成的 service 当中已经有很多的基础服务，直接调用即可</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AuthorService authorService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AuthorController</span><span class="params">(AuthorService authorService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.authorService = authorService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 获取创作者列表</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;所有的作者列表&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/getAuthorList&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Author&gt; <span class="title function_">getAuthorList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> authorService.list(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 根据Id删除创作者</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;逻辑删除作者&quot;)</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/deleteAuthor/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">deleteAuthor</span><span class="params">(<span class="meta">@ApiParam(name = &quot;id&quot;, value = &quot;作者Id&quot;, required = true)</span> <span class="meta">@PathVariable</span> String id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> authorService.removeById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>详细说明请参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhuhui-site/p/10092322.html">https://www.cnblogs.com/zhuhui-site/p/10092322.html</a></p>
<p>重启工程访问：<a target="_blank" rel="noopener" href="http://localhost:8001/swagger-ui.html">http://localhost:8001/swagger-ui.html</a></p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822101352597.png" alt="image-20220822101352597"></p>
<h3 id="swagger2-汉化"><a href="#swagger2-汉化" class="headerlink" title="swagger2 汉化"></a>swagger2 汉化</h3><p>汉化 2.7 以下的版本，首先在自己项目当中的 <code>resources</code> 中创建 <code>META-INF\resourece</code> 文件夹如下图</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822101405386.png" alt="image-20220822101405386"></p>
<p>需要注意有一个 <code>/</code> 不是以 <code>.</code> 来进行创建</p>
<p>把 <code>swagger-ui.html</code> 复制到自己工程的 <code>META-INF\resourece</code> 中, 添加两行 <code>js</code> js内容如下</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822101421267.png" alt="image-20220822101421267"></p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822101433215.png" alt="image-20220822101433215"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 加入国际化的js --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;webjars/springfox-swagger-ui/lang/translator.js&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;webjars/springfox-swagger-ui/lang/zh-cn.js&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h2 id="06-项目搭建与创作者接口-统一返回数据格式"><a href="#06-项目搭建与创作者接口-统一返回数据格式" class="headerlink" title="06-项目搭建与创作者接口-统一返回数据格式"></a>06-项目搭建与创作者接口-统一返回数据格式</h2><p>在 common 模块中创建 <code>common_utils</code> 子模块</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822101515064.png" alt="image-20220822101515064"></p>
<p>在 <code>top.it6666.common_utils.utils</code> 下创建一个接口为 <code>状态码</code> 新建 <code>ResultCode</code> 内容如下</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822101526664.png" alt="image-20220822101526664"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ResultCode</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 成功状态码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">SUCCESS</span> <span class="operator">=</span> <span class="number">20000</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 失败的状态码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">ERROR</span> <span class="operator">=</span> <span class="number">20001</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>紧接着在 <code>top.it6666.common_utils.utils</code> 下创建一个统一返回结果的类 <code>ResponseResult.java</code></p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822101546226.png" alt="image-20220822101546226"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResponseResult</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">ResponseResult</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;是否成功&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Boolean success;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;状态码&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;返回消息&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;返回的数据&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Object&gt; data = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 提供工具方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ResponseResult <span class="title function_">ok</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ResponseResult</span> <span class="variable">responseResult</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>();</span><br><span class="line">        responseResult.setSuccess(<span class="literal">true</span>);</span><br><span class="line">        responseResult.setCode(ResultCode.SUCCESS);</span><br><span class="line">        responseResult.setMessage(<span class="string">&quot;成功&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> responseResult;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ResponseResult <span class="title function_">error</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ResponseResult</span> <span class="variable">responseResult</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ResponseResult</span>();</span><br><span class="line">        responseResult.setSuccess(<span class="literal">false</span>);</span><br><span class="line">        responseResult.setCode(ResultCode.ERROR);</span><br><span class="line">        responseResult.setMessage(<span class="string">&quot;失败&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> responseResult;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">success</span><span class="params">(Boolean success)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.setSuccess(success);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">message</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.setMessage(message);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">code</span><span class="params">(Integer code)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.setCode(code);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">data</span><span class="params">(String key, Object value)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.data.put(key, value);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">data</span><span class="params">(Map&lt;String, Object&gt; map)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.setData(map);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="重点07-项目搭建与创作者接口-创作者CRUD"><a href="#重点07-项目搭建与创作者接口-创作者CRUD" class="headerlink" title="重点07-项目搭建与创作者接口-创作者CRUD"></a><font color="red">重点07-项目搭建与创作者接口-创作者CRUD</font></h2><h3 id="引入-common-utils"><a href="#引入-common-utils" class="headerlink" title="引入 common_utils"></a>引入 common_utils</h3><p>首先需要引入 common_utils 依赖的模块为 <code>common_base</code></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202103/2105804-20210327164422283-639657652.png"><img src="https://img2020.cnblogs.com/blog/2105804/202103/2105804-20210327164422283-639657652.png" alt="img"></a></p>
<p>xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>top.it6666<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>common_utils<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后紧接着 <code>service</code> 模块也引入了 common_utils 了为啥呢，看下图</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202103/2105804-20210327164711659-341473242.png"><img src="https://img2020.cnblogs.com/blog/2105804/202103/2105804-20210327164711659-341473242.png" alt="img"></a></p>
<h3 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h3><h4 id="配置-Mp-分页插件"><a href="#配置-Mp-分页插件" class="headerlink" title="配置 Mp 分页插件"></a>配置 Mp 分页插件</h4><p>至于修改那个模块中的那个文件我就以为图来表示了，以文字太麻烦了如下图，当然了你可以手写也可以直接拷贝我下方给出来的代码</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822091504788.png" alt="image-20220822091504788"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 配置分页插件</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> PaginationInterceptor <span class="title function_">paginationInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PaginationInterceptor</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在作者控制器中编写分页查询的代码，如下图</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822091533458.png" alt="image-20220822091533458"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 分页查询创作者</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;作者分页列表数据&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/pageList/&#123;page&#125;/&#123;limit&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">pageList</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="meta">@ApiParam(name = &quot;page&quot;, value = &quot;当前页&quot;, required = true)</span> <span class="meta">@PathVariable</span> Long page,</span></span><br><span class="line"><span class="params">        <span class="meta">@ApiParam(name = &quot;limit&quot;, value = &quot;每页记录数&quot;, required = true)</span> <span class="meta">@PathVariable</span> Long limit)</span> &#123;</span><br><span class="line">    <span class="comment">// 分页查询</span></span><br><span class="line">    Page&lt;Author&gt; pageInfo = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page, limit);</span><br><span class="line">    authorService.page(pageInfo, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取当前页的数据</span></span><br><span class="line">    List&lt;Author&gt; records = pageInfo.getRecords();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取总记录</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">total</span> <span class="operator">=</span> pageInfo.getTotal();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ResponseResult.ok().data(<span class="string">&quot;total&quot;</span>, total).data(<span class="string">&quot;rows&quot;</span>, records);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="添加分页条件筛选"><a href="#添加分页条件筛选" class="headerlink" title="添加分页条件筛选"></a>添加分页条件筛选</h3><ul>
<li>需求：根据名称 <code>name</code>，头衔 <code>level</code>、时间 <code>gmt_create</code></li>
<li>把前端传的数据给封装到一个类当中, 放到 <code>VO</code> 包中，新建 <code>VO</code> 包</li>
<li>vo 当中的实体，是用与前端交互封装数据对象的实体类</li>
</ul>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822091625036.png" alt="image-20220822091625036"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthorQuery</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer level;</span><br><span class="line">    <span class="keyword">private</span> String begin;</span><br><span class="line">    <span class="keyword">private</span> String end;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在分页方法当中添加查询的参数，在添加之前需要修改掉请求方式为 Post，get 请求没有办法传递 JSON，mp 生成的基础服务的分页方法满足不了我们自己的需求，这个时候我们需要自己手动的去添加方法并实现，修改 <code>AuthorService.java</code> 添加如下方法</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822091650385.png" alt="image-20220822091650385"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 带条件查询的分页</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> pageInfo    分页信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> authorQuery 查询条件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">pageQuery</span><span class="params">(Page&lt;Author&gt; pageInfo, AuthorQuery authorQuery)</span>;</span><br></pre></td></tr></table></figure>

<p>紧接着就是在对应的实现类当中进行实现该方法</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822091709234.png" alt="image-20220822091709234"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pageQuery</span><span class="params">(Page&lt;Author&gt; pageInfo, AuthorQuery authorQuery)</span> &#123;</span><br><span class="line">    QueryWrapper&lt;Author&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    queryWrapper.orderByAsc(<span class="string">&quot;sort&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (Objects.isNull(authorQuery)) &#123;</span><br><span class="line">        <span class="comment">// 没有条件</span></span><br><span class="line">        baseMapper.selectPage(pageInfo, queryWrapper);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 有条件，判断条件是否为空</span></span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(authorQuery.getName())) &#123;</span><br><span class="line">        <span class="comment">// 模糊查询 name</span></span><br><span class="line">        queryWrapper.like(<span class="string">&quot;name&quot;</span>, authorQuery.getName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!Objects.isNull(authorQuery.getLevel())) &#123;</span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;level&quot;</span>, authorQuery.getLevel());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询创建的时间大于等于开始时间</span></span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(authorQuery.getBegin())) &#123;</span><br><span class="line">        queryWrapper.ge(<span class="string">&quot;gmt_create&quot;</span>, authorQuery.getBegin());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询创建的时间在小于等于结束时间</span></span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(authorQuery.getEnd())) &#123;</span><br><span class="line">        queryWrapper.le(<span class="string">&quot;gmt_create&quot;</span>, authorQuery.getEnd());</span><br><span class="line">    &#125;</span><br><span class="line">    baseMapper.selectPage(pageInfo, queryWrapper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改 <code>AuthorController</code> 修改内容如下图，当然你可以直接拷贝我下面的代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 分页查询创作者,还可以添加过滤条件进行查询</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;作者分页列表数据&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/pageList/&#123;page&#125;/&#123;limit&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">pageList</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="meta">@ApiParam(name = &quot;page&quot;, value = &quot;当前页&quot;, required = true)</span> <span class="meta">@PathVariable</span> Long page,</span></span><br><span class="line"><span class="params">        <span class="meta">@ApiParam(name = &quot;limit&quot;, value = &quot;每页记录数&quot;, required = true)</span> <span class="meta">@PathVariable</span> Long limit,</span></span><br><span class="line"><span class="params">        <span class="meta">@ApiParam(name = &quot;authorQuery&quot;, value = &quot;查询对象&quot;)</span></span></span><br><span class="line"><span class="params">        <span class="meta">@RequestBody(required = false)</span> AuthorQuery authorQuery)</span> &#123;</span><br><span class="line">    <span class="comment">// 分页查询</span></span><br><span class="line">    Page&lt;Author&gt; pageInfo = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page, limit);</span><br><span class="line"></span><br><span class="line">    authorService.pageQuery(pageInfo, authorQuery);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取当前页的数据</span></span><br><span class="line">    List&lt;Author&gt; records = pageInfo.getRecords();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取总记录</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">total</span> <span class="operator">=</span> pageInfo.getTotal();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ResponseResult.ok().data(<span class="string">&quot;total&quot;</span>, total).data(<span class="string">&quot;rows&quot;</span>, records);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>改造完毕之后访问 swagger 页面进行测试一下接口效果如下图</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822091358244.png" alt="image-20220822091358244"></p>
<h3 id="根据-ID-查询"><a href="#根据-ID-查询" class="headerlink" title="根据 ID 查询"></a>根据 ID 查询</h3><p>测试自行访问 swagger 自测，后续不在贴图，代码如下修改 <code>AuthorController.java</code></p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822091830384.png" alt="image-20220822091830384"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 根据id查询作者</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id 作者Id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 查询到的作者</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;根据id查询作者&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/getAuthorWithId/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">getAuthorWithId</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="meta">@ApiParam(name = &quot;id&quot;, value = &quot;作者的id&quot;, required = true)</span> <span class="meta">@PathVariable</span> String id)</span> &#123;</span><br><span class="line">    <span class="type">Author</span> <span class="variable">author</span> <span class="operator">=</span> authorService.getById(id);</span><br><span class="line">    <span class="keyword">return</span> ResponseResult.ok().data(<span class="string">&quot;item&quot;</span>, author);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="添加作者"><a href="#添加作者" class="headerlink" title="添加作者"></a>添加作者</h3><h4 id="配置自动填充"><a href="#配置自动填充" class="headerlink" title="配置自动填充"></a>配置自动填充</h4><p>移动 mp 依赖的位置原先 mp 依赖是放在 service 模块当中，现在移动到 common_base 当中因为我们在 service 引入了 common_base 所以就会包含 mp 的依赖</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822091924443.png" alt="image-20220822091924443"></p>
<p>创建处理器, 设置自动填充日期</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822091936547.png" alt="image-20220822091936547"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyMetaObjectHandler</span> <span class="keyword">implements</span> <span class="title class_">MetaObjectHandler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;gmtCreate&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), metaObject);</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;gmtModified&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), metaObject);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;gmtModified&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), metaObject);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在实体类当中添加自动填充的注解</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822091955609.png" alt="image-20220822091955609"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br></pre></td></tr></table></figure>

<p>然后继续完善添加创作者的接口，修改 <code>AuthorController</code></p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822092025051.png" alt="image-20220822092025051"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 添加作者</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> author 需要添加的创作者</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 添加结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;添加作者&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/addAuthor&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">addAuthor</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="meta">@ApiParam(name = &quot;author&quot;, value = &quot;作者对象&quot;, required = true)</span> <span class="meta">@RequestBody</span> Author author)</span> &#123;</span><br><span class="line">    authorService.save(author);</span><br><span class="line">    <span class="keyword">return</span> ResponseResult.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="更新创作者"><a href="#更新创作者" class="headerlink" title="更新创作者"></a>更新创作者</h3><p>修改 <code>AuthorController</code></p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822092101023.png" alt="image-20220822092101023"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 更新创作者</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> author 更新的创作者</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 更新结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;更新创作者&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/updateAuthor&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">updateAuthor</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="meta">@ApiParam(name = &quot;author&quot;, value = &quot;作者对象&quot;, required = true)</span> <span class="meta">@RequestBody</span> Author author)</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> authorService.updateById(author);</span><br><span class="line">    <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.error();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="08-项目搭建与创作者接口-统一异常与日志处理"><a href="#08-项目搭建与创作者接口-统一异常与日志处理" class="headerlink" title="08-项目搭建与创作者接口-统一异常与日志处理"></a>08-项目搭建与创作者接口-统一异常与日志处理</h2><h3 id="统一异常处理简介"><a href="#统一异常处理简介" class="headerlink" title="统一异常处理简介"></a>统一异常处理简介</h3><p>让异常结果显示为统一的样式结构，例如</p>
<ul>
<li>错误信息</li>
<li>错误提示</li>
</ul>
<p>可以使用 <code>@ControllerAdvice</code> 这个注解来进行实现这是 SpringMVC 提供的</p>
<h3 id="实用步骤"><a href="#实用步骤" class="headerlink" title="实用步骤"></a>实用步骤</h3><p>在 common_base 模块中引入依赖, 想要使用这个注解得要有 SpringMVC Web 相关的依赖才可以，所以这里需要将 Spring Web 启动器的依赖移动到 common_base 当中如下图，为啥要移动呢，因为 service_video 模块中依赖了 common_base 所以你把依赖移动到了 common_base 中 自然而然的 service_video 当中也会有，后面我们还有其它很多的依赖，都直接依赖一下这个 common_base 模块即可完成依赖共享</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202103/2105804-20210328020312692-2125813272.png"><img src="https://img2020.cnblogs.com/blog/2105804/202103/2105804-20210328020312692-2125813272.png" alt="img"></a></p>
<p>xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="编辑全局异常处理器"><a href="#编辑全局异常处理器" class="headerlink" title="编辑全局异常处理器"></a>编辑全局异常处理器</h3><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202103/2105804-20210328020500021-1433466444.png"><img src="https://img2020.cnblogs.com/blog/2105804/202103/2105804-20210328020500021-1433466444.png" alt="img"></a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * 全局异常处理器, 只要发生了异常,如果在自己控制当中.没有去捕获,就会到此控制器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">error</span><span class="params">(Exception e)</span> &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.error();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202103/2105804-20210328020651188-351983063.png"><img src="https://img2020.cnblogs.com/blog/2105804/202103/2105804-20210328020651188-351983063.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202103/2105804-20210328020635233-392679624.png"><img src="https://img2020.cnblogs.com/blog/2105804/202103/2105804-20210328020635233-392679624.png" alt="img"></a></p>
<h2 id="09-创作者前端-前后端分离与建立前端工程"><a href="#09-创作者前端-前后端分离与建立前端工程" class="headerlink" title="09-创作者前端-前后端分离与建立前端工程"></a>09-创作者前端-前后端分离与建立前端工程</h2><h3 id="什么是前后端分离"><a href="#什么是前后端分离" class="headerlink" title="什么是前后端分离"></a>什么是前后端分离</h3><ul>
<li>前端单独进行部署</li>
<li>后端也是单独进行部署</li>
<li>两个系统之间使用 JSON 进行传输</li>
</ul>
<h3 id="建立前端工程"><a href="#建立前端工程" class="headerlink" title="建立前端工程"></a>建立前端工程</h3><p>前端是基于 Vue 来进行开发的，所以我本次使用的 UI 为 vue-element-amdin 进行二次开发, 不过使用的是 template 模板 admin 那套内容太多了，所以在这里我将一步一步的来完善该系统</p>
<p>前端使用的开发工具为 WebStorm 可以和我一样也可以不一样，本次编写博主使用的为 WebStorm</p>
<h3 id="UI-模板的目录结构"><a href="#UI-模板的目录结构" class="headerlink" title="UI 模板的目录结构"></a>UI 模板的目录结构</h3><p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822093314873.png" alt="image-20220822093314873"></p>
<p>下载模板，<a target="_blank" rel="noopener" href="https://github.com/PanJiaChen/vue-admin-template">https://github.com/PanJiaChen/vue-admin-template</a></p>
<p>如果对 Git 了解可以使用 SSH 的方式进行下载，没有的话就直接下载 zip 即可，下载解压之后的效果图如下</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822093347325.png" alt="image-20220822093347325"></p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822093358319.png" alt="image-20220822093358319"></p>
<p>在跑起来这个前端之前你需要准备一个东西就是安装 Node.js 看本教程的时候如果你基础不好我建议还是先去学学前面的内容，在来回头看本教程，Node.js 的安装方式参考链接为：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/BNTang/p/13674486.html">https://www.cnblogs.com/BNTang/p/13674486.html</a></p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822093425315.png" alt="image-20220822093425315"></p>
<p>还有就是需要配置一下包的下载源对象，默认是从国外进行下载，博主已经改好了，改到了国内的阿里源，切换方式上图的文章列表当中也有如下图</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822093439735.png" alt="image-20220822093439735"></p>
<p>配置 Node</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822093453822.png" alt="image-20220822093453822"></p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822093501359.png" alt="image-20220822093501359"></p>
<p>如上图打开终端，然后下载前端对应的包在终端当中执行如下脚本</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 建议不要用 cnpm 安装 会有各种诡异的bug 可以通过如下操作解决 npm 下载速度慢的问题</span></span><br><span class="line">npm install --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>

<p>配置运行脚本如下图，就不用每次运行都在终端当中自己打对应的运行脚本了</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822093531645.png" alt="image-20220822093531645"></p>
<p>如上如果都配置好了，那么就直接点击启动的按钮启动工程，最终得到的效果图如下</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822093551838.png" alt="image-20220822093551838"></p>
<h3 id="前端开发步骤"><a href="#前端开发步骤" class="headerlink" title="前端开发步骤"></a>前端开发步骤</h3><p>路径对应路由, 路由当中会对应我们的页面</p>
<p>添加路由</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822093610990.png" alt="image-20220822093610990"></p>
<p>引入路由的页面</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822093627561.png" alt="image-20220822093627561"></p>
<p>进入到组件当中, 编写页面, 加载对应的 js, 发送网络请求</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822093642271.png" alt="image-20220822093642271"></p>
<p>发送网络请求</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822093702953.png" alt="image-20220822093702953"></p>
<p>在 api 当中创建对应的 js 文件, 定义接口地址参数</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822093714951.png" alt="image-20220822093714951"></p>
<h3 id="前端界面修改"><a href="#前端界面修改" class="headerlink" title="前端界面修改"></a>前端界面修改</h3><h4 id="添加Log"><a href="#添加Log" class="headerlink" title="添加Log"></a>添加Log</h4><p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822093839631.png" alt="image-20220822093839631"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;logo_img&quot;</span> <span class="attr">src</span>=<span class="string">&quot;@/assets/logo_image/logo.jpg&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>添加样式</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822093918100.png" alt="image-20220822093918100"></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.title</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">35px</span>;</span><br><span class="line">  <span class="attribute">color</span>: $light_gray;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> auto <span class="number">20px</span> auto;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">padding-top</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.logo_img</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">60px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">60px</span>;</span><br><span class="line">  <span class="attribute">margin-right</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">vertical-align</span>: top;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="attribute">margin-bottom</span>: <span class="number">20px</span>;</span><br></pre></td></tr></table></figure>

<h4 id="修改-favicon-ico"><a href="#修改-favicon-ico" class="headerlink" title="修改 favicon.ico"></a>修改 favicon.ico</h4><p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822094108039.png" alt="image-20220822094108039"></p>
<h4 id="修改-Title"><a href="#修改-Title" class="headerlink" title="修改 Title"></a>修改 Title</h4><p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822094124147.png" alt="image-20220822094124147"></p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822094132583.png" alt="image-20220822094132583"></p>
<h3 id="前端请求流程"><a href="#前端请求流程" class="headerlink" title="前端请求流程"></a>前端请求流程</h3><p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822094149274.png" alt="image-20220822094149274"></p>
<h3 id="替换前端请求服务器地址"><a href="#替换前端请求服务器地址" class="headerlink" title="替换前端请求服务器地址"></a>替换前端请求服务器地址</h3><p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822094211697.png" alt="image-20220822094211697"></p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822094219303.png" alt="image-20220822094219303"></p>
<h3 id="编写服务器登录请求接口"><a href="#编写服务器登录请求接口" class="headerlink" title="编写服务器登录请求接口"></a>编写服务器登录请求接口</h3><p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822094244888.png" alt="image-20220822094244888"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;用户组&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 登录</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 登录成功之后的信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;登录&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">login</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok().data(<span class="string">&quot;token&quot;</span>, <span class="string">&quot;admin-token&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 登录之后的用户信息</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 登录之后的用户信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/info&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;获取登录之后的用户信息&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">info</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok()</span><br><span class="line">                .data(<span class="string">&quot;roles&quot;</span>, <span class="string">&quot;[admin]&quot;</span>)</span><br><span class="line">                .data(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;BNTang&quot;</span>)</span><br><span class="line">                .data(<span class="string">&quot;avatar&quot;</span>, <span class="string">&quot;https://wpimg.wallstcn.com/f778738c-e4f8-4870-b634-56703b4acafe.gif&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在前端调用请求的时候会产生跨域的问题，至于什么是跨域我就不在介绍了，自行问度娘，后续我在出文章进行讲解，目前没有统一的处理跨域所以需要在每一个 Controller 添加一个允许跨域访问的注解就是 <code>@CrossOrigin</code> 没有指定路径，代表当前下的所有都允许跨域访问</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822094309488.png" alt="image-20220822094309488"></p>
<p>然后在修改 <code>user.js</code> 中的 api 为我们自己后台的地址修改文件和修改内容如下图所示</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822094325957.png" alt="image-20220822094325957"></p>
<h2 id="10-创作者前端-创作者列表"><a href="#10-创作者前端-创作者列表" class="headerlink" title="10-创作者前端-创作者列表"></a>10-创作者前端-创作者列表</h2><h3 id="修改路由跳转"><a href="#修改路由跳转" class="headerlink" title="修改路由跳转"></a>修改路由跳转</h3><h4 id="修改路由"><a href="#修改路由" class="headerlink" title="修改路由"></a>修改路由</h4><p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822094606319.png" alt="image-20220822094606319"></p>
<p>需要注意把如下图的地方给注释掉，不要纠结为啥，因为路由重复了</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822094619517.png" alt="image-20220822094619517"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">Layout</span>,</span><br><span class="line">    <span class="comment">// redirect: &#x27;/dashboard&#x27;,</span></span><br><span class="line">    <span class="attr">children</span>: [&#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;首页&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/dashboard/index&#x27;</span>),</span><br><span class="line">      <span class="attr">meta</span>: &#123;<span class="attr">title</span>: <span class="string">&#x27;首页&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;dashboard&#x27;</span>&#125;</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/author&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">Layout</span>,</span><br><span class="line">    <span class="attr">redirect</span>: <span class="string">&#x27;/author/table&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;创作者管理&#x27;</span>,</span><br><span class="line">    <span class="attr">meta</span>: &#123;<span class="attr">title</span>: <span class="string">&#x27;创作者管理&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;el-icon-s-help&#x27;</span>&#125;,</span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;table&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;创作者列表&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/video/author/list&#x27;</span>),</span><br><span class="line">        <span class="attr">meta</span>: &#123;<span class="attr">title</span>: <span class="string">&#x27;创作者列表&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;table&#x27;</span>&#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;save&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;添加创作者&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/video/author/save&#x27;</span>),</span><br><span class="line">        <span class="attr">meta</span>: &#123;<span class="attr">title</span>: <span class="string">&#x27;添加创作者&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;tree&#x27;</span>&#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>在上图中我新建了两个组件，如何新建的呢，快捷键为 Ctrl + Alt + Shift + insert 即可弹出如下的框子选择 <code>Vue Component</code> 如下图</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822094645077.png" alt="image-20220822094645077"></p>
<p>不使用快捷键的话那么就直接在需要添加组件的文件包上面鼠标右键选择 <code>New</code> 也可以出现如上图的选项卡</p>
<h4 id="创建组件"><a href="#创建组件" class="headerlink" title="创建组件"></a>创建组件</h4><p>一个 list，一个 save 内容如下图所示</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822094708464.png" alt="image-20220822094708464"></p>
<h3 id="编写-api-请求数据"><a href="#编写-api-请求数据" class="headerlink" title="编写 api 请求数据"></a>编写 api 请求数据</h3><h4 id="列表数据请求"><a href="#列表数据请求" class="headerlink" title="列表数据请求"></a>列表数据请求</h4><p>在 api 文件夹当中创建请求的 js 文件</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822094731028.png" alt="image-20220822094731028"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// 1.作者列表-分页查询</span></span><br><span class="line">  <span class="title function_">getAuthorListPage</span>(<span class="params">page, limit, authorQuery</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="comment">// 路由参数拼接</span></span><br><span class="line">      <span class="attr">url</span>: <span class="string">`/service_video/author/pageList/<span class="subst">$&#123;page&#125;</span>/<span class="subst">$&#123;limit&#125;</span>/`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">      <span class="comment">// data 会自动转成 json 传递到接口当中</span></span><br><span class="line">      <span class="attr">data</span>: authorQuery</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 list.vue 当中引入对应的 js</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822094803302.png" alt="image-20220822094803302"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入 author.js 调用对应的请求方法</span></span><br><span class="line"><span class="keyword">import</span> author <span class="keyword">from</span> <span class="string">&#x27;@/api/video/author/author&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>定义成员变量, 发送请求</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822094833495.png" alt="image-20220822094833495"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;list&quot;</span>,</span><br><span class="line">  <span class="comment">// 定义变量与初始值</span></span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="comment">// 查询的结果集</span></span><br><span class="line">      <span class="attr">list</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="comment">// 当前页</span></span><br><span class="line">      <span class="attr">page</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="comment">// 每页多少条记录</span></span><br><span class="line">      <span class="attr">limit</span>: <span class="number">10</span>,</span><br><span class="line">      <span class="comment">// 总记录数</span></span><br><span class="line">      <span class="attr">total</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="comment">// 查询封装的对象</span></span><br><span class="line">      <span class="attr">authorQuery</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 自定义方法</span></span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">getAuthorList</span>(<span class="params">page = <span class="number">1</span></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">page</span> = page</span><br><span class="line">      author.<span class="title function_">getAuthorListPage</span>(<span class="variable language_">this</span>.<span class="property">page</span>, <span class="variable language_">this</span>.<span class="property">limit</span>, <span class="variable language_">this</span>.<span class="property">authorQuery</span>)</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// 处理请求成功</span></span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(resp);</span><br><span class="line">        &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 请求失败</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 页面渲染之前会自动调用此方法</span></span><br><span class="line">  <span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getAuthorList</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在后端服务器接口当中添加跨域注解</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822094901722.png" alt="image-20220822094901722"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@CrossOrigin</span><br></pre></td></tr></table></figure>

<p>前端和后端工程都启动点击创作者列表效果如下图所示</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822094920001.png" alt="image-20220822094920001"></p>
<h3 id="Element-ui-表格组件"><a href="#Element-ui-表格组件" class="headerlink" title="Element-ui 表格组件"></a>Element-ui 表格组件</h3><p><a target="_blank" rel="noopener" href="https://element.eleme.io/#/zh-CN/component/table">https://element.eleme.io/#/zh-CN/component/table</a></p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822094939664.png" alt="image-20220822094939664"></p>
<h3 id="数据展示"><a href="#数据展示" class="headerlink" title="数据展示"></a>数据展示</h3><p>创作者列表数据展示</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822094954496.png" alt="image-20220822094954496"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line">表格</span><br><span class="line">--&gt;</span><br><span class="line">&lt;el-table</span><br><span class="line">  :data=&quot;list&quot;</span><br><span class="line">  border</span><br><span class="line">  fit</span><br><span class="line">  highlight-current-row&gt;</span><br><span class="line">  &lt;el-table-column label=&quot;序号&quot; align=&quot;center&quot;/&gt;</span><br><span class="line">  &lt;el-table-column label=&quot;名称&quot; align=&quot;center&quot; prop=&quot;name&quot;/&gt;</span><br><span class="line">  &lt;el-table-column label=&quot;级别&quot; align=&quot;center&quot;/&gt;</span><br><span class="line">  &lt;el-table-column label=&quot;创作者简介&quot; align=&quot;center&quot; prop=&quot;intro&quot;/&gt;</span><br><span class="line">  &lt;el-table-column label=&quot;添加时间&quot; align=&quot;center&quot; prop=&quot;gmtCreate&quot;/&gt;</span><br><span class="line">  &lt;el-table-column label=&quot;排序&quot; align=&quot;center&quot; prop=&quot;sort&quot;/&gt;</span><br><span class="line">  &lt;el-table-column label=&quot;操作&quot; align=&quot;center&quot;&gt;</span><br><span class="line">    &lt;el-button type=&quot;primary&quot; size=&quot;mini&quot; icon=&quot;el-icon-edit&quot;&gt;修改&lt;/el-button&gt;</span><br><span class="line">    &lt;el-button type=&quot;danger&quot; size=&quot;mini&quot; icon=&quot;el-icon-delete&quot;&gt;删除&lt;/el-button&gt;</span><br><span class="line">  &lt;/el-table-column&gt;</span><br><span class="line">&lt;/el-table&gt;</span><br></pre></td></tr></table></figure>

<p>处理请求成功的回调如下</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822095030797.png" alt="image-20220822095030797"></p>
<p>序号与级别处理</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822095044548.png" alt="image-20220822095044548"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 通过 slot 拿到表格当中绑定的数据 --&gt;</span><br><span class="line">&lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">  &#123;&#123; scope.$index + 1 &#125;&#125;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 通过 slot 拿到表格当中绑定的数据 --&gt;</span><br><span class="line">&lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">  &#123;&#123; scope.row.level === 1 ? &quot;普通创作者&quot; : &quot;特约创作者&quot; &#125;&#125;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<h2 id="11-创作者前端-添加分页"><a href="#11-创作者前端-添加分页" class="headerlink" title="11-创作者前端-添加分页"></a>11-创作者前端-添加分页</h2><h3 id="使用-Element-ui-分页组件"><a href="#使用-Element-ui-分页组件" class="headerlink" title="使用 Element-ui 分页组件"></a>使用 Element-ui 分页组件</h3><p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822095205115.png" alt="image-20220822095205115"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--分页--&gt;</span><br><span class="line">&lt;el-pagination</span><br><span class="line">  style=&quot;padding: 30px 0; text-align: center&quot;</span><br><span class="line">  background</span><br><span class="line">  :current-page=&quot;page&quot;</span><br><span class="line">  :page-size=&quot;limit&quot;</span><br><span class="line">  layout=&quot;total, prev, pager, next, jumper &quot;</span><br><span class="line">  :total=&quot;total&quot;</span><br><span class="line">  @current-change=&quot;getAuthorList&quot;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>

<p>定义请求方法，如下的方法代码之前的文章已经有了不在贴</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822095225792.png" alt="image-20220822095225792"></p>
<p>修改使用汉字 Element-UI 显示，不然分页信息是英文如下图</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822095237297.png" alt="image-20220822095237297"></p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822095245211.png" alt="image-20220822095245211"></p>
<p>修改 main.js 即可进行切换为汉字显示</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822095256116.png" alt="image-20220822095256116"></p>
<h2 id="12-创作者前端-条件查询"><a href="#12-创作者前端-条件查询" class="headerlink" title="12-创作者前端-条件查询"></a>12-创作者前端-条件查询</h2><h3 id="添加查询表单"><a href="#添加查询表单" class="headerlink" title="添加查询表单"></a>添加查询表单</h3><p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822103039430.png" alt="image-20220822103039430"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 表单查询 --&gt;</span><br><span class="line">&lt;el-form :inline=&quot;true&quot; :model=&quot;authorQuery&quot; class=&quot;demo-form-inline&quot;&gt;</span><br><span class="line">  &lt;!-- 姓名 --&gt;</span><br><span class="line">  &lt;el-form-item label=&quot;姓名&quot;&gt;</span><br><span class="line">    &lt;el-input v-model=&quot;authorQuery.name&quot; placeholder=&quot;姓名&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">  &lt;/el-form-item&gt;</span><br><span class="line">  &lt;!-- 下拉列表 --&gt;</span><br><span class="line">  &lt;el-form-item label=&quot;级别&quot;&gt;</span><br><span class="line">    &lt;el-select v-model=&quot;authorQuery.level&quot; clearable placeholder=&quot;选择级别&quot;&gt;</span><br><span class="line">      &lt;el-option label=&quot;特约创作者&quot; value=&quot;0&quot;&gt;&lt;/el-option&gt;</span><br><span class="line">      &lt;el-option label=&quot;普通创作者&quot; value=&quot;1&quot;&gt;&lt;/el-option&gt;</span><br><span class="line">    &lt;/el-select&gt;</span><br><span class="line">  &lt;/el-form-item&gt;</span><br><span class="line">  &lt;!--日期选择--&gt;</span><br><span class="line">  &lt;el-form-item&gt;</span><br><span class="line">    &lt;el-date-picker</span><br><span class="line">      v-model=&quot;authorQuery.begin&quot;</span><br><span class="line">      type=&quot;datetime&quot;</span><br><span class="line">      value-format=&quot;yyyy-MM-dd HH:mm:ss&quot;</span><br><span class="line">      default-time=&quot;00:00:00&quot;</span><br><span class="line">      placeholder=&quot;选择开始时间&quot;&gt;</span><br><span class="line">    &lt;/el-date-picker&gt;</span><br><span class="line">  &lt;/el-form-item&gt;</span><br><span class="line">  &lt;el-form-item&gt;</span><br><span class="line">    &lt;el-date-picker</span><br><span class="line">      v-model=&quot;authorQuery.end&quot;</span><br><span class="line">      type=&quot;datetime&quot;</span><br><span class="line">      value-format=&quot;yyyy-MM-dd HH:mm:ss&quot;</span><br><span class="line">      default-time=&quot;00:00:00&quot;</span><br><span class="line">      placeholder=&quot;选择截止时间&quot;&gt;</span><br><span class="line">    &lt;/el-date-picker&gt;</span><br><span class="line">  &lt;/el-form-item&gt;</span><br><span class="line">  &lt;el-form-item&gt;</span><br><span class="line">    &lt;el-button type=&quot;primary&quot; @click=&quot;getAuthorList()&quot;&gt;查询&lt;/el-button&gt;</span><br><span class="line">    &lt;el-button type=&quot;default&quot; @click=&quot;resetData()&quot;&gt;清空&lt;/el-button&gt;</span><br><span class="line">  &lt;/el-form-item&gt;</span><br><span class="line">&lt;/el-form&gt;</span><br></pre></td></tr></table></figure>

<h3 id="添加清空查询条件数据方法"><a href="#添加清空查询条件数据方法" class="headerlink" title="添加清空查询条件数据方法"></a>添加清空查询条件数据方法</h3><p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822103111816.png" alt="image-20220822103111816"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 清空查询的数据</span></span><br><span class="line"><span class="title function_">resetData</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 清空表单</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">authorQuery</span> = &#123;&#125;;</span><br><span class="line">  <span class="comment">// 重新查询</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">getAuthorList</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="13-创作者前端-逻辑删除创作者"><a href="#13-创作者前端-逻辑删除创作者" class="headerlink" title="13-创作者前端-逻辑删除创作者"></a>13-创作者前端-逻辑删除创作者</h2><p>监听删除按钮的点击，然后传入当前删除记录的 id 进行逻辑删除</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-table-column label=&quot;操作&quot; align=&quot;center&quot;&gt;</span><br><span class="line">  &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">    &lt;el-button type=&quot;primary&quot; size=&quot;mini&quot; icon=&quot;el-icon-edit&quot;&gt;修改&lt;/el-button&gt;</span><br><span class="line">    &lt;el-button type=&quot;danger&quot; size=&quot;mini&quot; icon=&quot;el-icon-delete&quot;</span><br><span class="line">               @click=&quot;deleteAuthorWithId(scope.row.id)&quot;&gt;删除</span><br><span class="line">    &lt;/el-button&gt;</span><br><span class="line">  &lt;/template&gt;</span><br><span class="line">&lt;/el-table-column&gt;</span><br></pre></td></tr></table></figure>

<h3 id="实现删除的方法"><a href="#实现删除的方法" class="headerlink" title="实现删除的方法"></a>实现删除的方法</h3><p>编写删除的前端 api</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822103233861.png" alt="image-20220822103233861"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2.删除作者</span></span><br><span class="line"><span class="title function_">deleteAuthorWithId</span>(<span class="params">id</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="comment">// 路由参数拼接</span></span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/service_video/author/deleteAuthor/<span class="subst">$&#123;id&#125;</span>/`</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;delete&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改后端的接口</p>
<p><img src="C:\Users\hp\AppData\Roaming\Typora\typora-user-images\image-20220822103312250.png" alt="image-20220822103312250"></p>
<p>实现前端删除的方法</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202103/2105804-20210330221422438-727638782.png"><img src="https://img2020.cnblogs.com/blog/2105804/202103/2105804-20210330221422438-727638782.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除创作者</span></span><br><span class="line"><span class="title function_">deleteAuthorWithId</span>(<span class="params">id</span>) &#123;</span><br><span class="line">  <span class="comment">// 用户提示</span></span><br><span class="line">  <span class="variable language_">this</span>.$confirm(<span class="string">&#x27;此操作将永久删除该创作者！, 是否继续?&#x27;</span>, <span class="string">&#x27;提示&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">confirmButtonText</span>: <span class="string">&#x27;确定&#x27;</span>,</span><br><span class="line">    <span class="attr">cancelButtonText</span>: <span class="string">&#x27;取消&#x27;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;warning&#x27;</span></span><br><span class="line">  &#125;).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 调用删除的api</span></span><br><span class="line">    author.<span class="title function_">deleteAuthorWithId</span>(id).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">        <span class="attr">message</span>: response.<span class="property">message</span></span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="comment">// 重新加载数据</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">getAuthorList</span>();</span><br><span class="line">    &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">&#x27;删除失败！&#x27;</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;).<span class="title function_">catch</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;info&#x27;</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;已取消删除&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="14-创作者前端-添加创作者"><a href="#14-创作者前端-添加创作者" class="headerlink" title="14-创作者前端-添加创作者"></a>14-创作者前端-添加创作者</h2><p>编写添加界面</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202103/2105804-20210330230336007-771215017.png"><img src="https://img2020.cnblogs.com/blog/2105804/202103/2105804-20210330230336007-771215017.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line">    &lt;el-form label-width=&quot;120px&quot;&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;作者名称&quot;&gt;</span><br><span class="line">        &lt;el-input v-model=&quot;author.name&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">      &lt;el-form-item label=&quot;排序&quot;&gt;</span><br><span class="line">        &lt;el-input-number v-model=&quot;author.sort&quot; controls-position=&quot;right&quot; :min=&quot;0&quot;/&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">      &lt;el-form-item label=&quot;级别&quot;&gt;</span><br><span class="line">        &lt;el-select v-model=&quot;author.level&quot; clearable placeholder=&quot;选择级别&quot;&gt;</span><br><span class="line">          &lt;el-option label=&quot;特约创作者&quot; value=&quot;0&quot;&gt;&lt;/el-option&gt;</span><br><span class="line">          &lt;el-option label=&quot;普通创作者&quot; value=&quot;1&quot;&gt;&lt;/el-option&gt;</span><br><span class="line">        &lt;/el-select&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">      &lt;el-form-item label=&quot;工作经历&quot;&gt;</span><br><span class="line">        &lt;el-input v-model=&quot;author.career&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">      &lt;el-form-item label=&quot;创作者简介&quot;&gt;</span><br><span class="line">        &lt;el-input v-model=&quot;author.intro&quot; type=&quot;textarea&quot; :rows=&quot;10&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">      &lt;el-form-item&gt;</span><br><span class="line">        &lt;el-button :disabled=&quot;false&quot; type=&quot;primary&quot; @click=&quot;saveClick()&quot;&gt;保存&lt;/el-button&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">    &lt;/el-form&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<p>编写添加接口 api</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202103/2105804-20210330225328891-1735778743.png"><img src="https://img2020.cnblogs.com/blog/2105804/202103/2105804-20210330225328891-1735778743.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 3.添加</span></span><br><span class="line"><span class="title function_">addAuthor</span>(<span class="params">author</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/service_video/author/addAuthor`</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">    <span class="comment">// data 会自动转成 json 传递到接口当中</span></span><br><span class="line">    <span class="attr">data</span>: author</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>引入添加的接口，处理添加的请求</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202103/2105804-20210330230455891-779233552.png"><img src="https://img2020.cnblogs.com/blog/2105804/202103/2105804-20210330230455891-779233552.png" alt="img"></a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">import</span> author <span class="keyword">from</span> <span class="string">&quot;@/api/video/author/author&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;save&quot;</span>,</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">author</span>: &#123;</span><br><span class="line">        <span class="comment">// 排序默认值</span></span><br><span class="line">        <span class="attr">sort</span>: <span class="number">0</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">saveClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">//保存，添加 / 更新</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">addAuthor</span>();</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 添加</span></span><br><span class="line">    <span class="title function_">addAuthor</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">// 调用接口，做添加操作</span></span><br><span class="line">      author.<span class="title function_">addAuthor</span>(<span class="variable language_">this</span>.<span class="property">author</span>).<span class="title function_">then</span>(<span class="function"><span class="params">resposne</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 添加成功</span></span><br><span class="line">        <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">          <span class="attr">message</span>: resposne.<span class="property">message</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 跳转到列表页</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123;<span class="attr">path</span>: <span class="string">&#x27;/author/table&#x27;</span>&#125;)</span><br><span class="line">      &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">&#x27;添加失败！&#x27;</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="15-创作者前端-更新创作者"><a href="#15-创作者前端-更新创作者" class="headerlink" title="15-创作者前端-更新创作者"></a>15-创作者前端-更新创作者</h2><p>点击编辑按钮进行页面路由跳转</p>
<p>定义点击编辑按钮的路由如下图</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202103/2105804-20210331223622642-1994713130.png"><img src="https://img2020.cnblogs.com/blog/2105804/202103/2105804-20210331223622642-1994713130.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;edit/:id&#x27;</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;编辑&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/video/author/save&#x27;</span>),</span><br><span class="line">  <span class="attr">meta</span>: &#123;<span class="attr">title</span>: <span class="string">&#x27;编辑&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;tree&#x27;</span>&#125;,</span><br><span class="line">  <span class="attr">hidden</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改编辑按钮，修改点击编辑按钮跳转的路由地址，使用 <code>router-link</code> 如下图</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202103/2105804-20210331223720885-472657697.png"><img src="https://img2020.cnblogs.com/blog/2105804/202103/2105804-20210331223720885-472657697.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line">修改跳转,让其跳转到路由当中,编辑路由页面和添加的是一样，编辑当中是有参数</span><br><span class="line">--&gt;</span><br><span class="line">&lt;router-link :to=&quot;&#x27;/author/edit/&#x27;+scope.row.id&quot;&gt;</span><br><span class="line">  &lt;el-button type=&quot;primary&quot; size=&quot;mini&quot; icon=&quot;el-icon-edit&quot;&gt;修改&lt;/el-button&gt;</span><br><span class="line">&lt;/router-link&gt;</span><br></pre></td></tr></table></figure>

<h3 id="更新数据回显"><a href="#更新数据回显" class="headerlink" title="更新数据回显"></a>更新数据回显</h3><p>编写请求 api</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202103/2105804-20210331224724096-915205001.png"><img src="https://img2020.cnblogs.com/blog/2105804/202103/2105804-20210331224724096-915205001.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 4.根据id查询作者</span></span><br><span class="line"><span class="title function_">getOneAuthor</span>(<span class="params">id</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="comment">// 路由参数拼接</span></span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/service_video/author/getAuthorWithId/<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>获取参数，然后发送请求</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202103/2105804-20210331225102452-812355676.png"><img src="https://img2020.cnblogs.com/blog/2105804/202103/2105804-20210331225102452-812355676.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 一进来就要获取参数</span></span><br><span class="line"><span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 判断有没有参数，如果有，获取参数</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">params</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">params</span>.<span class="property">id</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> authorId = <span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">params</span>.<span class="property">id</span>;</span><br><span class="line">    <span class="comment">// 根据id获取该条参数对应的数据,发送请求到服务器当中获取数据</span></span><br><span class="line">    author.<span class="title function_">getOneAuthor</span>(authorId).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">author</span> = res.<span class="property">data</span>.<span class="property">item</span>;</span><br><span class="line">    &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">&quot;服务器繁忙，请稍后再试！&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">author</span> = &#123;</span><br><span class="line">      <span class="attr">sort</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">level</span>: <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>让下拉列表进行默认选中</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202103/2105804-20210331224935290-1287713323.png"><img src="https://img2020.cnblogs.com/blog/2105804/202103/2105804-20210331224935290-1287713323.png" alt="img"></a></p>
<h3 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h3><p>添加更新创作者的请求 api</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202103/2105804-20210331230152456-96210100.png"><img src="https://img2020.cnblogs.com/blog/2105804/202103/2105804-20210331230152456-96210100.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 5.更新创作者</span></span><br><span class="line"><span class="title function_">updateAuthor</span>(<span class="params">author</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;/service_video/author/updateAuthor&#x27;</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">    <span class="comment">// data会自动转成JSON传递到接口当中</span></span><br><span class="line">    <span class="attr">data</span>: author</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编写更新创作者请求的方法如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202103/2105804-20210331230316878-1363337643.png"><img src="https://img2020.cnblogs.com/blog/2105804/202103/2105804-20210331230316878-1363337643.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更新</span></span><br><span class="line"><span class="title function_">updateAuthor</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="comment">// 调用更新的api</span></span><br><span class="line">  author.<span class="title function_">updateAuthor</span>(<span class="variable language_">this</span>.<span class="property">author</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">// 更新成功</span></span><br><span class="line">    <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;更新成功!&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">&quot;更新失败！&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// 跳转到创作者列表页</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123;<span class="attr">path</span>: <span class="string">&#x27;/author/table&#x27;</span>&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改之前的添加方法，判断，当前是否为更新或者添加，达到复用</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202103/2105804-20210331230418629-893693451.png"><img src="https://img2020.cnblogs.com/blog/2105804/202103/2105804-20210331230418629-893693451.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">saveClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 根据有没有 id 判断，是添加还是更新</span></span><br><span class="line">  <span class="comment">// 如果有id，那么就是更新，否则就是添加</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">author</span>.<span class="property">id</span>) &#123;</span><br><span class="line">    <span class="comment">// 更新</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">updateAuthor</span>();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 添加</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">addAuthor</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h2 id="16-创作者前端-云对象存储"><a href="#16-创作者前端-云对象存储" class="headerlink" title="16-创作者前端-云对象存储"></a>16-创作者前端-云对象存储</h2><h3 id="申请"><a href="#申请" class="headerlink" title="申请"></a>申请</h3><p>首先进入阿里云官网：<a target="_blank" rel="noopener" href="https://www.aliyun.com/">https://www.aliyun.com/</a> 搜索 <code>oss</code></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403120053213-768450886.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403120053213-768450886.png" alt="img"></a></p>
<p>点击管理控制台，进去之后, 点击立即开通</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403120345186-507450181.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403120345186-507450181.png" alt="img"></a></p>
<p>开通之后的样子如下图</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403120442932-947980182.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403120442932-947980182.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403120406697-578889913.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403120406697-578889913.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403120530653-2011256197.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403120530653-2011256197.png" alt="img"></a></p>
<h3 id="申请密钥"><a href="#申请密钥" class="headerlink" title="申请密钥"></a>申请密钥</h3><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403120620624-583609961.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403120620624-583609961.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403120640289-869350431.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403120640289-869350431.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403120702235-1578196613.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403120702235-1578196613.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403120718524-415737432.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403120718524-415737432.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403120755512-138518618.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403120755512-138518618.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403120821997-684776233.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403120821997-684776233.png" alt="img"></a></p>
<h3 id="Api-地址"><a href="#Api-地址" class="headerlink" title="Api 地址"></a>Api 地址</h3><p>地址：<a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/32011.html?spm=a2c4g.11186623.6.939.68ec46a1Dmwj0L">https://help.aliyun.com/document_detail/32011.html?spm=a2c4g.11186623.6.939.68ec46a1Dmwj0L</a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403120926451-949208435.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403120926451-949208435.png" alt="img"></a></p>
<h3 id="创建-service-upload-服务"><a href="#创建-service-upload-服务" class="headerlink" title="创建 service_upload 服务"></a>创建 service_upload 服务</h3><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403121325241-1156064171.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403121325241-1156064171.png" alt="img"></a></p>
<p>修改 service_upload 服务的 pom.xml 引入依赖</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403122334776-1644420724.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403122334776-1644420724.png" alt="img"></a></p>
<p>xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 阿里云oss依赖 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun.oss<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-sdk-oss<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 日期工具类依赖 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>joda-time<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>joda-time<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>添加启动类并排除加载数据库相关信息</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403122152415-53381302.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403122152415-53381302.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@project</span> video_parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> OSS云上传服务</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> Created in 2021/4/3 12:17</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@SpringBootApplication(exclude = DataSourceAutoConfiguration.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UpLoadApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        exclude = DataSourceAutoConfiguration.class：默认会加载数据库相关信息，现在是上传服务，里面用不到数据库相关信息,不让工程加载数据库相关信息</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        SpringApplication.run(UpLoadApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 <code>resources</code> 中添加配置文件 <code>application.yml</code> 内容如下</p>
<p>yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application-dev.yml</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8002</span></span><br><span class="line"></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">pattern:</span></span><br><span class="line">    <span class="attr">console:</span> <span class="string">&quot;%clr(%5p) %clr(-)&#123;faint&#125; %clr(%-80.80logger&#123;79&#125;)&#123;cyan&#125; %clr(:) %m%n&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">service-video</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义oss相关属性</span></span><br><span class="line"><span class="attr">oss:</span></span><br><span class="line">  <span class="attr">endpoint:</span> <span class="string">oss-cn-hangzhou.aliyuncs.com</span></span><br><span class="line">  <span class="attr">accessKeyId:</span> <span class="string">LTAI4GH19ep2P8caxW2E2N6A</span></span><br><span class="line">  <span class="attr">accessKeySecret:</span> <span class="string">NAmWiBmKXofw7hs4JRcx7SLhF1MN6P</span></span><br><span class="line">  <span class="attr">bucketName:</span> <span class="string">BNTang</span></span><br></pre></td></tr></table></figure>

<p>oss 相关属性怎么来的呢，继续进入到我们上方开通好的 oss 管理控制台中选择 <code>Bucket 管理</code> 如下图</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403122642515-1904847350.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403122642515-1904847350.png" alt="img"></a></p>
<p>按照我如下图进行选择即可，读写不能设置为私有，不然就不能访问了，同城冗余存储代表的是，如果出现故障了，它可以做备份，之前的数据还有，其它的就没什么要注意的了创建即可</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403122844363-721456685.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403122844363-721456685.png" alt="img"></a></p>
<p>创建好了之后界面如下图所示，我下图选中了一个 <code>Endpoint</code> 就是我们上方 oss 相关属性的 Endpoint 配置值，其它的在哪里呢，继续往下看 <code>accessKey</code> 就是我们之前创建的那个 <code>accessKey</code> 的界面中的 accessKey，不知道找了可以参考下图</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403123517631-149328232.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403123517631-149328232.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403123816927-581167759.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403123816927-581167759.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403123841330-255602506.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403123841330-255602506.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403123938263-1500844431.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403123938263-1500844431.png" alt="img"></a></p>
<p>可能你一来不是显示的，需要获取验证码输入之后就可以看到了，复制上方的一些信息替换成你自己实际的即可配置完毕了, <code>bucketName</code> 就是你创建的 bucketName 的名称</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403124125027-1775556320.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403124125027-1775556320.png" alt="img"></a></p>
<p>定义工具类加载配置信息</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403125122567-560875593.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403125122567-560875593.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@project</span> video_parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 读取配置的属性信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> Created in 2021/4/3 12:46</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OssConstant</span> <span class="keyword">implements</span> <span class="title class_">InitializingBean</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;oss.endpoint&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String endpoint;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;oss.accessKeyId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String accessKeyId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;oss.accessKeySecret&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String accessKeySecret;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;oss.bucketName&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String bucketName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String ENDPOINT;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String ASSESS_KEY_ID;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String ASSESS_KEY_SECRET;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String BUCKET_NAME;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在属性文件加载完毕后属性也设置完毕之后, 会自动调用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> &#123;</span><br><span class="line">        ENDPOINT = endpoint;</span><br><span class="line">        ASSESS_KEY_ID = accessKeyId;</span><br><span class="line">        ASSESS_KEY_SECRET = accessKeySecret;</span><br><span class="line">        BUCKET_NAME = bucketName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>定义上传的控制器接口</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403165122803-838436467.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403165122803-838436467.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@project</span> video_parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 上传oss控制器</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> Created in 2021/4/3 12:53</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/service_upload/file&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;上传OSS&quot;)</span></span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UpLoadController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UpLoadService upLoadService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UpLoadController</span><span class="params">(UpLoadService upLoadService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.upLoadService = upLoadService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 上传文件</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file 文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 上传之后的文件下载地址 url</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/uploadOssFile&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">uploadOssFile</span><span class="params">(MultipartFile file)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok().data(<span class="string">&quot;url&quot;</span>, upLoadService.uploadFile(file));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>定义上传的接口业务</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403165249370-238901943.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403165249370-238901943.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@project</span> video_parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 上传服务接口</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> Created in 2021/4/3 12:56</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UpLoadService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 上传OSS文件</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file 文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 上传之后的url</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">uploadFile</span><span class="params">(MultipartFile file)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>OSS 上传业务实现</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403165511249-1662596868.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403165511249-1662596868.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@project</span> video_parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> OSS上传业务实现</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> Created in 2021/4/3 12:57</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UpLoadServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UpLoadService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">uploadFile</span><span class="params">(MultipartFile file)</span> &#123;</span><br><span class="line">        <span class="comment">// Endpoint以上海为例，其它Region请按实际情况填写。</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">endpoint</span> <span class="operator">=</span> OssConstant.ENDPOINT;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 云账号AccessKey有所有API访问权限</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">accessKeyId</span> <span class="operator">=</span> OssConstant.ASSESS_KEY_ID;</span><br><span class="line">        <span class="type">String</span> <span class="variable">accessKeySecret</span> <span class="operator">=</span> OssConstant.ASSESS_KEY_SECRET;</span><br><span class="line">        <span class="type">String</span> <span class="variable">bucketName</span> <span class="operator">=</span> OssConstant.BUCKET_NAME;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建OSSClient实例。</span></span><br><span class="line">        <span class="type">OSS</span> <span class="variable">ossClient</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 创建OSSClient实例。</span></span><br><span class="line">            ossClient = <span class="keyword">new</span> <span class="title class_">OSSClientBuilder</span>().build(endpoint, accessKeyId, accessKeySecret);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 上传文件流。</span></span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> file.getInputStream();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 处理文件名称</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">uuid</span> <span class="operator">=</span> UUID.randomUUID().toString().replaceAll(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> uuid + file.getOriginalFilename();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 把同一天上传的文件 放到同一个文件夹当中  2020/10/1/fileName</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DateTime</span>().toString(<span class="string">&quot;yyyy/MM/dd&quot;</span>);</span><br><span class="line">            fileName = date + <span class="string">&quot;/&quot;</span> + fileName;</span><br><span class="line"></span><br><span class="line">            ossClient.putObject(bucketName, fileName, inputStream);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// https://bntang.oss-cn-shanghai.aliyuncs.com/01-%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%AF%AD%E8%A8%80%E6%A6%82%E8%BF%B01.png</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;https://&quot;</span> + bucketName + <span class="string">&quot;.&quot;</span> + endpoint + <span class="string">&quot;/&quot;</span> + fileName;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 关闭OSSClient。</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> != ossClient) &#123;</span><br><span class="line">                ossClient.shutdown();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>重启工程进行测试上传，访问 swagger 选择需要上传的文件进行上传，在进行访问 swagger 的时候发现，弹出了如下图的内容，如果出现了下图中的内容就代表没有添加扫描包的注解</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403170004511-1159084315.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403170004511-1159084315.png" alt="img"></a></p>
<p>修改 service_upload 的启动类添加如下注解即可</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403170557242-1843100419.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403170557242-1843100419.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan(basePackages = &#123;&quot;top.it6666&quot;&#125;)</span></span><br></pre></td></tr></table></figure>

<p>测试上传，成功，如下图</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403170423695-1413887640.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403170423695-1413887640.png" alt="img"></a></p>
<p>查看阿里云 OSS 存储文件列表如下图，发现已经OK了</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403170532891-461199861.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403170532891-461199861.png" alt="img"></a></p>
<h2 id="17-创作者前端-前后端分离多服务之间的访问调用"><a href="#17-创作者前端-前后端分离多服务之间的访问调用" class="headerlink" title="17-创作者前端-前后端分离多服务之间的访问调用"></a>17-创作者前端-前后端分离多服务之间的访问调用</h2><p>利用 <code>nginx</code>，在 <code>nginx</code> 当中配置服务地址代理规则</p>
<p>下载 nginx，<a target="_blank" rel="noopener" href="http://nginx.org/en/download.html">http://nginx.org/en/download.html</a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403171620738-1353276971.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403171620738-1353276971.png" alt="img"></a></p>
<p>修改 nginx 配置，修改 <code>nginx-1.16.1\conf</code> 目录下的 <code>nginx.conf</code> 文件，修改内容如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403172253755-946127943.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403172253755-946127943.png" alt="img"></a></p>
<p>text</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">location ~ /service_video &#123;</span><br><span class="line">    proxy_pass http://localhost:8001;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location ~ /service_upload &#123;</span><br><span class="line">    proxy_pass http://localhost:8002;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>启动 nginx，然后在浏览器中访问 <a target="_blank" rel="noopener" href="http://localhost/">http://localhost/</a> 看到如下界面说明 nginx 已经启动好了</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403172356494-1945287669.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403172356494-1945287669.png" alt="img"></a></p>
<p>那么如何关闭 nginx 呢，你们的有可能有一个命令行窗口，你关闭那个窗口其实 nginx 并没有真正的关闭，你不信你关闭了之后你在访问 <a target="_blank" rel="noopener" href="http://localhost/">http://localhost/</a> 还是可以看到如上图的界面，那么怎么关闭呢，关闭方式如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403172525929-1943693494.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403172525929-1943693494.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403172610067-1173652130.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403172610067-1173652130.png" alt="img"></a></p>
<p>sh</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx.exe -s stop</span><br></pre></td></tr></table></figure>

<p>再次访问如上 nginx 的地址你会发现访问不到了，就说明关闭啦，配置好了 nginx 之后呢，然后在前端工程当中配置接口地址为 <code>nginx</code> 地址即可完成多服务访问的效果了，修改前端的 <code>.env.development</code> 修改内容如下图</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403172734239-987055984.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403172734239-987055984.png" alt="img"></a></p>
<p>如上的内容都配置完毕了之后这个时候你启动后端和前端来测试一下，还有 nginx 也需要启动，来看看可不可以达到多服务的访问呢</p>
<p>启动后端</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403172839646-2094413180.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403172839646-2094413180.png" alt="img"></a></p>
<p>访问登录发现出错了</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403172904468-109367762.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403172904468-109367762.png" alt="img"></a></p>
<p>问题原因就是我们登录的 Controller 没有加模块的前缀路径，修改 <code>LoginController</code></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403173016854-31611424.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403173016854-31611424.png" alt="img"></a></p>
<p>紧接着前端登录接口的路径也需要同理的修改，如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403173223005-1446613152.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403173223005-1446613152.png" alt="img"></a></p>
<p>修改之后在访问，发现全部都OK啦，效果如下图</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403173258194-1999252729.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403173258194-1999252729.png" alt="img"></a></p>
<h2 id="18-创作者前端-头像上传前端"><a href="#18-创作者前端-头像上传前端" class="headerlink" title="18-创作者前端-头像上传前端"></a>18-创作者前端-头像上传前端</h2><p>添加缩略图，和上传图片的组件，上传图片的组件我是从 vue-element-admin 中进行拷贝过来的，如果你想使用和我不同的上传组件可以自行去弄一个，我的话就使用 vue-element-admin 提供的了，下载 vue-element-admin</p>
<p>下载地址：<a target="_blank" rel="noopener" href="https://github.com/PanJiaChen/vue-element-admin">https://github.com/PanJiaChen/vue-element-admin</a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403181342673-1558821332.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403181342673-1558821332.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403182208859-1485594958.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403182208859-1485594958.png" alt="img"></a></p>
<p>在添加创作者页面当中导入该组件</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403182534811-660572070.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403182534811-660572070.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> imageCropper <span class="keyword">from</span> <span class="string">&quot;@/components/ImageCropper&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> panThumb <span class="keyword">from</span> <span class="string">&quot;@/components/PanThumb&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">components</span>: &#123;imageCropper, panThumb&#125;,</span><br></pre></td></tr></table></figure>

<p>修改添加页面，添加缩略图</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403182951653-654884152.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403182951653-654884152.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-form-item&gt;</span><br><span class="line">  &lt;pan-thumb :width=&quot;String(&#x27;100px&#x27;)&quot; :height=&quot;String(&#x27;100px&#x27;)&quot; :image=&quot;String(author.avatar)&quot;/&gt;</span><br><span class="line">&lt;/el-form-item&gt;</span><br></pre></td></tr></table></figure>

<h3 id="上传文件"><a href="#上传文件" class="headerlink" title="上传文件"></a>上传文件</h3><p>上传界面</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403183205995-923377412.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403183205995-923377412.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-form-item&gt;</span><br><span class="line">  &lt;pan-thumb :width=&quot;String(&#x27;100px&#x27;)&quot; :height=&quot;String(&#x27;100px&#x27;)&quot; :image=&quot;String(author.avatar)&quot;/&gt;</span><br><span class="line"></span><br><span class="line">  &lt;el-button type=&quot;primary&quot; @click=&quot;imageCropperShow=true&quot;&gt;上传头像&lt;/el-button&gt;</span><br><span class="line">  &lt;!--</span><br><span class="line">  上传头像的界面</span><br><span class="line">  --&gt;</span><br><span class="line">  &lt;image-cropper</span><br><span class="line">    v-show=&quot;imageCropperShow&quot;</span><br><span class="line">    :width=&quot;500&quot;</span><br><span class="line">    :height=&quot;300&quot;</span><br><span class="line">    :key=&quot;cropperKey&quot;</span><br><span class="line">    :url=&quot;BASE_API+&#x27;/service_upload/file/uploadOssFile&#x27;&quot;</span><br><span class="line">    field=&quot;file&quot;</span><br><span class="line">    @close=&quot;close&quot;</span><br><span class="line">    @crop-upload-success=&quot;cropSuccess&quot;</span><br><span class="line">  /&gt;</span><br><span class="line">&lt;/el-form-item&gt;</span><br></pre></td></tr></table></figure>

<p>事件处理</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403183850318-1036544184.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403183850318-1036544184.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">author</span>: &#123;</span><br><span class="line">      <span class="comment">// 排序默认值</span></span><br><span class="line">      <span class="attr">sort</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">level</span>: <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">imageCropperShow</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">cropperKey</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">BASE_API</span>: process.<span class="property">env</span>.<span class="property">VUE_APP_BASE_API</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403184106978-1722551225.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403184106978-1722551225.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">close</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 关闭弹框</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">imageCropperShow</span> = <span class="literal">false</span>;</span><br><span class="line">  <span class="comment">// 该代码可以清空上传组件的默认样式，也就是说每次弹出来的窗口都是新的</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">cropperKey</span> = <span class="variable language_">this</span>.<span class="property">cropperKey</span> + <span class="number">1</span>;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="title function_">cropSuccess</span>(<span class="params">data</span>) &#123;</span><br><span class="line">  <span class="comment">// 关闭弹框</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">imageCropperShow</span> = <span class="literal">false</span>;</span><br><span class="line">  <span class="comment">// 显示图片</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">author</span>.<span class="property">avatar</span> = data.<span class="property">url</span>;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">cropperKey</span> = <span class="variable language_">this</span>.<span class="property">cropperKey</span> + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如上内容都完成好了之后，测试上传效果图如下所示</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403185636068-926996684.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403185636068-926996684.png" alt="img"></a></p>
<h2 id="19-分类管理-数据库表创建"><a href="#19-分类管理-数据库表创建" class="headerlink" title="19-分类管理-数据库表创建"></a>19-分类管理-数据库表创建</h2><p>数据库语句如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `video_category` (</span><br><span class="line">	`id` CHAR ( 19 ) NOT NULL COMMENT &#x27;类别ID&#x27;,</span><br><span class="line">	`title` VARCHAR ( 10 ) NOT NULL COMMENT &#x27;类别名称&#x27;,</span><br><span class="line">	`parent_id` CHAR ( 19 ) NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;父ID&#x27;,</span><br><span class="line">	`sort` INT ( 10 ) UNSIGNED NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;排序字段&#x27;,</span><br><span class="line">	`gmt_create` datetime NOT NULL COMMENT &#x27;创建时间&#x27;,</span><br><span class="line">	`gmt_modified` datetime NOT NULL COMMENT &#x27;更新时间&#x27;,</span><br><span class="line">	PRIMARY KEY ( `id` ),</span><br><span class="line">KEY `idx_parent_id` ( `parent_id` ) </span><br><span class="line">) ENGINE = INNODB DEFAULT CHARSET = utf8mb4 ROW_FORMAT = COMPACT COMMENT = &#x27;科目分类&#x27;;</span><br></pre></td></tr></table></figure>

<h2 id="20-分类管理-上传分类前端"><a href="#20-分类管理-上传分类前端" class="headerlink" title="20-分类管理-上传分类前端"></a>20-分类管理-上传分类前端</h2><h3 id="添加路由"><a href="#添加路由" class="headerlink" title="添加路由"></a>添加路由</h3><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403191804810-932327535.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403191804810-932327535.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/category&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="title class_">Layout</span>,</span><br><span class="line">  <span class="attr">redirect</span>: <span class="string">&#x27;/category/list&#x27;</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;视频分类管理&#x27;</span>,</span><br><span class="line">  <span class="attr">meta</span>: &#123;<span class="attr">title</span>: <span class="string">&#x27;视频分类管理&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;el-icon-s-help&#x27;</span>&#125;,</span><br><span class="line">  <span class="attr">children</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;list&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;视频分类列表&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/video/category/list&#x27;</span>),</span><br><span class="line">      <span class="attr">meta</span>: &#123;<span class="attr">title</span>: <span class="string">&#x27;视频分类列表&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;table&#x27;</span>&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;save&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;上传视频分类&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/video/category/save&#x27;</span>),</span><br><span class="line">      <span class="attr">meta</span>: &#123;<span class="attr">title</span>: <span class="string">&#x27;上传视频分类&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;tree&#x27;</span>&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>完善上传页面，上传页面也就是所谓的添加页面，现在大部分使用 excel 导致的比较多，所以这次就采用 excel 导入上传的形式来做添加，添加内容如下，添加了之后会报错，因为方法还没添加，不过没什么问题，先添加，添加完毕了之后紧接着就是去写 excel 上传解析接口了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line">    &lt;el-form label-width=&quot;120px&quot;&gt;</span><br><span class="line">      &lt;!--</span><br><span class="line">      下载 excel 模板</span><br><span class="line">      --&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;描述信息&quot;&gt;</span><br><span class="line">        &lt;el-tag type=&quot;info&quot;&gt;excel模板说明&lt;/el-tag&gt;</span><br><span class="line">        &amp;nbsp;</span><br><span class="line">        &lt;el-tag&gt;</span><br><span class="line">          &lt;i class=&quot;el-icon-download&quot;&gt;&lt;/i&gt;</span><br><span class="line">          &lt;a href=&quot;javascript:(0)&quot;&gt;点击下载模板&lt;/a&gt;</span><br><span class="line">        &lt;/el-tag&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!--</span><br><span class="line">      上传excel</span><br><span class="line">      --&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;上传信息&quot;&gt;</span><br><span class="line">        &lt;el-upload</span><br><span class="line">          ref=&quot;upload&quot;</span><br><span class="line">          action=&quot;https://jsonplaceholder.typicode.com/posts/&quot;</span><br><span class="line">          :auto-upload=&quot;false&quot;</span><br><span class="line">          :on-success=&quot;uploadSuccess&quot;</span><br><span class="line">          :on-error=&quot;uploadError&quot;</span><br><span class="line">          accept=&quot;.xls, .xlsx&quot;</span><br><span class="line">          :limit=&quot;1&quot;</span><br><span class="line">          :disabled=&quot;btnDisabled&quot;</span><br><span class="line">          name=&quot;file&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;el-button slot=&quot;trigger&quot; size=&quot;small&quot; type=&quot;primary&quot;&gt;选取文件&lt;/el-button&gt;</span><br><span class="line">          &lt;el-button style=&quot;margin-left: 10px;&quot; size=&quot;small&quot; type=&quot;success&quot;</span><br><span class="line">                     @click=&quot;submitUpload&quot;&gt;上传到服务器</span><br><span class="line">          &lt;/el-button&gt;</span><br><span class="line">        &lt;/el-upload&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">    &lt;/el-form&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;save&quot;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="21-分类管理-后台接口编写"><a href="#21-分类管理-后台接口编写" class="headerlink" title="21-分类管理-后台接口编写"></a>21-分类管理-后台接口编写</h2><h3 id="EasyExcel"><a href="#EasyExcel" class="headerlink" title="EasyExcel"></a>EasyExcel</h3><h4 id="EasyExcel-概述"><a href="#EasyExcel-概述" class="headerlink" title="EasyExcel 概述"></a>EasyExcel 概述</h4><p>Java 解析、生成 excel 比较有名的框架有 Apache poi、jxl，但他们都存在一个严重的问题就是非常耗内存，easyExcel 也是用来解析 excel 用的，但是他却解决了这个问题</p>
<h4 id="EasyExcel-的原理"><a href="#EasyExcel-的原理" class="headerlink" title="EasyExcel 的原理"></a>EasyExcel 的原理</h4><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403205450746-91259428.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403205450746-91259428.png" alt="img"></a></p>
<h3 id="写数据"><a href="#写数据" class="headerlink" title="写数据"></a>写数据</h3><p>创建模型，在创建模型之前在 service_video 模型中添加单元测试和热加载相关的依赖，如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403222030234-1004678625.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210403222030234-1004678625.png" alt="img"></a></p>
<p>xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后在引入 easyExcel 相关的依赖</p>
<p>xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easyexcel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>模型内容如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404020657995-562868455.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404020657995-562868455.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StudentData</span> &#123;</span><br><span class="line">    <span class="meta">@ExcelProperty(value = &quot;学号&quot;, index = 0)</span></span><br><span class="line">    <span class="keyword">private</span> Integer no;</span><br><span class="line">    <span class="meta">@ExcelProperty(value = &quot;姓名&quot;, index = 1)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>写数据，也就是导出 excel 文件</p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> S2.3.2Dev</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span> video_parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> Created in 2021/4/3 22:08</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span></span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServiceVideoApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writeExcel</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> <span class="string">&quot;D:\\01.xlsx&quot;</span>;</span><br><span class="line"></span><br><span class="line">        List&lt;StudentData&gt; studentDataList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="type">StudentData</span> <span class="variable">studentData</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StudentData</span>();</span><br><span class="line"></span><br><span class="line">            studentData.setNo(i);</span><br><span class="line">            studentData.setName(<span class="string">&quot;BNTang&quot;</span> + i);</span><br><span class="line"></span><br><span class="line">            studentDataList.add(studentData);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 1.fileName：文件路径与名称</span></span><br><span class="line"><span class="comment">         * 2.StudentData.class：模型的字节码</span></span><br><span class="line"><span class="comment">         * 3.sheet：名称</span></span><br><span class="line"><span class="comment">         * 4.doWrite：要写的数据，是一个list</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        EasyExcel.write(fileName, StudentData.class).sheet(<span class="string">&quot;学生&quot;</span>).doWrite(studentDataList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行测试类，最终结果如下图所示</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404020822957-2066477392.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404020822957-2066477392.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404020845122-434877068.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404020845122-434877068.png" alt="img"></a></p>
<h3 id="读数据"><a href="#读数据" class="headerlink" title="读数据"></a>读数据</h3><p>创建监听器</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404021112749-1997089309.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404021112749-1997089309.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExcelListener</span> <span class="keyword">extends</span> <span class="title class_">AnalysisEventListener</span>&lt;StudentData&gt; &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 一行一行读取数据</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> studentData     读取到的一行数据模型对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> analysisContext analysisContext</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invoke</span><span class="params">(StudentData studentData, AnalysisContext analysisContext)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;data = &quot;</span> + studentData);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invokeHeadMap</span><span class="params">(Map&lt;Integer, String&gt; headMap, AnalysisContext context)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;表头: &quot;</span> + headMap);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 所有的数据读取完毕之后会自动调用</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> analysisContext analysisContext</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doAfterAllAnalysed</span><span class="params">(AnalysisContext analysisContext)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;读取完毕&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>读数据</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404021243456-1838718955.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404021243456-1838718955.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">ReadExcel</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> <span class="string">&quot;D:\\01.xlsx&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 每读取一行数据的时候, 就会调用监听器当中的方法</span></span><br><span class="line">    EasyExcel.read(fileName, StudentData.class, <span class="keyword">new</span> <span class="title class_">ExcelListener</span>()).sheet().doRead();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="应用到工程当中"><a href="#应用到工程当中" class="headerlink" title="应用到工程当中"></a>应用到工程当中</h3><h4 id="建立模型"><a href="#建立模型" class="headerlink" title="建立模型"></a>建立模型</h4><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404022421387-1955581545.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404022421387-1955581545.png" alt="img"></a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> S2.3.2Dev</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span> video_parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> Created in 2021/4/4 2:22</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 分类excel上传的模型类</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CategoryData</span> &#123;</span><br><span class="line">    <span class="meta">@ExcelProperty(index = 0)</span></span><br><span class="line">    <span class="keyword">private</span> String oneCategoryData;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExcelProperty(index = 1)</span></span><br><span class="line">    <span class="keyword">private</span> String twoCategoryData;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建监听器</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404022648075-690675502.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404022648075-690675502.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> S2.3.2Dev</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span> video_parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> Created in 2021/4/4 2:25</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 分类管理上传excel监听器</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CategoryExcelListener</span> <span class="keyword">extends</span> <span class="title class_">AnalysisEventListener</span>&lt;CategoryData&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invoke</span><span class="params">(CategoryData categoryData, AnalysisContext analysisContext)</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doAfterAllAnalysed</span><span class="params">(AnalysisContext analysisContext)</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编写控制器，用来接收文件，然后编写对应文件处理的业务</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404022853966-2064679854.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404022853966-2064679854.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> S2.3.2Dev</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span> video_parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> Created in 2021/4/4 2:27</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 分类管理控制器</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/service_video/category&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CategoryController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CategoryService categoryService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CategoryController</span><span class="params">(CategoryService categoryService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.categoryService = categoryService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/addCategory&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">addCategory</span><span class="params">(MultipartFile file)</span> &#123;</span><br><span class="line">        <span class="comment">// 调用业务上传excel</span></span><br><span class="line">        categoryService.saveCategory(file);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如上报错是因为还没有编写对应的接口和实现类所以找不到下面我们就来编写，在继续往下写之前我先来弥补一下我之前的一个错误就是把 mp 的代码生成器给删除了，这个时候要生成分类管理表相关的实体了，所以这个时候把之前的生成器代码拿回来放到测试包下，然后改一下生成的表名，把之前新建的分类管理的 <code>Controller</code> 删除用 mp 生成器生成的</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404023720077-421782479.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404023720077-421782479.png" alt="img"></a></p>
<p>改好了之前点击启动生成即可，这个类以后就保留着，然后把如上 Controller 写的内容复制到 mp 生成器生成的 Controller 中去即可</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404023855292-1097642576.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404023855292-1097642576.png" alt="img"></a></p>
<p>修改对应的业务类，修改 <code>CategoryService</code> 接口，也就是分类管理的接口</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404024019574-1127205993.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404024019574-1127205993.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 上传excel</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> file 上传的文件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">saveCategory</span><span class="params">(MultipartFile file)</span>;</span><br></pre></td></tr></table></figure>

<p>然后就是编写业务类了，内容如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404024212805-697630825.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404024212805-697630825.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 科目分类 服务实现类</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2021-04-04</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CategoryServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;CategoryMapper, Category&gt; <span class="keyword">implements</span> <span class="title class_">CategoryService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * excel监听器</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CategoryExcelListener categoryExcelListener;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CategoryServiceImpl</span><span class="params">(CategoryExcelListener categoryExcelListener)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.categoryExcelListener = categoryExcelListener;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveCategory</span><span class="params">(MultipartFile file)</span> &#123;</span><br><span class="line">        <span class="comment">// 读取excel</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            EasyExcel.read(file.getInputStream(), CategoryData.class, categoryExcelListener).sheet().doRead();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>剩余的内容就是完善一下我们 excel 上传解析的监听器了，主要就是在监听器当中保存数据，最终监听器代码如下</p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> S2.3.2Dev</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span> video_parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> Created in 2021/4/4 2:25</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 分类管理上传excel监听器</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CategoryExcelListener</span> <span class="keyword">extends</span> <span class="title class_">AnalysisEventListener</span>&lt;CategoryData&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CategoryService categoryService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CategoryExcelListener</span><span class="params">(CategoryService categoryService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.categoryService = categoryService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invoke</span><span class="params">(CategoryData categoryData, AnalysisContext analysisContext)</span> &#123;</span><br><span class="line">        <span class="comment">// 写入到数据库当中</span></span><br><span class="line">        <span class="keyword">if</span> (!Objects.isNull(categoryData)) &#123;</span><br><span class="line">            <span class="comment">// 如果一级分类不存在,就保存到数据库当中</span></span><br><span class="line">            <span class="type">Category</span> <span class="variable">oneCategory</span> <span class="operator">=</span> <span class="built_in">this</span>.isExistOneCategory(categoryData);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (Objects.isNull(oneCategory)) &#123;</span><br><span class="line">                oneCategory = <span class="keyword">new</span> <span class="title class_">Category</span>();</span><br><span class="line">                oneCategory.setTitle(categoryData.getOneCategoryData());</span><br><span class="line">                oneCategory.setParentId(<span class="string">&quot;0&quot;</span>);</span><br><span class="line"></span><br><span class="line">                categoryService.save(oneCategory);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 保存2级分类,先判断2级分类是否已经存在</span></span><br><span class="line">            <span class="type">Category</span> <span class="variable">twoCategory</span> <span class="operator">=</span> <span class="built_in">this</span>.isExistTwoCategory(categoryData, oneCategory.getId());</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (Objects.isNull(twoCategory)) &#123;</span><br><span class="line">                twoCategory = <span class="keyword">new</span> <span class="title class_">Category</span>();</span><br><span class="line">                twoCategory.setTitle(categoryData.getTwoCategoryData());</span><br><span class="line">                twoCategory.setParentId(oneCategory.getId());</span><br><span class="line"></span><br><span class="line">                categoryService.save(twoCategory);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 判断1级分类是否已经存在</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Category <span class="title function_">isExistOneCategory</span><span class="params">(CategoryData categoryData)</span> &#123;</span><br><span class="line">        QueryWrapper&lt;Category&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;title&quot;</span>, categoryData.getOneCategoryData());</span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;parent_id&quot;</span>, <span class="string">&quot;0&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> categoryService.getOne(queryWrapper);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 判断2级分类是否已经存在</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Category <span class="title function_">isExistTwoCategory</span><span class="params">(CategoryData categoryData, String pid)</span> &#123;</span><br><span class="line">        QueryWrapper&lt;Category&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;title&quot;</span>, categoryData.getTwoCategoryData());</span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;parent_id&quot;</span>, pid);</span><br><span class="line">        <span class="keyword">return</span> categoryService.getOne(queryWrapper);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 所有的数据读取完毕之后会自动调用</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doAfterAllAnalysed</span><span class="params">(AnalysisContext analysisContext)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;上传分类 excel 解析完毕！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如上主要的业务就是先看看数据库存不存在当前的分类有就不添加没有就添加，核心的方法为如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404024844384-230135189.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404024844384-230135189.png" alt="img"></a></p>
<p>然后启动工程发现出现了循环依赖注入的问题</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404030552555-970742108.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404030552555-970742108.png" alt="img"></a></p>
<p>为啥会出现这个问题呢，可参考：<a target="_blank" rel="noopener" href="https://mrbird.cc/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Spring%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96.html">https://mrbird.cc/深入理解Spring循环依赖.html</a></p>
<p>修改所有注入的地方都改为 <code>@Resource</code> 的方式即可</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404030844663-1177676833.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404030844663-1177676833.png" alt="img"></a></p>
<p>启动工程上传模板发现，报错了，模板的内容如下图所示</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404030929331-1637717227.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404030929331-1637717227.png" alt="img"></a></p>
<p>很明显就是我们少添加了自动填充的实体类配置</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404030955770-1032999254.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404030955770-1032999254.png" alt="img"></a></p>
<p>修改实体类如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404031108927-159556836.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404031108927-159556836.png" alt="img"></a></p>
<p>然后在修改我们之前的分类 Controller 因为少加了一些内容加的内容如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404031349351-1786650127.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404031349351-1786650127.png" alt="img"></a></p>
<p>再次重启测试效果如下图所示</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404032217663-680765931.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404032217663-680765931.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404032231497-1388475649.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404032231497-1388475649.png" alt="img"></a></p>
<h2 id="22-分类管理-前端上传接口调试"><a href="#22-分类管理-前端上传接口调试" class="headerlink" title="22-分类管理-前端上传接口调试"></a>22-分类管理-前端上传接口调试</h2><p>首先添加两个事件的回调方法一个是上传成功的，另一个是上传失败的，分别如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404113421285-576271899.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404113421285-576271899.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404113851157-1520704830.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404113851157-1520704830.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">  <span class="title function_">submitUpload</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">upload</span>.<span class="title function_">submit</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">btnDisabled</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">loading</span> = <span class="literal">true</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">uploadSuccess</span>(<span class="params">response</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">loading</span> = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">      <span class="attr">message</span>: response.<span class="property">message</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 跳转到列表页</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123;<span class="attr">path</span>: <span class="string">&#x27;/category/list&#x27;</span>&#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">uploadError</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">&quot;上传失败！&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 data 中添加需要的变量等信息</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404113911276-1288197442.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404113911276-1288197442.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">btnDisabled</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">loading</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">BASE_API</span>: process.<span class="property">env</span>.<span class="property">VUE_APP_BASE_API</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>给上传服务器按钮添加加载效果如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404114007756-169322140.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404114007756-169322140.png" alt="img"></a></p>
<p>上传服务器的地址绑定属性值的时候需要注意如下图所示的地方要使用 <code>:</code> 来绑定</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404114052257-144367432.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404114052257-144367432.png" alt="img"></a></p>
<p>下载模板功能我就不做了，我在这里说一下大概怎么做吧，就是你把模板上传到服务器当中拿到下载地址然后放在对应的 a 标签中即可完成下载</p>
<h2 id="23-分类管理-分类列表"><a href="#23-分类管理-分类列表" class="headerlink" title="23-分类管理-分类列表"></a>23-分类管理-分类列表</h2><p>添加 <code>el-tree</code> 组件到 <code>list.vue</code> 当中，当然你可以直接复制我下方的整体代码</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404115130131-959833215.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404115130131-959833215.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line">    &lt;el-input v-model=&quot;filterText&quot; placeholder=&quot;Filter keyword&quot; style=&quot;margin-bottom:30px;&quot;/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-tree</span><br><span class="line">      ref=&quot;tree2&quot;</span><br><span class="line">      :data=&quot;data2&quot;</span><br><span class="line">      :props=&quot;defaultProps&quot;</span><br><span class="line">      :filter-node-method=&quot;filterNode&quot;</span><br><span class="line">      class=&quot;filter-tree&quot;</span><br><span class="line">      default-expand-all</span><br><span class="line">    /&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;list&quot;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      filterText: &#x27;&#x27;,</span><br><span class="line">      data2: [&#123;</span><br><span class="line">        id: 1,</span><br><span class="line">        label: &#x27;Level one 1&#x27;,</span><br><span class="line">        children: [&#123;</span><br><span class="line">          id: 4,</span><br><span class="line">          label: &#x27;Level two 1-1&#x27;,</span><br><span class="line">          children: [&#123;</span><br><span class="line">            id: 9,</span><br><span class="line">            label: &#x27;Level three 1-1-1&#x27;</span><br><span class="line">          &#125;, &#123;</span><br><span class="line">            id: 10,</span><br><span class="line">            label: &#x27;Level three 1-1-2&#x27;</span><br><span class="line">          &#125;]</span><br><span class="line">        &#125;]</span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        id: 2,</span><br><span class="line">        label: &#x27;Level one 2&#x27;,</span><br><span class="line">        children: [&#123;</span><br><span class="line">          id: 5,</span><br><span class="line">          label: &#x27;Level two 2-1&#x27;</span><br><span class="line">        &#125;, &#123;</span><br><span class="line">          id: 6,</span><br><span class="line">          label: &#x27;Level two 2-2&#x27;</span><br><span class="line">        &#125;]</span><br><span class="line">      &#125;, &#123;</span><br><span class="line">        id: 3,</span><br><span class="line">        label: &#x27;Level one 3&#x27;,</span><br><span class="line">        children: [&#123;</span><br><span class="line">          id: 7,</span><br><span class="line">          label: &#x27;Level two 3-1&#x27;</span><br><span class="line">        &#125;, &#123;</span><br><span class="line">          id: 8,</span><br><span class="line">          label: &#x27;Level two 3-2&#x27;</span><br><span class="line">        &#125;]</span><br><span class="line">      &#125;],</span><br><span class="line">      defaultProps: &#123;</span><br><span class="line">        children: &#x27;children&#x27;,</span><br><span class="line">        label: &#x27;label&#x27;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  watch: &#123;</span><br><span class="line">    filterText(val) &#123;</span><br><span class="line">      this.$refs.tree2.filter(val)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    filterNode(value, data) &#123;</span><br><span class="line">      if (!value) return true</span><br><span class="line">      return data.label.indexOf(value) !== -1</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>现在去编写后端接口，封装好对应的模型数据返回，渲染即可，在服务器端建立模型</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404115453358-1794481027.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404115453358-1794481027.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> S2.3.2Dev</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span> video_parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> Created in 2021/4/4 11:53</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 分类管理列表树形数据类模型</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LevelCategory</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> List&lt;LevelCategory&gt; children = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建 Controller 处理请求及业务，Controller 层的内容如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404115816444-1796993880.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404115816444-1796993880.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 获取分类列表树形结构</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/getTreeCategory&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">getTreeCategory</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> ResponseResult.ok().data(<span class="string">&quot;list&quot;</span>, categoryService.getTreeCategory());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在实现类当中创建上图中报错的那个方法如下，首先在接口当中添加方法修改 <code>CategoryService.java</code></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404120021739-1439278241.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404120021739-1439278241.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 获取分类列表树形结构</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 树形结构分类Data</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">List&lt;LevelCategory&gt; <span class="title function_">getTreeCategory</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>

<p>紧接着就是编写实现类</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404120559369-1037456708.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404120559369-1037456708.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;LevelCategory&gt; <span class="title function_">getTreeCategory</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 1.读取1级分类</span></span><br><span class="line">    QueryWrapper&lt;Category&gt; oneQueryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    oneQueryWrapper.eq(<span class="string">&quot;parent_id&quot;</span>, <span class="number">0</span>);</span><br><span class="line">    List&lt;Category&gt; oneCategories = baseMapper.selectList(oneQueryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.读取2级分类</span></span><br><span class="line">    QueryWrapper&lt;Category&gt; twoQueryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    twoQueryWrapper.ne(<span class="string">&quot;parent_id&quot;</span>, <span class="number">0</span>);</span><br><span class="line">    List&lt;Category&gt; twoCategories = baseMapper.selectList(twoQueryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 封装模型数据</span></span><br><span class="line">    List&lt;LevelCategory&gt; resultData = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    oneCategories.forEach(oneCategory -&gt; &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 把Category转成LevelCategory</span></span><br><span class="line">        <span class="type">LevelCategory</span> <span class="variable">oneLevelCategory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LevelCategory</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 属性的复制</span></span><br><span class="line">        <span class="comment">// 把前一个对象当中的属性值复制到后一个对象当中相同的属性中去</span></span><br><span class="line">        <span class="comment">// 如果前一个对象在后一个对象当中没有找到相同的属性,就不复制</span></span><br><span class="line">        BeanUtils.copyProperties(oneCategory, oneLevelCategory);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取当前子分类有哪些</span></span><br><span class="line">        <span class="comment">// 遍历所有的二级分类</span></span><br><span class="line">        twoCategories.forEach(twoCategory -&gt; &#123;</span><br><span class="line">            <span class="comment">// 二级分类的parent_id=一级分类的id,就是当前一级分类,的子级</span></span><br><span class="line">            <span class="keyword">if</span> (twoCategory.getParentId().equals(oneCategory.getId())) &#123;</span><br><span class="line">                <span class="type">LevelCategory</span> <span class="variable">twoLevelCategory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LevelCategory</span>();</span><br><span class="line"></span><br><span class="line">                BeanUtils.copyProperties(twoCategory, twoLevelCategory);</span><br><span class="line"></span><br><span class="line">                oneLevelCategory.getChildren().add(twoLevelCategory);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        resultData.add(oneLevelCategory);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> resultData;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果的业务我在代码当中写了注释，大致意思就是把一级二级都查询出来，先遍历一级，转换一级，然后在遍历二级看一下二级的父Id，是否等于一级是的话就是子分类，添加到 Children 当中，重启工程测试接口，效果如下图所示</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404121014968-1602506538.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404121014968-1602506538.png" alt="img"></a></p>
<h2 id="24-分类管理-前端列表请求展示渲染"><a href="#24-分类管理-前端列表请求展示渲染" class="headerlink" title="24-分类管理-前端列表请求展示渲染"></a>24-分类管理-前端列表请求展示渲染</h2><p>编写请求接口</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404122722566-1882535999.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404122722566-1882535999.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// 1.获取分类数据</span></span><br><span class="line">  <span class="title function_">getCategoryData</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`/service_video/category/getTreeCategory`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在列表页，导入请求，然后在调用请求 Api 拿到分类树形结构数据渲染</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404123745961-1095305823.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404123745961-1095305823.png" alt="img"></a></p>
<p>因为我们后台给的是 <code>title</code> 而且 el-tree 默认的是 lable 需要改下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404123913006-836559192.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210404123913006-836559192.png" alt="img"></a></p>
<p>最终的代码如下，参考自己写也行，复制也可以</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line">    &lt;el-input v-model=&quot;filterText&quot; placeholder=&quot;Filter keyword&quot; style=&quot;margin-bottom:30px;&quot;/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-tree</span><br><span class="line">      ref=&quot;tree&quot;</span><br><span class="line">      :data=&quot;list&quot;</span><br><span class="line">      :props=&quot;defaultProps&quot;</span><br><span class="line">      :filter-node-method=&quot;filterNode&quot;</span><br><span class="line">      class=&quot;filter-tree&quot;</span><br><span class="line">      default-expand-all</span><br><span class="line">    /&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import category from &#x27;@/api/video/category/category&#x27;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;list&quot;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      filterText: &#x27;&#x27;,</span><br><span class="line">      list: [],</span><br><span class="line">      defaultProps: &#123;</span><br><span class="line">        children: &#x27;children&#x27;,</span><br><span class="line">        label: &#x27;title&#x27;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  watch: &#123;</span><br><span class="line">    filterText(val) &#123;</span><br><span class="line">      this.$refs.tree.filter(val)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    filterNode(value, data) &#123;</span><br><span class="line">      if (!value) return true</span><br><span class="line">      return data.title.indexOf(value) !== -1</span><br><span class="line">    &#125;,</span><br><span class="line">    getTreeCategory() &#123;</span><br><span class="line">      category.getCategoryData().then(res =&gt; &#123;</span><br><span class="line">        this.list = res.data.list;</span><br><span class="line">      &#125;).catch(error =&gt; &#123;</span><br><span class="line">        this.$message.error(&quot;服务器繁忙！&quot;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    // 一进入页面就加载分类列表数据</span><br><span class="line">    this.getTreeCategory();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="25-作品管理-创建数据库表以及表之间的关系"><a href="#25-作品管理-创建数据库表以及表之间的关系" class="headerlink" title="25-作品管理-创建数据库表以及表之间的关系"></a>25-作品管理-创建数据库表以及表之间的关系</h2><h3 id="作品表"><a href="#作品表" class="headerlink" title="作品表"></a>作品表</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `video_content` (</span><br><span class="line">  `id` char(19) NOT NULL COMMENT &#x27;作品ID&#x27;,</span><br><span class="line">  `author_id` char(19) NOT NULL COMMENT &#x27;作者ID&#x27;,</span><br><span class="line">  `category_id` char(19) NOT NULL COMMENT &#x27;分类ID&#x27;,</span><br><span class="line">  `category_parent_id` char(19) NOT NULL COMMENT &#x27;分类父级ID&#x27;,</span><br><span class="line">  `title` varchar(50) NOT NULL COMMENT &#x27;作品标题&#x27;,</span><br><span class="line">  `price` decimal(10,2) unsigned NOT NULL DEFAULT &#x27;0.00&#x27; COMMENT &#x27;价格，设置为0则可免费观看&#x27;,</span><br><span class="line">  `conntent_num` int(10) unsigned NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;作品个数&#x27;,</span><br><span class="line">  `cover` varchar(255) CHARACTER SET utf8 NOT NULL COMMENT &#x27;作品&#x27;,</span><br><span class="line">  `buy_count` bigint(10) unsigned NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;销售数量&#x27;,</span><br><span class="line">  `view_count` bigint(10) unsigned NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;浏览数量&#x27;,</span><br><span class="line">  `version` bigint(20) unsigned NOT NULL DEFAULT &#x27;1&#x27; COMMENT &#x27;乐观锁&#x27;,</span><br><span class="line">  `status` varchar(10) NOT NULL DEFAULT &#x27;Draft&#x27; COMMENT &#x27;课程状态 Draft未发布  Normal已发布&#x27;,</span><br><span class="line">  `is_deleted` tinyint(3) DEFAULT NULL COMMENT &#x27;逻辑删除 1（true）已删除， 0（false）未删除&#x27;,</span><br><span class="line">  `gmt_create` datetime NOT NULL COMMENT &#x27;创建时间&#x27;,</span><br><span class="line">  `gmt_modified` datetime NOT NULL COMMENT &#x27;更新时间&#x27;,</span><br><span class="line">  PRIMARY KEY (`id`),</span><br><span class="line">  KEY `idx_title` (`title`),</span><br><span class="line">  KEY `idx_category_id` (`category_id`),</span><br><span class="line">  KEY `idx_author_id` (`author_id`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 ROW_FORMAT=COMPACT COMMENT=&#x27;作品表&#x27;;</span><br></pre></td></tr></table></figure>

<h3 id="作品简介表"><a href="#作品简介表" class="headerlink" title="作品简介表"></a>作品简介表</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `video_content_description` (</span><br><span class="line">  `id` char(19) NOT NULL COMMENT &#x27;作品ID&#x27;,</span><br><span class="line">  `description` text COMMENT &#x27;作品简介&#x27;,</span><br><span class="line">  `gmt_create` datetime NOT NULL COMMENT &#x27;创建时间&#x27;,</span><br><span class="line">  `gmt_modified` datetime NOT NULL COMMENT &#x27;更新时间&#x27;,</span><br><span class="line">  PRIMARY KEY (`id`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT=&#x27;作品简介&#x27;;</span><br></pre></td></tr></table></figure>

<h3 id="作品视频表"><a href="#作品视频表" class="headerlink" title="作品视频表"></a>作品视频表</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `video_content_video` (</span><br><span class="line">  `id` char(19) NOT NULL COMMENT &#x27;视频ID&#x27;,</span><br><span class="line">  `course_id` char(19) NOT NULL COMMENT &#x27;作品ID&#x27;,</span><br><span class="line">  `chapter_id` char(19) NOT NULL COMMENT &#x27;章节ID&#x27;,</span><br><span class="line">  `title` varchar(50) NOT NULL COMMENT &#x27;节点名称&#x27;,</span><br><span class="line">  `video_source_id` varchar(100) DEFAULT NULL COMMENT &#x27;云端视频资源&#x27;,</span><br><span class="line">  `video_original_name` varchar(100) DEFAULT NULL COMMENT &#x27;原始文件名称&#x27;,</span><br><span class="line">  `sort` int(10) unsigned NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;排序字段&#x27;,</span><br><span class="line">  `play_count` bigint(20) unsigned NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;播放次数&#x27;,</span><br><span class="line">  `is_free` tinyint(1) unsigned NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;是否可以试听：0收费 1免费&#x27;,</span><br><span class="line">  `duration` float NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;视频时长（秒）&#x27;,</span><br><span class="line">  `status` varchar(20) NOT NULL DEFAULT &#x27;Empty&#x27; COMMENT &#x27;Empty未上传 Transcoding转码中  Normal正常&#x27;,</span><br><span class="line">  `size` bigint(20) unsigned NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;视频源文件大小（字节）&#x27;,</span><br><span class="line">  `version` bigint(20) unsigned NOT NULL DEFAULT &#x27;1&#x27; COMMENT &#x27;乐观锁&#x27;,</span><br><span class="line">  `gmt_create` datetime NOT NULL COMMENT &#x27;创建时间&#x27;,</span><br><span class="line">  `gmt_modified` datetime NOT NULL COMMENT &#x27;更新时间&#x27;,</span><br><span class="line">  PRIMARY KEY (`id`),</span><br><span class="line">  KEY `idx_course_id` (`course_id`),</span><br><span class="line">  KEY `idx_chapter_id` (`chapter_id`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 ROW_FORMAT=COMPACT COMMENT=&#x27;作品视频&#x27;;</span><br></pre></td></tr></table></figure>

<h3 id="作品章节表"><a href="#作品章节表" class="headerlink" title="作品章节表"></a>作品章节表</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `video_chapter` (</span><br><span class="line">  `id` char(19) NOT NULL COMMENT &#x27;章节ID&#x27;,</span><br><span class="line">  `course_id` char(19) NOT NULL COMMENT &#x27;作品ID&#x27;,</span><br><span class="line">  `title` varchar(50) NOT NULL COMMENT &#x27;章节名称&#x27;,</span><br><span class="line">  `sort` int(10) unsigned NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;显示排序&#x27;,</span><br><span class="line">  `gmt_create` datetime NOT NULL COMMENT &#x27;创建时间&#x27;,</span><br><span class="line">  `gmt_modified` datetime NOT NULL COMMENT &#x27;更新时间&#x27;,</span><br><span class="line">  PRIMARY KEY (`id`),</span><br><span class="line">  KEY `idx_course_id` (`course_id`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 ROW_FORMAT=COMPACT COMMENT=&#x27;作品章节&#x27;;</span><br></pre></td></tr></table></figure>

<h3 id="表之间的关系"><a href="#表之间的关系" class="headerlink" title="表之间的关系"></a>表之间的关系</h3><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210408231722178-156423389.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210408231722178-156423389.png" alt="img"></a></p>
<h2 id="26-作品管理-作品信息管理"><a href="#26-作品管理-作品信息管理" class="headerlink" title="26-作品管理-作品信息管理"></a>26-作品管理-作品信息管理</h2><h3 id="Mp-生成表对应层级代码"><a href="#Mp-生成表对应层级代码" class="headerlink" title="Mp 生成表对应层级代码"></a>Mp 生成表对应层级代码</h3><p>修改 <code>CodeGeneratorTest.java</code> 复制出一个全新的测试方式，就是用来存储上一个章节中新建的表，如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210408233140556-1004237063.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210408233140556-1004237063.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CodeGeneratorTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">generate_video_author</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 1、创建代码生成器</span></span><br><span class="line">        <span class="type">AutoGenerator</span> <span class="variable">mpg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AutoGenerator</span>();</span><br><span class="line">        <span class="comment">// 2、全局配置</span></span><br><span class="line">        <span class="type">GlobalConfig</span> <span class="variable">gc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GlobalConfig</span>();</span><br><span class="line"></span><br><span class="line">        gc.setOutputDir(<span class="string">&quot;D:\\Develop\\IdeaPro\\video_parent\\service\\service_video\\src\\main\\java&quot;</span>);</span><br><span class="line">        gc.setAuthor(<span class="string">&quot;BNTang&quot;</span>);</span><br><span class="line">        <span class="comment">// 生成后是否打开资源管理器</span></span><br><span class="line">        gc.setOpen(<span class="literal">false</span>);</span><br><span class="line">        <span class="comment">// 重新生成时文件是否覆盖</span></span><br><span class="line">        gc.setFileOverride(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// mp生成 service 层代码，默认接口名称第一个字母有 I</span></span><br><span class="line">        gc.setControllerName(<span class="string">&quot;%sController&quot;</span>);</span><br><span class="line">        gc.setServiceName(<span class="string">&quot;%sService&quot;</span>);</span><br><span class="line">        gc.setServiceImplName(<span class="string">&quot;%sServiceImpl&quot;</span>);</span><br><span class="line">        gc.setMapperName(<span class="string">&quot;%sMapper&quot;</span>);</span><br><span class="line">        gc.setXmlName(<span class="string">&quot;%sMapper&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 主键策略</span></span><br><span class="line">        gc.setIdType(IdType.ID_WORKER_STR);</span><br><span class="line">        <span class="comment">// 定义生成的实体类中日期类型</span></span><br><span class="line">        gc.setDateType(DateType.ONLY_DATE);</span><br><span class="line">        <span class="comment">// 开启Swagger2模式</span></span><br><span class="line">        gc.setSwagger2(<span class="literal">true</span>);</span><br><span class="line">        mpg.setGlobalConfig(gc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、数据源配置</span></span><br><span class="line">        <span class="type">DataSourceConfig</span> <span class="variable">dsc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataSourceConfig</span>();</span><br><span class="line">        dsc.setUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/video_db?serverTimezone=GMT%2B8&quot;</span>);</span><br><span class="line">        dsc.setDriverName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">        dsc.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        dsc.setPassword(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        dsc.setDbType(DbType.MYSQL);</span><br><span class="line">        mpg.setDataSource(dsc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、包配置</span></span><br><span class="line">        <span class="type">PackageConfig</span> <span class="variable">pc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PackageConfig</span>();</span><br><span class="line">        <span class="comment">// 模块名</span></span><br><span class="line">        pc.setModuleName(<span class="string">&quot;service_video&quot;</span>);</span><br><span class="line">        pc.setParent(<span class="string">&quot;top.it6666&quot;</span>);</span><br><span class="line">        pc.setController(<span class="string">&quot;controller&quot;</span>);</span><br><span class="line">        pc.setEntity(<span class="string">&quot;entity&quot;</span>);</span><br><span class="line">        pc.setService(<span class="string">&quot;service&quot;</span>);</span><br><span class="line">        pc.setMapper(<span class="string">&quot;mapper&quot;</span>);</span><br><span class="line">        mpg.setPackageInfo(pc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5、策略配置</span></span><br><span class="line">        <span class="type">StrategyConfig</span> <span class="variable">strategy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StrategyConfig</span>();</span><br><span class="line">        strategy.setInclude(<span class="string">&quot;video_author&quot;</span>);</span><br><span class="line">        <span class="comment">// 数据库表映射到实体的命名策略,驼峰命名</span></span><br><span class="line">        strategy.setNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">        <span class="comment">// 生成实体时去掉表前缀</span></span><br><span class="line">        strategy.setTablePrefix(<span class="string">&quot;video_&quot;</span>);</span><br><span class="line">        <span class="comment">// 数据库表字段映射到实体的命名策略</span></span><br><span class="line">        strategy.setColumnNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">        <span class="comment">// lombok 模型 @Accessors(chain = true) setter链式操作</span></span><br><span class="line">        strategy.setEntityLombokModel(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">// restful api风格控制器</span></span><br><span class="line">        strategy.setRestControllerStyle(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">// url中驼峰转连字符</span></span><br><span class="line">        strategy.setControllerMappingHyphenStyle(<span class="literal">true</span>);</span><br><span class="line">        mpg.setStrategy(strategy);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6、执行</span></span><br><span class="line">        mpg.execute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">generate_video_category</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 1、创建代码生成器</span></span><br><span class="line">        <span class="type">AutoGenerator</span> <span class="variable">mpg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AutoGenerator</span>();</span><br><span class="line">        <span class="comment">// 2、全局配置</span></span><br><span class="line">        <span class="type">GlobalConfig</span> <span class="variable">gc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GlobalConfig</span>();</span><br><span class="line"></span><br><span class="line">        gc.setOutputDir(<span class="string">&quot;D:\\Develop\\IdeaPro\\video_parent\\service\\service_video\\src\\main\\java&quot;</span>);</span><br><span class="line">        gc.setAuthor(<span class="string">&quot;BNTang&quot;</span>);</span><br><span class="line">        <span class="comment">// 生成后是否打开资源管理器</span></span><br><span class="line">        gc.setOpen(<span class="literal">false</span>);</span><br><span class="line">        <span class="comment">// 重新生成时文件是否覆盖</span></span><br><span class="line">        gc.setFileOverride(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// mp生成 service 层代码，默认接口名称第一个字母有 I</span></span><br><span class="line">        gc.setControllerName(<span class="string">&quot;%sController&quot;</span>);</span><br><span class="line">        gc.setServiceName(<span class="string">&quot;%sService&quot;</span>);</span><br><span class="line">        gc.setServiceImplName(<span class="string">&quot;%sServiceImpl&quot;</span>);</span><br><span class="line">        gc.setMapperName(<span class="string">&quot;%sMapper&quot;</span>);</span><br><span class="line">        gc.setXmlName(<span class="string">&quot;%sMapper&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 主键策略</span></span><br><span class="line">        gc.setIdType(IdType.ID_WORKER_STR);</span><br><span class="line">        <span class="comment">// 定义生成的实体类中日期类型</span></span><br><span class="line">        gc.setDateType(DateType.ONLY_DATE);</span><br><span class="line">        <span class="comment">// 开启Swagger2模式</span></span><br><span class="line">        gc.setSwagger2(<span class="literal">true</span>);</span><br><span class="line">        mpg.setGlobalConfig(gc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、数据源配置</span></span><br><span class="line">        <span class="type">DataSourceConfig</span> <span class="variable">dsc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataSourceConfig</span>();</span><br><span class="line">        dsc.setUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/video_db?serverTimezone=GMT%2B8&quot;</span>);</span><br><span class="line">        dsc.setDriverName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">        dsc.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        dsc.setPassword(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        dsc.setDbType(DbType.MYSQL);</span><br><span class="line">        mpg.setDataSource(dsc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、包配置</span></span><br><span class="line">        <span class="type">PackageConfig</span> <span class="variable">pc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PackageConfig</span>();</span><br><span class="line">        <span class="comment">// 模块名</span></span><br><span class="line">        pc.setModuleName(<span class="string">&quot;service_video&quot;</span>);</span><br><span class="line">        pc.setParent(<span class="string">&quot;top.it6666&quot;</span>);</span><br><span class="line">        pc.setController(<span class="string">&quot;controller&quot;</span>);</span><br><span class="line">        pc.setEntity(<span class="string">&quot;entity&quot;</span>);</span><br><span class="line">        pc.setService(<span class="string">&quot;service&quot;</span>);</span><br><span class="line">        pc.setMapper(<span class="string">&quot;mapper&quot;</span>);</span><br><span class="line">        mpg.setPackageInfo(pc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5、策略配置</span></span><br><span class="line">        <span class="type">StrategyConfig</span> <span class="variable">strategy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StrategyConfig</span>();</span><br><span class="line">        strategy.setInclude(<span class="string">&quot;video_category&quot;</span>);</span><br><span class="line">        <span class="comment">// 数据库表映射到实体的命名策略,驼峰命名</span></span><br><span class="line">        strategy.setNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">        <span class="comment">// 生成实体时去掉表前缀</span></span><br><span class="line">        strategy.setTablePrefix(<span class="string">&quot;video_&quot;</span>);</span><br><span class="line">        <span class="comment">// 数据库表字段映射到实体的命名策略</span></span><br><span class="line">        strategy.setColumnNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">        <span class="comment">// lombok 模型 @Accessors(chain = true) setter链式操作</span></span><br><span class="line">        strategy.setEntityLombokModel(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">// restful api风格控制器</span></span><br><span class="line">        strategy.setRestControllerStyle(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">// url中驼峰转连字符</span></span><br><span class="line">        strategy.setControllerMappingHyphenStyle(<span class="literal">true</span>);</span><br><span class="line">        mpg.setStrategy(strategy);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6、执行</span></span><br><span class="line">        mpg.execute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">generate_video_chapter_video_content_video_content_description_video_content_video</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 1、创建代码生成器</span></span><br><span class="line">        <span class="type">AutoGenerator</span> <span class="variable">mpg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AutoGenerator</span>();</span><br><span class="line">        <span class="comment">// 2、全局配置</span></span><br><span class="line">        <span class="type">GlobalConfig</span> <span class="variable">gc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GlobalConfig</span>();</span><br><span class="line"></span><br><span class="line">        gc.setOutputDir(<span class="string">&quot;D:\\Develop\\IdeaPro\\video_parent\\service\\service_video\\src\\main\\java&quot;</span>);</span><br><span class="line">        gc.setAuthor(<span class="string">&quot;BNTang&quot;</span>);</span><br><span class="line">        <span class="comment">// 生成后是否打开资源管理器</span></span><br><span class="line">        gc.setOpen(<span class="literal">false</span>);</span><br><span class="line">        <span class="comment">// 重新生成时文件是否覆盖</span></span><br><span class="line">        gc.setFileOverride(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// mp生成 service 层代码，默认接口名称第一个字母有 I</span></span><br><span class="line">        gc.setControllerName(<span class="string">&quot;%sController&quot;</span>);</span><br><span class="line">        gc.setServiceName(<span class="string">&quot;%sService&quot;</span>);</span><br><span class="line">        gc.setServiceImplName(<span class="string">&quot;%sServiceImpl&quot;</span>);</span><br><span class="line">        gc.setMapperName(<span class="string">&quot;%sMapper&quot;</span>);</span><br><span class="line">        gc.setXmlName(<span class="string">&quot;%sMapper&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 主键策略</span></span><br><span class="line">        gc.setIdType(IdType.ID_WORKER_STR);</span><br><span class="line">        <span class="comment">// 定义生成的实体类中日期类型</span></span><br><span class="line">        gc.setDateType(DateType.ONLY_DATE);</span><br><span class="line">        <span class="comment">// 开启Swagger2模式</span></span><br><span class="line">        gc.setSwagger2(<span class="literal">true</span>);</span><br><span class="line">        mpg.setGlobalConfig(gc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、数据源配置</span></span><br><span class="line">        <span class="type">DataSourceConfig</span> <span class="variable">dsc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataSourceConfig</span>();</span><br><span class="line">        dsc.setUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/video_db?serverTimezone=GMT%2B8&quot;</span>);</span><br><span class="line">        dsc.setDriverName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">        dsc.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        dsc.setPassword(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        dsc.setDbType(DbType.MYSQL);</span><br><span class="line">        mpg.setDataSource(dsc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、包配置</span></span><br><span class="line">        <span class="type">PackageConfig</span> <span class="variable">pc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PackageConfig</span>();</span><br><span class="line">        <span class="comment">// 模块名</span></span><br><span class="line">        pc.setModuleName(<span class="string">&quot;service_video&quot;</span>);</span><br><span class="line">        pc.setParent(<span class="string">&quot;top.it6666&quot;</span>);</span><br><span class="line">        pc.setController(<span class="string">&quot;controller&quot;</span>);</span><br><span class="line">        pc.setEntity(<span class="string">&quot;entity&quot;</span>);</span><br><span class="line">        pc.setService(<span class="string">&quot;service&quot;</span>);</span><br><span class="line">        pc.setMapper(<span class="string">&quot;mapper&quot;</span>);</span><br><span class="line">        mpg.setPackageInfo(pc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5、策略配置</span></span><br><span class="line">        <span class="type">StrategyConfig</span> <span class="variable">strategy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StrategyConfig</span>();</span><br><span class="line">        strategy.setInclude(<span class="string">&quot;video_chapter&quot;</span>, <span class="string">&quot;video_content&quot;</span>, <span class="string">&quot;video_content_description&quot;</span>, <span class="string">&quot;video_content_video&quot;</span>);</span><br><span class="line">        <span class="comment">// 数据库表映射到实体的命名策略,驼峰命名</span></span><br><span class="line">        strategy.setNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">        <span class="comment">// 生成实体时去掉表前缀</span></span><br><span class="line">        strategy.setTablePrefix(<span class="string">&quot;video_&quot;</span>);</span><br><span class="line">        <span class="comment">// 数据库表字段映射到实体的命名策略</span></span><br><span class="line">        strategy.setColumnNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">        <span class="comment">// lombok 模型 @Accessors(chain = true) setter链式操作</span></span><br><span class="line">        strategy.setEntityLombokModel(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">// restful api风格控制器</span></span><br><span class="line">        strategy.setRestControllerStyle(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">// url中驼峰转连字符</span></span><br><span class="line">        strategy.setControllerMappingHyphenStyle(<span class="literal">true</span>);</span><br><span class="line">        mpg.setStrategy(strategy);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6、执行</span></span><br><span class="line">        mpg.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>直接拷贝我的即可，你也可以自行修改，供参考</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210408233426598-750221031.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210408233426598-750221031.png" alt="img"></a></p>
<h3 id="编写后端"><a href="#编写后端" class="headerlink" title="编写后端"></a>编写后端</h3><p><strong>保存基本信息, 接收请求</strong>, 在接收之前首先先添加一个 VO 实体，实体代码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ContentVO</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 标题</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 二级分类ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String categoryId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 一级分类ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String categoryParentId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 作者id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String authorId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 总视频数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer contentNum;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 简介</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 封面</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String cover;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 价格</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210408234514690-1922461105.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210408234514690-1922461105.png" alt="img"></a></p>
<p>紧接着修改 <code>ContentController</code> 内容如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 作品表 前端控制器</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2021-04-08</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/service_video/content&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;作品组&quot;)</span></span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ContentController</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ContentService contentService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/addContentInfo&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">addContentInfo</span><span class="params">(ContentVO contentVO)</span> &#123;</span><br><span class="line">        <span class="comment">// 调用contentService处理添加作品信息业务</span></span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok().data(<span class="string">&quot;contentId&quot;</span>, contentService.saveContentInfo(contentVO));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210408234718722-1354751802.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210408234718722-1354751802.png" alt="img"></a></p>
<p>在对应的接口当中添加对应的方法如下不贴图了，不重要的部分</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 作品表 服务类</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2021-04-08</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ContentService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;Content&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 保存基本信息</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> contentVO 基本信息实体VO</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 添加之后生成的ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">saveContentInfo</span><span class="params">(ContentVO contentVO)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现业务方法，分为两步，一，先保存基本信息，获取自增ID后再保存简介设置简介ID为刚刚自增之后得到的ID入库</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 作品表 服务实现类</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2021-04-08</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ContentServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;ContentMapper, Content&gt; <span class="keyword">implements</span> <span class="title class_">ContentService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注入简介的业务 保存简介</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ContentDescriptionService contentDescriptionService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">saveContentInfo</span><span class="params">(ContentVO contentVO)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.保存基本信息</span></span><br><span class="line">        <span class="type">Content</span> <span class="variable">content</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Content</span>();</span><br><span class="line">        BeanUtils.copyProperties(contentVO, content);</span><br><span class="line">        <span class="comment">// 1.1.保存到数据当中</span></span><br><span class="line">        baseMapper.insert(content);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.保存简介</span></span><br><span class="line">        <span class="comment">// 2.1.获取刚保存基本信息的id,之后再设置自己的简介id</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> content.getId();</span><br><span class="line">        <span class="type">ContentDescription</span> <span class="variable">contentDescription</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ContentDescription</span>();</span><br><span class="line">        contentDescription.setId(id);</span><br><span class="line">        contentDescription.setDescription(contentVO.getDescription());</span><br><span class="line">        contentDescriptionService.save(contentDescription);</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>基本信息修改，后端接口</strong>，获取一条数据，ContentController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 根据ID获取一条作品简介信息数据</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/getContentWithInfoId/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">getContentWithInfoId</span><span class="params">(<span class="meta">@PathVariable</span> String id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> ResponseResult.ok().data(<span class="string">&quot;contentVO&quot;</span>, contentService.getContentWithInfoId(id));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改 ContentService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 根据ID获取一条作品简介信息数据</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id 作品ID</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 作品简介信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">ContentVO <span class="title function_">getContentWithInfoId</span><span class="params">(String id)</span>;</span><br></pre></td></tr></table></figure>

<p>修改 ContentServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ContentVO <span class="title function_">getContentWithInfoId</span><span class="params">(String id)</span> &#123;</span><br><span class="line">    <span class="type">ContentVO</span> <span class="variable">contentVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ContentVO</span>();</span><br><span class="line">    <span class="comment">// 查询基本信息</span></span><br><span class="line">    <span class="type">Content</span> <span class="variable">content</span> <span class="operator">=</span> baseMapper.selectById(id);</span><br><span class="line">    BeanUtils.copyProperties(content, contentVO);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询简介信息</span></span><br><span class="line">    <span class="type">ContentDescription</span> <span class="variable">description</span> <span class="operator">=</span> contentDescriptionService.getById(id);</span><br><span class="line">    contentVO.setDescription(description.getDescription());</span><br><span class="line">    <span class="keyword">return</span> contentVO;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>添加，修改作品基本信息接口，修改 ContentController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 修改作品基本信息</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;updateContentInfo&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">updateContentInfo</span><span class="params">(<span class="meta">@RequestBody</span> ContentVO contentVO)</span> &#123;</span><br><span class="line">    contentService.updateContentInfo(contentVO);</span><br><span class="line">    <span class="keyword">return</span> ResponseResult.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改 ContentService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 修改作品基本信息</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> contentVO 基本信息VO实体</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">updateContentInfo</span><span class="params">(ContentVO contentVO)</span>;</span><br></pre></td></tr></table></figure>

<p>修改 ContentServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateContentInfo</span><span class="params">(ContentVO contentVO)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.修改基本信息</span></span><br><span class="line">    <span class="type">Content</span> <span class="variable">content</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Content</span>();</span><br><span class="line">    BeanUtils.copyProperties(contentVO, content);</span><br><span class="line">    baseMapper.updateById(content);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.修改描述信息</span></span><br><span class="line">    <span class="type">ContentDescription</span> <span class="variable">contentDescription</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ContentDescription</span>();</span><br><span class="line">    contentDescription.setId(content.getId());</span><br><span class="line">    contentDescription.setDescription(contentVO.getDescription());</span><br><span class="line">    contentDescriptionService.updateById(contentDescription);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="27-作品管理-作品信息管理-前端"><a href="#27-作品管理-作品信息管理-前端" class="headerlink" title="27-作品管理-作品信息管理(前端)"></a>27-作品管理-作品信息管理(前端)</h2><h3 id="基本信息"><a href="#基本信息" class="headerlink" title="基本信息"></a>基本信息</h3><h4 id="路由配置"><a href="#路由配置" class="headerlink" title="路由配置"></a>路由配置</h4><p>首先是基础路由</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210409224127210-261586653.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210409224127210-261586653.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/content&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="title class_">Layout</span>,</span><br><span class="line">  <span class="attr">redirect</span>: <span class="string">&#x27;/content/list&#x27;</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;作品管理&#x27;</span>,</span><br><span class="line">  <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;作品管理&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;el-icon-s-help&#x27;</span> &#125;,</span><br><span class="line">  <span class="attr">children</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;list&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;作品列表&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/video/content/list&#x27;</span>),</span><br><span class="line">      <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;作品列表&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;table&#x27;</span> &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;info&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;添加作品&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/video/content/info&#x27;</span>),</span><br><span class="line">      <span class="attr">meta</span>: &#123; <span class="attr">title</span>: <span class="string">&#x27;添加作品&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;tree&#x27;</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>添加切换路由</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210409224315659-1989134445.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210409224315659-1989134445.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;info/:id&#x27;</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;添加作品&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/video/content/info&#x27;</span>),</span><br><span class="line">  <span class="attr">meta</span>: &#123;<span class="attr">title</span>: <span class="string">&#x27;添加作品&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;tree&#x27;</span>&#125;,</span><br><span class="line">  <span class="attr">hidden</span>: <span class="literal">true</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;chapter/:id&#x27;</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;章节信息&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/video/content/chapter&#x27;</span>),</span><br><span class="line">  <span class="attr">meta</span>: &#123;<span class="attr">title</span>: <span class="string">&#x27;章节信息&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;tree&#x27;</span>&#125;,</span><br><span class="line">  <span class="attr">hidden</span>: <span class="literal">true</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;send/:id&#x27;</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;最终发布&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/video/content/send&#x27;</span>),</span><br><span class="line">  <span class="attr">meta</span>: &#123;<span class="attr">title</span>: <span class="string">&#x27;最终发布&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;tree&#x27;</span>&#125;,</span><br><span class="line">  <span class="attr">hidden</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如上的路由的配置主要是用来进行组件之间切换的时候使用的，自行把对应的组件新建好，如下图</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210409224526330-1153963824.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210409224526330-1153963824.png" alt="img"></a></p>
<p>到了这里，可以自行的把前端跑起来看一下</p>
<h4 id="编写添加界面"><a href="#编写添加界面" class="headerlink" title="编写添加界面"></a>编写添加界面</h4><p><strong>info</strong>，基础界面</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line">    &lt;h1&gt;添加作品&lt;/h1&gt;</span><br><span class="line">    &lt;el-steps :active=&quot;1&quot; finish-status=&quot;success&quot;&gt;</span><br><span class="line">      &lt;el-step title=&quot;填写作品基本信息&quot;&gt;&lt;/el-step&gt;</span><br><span class="line">      &lt;el-step title=&quot;添加章节视频&quot;&gt;&lt;/el-step&gt;</span><br><span class="line">      &lt;el-step title=&quot;完成&quot;&gt;&lt;/el-step&gt;</span><br><span class="line">    &lt;/el-steps&gt;</span><br><span class="line">    &lt;el-form label-width=&quot;120px&quot;&gt;</span><br><span class="line">      &lt;el-form-item label-width=&quot;作品标题&quot;&gt;</span><br><span class="line">        &lt;el-input placeholder=&quot;请填写作品标题&quot;/&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">    &lt;/el-form&gt;</span><br><span class="line">    &lt;el-button style=&quot;margin-top: 12px;&quot; @click=&quot;next&quot;&gt;下一步&lt;/el-button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;info&quot;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      active: 0</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    next() &#123;</span><br><span class="line">      // 路由跳转</span><br><span class="line">      this.$router.push(&#123;path: &#x27;/content/chapter/1&#x27;&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p><strong>chapter</strong>，基础界面</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line">    &lt;h1&gt;章节信息&lt;/h1&gt;</span><br><span class="line">    &lt;el-steps :active=&quot;2&quot; finish-status=&quot;success&quot;&gt;</span><br><span class="line">      &lt;el-step title=&quot;填写作品基本信息&quot;&gt;&lt;/el-step&gt;</span><br><span class="line">      &lt;el-step title=&quot;添加章节视频&quot;&gt;&lt;/el-step&gt;</span><br><span class="line">      &lt;el-step title=&quot;完成&quot;&gt;&lt;/el-step&gt;</span><br><span class="line">    &lt;/el-steps&gt;</span><br><span class="line">    &lt;h1&gt;章节信息&lt;/h1&gt;</span><br><span class="line">    &lt;el-button style=&quot;margin-top: 12px;&quot; @click=&quot;pre&quot;&gt;上一步&lt;/el-button&gt;</span><br><span class="line">    &lt;el-button style=&quot;margin-top: 12px;&quot; @click=&quot;next&quot;&gt;下一步&lt;/el-button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;chapter&quot;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      active: 0</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    pre() &#123;</span><br><span class="line">      this.$router.push(&#123;path: &#x27;/content/info/1&#x27;&#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    next() &#123;</span><br><span class="line">      this.$router.push(&#123;path: &#x27;/content/send/1&#x27;&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p><strong>send</strong>，基础界面</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line">    &lt;h1&gt;最终发布&lt;/h1&gt;</span><br><span class="line">    &lt;el-steps :active=&quot;3&quot; finish-status=&quot;success&quot;&gt;</span><br><span class="line">      &lt;el-step title=&quot;填写作品基本信息&quot;&gt;&lt;/el-step&gt;</span><br><span class="line">      &lt;el-step title=&quot;添加章节视频&quot;&gt;&lt;/el-step&gt;</span><br><span class="line">      &lt;el-step title=&quot;完成&quot;&gt;&lt;/el-step&gt;</span><br><span class="line">    &lt;/el-steps&gt;</span><br><span class="line">    &lt;el-button style=&quot;margin-top: 12px;&quot; @click=&quot;pre&quot;&gt;上一步&lt;/el-button&gt;</span><br><span class="line">    &lt;el-button style=&quot;margin-top: 12px;&quot;&gt;发布&lt;/el-button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;send&quot;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      active: 0</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    pre() &#123;</span><br><span class="line">      this.$router.push(&#123;path: &#x27;/content/chapter/1&#x27;&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h4 id="组件之间的跳转"><a href="#组件之间的跳转" class="headerlink" title="组件之间的跳转"></a>组件之间的跳转</h4><p>基本信息保存下一步，首先来新建一个编写 api 请求的文件如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210409231735545-787268337.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210409231735545-787268337.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// 1.作者列表-分页查询</span></span><br><span class="line">  <span class="title function_">getAuthorList</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`/service_video/author/getAuthorList`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 2.添加作品信息</span></span><br><span class="line">  <span class="title function_">addContentInfo</span>(<span class="params">contentVO</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`/service_video/content/addContentInfo`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: contentVO</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210409232207701-1640173926.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210409232207701-1640173926.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">saveAndNext</span>(<span class="params"></span>) &#123;</span><br><span class="line">  content.<span class="title function_">addContentInfo</span>(<span class="variable language_">this</span>.<span class="property">contentVO</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">      <span class="attr">message</span>: res.<span class="property">message</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//路由跳转</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123;<span class="attr">path</span>: <span class="string">&#x27;/content/chapter/&#x27;</span> + res.<span class="property">data</span>.<span class="property">contentId</span>&#125;)</span><br><span class="line">  &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">&quot;添加失败&quot;</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>发布作品界面模型绑定</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210409233025505-700989454.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210409233025505-700989454.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">active</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">contentVO</span>: &#123;</span><br><span class="line">      <span class="comment">// 标题</span></span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      <span class="comment">// 二级分类ID</span></span><br><span class="line">      <span class="attr">categoryId</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      <span class="comment">// 一级分类ID</span></span><br><span class="line">      <span class="attr">categoryParentId</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      <span class="comment">// 作者id</span></span><br><span class="line">      <span class="attr">authorId</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      <span class="comment">// 总视频数</span></span><br><span class="line">      <span class="attr">contentNum</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      <span class="comment">// 简介</span></span><br><span class="line">      <span class="attr">description</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      <span class="comment">// 封面</span></span><br><span class="line">      <span class="attr">cover</span>: <span class="built_in">require</span>(<span class="string">&#x27;@/assets/images/cover.jpg&#x27;</span>),</span><br><span class="line">      <span class="attr">price</span>: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 作者列表</span></span><br><span class="line">    <span class="attr">authorList</span>: [],</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 一级分类列表</span></span><br><span class="line">    <span class="attr">oneCategoryList</span>: [],</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 二级分类列表</span></span><br><span class="line">    <span class="attr">twoCategoryList</span>: [],</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 请求API地址</span></span><br><span class="line">    <span class="attr">BASE_API</span>: process.<span class="property">env</span>.<span class="property">VUE_APP_BASE_API</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>你也可以自己使用自己喜欢的素材图片，当然了我这里给出我文章中的素材占位图片下载地址：<a target="_blank" rel="noopener" href="https://wws.lanzous.com/i5lrvnv53eb">https://wws.lanzous.com/i5lrvnv53eb</a></p>
<p>界面绑定模型数据</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210409232939005-1407593310.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210409232939005-1407593310.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line">    &lt;h1&gt;添加作品&lt;/h1&gt;</span><br><span class="line">    &lt;el-steps :active=&quot;1&quot; finish-status=&quot;success&quot;&gt;</span><br><span class="line">      &lt;el-step title=&quot;填写作品基本信息&quot;&gt;&lt;/el-step&gt;</span><br><span class="line">      &lt;el-step title=&quot;添加章节视频&quot;&gt;&lt;/el-step&gt;</span><br><span class="line">      &lt;el-step title=&quot;完成&quot;&gt;&lt;/el-step&gt;</span><br><span class="line">    &lt;/el-steps&gt;</span><br><span class="line">    &lt;el-form label-width=&quot;120px&quot; style=&quot;margin-top: 10px&quot;&gt;</span><br><span class="line">      &lt;!--</span><br><span class="line">      标题</span><br><span class="line">      --&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;作品标题&quot;&gt;</span><br><span class="line">        &lt;el-input placeholder=&quot;请填写作品标题&quot; v-model=&quot;contentVO.title&quot;/&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!--</span><br><span class="line">      分类</span><br><span class="line">      --&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;作品分类&quot;&gt;</span><br><span class="line">        &lt;el-select placeholder=&quot;一级分类&quot; v-model=&quot;contentVO.categoryParentId&quot; @change=&quot;oneCategoryChanged&quot;&gt;</span><br><span class="line">          &lt;el-option v-for=&quot;oneCategory in oneCategoryList&quot;</span><br><span class="line">                     :key=&quot;oneCategory.id&quot;</span><br><span class="line">                     :label=&quot;oneCategory.title&quot;</span><br><span class="line">                     :value=&quot;oneCategory.id&quot;/&gt;</span><br><span class="line">        &lt;/el-select&gt;</span><br><span class="line">        &amp;nbsp;</span><br><span class="line">        &lt;el-select placeholder=&quot;二级分类&quot; v-model=&quot;contentVO.categoryId&quot;&gt;</span><br><span class="line">          &lt;el-option v-for=&quot;oneCategory in twoCategoryList&quot;</span><br><span class="line">                     :key=&quot;oneCategory.id&quot;</span><br><span class="line">                     :label=&quot;oneCategory.title&quot;</span><br><span class="line">                     :value=&quot;oneCategory.id&quot;/&gt;</span><br><span class="line">        &lt;/el-select&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!--</span><br><span class="line">      作者</span><br><span class="line">      --&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;作者&quot;&gt;</span><br><span class="line">        &lt;el-select placeholder=&quot;选择作者&quot; v-model=&quot;contentVO.authorID&quot;&gt;</span><br><span class="line">          &lt;el-option v-for=&quot;author in authorList&quot;</span><br><span class="line">                     :key=&quot;author.id&quot;</span><br><span class="line">                     :label=&quot;author.name&quot;</span><br><span class="line">                     :value=&quot;author.id&quot;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/el-select&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!--</span><br><span class="line">      总视频数</span><br><span class="line">      --&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;总视频数&quot;&gt;</span><br><span class="line">        &lt;el-input :min=&quot;0&quot; placeholder=&quot;总视频数&quot; v-model=&quot;contentVO.contentNum&quot;/&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!--</span><br><span class="line">      简介</span><br><span class="line">      --&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;作品简介&quot;&gt;</span><br><span class="line">        &lt;el-input :min=&quot;0&quot; placeholder=&quot;简介&quot; v-model=&quot;contentVO.description&quot;/&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!--</span><br><span class="line">      封面</span><br><span class="line">      --&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;作品封面&quot;&gt;</span><br><span class="line">        &lt;el-upload</span><br><span class="line">          :show-file-list=&quot;false&quot;</span><br><span class="line">          :action=&quot;BASE_API+&#x27;/service_upload/file/ossUploadFile&#x27;&quot;</span><br><span class="line">          :on-success=&quot;uploadSuccess&quot;</span><br><span class="line">          :limit=&quot;1&quot;</span><br><span class="line">          name=&quot;file&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;img :src=&quot;contentVO.cover&quot; style=&quot;width: 300px; height: 150px&quot;/&gt;</span><br><span class="line">        &lt;/el-upload&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!--</span><br><span class="line">      价格</span><br><span class="line">      --&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;价格&quot;&gt;</span><br><span class="line">        &lt;el-input :min=&quot;0&quot; placeholder=&quot;价格&quot; v-model=&quot;contentVO.price&quot;/&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">      &lt;el-button style=&quot;margin-top: 12px;&quot; type=&quot;primary&quot; @click=&quot;saveAndNext&quot;&gt;基本信息保存下一步&lt;/el-button&gt;</span><br><span class="line">    &lt;/el-form&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<p>在点击按钮之前还需要处理一下后台(等待后续所有的准备都做好了在点击进行测试按照如下步骤走)，作品ID不能让其自动生成 ，要自己手动设置需要设置成 <code>input</code></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210409234429002-1169038737.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210409234429002-1169038737.png" alt="img"></a></p>
<p>紧接着修改一下作品表的实体类，对创建时间和更新时间，逻辑删除字段进行处理如下, 当然如上图中的作品简介的也是同理，后面所有生成的实体类当中都应该设置自动填充属性，至于逻辑删除我在一一强调即可</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210409234901495-1756112629.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210409234901495-1756112629.png" alt="img"></a></p>
<p>处理下拉列表数据，首先导入对应需要使用到的 api 文件如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210409235503694-556540211.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210409235503694-556540211.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> content <span class="keyword">from</span> <span class="string">&quot;@/api/video/content/content&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> category <span class="keyword">from</span> <span class="string">&quot;@/api/video/category/category&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>在这里我说明一个东西，那么就是关于 <code>el-steps</code> 组件的问题，我这里是单独的新建了三个不同的组件进行的是组件之间的跳转，并不是 <code>el-steps</code> 的跳转，所以每个页面的 <code>el-steps</code> 状态值都是固定写死了，例如下图中的状态</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410001914550-720743373.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410001914550-720743373.png" alt="img"></a></p>
<p>作者列表</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410103522009-753850872.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410103522009-753850872.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加载所有的作者下拉列表</span></span><br><span class="line"><span class="title function_">getAuthorList</span>(<span class="params"></span>) &#123;</span><br><span class="line">  content.<span class="title function_">getAuthorList</span>().<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">authorList</span> = res.<span class="property">data</span>.<span class="property">list</span>;</span><br><span class="line">  &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">&quot;系统繁忙！&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 加载所有的作者下拉列表</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">getAuthorList</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改一下后端加载所有创作者列表的接口，返回值不是我们需要的，因为是在写 ResponseResult 之前写的，所以没有改造为这种形式需要改造一下如下图</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410103732999-1388979583.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410103732999-1388979583.png" alt="img"></a></p>
<p>渲染创作者下拉列表</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410103820511-613472604.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410103820511-613472604.png" alt="img"></a></p>
<p>分类列表</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410104037402-893256388.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410104037402-893256388.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加载所有的分类</span></span><br><span class="line"><span class="title function_">getCategoryList</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 1.获取一级分类</span></span><br><span class="line">  category.<span class="title function_">getCategoryData</span>().<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">oneCategoryList</span> = res.<span class="property">data</span>.<span class="property">list</span>;</span><br><span class="line">  &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">&quot;系统繁忙！&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>实现当一级分类发生改变时的监听事件</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410104139235-1856526447.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410104139235-1856526447.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 当一级分类改变时调用的方法，参数：当前选择的一级分类ID</span></span><br><span class="line"><span class="title function_">oneCategoryChanged</span>(<span class="params">value</span>) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">oneCategoryList</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> category = <span class="variable language_">this</span>.<span class="property">oneCategoryList</span>[i];</span><br><span class="line">    <span class="keyword">if</span> (value === category.<span class="property">id</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">twoCategoryList</span> = category.<span class="property">children</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 清空已经选择的二级分类列表</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">contentVO</span>.<span class="property">categoryId</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>渲染分类数据方式如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410104326193-1197684777.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410104326193-1197684777.png" alt="img"></a></p>
<p>完善上传封面功能，OSS上传接口在之前就已经写好了调用一下即可</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410104434009-1264321919.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410104434009-1264321919.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line">封面</span><br><span class="line">--&gt;</span><br><span class="line">&lt;el-form-item label=&quot;作品封面&quot;&gt;</span><br><span class="line">  &lt;el-upload</span><br><span class="line">    :show-file-list=&quot;false&quot;</span><br><span class="line">    :action=&quot;BASE_API+&#x27;/service_upload/file/uploadOssFile&#x27;&quot;</span><br><span class="line">    :on-success=&quot;uploadSuccess&quot;</span><br><span class="line">    :limit=&quot;1&quot;</span><br><span class="line">    name=&quot;file&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;img :src=&quot;contentVO.cover&quot; style=&quot;width: 300px; height: 150px&quot;/&gt;</span><br><span class="line">  &lt;/el-upload&gt;</span><br><span class="line">&lt;/el-form-item&gt;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410104451020-1293549236.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410104451020-1293549236.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">uploadSuccess</span>(<span class="params">res, file</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">contentVO</span>.<span class="property">cover</span> = res.<span class="property">data</span>.<span class="property">url</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>到这里添加的准备都已经完成了，还需要修改一下后端的添加接口，因为是 POST 请求，而参数又是一个对象我少加了一个 <code>@RequestBody</code> 注解如下图自行加上之后在测试添加即可，填写对应的信息</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410105013460-876477508.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410105013460-876477508.png" alt="img"></a></p>
<p>可以看到我这里已经成功了</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410105054146-1301078293.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410105054146-1301078293.png" alt="img"></a></p>
<h3 id="基本信息修改"><a href="#基本信息修改" class="headerlink" title="基本信息修改"></a>基本信息修改</h3><p>数据回显，首先在 data 中声明一个 <code>contentId</code> 属性如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410112031224-1728063425.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410112031224-1728063425.png" alt="img"></a></p>
<p>然后在 <code>created</code> 处于loading结束后，还做一些初始化，实现函数自执行（data 数据已经初始化，但是 DOM 结构渲染完成，组件没有加载）中做数据回显</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410122410954-1687948060.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410122410954-1687948060.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 思路为：判断路由当中有没有ID，如果有，就是修改，做数据回显</span></span><br><span class="line">  <span class="comment">// 获取路由当中的ID</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">params</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">params</span>.<span class="property">id</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">contentId</span> = <span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">params</span>.<span class="property">id</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据ID查询当前的作品，进行信息回显</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getInfo</span>();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 加载所有的作者下拉列表</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getAuthorList</span>();</span><br><span class="line">    <span class="comment">// 加载所有的分类</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getCategoryList</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改一下模型绑定的创作者 ID，将ID 改为 Id</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410122539985-1478603417.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410122539985-1478603417.png" alt="img"></a></p>
<p>根据ID查询当前的作品，进行信息回显, <code>this.getInfo();</code> 内容如下</p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据id获取作品信息</span></span><br><span class="line"><span class="title function_">getInfo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  content.<span class="title function_">getContentWithInfoId</span>(<span class="variable language_">this</span>.<span class="property">contentId</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">contentVO</span> = res.<span class="property">data</span>.<span class="property">contentVO</span>;</span><br><span class="line">    <span class="comment">// 1.获取一级分类</span></span><br><span class="line">    category.<span class="title function_">getCategoryData</span>().<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">oneCategoryList</span> = res.<span class="property">data</span>.<span class="property">list</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 遍历每一个一级分类 , 判断当前的contentVO 是属于哪一个一级分类</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">oneCategoryList</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">let</span> oneCategory = <span class="variable language_">this</span>.<span class="property">oneCategoryList</span>[i];</span><br><span class="line">        <span class="keyword">if</span> (oneCategory.<span class="property">id</span> === <span class="variable language_">this</span>.<span class="property">contentVO</span>.<span class="property">categoryParentId</span>) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">twoCategoryList</span> = oneCategory.<span class="property">children</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//加载作者列表</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getAuthorList</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>紧接着修改 saveAndNext 主要就是判断有 ID 就是更新没有就是添加的操作</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410122720129-1030123189.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410122720129-1030123189.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">saveAndNext</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 判断当前是添加还是更新</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">contentId</span> === <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">    content.<span class="title function_">addContentInfo</span>(<span class="variable language_">this</span>.<span class="property">contentVO</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">        <span class="attr">message</span>: res.<span class="property">message</span></span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="comment">//路由跳转</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123;<span class="attr">path</span>: <span class="string">&#x27;/content/chapter/&#x27;</span> + res.<span class="property">data</span>.<span class="property">contentId</span>&#125;)</span><br><span class="line">    &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">&quot;添加失败&quot;</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 更新操作</span></span><br><span class="line">    content.<span class="title function_">updateContentInfo</span>(<span class="variable language_">this</span>.<span class="property">contentVO</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">        <span class="attr">message</span>: res.<span class="property">message</span></span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="comment">// 路由跳转跳转到章节</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123;<span class="attr">path</span>: <span class="string">&#x27;/content/chapter/&#x27;</span> + <span class="variable language_">this</span>.<span class="property">contentId</span>&#125;)</span><br><span class="line">    &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">&quot;更新失败&quot;</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>最终 <code>info.vue</code> 代码如下所示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line">    &lt;h1&gt;添加作品&lt;/h1&gt;</span><br><span class="line">    &lt;el-steps :active=&quot;1&quot; finish-status=&quot;success&quot;&gt;</span><br><span class="line">      &lt;el-step title=&quot;填写作品基本信息&quot;&gt;&lt;/el-step&gt;</span><br><span class="line">      &lt;el-step title=&quot;添加章节视频&quot;&gt;&lt;/el-step&gt;</span><br><span class="line">      &lt;el-step title=&quot;完成&quot;&gt;&lt;/el-step&gt;</span><br><span class="line">    &lt;/el-steps&gt;</span><br><span class="line">    &lt;el-form label-width=&quot;120px&quot; style=&quot;margin-top: 10px&quot;&gt;</span><br><span class="line">      &lt;!--</span><br><span class="line">      标题</span><br><span class="line">      --&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;作品标题&quot;&gt;</span><br><span class="line">        &lt;el-input placeholder=&quot;请填写作品标题&quot; v-model=&quot;contentVO.title&quot;/&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!--</span><br><span class="line">      分类</span><br><span class="line">      --&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;作品分类&quot;&gt;</span><br><span class="line">        &lt;el-select placeholder=&quot;一级分类&quot; v-model=&quot;contentVO.categoryParentId&quot; @change=&quot;oneCategoryChanged&quot;&gt;</span><br><span class="line">          &lt;el-option v-for=&quot;oneCategory in oneCategoryList&quot;</span><br><span class="line">                     :key=&quot;oneCategory.id&quot;</span><br><span class="line">                     :label=&quot;oneCategory.title&quot;</span><br><span class="line">                     :value=&quot;oneCategory.id&quot;/&gt;</span><br><span class="line">        &lt;/el-select&gt;</span><br><span class="line">        &amp;nbsp;</span><br><span class="line">        &lt;el-select placeholder=&quot;二级分类&quot; v-model=&quot;contentVO.categoryId&quot;&gt;</span><br><span class="line">          &lt;el-option v-for=&quot;oneCategory in twoCategoryList&quot;</span><br><span class="line">                     :key=&quot;oneCategory.id&quot;</span><br><span class="line">                     :label=&quot;oneCategory.title&quot;</span><br><span class="line">                     :value=&quot;oneCategory.id&quot;/&gt;</span><br><span class="line">        &lt;/el-select&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!--</span><br><span class="line">      作者</span><br><span class="line">      --&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;作者&quot;&gt;</span><br><span class="line">        &lt;el-select placeholder=&quot;选择作者&quot; v-model=&quot;contentVO.authorId&quot;&gt;</span><br><span class="line">          &lt;el-option v-for=&quot;author in authorList&quot;</span><br><span class="line">                     :key=&quot;author.id&quot;</span><br><span class="line">                     :label=&quot;author.name&quot;</span><br><span class="line">                     :value=&quot;author.id&quot;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;/el-select&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!--</span><br><span class="line">      总视频数</span><br><span class="line">      --&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;总视频数&quot;&gt;</span><br><span class="line">        &lt;el-input :min=&quot;0&quot; placeholder=&quot;总视频数&quot; v-model=&quot;contentVO.contentNum&quot;/&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!--</span><br><span class="line">      简介</span><br><span class="line">      --&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;作品简介&quot;&gt;</span><br><span class="line">        &lt;el-input :min=&quot;0&quot; placeholder=&quot;简介&quot; v-model=&quot;contentVO.description&quot;/&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!--</span><br><span class="line">      封面</span><br><span class="line">      --&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;作品封面&quot;&gt;</span><br><span class="line">        &lt;el-upload</span><br><span class="line">          :show-file-list=&quot;false&quot;</span><br><span class="line">          :action=&quot;BASE_API+&#x27;/service_upload/file/uploadOssFile&#x27;&quot;</span><br><span class="line">          :on-success=&quot;uploadSuccess&quot;</span><br><span class="line">          :limit=&quot;1&quot;</span><br><span class="line">          name=&quot;file&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;img :src=&quot;contentVO.cover&quot; style=&quot;width: 300px; height: 150px&quot;/&gt;</span><br><span class="line">        &lt;/el-upload&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!--</span><br><span class="line">      价格</span><br><span class="line">      --&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;价格&quot;&gt;</span><br><span class="line">        &lt;el-input :min=&quot;0&quot; placeholder=&quot;价格&quot; v-model=&quot;contentVO.price&quot;/&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">      &lt;el-button style=&quot;margin-top: 12px;&quot; type=&quot;primary&quot; @click=&quot;saveAndNext&quot;&gt;基本信息保存下一步&lt;/el-button&gt;</span><br><span class="line">    &lt;/el-form&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import content from &quot;@/api/video/content/content&quot;;</span><br><span class="line">import category from &quot;@/api/video/category/category&quot;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;info&quot;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      contentVO: &#123;</span><br><span class="line">        // 标题</span><br><span class="line">        title: &#x27;&#x27;,</span><br><span class="line">        // 二级分类ID</span><br><span class="line">        categoryId: &#x27;&#x27;,</span><br><span class="line">        // 一级分类ID</span><br><span class="line">        categoryParentId: &#x27;&#x27;,</span><br><span class="line">        // 作者id</span><br><span class="line">        authorId: &#x27;&#x27;,</span><br><span class="line">        // 总视频数</span><br><span class="line">        contentNum: &#x27;&#x27;,</span><br><span class="line">        // 简介</span><br><span class="line">        description: &#x27;&#x27;,</span><br><span class="line">        // 封面</span><br><span class="line">        cover: require(&#x27;@/assets/images/cover.jpg&#x27;),</span><br><span class="line">        price: 0</span><br><span class="line">      &#125;,</span><br><span class="line">      // 作品的ID</span><br><span class="line">      contentId: &#x27;&#x27;,</span><br><span class="line">      // 作者列表</span><br><span class="line">      authorList: [],</span><br><span class="line"></span><br><span class="line">      // 一级分类列表</span><br><span class="line">      oneCategoryList: [],</span><br><span class="line"></span><br><span class="line">      // 二级分类列表</span><br><span class="line">      twoCategoryList: [],</span><br><span class="line"></span><br><span class="line">      // 请求API地址</span><br><span class="line">      BASE_API: process.env.VUE_APP_BASE_API</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    saveAndNext() &#123;</span><br><span class="line">      // 判断当前是添加还是更新</span><br><span class="line">      if (this.contentId === &#x27;&#x27;) &#123;</span><br><span class="line">        content.addContentInfo(this.contentVO).then(res =&gt; &#123;</span><br><span class="line">          this.$message(&#123;</span><br><span class="line">            type: &#x27;success&#x27;,</span><br><span class="line">            message: res.message</span><br><span class="line">          &#125;);</span><br><span class="line">          //路由跳转</span><br><span class="line">          this.$router.push(&#123;path: &#x27;/content/chapter/&#x27; + res.data.contentId&#125;)</span><br><span class="line">        &#125;).catch(error =&gt; &#123;</span><br><span class="line">          this.$message.error(&quot;添加失败&quot;);</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        // 更新操作</span><br><span class="line">        content.updateContentInfo(this.contentVO).then(res =&gt; &#123;</span><br><span class="line">          this.$message(&#123;</span><br><span class="line">            type: &#x27;success&#x27;,</span><br><span class="line">            message: res.message</span><br><span class="line">          &#125;);</span><br><span class="line">          // 路由跳转跳转到章节</span><br><span class="line">          this.$router.push(&#123;path: &#x27;/content/chapter/&#x27; + this.contentId&#125;)</span><br><span class="line">        &#125;).catch(error =&gt; &#123;</span><br><span class="line">          this.$message.error(&quot;更新失败&quot;);</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    // 加载所有的作者下拉列表</span><br><span class="line">    getAuthorList() &#123;</span><br><span class="line">      content.getAuthorList().then(res =&gt; &#123;</span><br><span class="line">        this.authorList = res.data.list;</span><br><span class="line">      &#125;).catch(error =&gt; &#123;</span><br><span class="line">        this.$message.error(&quot;系统繁忙！&quot;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 加载所有的分类</span><br><span class="line">    getCategoryList() &#123;</span><br><span class="line">      // 1.获取一级分类</span><br><span class="line">      category.getCategoryData().then(res =&gt; &#123;</span><br><span class="line">        this.oneCategoryList = res.data.list;</span><br><span class="line">      &#125;).catch(error =&gt; &#123;</span><br><span class="line">        this.$message.error(&quot;系统繁忙！&quot;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 当一级分类改变时调用的方法，参数：当前选择的一级分类ID</span><br><span class="line">    oneCategoryChanged(value) &#123;</span><br><span class="line">      for (let i = 0; i &lt; this.oneCategoryList.length; i++) &#123;</span><br><span class="line">        let category = this.oneCategoryList[i];</span><br><span class="line">        if (value === category.id) &#123;</span><br><span class="line">          this.twoCategoryList = category.children;</span><br><span class="line"></span><br><span class="line">          // 清空已经选择的二级分类列表</span><br><span class="line">          this.contentVO.categoryId = &#x27;&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    uploadSuccess(res, file) &#123;</span><br><span class="line">      this.contentVO.cover = res.data.url;</span><br><span class="line">    &#125;,</span><br><span class="line">    // 根据id获取作品信息</span><br><span class="line">    getInfo() &#123;</span><br><span class="line">      content.getContentWithInfoId(this.contentId).then(res =&gt; &#123;</span><br><span class="line">        this.contentVO = res.data.contentVO;</span><br><span class="line">        // 1.获取一级分类</span><br><span class="line">        category.getCategoryData().then(res =&gt; &#123;</span><br><span class="line">          this.oneCategoryList = res.data.list;</span><br><span class="line"></span><br><span class="line">          // 遍历每一个一级分类 , 判断当前的contentVO 是属于哪一个一级分类</span><br><span class="line">          for (let i = 0; i &lt; this.oneCategoryList.length; i++) &#123;</span><br><span class="line">            let oneCategory = this.oneCategoryList[i];</span><br><span class="line">            if (oneCategory.id === this.contentVO.categoryParentId) &#123;</span><br><span class="line">              this.twoCategoryList = oneCategory.children;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        //加载作者列表</span><br><span class="line">        this.getAuthorList();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    // 思路为：判断路由当中有没有ID，如果有，就是修改，做数据回显</span><br><span class="line">    // 获取路由当中的ID</span><br><span class="line">    if (this.$route.params &amp;&amp; this.$route.params.id) &#123;</span><br><span class="line">      this.contentId = this.$route.params.id;</span><br><span class="line"></span><br><span class="line">      // 根据ID查询当前的作品，进行信息回显</span><br><span class="line">      this.getInfo();</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      // 加载所有的作者下拉列表</span><br><span class="line">      this.getAuthorList();</span><br><span class="line">      // 加载所有的分类</span><br><span class="line">      this.getCategoryList();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>紧接着就是修改 <code>content.js</code> 把对应的 api 请求方法加上</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410122920555-932877033.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410122920555-932877033.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 3.根据id获取作品信息</span></span><br><span class="line"><span class="title function_">getContentWithInfoId</span>(<span class="params">id</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/service_video/content/getContentWithInfoId/<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 4.更新操作</span></span><br><span class="line"><span class="title function_">updateContentInfo</span>(<span class="params">contentVO</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/service_video/content/updateContentInfo`</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: contentVO</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>紧接着后端还需要完善一些信息，内容分别如下，首先是配置逻辑删除的自动填充配置如下，修改 <code>common_base</code> 模块中的 <code>MyMetaObjectHandler</code> 如下所示</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410123231761-397189292.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410123231761-397189292.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410123320888-1045056052.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410123320888-1045056052.png" alt="img"></a></p>
<p>在添加逻辑删除，添加数据的时候自动填充注解如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410123409907-971832218.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410123409907-971832218.png" alt="img"></a></p>
<p>紧接着就是把数据库里面的字段修正，单词打错了，执行如下 ALTER 语句即可修正，修改完成之后自行测试即可</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410123617566-1776841228.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410123617566-1776841228.png" alt="img"></a></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> `video_db`.`video_content` </span><br><span class="line">CHANGE <span class="keyword">COLUMN</span> `conntent_num` `content_num` <span class="type">int</span> UNSIGNED <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span> COMMENT <span class="string">&#x27;作品个数&#x27;</span> AFTER `price`;</span><br></pre></td></tr></table></figure>

<h2 id="28-作品管理-作品章节管理"><a href="#28-作品管理-作品章节管理" class="headerlink" title="28-作品管理-作品章节管理"></a>28-作品管理-作品章节管理</h2><h3 id="页面"><a href="#页面" class="headerlink" title="页面"></a>页面</h3><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410142852408-683921278.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410142852408-683921278.png" alt="img"></a></p>
<h3 id="章节列表"><a href="#章节列表" class="headerlink" title="章节列表"></a>章节列表</h3><h4 id="后端"><a href="#后端" class="headerlink" title="后端"></a>后端</h4><p>数据库模拟数据</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410143015918-203790135.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410143015918-203790135.png" alt="img"></a></p>
<p>自己去你自己的 <code>video_content</code> 表中找一个 <code>id</code> 然后替换一下我下方的SQL脚本中的ID，然后执行即可</p>
<p>sql</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`video_chapter` (`id`, `course_id`, `title`, `sort`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;1380737860695597058&#x27;</span>, <span class="string">&#x27;第一章节&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;2021-04-10 14:31:58&#x27;</span>, <span class="string">&#x27;2021-04-10 14:32:01&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`video_chapter` (`id`, `course_id`, `title`, `sort`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;1380737860695597058&#x27;</span>, <span class="string">&#x27;第二章节&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;2021-04-10 14:31:58&#x27;</span>, <span class="string">&#x27;2021-04-10 14:32:01&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>sql</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`video_content_video` (`id`, `course_id`, `chapter_id`, `title`, `video_source_id`, `video_original_name`, `sort`, `play_count`, `is_free`, `duration`, `status`, `size`, `version`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;1380737860695597058&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;第1小节&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="string">&#x27;Empty&#x27;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="string">&#x27;2021-04-10 14:33:03&#x27;</span>, <span class="string">&#x27;2021-04-10 14:33:05&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`video_content_video` (`id`, `course_id`, `chapter_id`, `title`, `video_source_id`, `video_original_name`, `sort`, `play_count`, `is_free`, `duration`, `status`, `size`, `version`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;1380737860695597058&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;第2小节&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="string">&#x27;Empty&#x27;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="string">&#x27;2021-04-10 14:33:03&#x27;</span>, <span class="string">&#x27;2021-04-10 14:33:05&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`video_content_video` (`id`, `course_id`, `chapter_id`, `title`, `video_source_id`, `video_original_name`, `sort`, `play_count`, `is_free`, `duration`, `status`, `size`, `version`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;1380737860695597058&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;第1小节&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="string">&#x27;Empty&#x27;</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="string">&#x27;2021-04-10 14:33:03&#x27;</span>, <span class="string">&#x27;2021-04-10 14:33:05&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>定义对应的 VO 实体</p>
<p><strong>ContentVideoVO</strong></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> S2.3.2Dev</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span> video_parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> Created in 2021/4/10 14:37</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 小节信息VO</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ContentVideoVO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 小节标题</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 小节是否免费</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Boolean free;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ChapterVO</strong></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> S2.3.2Dev</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span> video_parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> Created in 2021/4/10 14:36</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 作品章节VO，作品章节信息</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChapterVO</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 章节下的小节信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;ContentVideoVO&gt; children;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>定义查询嵌套章节与小节信息的数据结构接口</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410145005964-708102975.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410145005964-708102975.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;b&gt;</span></span><br><span class="line"><span class="comment"> * 获取章节嵌套形式的数据结构列表</span></span><br><span class="line"><span class="comment"> * &lt;/b&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> contentId 作品ID</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 章节小节嵌套形式的数据结构</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">List&lt;ChapterVO&gt; <span class="title function_">getChapterSection</span><span class="params">(String contentId)</span>;</span><br></pre></td></tr></table></figure>

<p>完善嵌套章节与小节信息数据结构业务</p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 作品章节 服务实现类</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2021-04-08</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChapterServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;ChapterMapper, Chapter&gt; <span class="keyword">implements</span> <span class="title class_">ChapterService</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ContentVideoService contentVideoService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;ChapterVO&gt; <span class="title function_">getChapterSection</span><span class="params">(String contentId)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.根据课程id查询课程里面所有的章节(章节)</span></span><br><span class="line">        QueryWrapper&lt;Chapter&gt; chapterQueryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        chapterQueryWrapper.eq(<span class="string">&quot;content_id&quot;</span>, contentId);</span><br><span class="line">        List&lt;Chapter&gt; chapterList = baseMapper.selectList(chapterQueryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.根据课程id查询课程里面所有的小节(小节)</span></span><br><span class="line">        QueryWrapper&lt;ContentVideo&gt; videoQueryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        videoQueryWrapper.eq(<span class="string">&quot;content_id&quot;</span>, contentId);</span><br><span class="line">        List&lt;ContentVideo&gt; contentVideoList = contentVideoService.list(videoQueryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> chapterList.stream().map(m -&gt; &#123;</span><br><span class="line">            <span class="type">ChapterVO</span> <span class="variable">chapterVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChapterVO</span>();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// chapter对象值复制到ChapterVo里面</span></span><br><span class="line">            <span class="type">ChapterVO</span> <span class="variable">chapterVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChapterVO</span>();</span><br><span class="line">            BeanUtils.copyProperties(m, chapterVo);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 创建集合，用于封装章节的小节</span></span><br><span class="line">            List&lt;ContentVideoVO&gt; subsectionList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 4.遍历查询小节list集合，进行封装</span></span><br><span class="line">            contentVideoList.forEach(a1 -&gt; &#123;</span><br><span class="line">                <span class="comment">// 判断：小节里面chapterId和章节里面id是否一样</span></span><br><span class="line">                <span class="keyword">if</span> (a1.getChapterId().equals(m.getId())) &#123;</span><br><span class="line">                    <span class="comment">// 进行封装</span></span><br><span class="line">                    <span class="type">ContentVideoVO</span> <span class="variable">videoVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ContentVideoVO</span>();</span><br><span class="line">                    BeanUtils.copyProperties(a1, videoVo);</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment">// 放到小节封装集合</span></span><br><span class="line">                    subsectionList.add(videoVo);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 把封装之后小节list集合，放到章节对象里面</span></span><br><span class="line">            chapterVo.setChildren(subsectionList);</span><br><span class="line">            <span class="keyword">return</span> chapterVO;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Controller 层代码如下</p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 作品章节 前端控制器</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2021-04-08</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/service_video/chapter&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;作品章节组&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChapterController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ChapterService chapterService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;b&gt;</span></span><br><span class="line"><span class="comment">     * 获取章节嵌套形式的数据结构列表</span></span><br><span class="line"><span class="comment">     * &lt;/b&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;获取章节嵌套形式的数据结构列表&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;getChapterContentVideo/&#123;contentId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">getChapterSection</span><span class="params">(<span class="meta">@PathVariable</span> String contentId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok().data(<span class="string">&quot;items&quot;</span>, chapterService.getChapterSection(contentId));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h4><p>在 api 当中创建 <code>chapter.js</code></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410151215860-248440827.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410151215860-248440827.png" alt="img"></a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> apiName = <span class="string">&#x27;/service_video/chapter&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">getNestedTreeList</span>(<span class="params">contentId</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;apiName&#125;</span>/getChapterContentVideo/<span class="subst">$&#123;contentId&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 chapter.vue 页面当中加载章节小节列表信息</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">import</span> chapter <span class="keyword">from</span> <span class="string">&#x27;@/api/video/content/chapter&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">active</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="comment">// 作品ID</span></span><br><span class="line">      <span class="attr">contentId</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      <span class="comment">// 章节嵌套小节列表</span></span><br><span class="line">      <span class="attr">chapterNestedList</span>: []</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 获取路由当中的id</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">params</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">params</span>.<span class="property">id</span>) &#123;</span><br><span class="line">      <span class="comment">// 获取当前作品id</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">contentId</span> = <span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">params</span>.<span class="property">id</span>;</span><br><span class="line">      <span class="comment">// 请求嵌套数据</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">getNestedTreeList</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">getNestedTreeList</span>(<span class="params"></span>) &#123;</span><br><span class="line">      chapter.<span class="title function_">getNestedTreeList</span>(<span class="variable language_">this</span>.<span class="property">contentId</span>).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">chapterNestedList</span> = response.<span class="property">data</span>.<span class="property">items</span>;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">pre</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123;<span class="attr">path</span>: <span class="string">&#x27;/content/info/&#x27;</span> + <span class="variable language_">this</span>.<span class="property">contentId</span>&#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">next</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123;<span class="attr">path</span>: <span class="string">&#x27;/content/send/&#x27;</span> + <span class="variable language_">this</span>.<span class="property">contentId</span>&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>页面结构如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line">    &lt;h1&gt;章节信息&lt;/h1&gt;</span><br><span class="line">    &lt;el-steps :active=&quot;2&quot; finish-status=&quot;success&quot;&gt;</span><br><span class="line">      &lt;el-step title=&quot;填写作品基本信息&quot;&gt;&lt;/el-step&gt;</span><br><span class="line">      &lt;el-step title=&quot;添加章节视频&quot;&gt;&lt;/el-step&gt;</span><br><span class="line">      &lt;el-step title=&quot;完成&quot;&gt;&lt;/el-step&gt;</span><br><span class="line">    &lt;/el-steps&gt;</span><br><span class="line">    &lt;el-button type=&quot;text&quot;&gt;添加章节&lt;/el-button&gt;</span><br><span class="line">    &lt;!--</span><br><span class="line">    章节</span><br><span class="line">    --&gt;</span><br><span class="line">    &lt;ul class=&quot;chapterList&quot;&gt;</span><br><span class="line">      &lt;li v-for=&quot;chapter in chapterList&quot; :key=&quot;chapter.id&quot;&gt;</span><br><span class="line">        &lt;p&gt;</span><br><span class="line">          &#123;&#123; chapter.title &#125;&#125;</span><br><span class="line">          &lt;span class=&quot;acts&quot;&gt;</span><br><span class="line">                &lt;el-button type=&quot;text&quot;&gt;添加小节&lt;/el-button&gt;</span><br><span class="line">                &lt;el-button style=&quot;&quot; type=&quot;text&quot;&gt;编辑&lt;/el-button&gt;</span><br><span class="line">                &lt;el-button type=&quot;text&quot;&gt;删除&lt;/el-button&gt;</span><br><span class="line">          &lt;/span&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &lt;!-- 视频 --&gt;</span><br><span class="line">        &lt;ul class=&quot;chapterListList sectionList&quot;&gt;</span><br><span class="line">          &lt;li v-for=&quot;section in chapter.children&quot; :key=&quot;section.id&quot;&gt;</span><br><span class="line">            &lt;p&gt;</span><br><span class="line">              &#123;&#123; section.title &#125;&#125;</span><br><span class="line">              &lt;span class=&quot;acts&quot;&gt;</span><br><span class="line">                    &lt;el-button type=&quot;text&quot;&gt;编辑&lt;/el-button&gt;</span><br><span class="line">                    &lt;el-button type=&quot;text&quot;&gt;删除&lt;/el-button&gt;</span><br><span class="line">              &lt;/span&gt;</span><br><span class="line">            &lt;/p&gt;</span><br><span class="line">          &lt;/li&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">      &lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">    &lt;el-button style=&quot;margin-top: 12px;&quot; @click=&quot;pre&quot;&gt;上一步&lt;/el-button&gt;</span><br><span class="line">    &lt;el-button style=&quot;margin-top: 12px;&quot; @click=&quot;next&quot;&gt;下一步&lt;/el-button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<p>样式代码如下</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&lt;style scoped&gt;</span><br><span class="line"><span class="selector-tag">ul</span> &#123;</span><br><span class="line">  <span class="attribute">list-style</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.chapterList</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">list-style</span>: none;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.chapterList</span> <span class="selector-tag">li</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.chapterList</span> <span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">10px</span> <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">70px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#DDD</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.chapterList</span> <span class="selector-class">.acts</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: right;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.sectionList</span> &#123;</span><br><span class="line">  <span class="attribute">padding-left</span>: <span class="number">50px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.sectionList</span> <span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">10px</span> <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> dashed <span class="number">#DDD</span>;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h3 id="章节管理后端"><a href="#章节管理后端" class="headerlink" title="章节管理后端"></a>章节管理后端</h3><p>在 <code>common_base</code> 工程当中添加自定义异常</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410173152720-1903799061.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410173152720-1903799061.png" alt="img"></a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> S2.3.2Dev</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span> video_parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> Created in 2021/4/10 17:27</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 自定义异常</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode(callSuper = true)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BnTangException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 状态码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 异常信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在全局异常处理器当中处理我们自己抛出的自定义异常</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410173357590-622873123.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410173357590-622873123.png" alt="img"></a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;b&gt;</span></span><br><span class="line"><span class="comment"> * 自定义异常</span></span><br><span class="line"><span class="comment"> * &lt;/b&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ExceptionHandler(BnTangException.class)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">error</span><span class="params">(BnTangException e)</span> &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">    <span class="keyword">return</span> ResponseResult.error().code(e.getCode()).message(e.getMsg());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来就都是修改 <code>ChapterController</code> 了如下</p>
<h4 id="新增章节"><a href="#新增章节" class="headerlink" title="新增章节"></a>新增章节</h4><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410173637713-221423494.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410173637713-221423494.png" alt="img"></a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;b&gt;</span></span><br><span class="line"><span class="comment"> * 新增章节</span></span><br><span class="line"><span class="comment"> * &lt;/b&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/addChapter&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">addChapter</span><span class="params">(<span class="meta">@RequestBody</span> Chapter chapter)</span> &#123;</span><br><span class="line">    chapterService.save(chapter);</span><br><span class="line">    <span class="keyword">return</span> ResponseResult.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="根据-ID-查询章节"><a href="#根据-ID-查询章节" class="headerlink" title="根据 ID 查询章节"></a>根据 ID 查询章节</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;b&gt;</span></span><br><span class="line"><span class="comment"> * 根据 ID 查询章节</span></span><br><span class="line"><span class="comment"> * &lt;/b&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/getChapterById/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;根据 ID 查询章节&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">getChapterById</span><span class="params">(<span class="meta">@ApiParam(name = &quot;id&quot;, value = &quot;章节ID&quot;, required = true)</span></span></span><br><span class="line"><span class="params">                                     <span class="meta">@PathVariable</span> String id)</span> &#123;</span><br><span class="line">    <span class="type">Chapter</span> <span class="variable">chapter</span> <span class="operator">=</span> chapterService.getById(id);</span><br><span class="line">    <span class="keyword">return</span> ResponseResult.ok().data(<span class="string">&quot;item&quot;</span>, chapter);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="根据-ID-修改章节"><a href="#根据-ID-修改章节" class="headerlink" title="根据 ID 修改章节"></a>根据 ID 修改章节</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;b&gt;</span></span><br><span class="line"><span class="comment"> * 根据ID修改章节</span></span><br><span class="line"><span class="comment"> * &lt;/b&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;根据ID修改章节&quot;)</span></span><br><span class="line"><span class="meta">@PutMapping(&quot;updateChapterById/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">updateChapterById</span><span class="params">(<span class="meta">@PathVariable</span> String id, <span class="meta">@RequestBody</span> Chapter chapter)</span> &#123;</span><br><span class="line">    chapter.setId(id);</span><br><span class="line">    chapterService.updateById(chapter);</span><br><span class="line">    <span class="keyword">return</span> ResponseResult.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="根据-ID-删除章节"><a href="#根据-ID-删除章节" class="headerlink" title="根据 ID 删除章节"></a>根据 ID 删除章节</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;b&gt;</span></span><br><span class="line"><span class="comment"> * 根据ID删除章节</span></span><br><span class="line"><span class="comment"> * &lt;/b&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;根据ID删除章节&quot;)</span></span><br><span class="line"><span class="meta">@DeleteMapping(&quot;deleteChapterById/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">deleteChapterById</span><span class="params">(<span class="meta">@PathVariable</span> String id)</span> &#123;</span><br><span class="line">    chapterService.deleteChapterById(id);</span><br><span class="line">    <span class="keyword">return</span> ResponseResult.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>业务类的实现和接口方法的定义都没有写的，先来看看最终 ChapterController 的代码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 作品章节 前端控制器</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2021-04-08</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/service_video/chapter&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;作品章节组&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChapterController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ChapterService chapterService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;b&gt;</span></span><br><span class="line"><span class="comment">     * 获取章节嵌套形式的数据结构列表</span></span><br><span class="line"><span class="comment">     * &lt;/b&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;获取章节嵌套形式的数据结构列表&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;getChapterContentVideo/&#123;contentId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">getChapterSection</span><span class="params">(<span class="meta">@PathVariable</span> String contentId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok().data(<span class="string">&quot;items&quot;</span>, chapterService.getChapterSection(contentId));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;b&gt;</span></span><br><span class="line"><span class="comment">     * 新增章节</span></span><br><span class="line"><span class="comment">     * &lt;/b&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/addChapter&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;新增章节&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">addChapter</span><span class="params">(<span class="meta">@RequestBody</span> Chapter chapter)</span> &#123;</span><br><span class="line">        chapterService.save(chapter);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;b&gt;</span></span><br><span class="line"><span class="comment">     * 根据 ID 查询章节</span></span><br><span class="line"><span class="comment">     * &lt;/b&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/getChapterById/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;根据 ID 查询章节&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">getChapterById</span><span class="params">(<span class="meta">@ApiParam(name = &quot;id&quot;, value = &quot;章节ID&quot;, required = true)</span></span></span><br><span class="line"><span class="params">                                         <span class="meta">@PathVariable</span> String id)</span> &#123;</span><br><span class="line">        <span class="type">Chapter</span> <span class="variable">chapter</span> <span class="operator">=</span> chapterService.getById(id);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok().data(<span class="string">&quot;item&quot;</span>, chapter);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;b&gt;</span></span><br><span class="line"><span class="comment">     * 根据ID修改章节</span></span><br><span class="line"><span class="comment">     * &lt;/b&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;根据ID修改章节&quot;)</span></span><br><span class="line">    <span class="meta">@PutMapping(&quot;updateChapterById/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">updateChapterById</span><span class="params">(<span class="meta">@PathVariable</span> String id, <span class="meta">@RequestBody</span> Chapter chapter)</span> &#123;</span><br><span class="line">        chapter.setId(id);</span><br><span class="line">        chapterService.updateById(chapter);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;b&gt;</span></span><br><span class="line"><span class="comment">     * 根据ID删除章节</span></span><br><span class="line"><span class="comment">     * &lt;/b&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;根据ID删除章节&quot;)</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;deleteChapterById/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">deleteChapterById</span><span class="params">(<span class="meta">@PathVariable</span> String id)</span> &#123;</span><br><span class="line">        chapterService.deleteChapterById(id);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>紧接着就是来添加接口方法和完成实现类如下，在 ChapterService 中添加如下方法</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410175201216-2038815760.png"><br><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410175201216-2038815760.png" alt="img"></a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;b&gt;</span></span><br><span class="line"><span class="comment"> * 根据ID删除章节</span></span><br><span class="line"><span class="comment"> * &lt;/b&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id 章节ID</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">deleteChapterById</span><span class="params">(String id)</span>;</span><br></pre></td></tr></table></figure>

<p>实现类代码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteChapterById</span><span class="params">(String id)</span> &#123;</span><br><span class="line">    <span class="comment">// 根据 id 查询是否存在小节，如果有则提示用户，有子节点</span></span><br><span class="line">    <span class="keyword">if</span> (contentVideoService.isExistContentVideoWithChapterId(id)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BnTangException</span>(<span class="number">20001</span>, <span class="string">&quot;该分章节下存在小节，请先删除小节!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    baseMapper.deleteById(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>紧接着在 <code>contentVideoService</code> 接口当中添加一个查询章节下是否存在小节的方法如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410175333890-358649908.png"><br><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410175333890-358649908.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据章节ID查询是否存在小节</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id 章节ID</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 是否存在小节</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">isExistContentVideoWithChapterId</span><span class="params">(String id)</span>;</span><br></pre></td></tr></table></figure>

<p>实现类如下，后端完毕开始前端</p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 作品视频 服务实现类</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2021-04-08</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ContentVideoServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;ContentVideoMapper, ContentVideo&gt; <span class="keyword">implements</span> <span class="title class_">ContentVideoService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isExistContentVideoWithChapterId</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        QueryWrapper&lt;ContentVideo&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;chapter_id&quot;</span>, id);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">count</span> <span class="operator">=</span> baseMapper.selectCount(queryWrapper);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span> != count &amp;&amp; count &gt; <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="章节管理前端"><a href="#章节管理前端" class="headerlink" title="章节管理前端"></a>章节管理前端</h3><h4 id="新增章节-1"><a href="#新增章节-1" class="headerlink" title="新增章节"></a>新增章节</h4><p>在 api 的 <code>chapter.js</code> 当中编写前端调用请求</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410175720138-1525538288.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410175720138-1525538288.png" alt="img"></a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2.新增章节</span></span><br><span class="line"><span class="title function_">saveChapter</span>(<span class="params">chapter</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;apiName&#125;</span>/saveChapter`</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: chapter</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>定义 data 数据</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410175835613-1375180788.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410175835613-1375180788.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 是否显示章节表单</span></span><br><span class="line"><span class="attr">dialogChapterFormVisible</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="comment">// 章节对象</span></span><br><span class="line"><span class="attr">chapter</span>: &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  <span class="attr">sort</span>: <span class="number">0</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>章节表单 <code>dialog</code></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410175949908-427544146.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410175949908-427544146.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- </span><br><span class="line">添加和修改章节表单</span><br><span class="line"> --&gt;</span><br><span class="line">&lt;el-dialog :visible.sync=&quot;dialogChapterFormVisible&quot; title=&quot;添加章节&quot;&gt;</span><br><span class="line">  &lt;el-form :model=&quot;chapter&quot; label-width=&quot;120px&quot;&gt;</span><br><span class="line">    &lt;el-form-item label=&quot;章节标题&quot;&gt;</span><br><span class="line">      &lt;el-input v-model=&quot;chapter.title&quot;/&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line">    &lt;el-form-item label=&quot;章节排序&quot;&gt;</span><br><span class="line">      &lt;el-input-number v-model=&quot;chapter.sort&quot; :min=&quot;0&quot; controls-position=&quot;right&quot;/&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line">  &lt;/el-form&gt;</span><br><span class="line">  &lt;div slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">    &lt;el-button @click=&quot;dialogChapterFormVisible = false&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">    &lt;el-button type=&quot;primary&quot; @click=&quot;saveOrUpdate&quot;&gt;确 定&lt;/el-button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/el-dialog&gt;</span><br></pre></td></tr></table></figure>

<p>定义表单提交方法</p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加或者更新</span></span><br><span class="line"><span class="title function_">saveOrUpdate</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">chapter</span>.<span class="property">id</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">saveData</span>();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">updateData</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410180527806-1928314861.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410180527806-1928314861.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">saveData</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">chapter</span>.<span class="property">contentId</span> = <span class="variable language_">this</span>.<span class="property">contentId</span>;</span><br><span class="line">  chapter.<span class="title function_">save</span>(<span class="variable language_">this</span>.<span class="property">chapter</span>).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">      <span class="attr">message</span>: response.<span class="property">message</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">      <span class="attr">message</span>: response.<span class="property">message</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>在测试添加功能之前先来修复一个 BUG，章节列表展示的问题，首先是前端</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410182531460-1756862234.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410182531460-1756862234.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410194139646-1401229106.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410194139646-1401229106.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410194414578-1605491484.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410194414578-1605491484.png" alt="img"></a></p>
<p>BUG解决，然后继续修改前端当点击 <code>添加章节</code> 的时候把表单对话框给显示出来如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410194959241-1313010079.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410194959241-1313010079.png" alt="img"></a></p>
<p>当然我这里是添加了一个方法，你可以直接把绑定的 data 值变为 <code>true</code> 即可显示, showDialog 方法内容如下</p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">showDialog</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">dialogChapterFormVisible</span> = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改一下 api 请求地址之前写错了</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410211046540-1980682861.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410211046540-1980682861.png" alt="img"></a></p>
<p>处理添加之后的数据操作，如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410211134428-1312364190.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410211134428-1312364190.png" alt="img"></a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">dialogChapterFormVisible</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="comment">// 请求嵌套数据</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="title function_">getNestedTreeList</span>();</span><br></pre></td></tr></table></figure>

<h4 id="更新章节"><a href="#更新章节" class="headerlink" title="更新章节"></a>更新章节</h4><p>添加注册事件</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410211706431-1096321833.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410211706431-1096321833.png" alt="img"></a></p>
<p>定义编辑方法</p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">editChapter</span>(<span class="params">chapterId</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">dialogChapterFormVisible</span> = <span class="literal">true</span>;</span><br><span class="line">  chapter.<span class="title function_">getChapterById</span>(chapterId).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">chapter</span> = res.<span class="property">data</span>.<span class="property">item</span>;</span><br><span class="line">  &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">&quot;系统繁忙!&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改 <code>chapter.js</code> 添加对应的 api 方法</p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 3.根据 ID 查询章节</span></span><br><span class="line"><span class="title function_">getChapterById</span>(<span class="params">chapterId</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;apiName&#125;</span>/getChapterById/<span class="subst">$&#123;chapterId&#125;</span>`</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>更新按钮点击方法实现</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410213225548-966400932.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410213225548-966400932.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加或者更新</span></span><br><span class="line"><span class="title function_">saveOrUpdate</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">chapter</span>.<span class="property">id</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">saveData</span>();</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">updateData</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>修改 <code>chapter.js</code> 添加对应的 api</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410213338281-1673517604.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410213338281-1673517604.png" alt="img"></a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 4.根据 ID 查询章节</span></span><br><span class="line"><span class="title function_">updateChapter</span>(<span class="params">chapter</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;apiName&#125;</span>/updateChapterById`</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;put&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: chapter</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 更新章节</span></span><br><span class="line"><span class="title function_">updateData</span>(<span class="params"></span>) &#123;</span><br><span class="line">  chapter.<span class="title function_">updateChapter</span>(<span class="variable language_">this</span>.<span class="property">chapter</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">success</span>(res.<span class="property">message</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dialogChapterFormVisible</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getNestedTreeList</span>();</span><br><span class="line">  &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(error.<span class="property">message</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="删除章节"><a href="#删除章节" class="headerlink" title="删除章节"></a>删除章节</h4><p>定义删除方法</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410214308420-692714135.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210410214308420-692714135.png" alt="img"></a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除章节</span></span><br><span class="line"><span class="title function_">deleteChapter</span>(<span class="params">id</span>) &#123;</span><br><span class="line">  <span class="comment">//提示</span></span><br><span class="line">  <span class="variable language_">this</span>.$confirm(<span class="string">&#x27;真的要删除嘛?&#x27;</span>, <span class="string">&#x27;提示&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">confirmButtonText</span>: <span class="string">&#x27;确定&#x27;</span>,</span><br><span class="line">    <span class="attr">cancelButtonText</span>: <span class="string">&#x27;取消&#x27;</span></span><br><span class="line">  &#125;).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 发送删除的请求</span></span><br><span class="line">    <span class="keyword">return</span> chapter.<span class="title function_">deleteChapter</span>(id);</span><br><span class="line">  &#125;).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 重新加载数据</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getNestedTreeList</span>();</span><br><span class="line">  &#125;).<span class="title function_">catch</span>((<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 取消</span></span><br><span class="line">    <span class="keyword">if</span> (error === <span class="string">&#x27;cancel&#x27;</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;info&#x27;</span>,</span><br><span class="line">        <span class="attr">message</span>: <span class="string">&#x27;取消删除&#x27;</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;));</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>编写对应的请求 api</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 5.删除章节</span></span><br><span class="line"><span class="title function_">deleteChapter</span>(<span class="params">id</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;apiName&#125;</span>/deleteChapterById/<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;delete&#x27;</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="29-作品管理-作品小节管理"><a href="#29-作品管理-作品小节管理" class="headerlink" title="29-作品管理-作品小节管理"></a>29-作品管理-作品小节管理</h2><h3 id="后端-1"><a href="#后端-1" class="headerlink" title="后端"></a>后端</h3><p>定义接收前端参数 <code>ContentVideoInfoVO</code></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> S2.3.2Dev</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span> video_parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> Created in 2021/4/10 22:03</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 作品小节接收前端参数VO</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ContentVideoInfoVO</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;视频ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;小节名称&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;作品ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String contentId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;章节ID&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String chapterId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;视频资源&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String videoSourceId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;显示排序&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer sort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;是否可以试听：0默认 1免费&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer isFree;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ContentVideoController"><a href="#ContentVideoController" class="headerlink" title="ContentVideoController"></a>ContentVideoController</h4><p>如下是 ContentVideoController 中所有的代码，比较简单主要是在 service 层代码我会额外进行解释</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 作品视频 前端控制器</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> <span class="variable">BNTang</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2021-04-08</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">@<span class="title class_">RestController</span></span><br><span class="line">@<span class="title class_">CrossOrigin</span></span><br><span class="line">@<span class="title class_">Api</span>(tags = <span class="string">&quot;作品视频组&quot;</span>)</span><br><span class="line">@<span class="title class_">RequestMapping</span>(<span class="string">&quot;/service_video/content_video&quot;</span>)</span><br><span class="line">public <span class="keyword">class</span> <span class="title class_">ContentVideoController</span> &#123;</span><br><span class="line"></span><br><span class="line">    @<span class="title class_">Resource</span></span><br><span class="line">    private <span class="title class_">ContentVideoService</span> contentVideoService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;b&gt;</span></span><br><span class="line"><span class="comment">     * 新增小节</span></span><br><span class="line"><span class="comment">     * &lt;/b&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    @<span class="title class_">ApiOperation</span>(value = <span class="string">&quot;新增小节&quot;</span>)</span><br><span class="line">    @<span class="title class_">PostMapping</span>(<span class="string">&quot;/saveVideoInfo&quot;</span>)</span><br><span class="line">    public <span class="title class_">ResponseResult</span> <span class="title function_">save</span>(<span class="params">@RequestBody ContentVideoInfoVO videoInfoForm</span>) &#123;</span><br><span class="line">        contentVideoService.<span class="title function_">saveVideoInfo</span>(videoInfoForm);</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">ResponseResult</span>.<span class="title function_">ok</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;b&gt;</span></span><br><span class="line"><span class="comment">     * 根据ID查询小节</span></span><br><span class="line"><span class="comment">     * &lt;/b&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    @<span class="title class_">ApiOperation</span>(value = <span class="string">&quot;根据ID查询小节&quot;</span>)</span><br><span class="line">    @<span class="title class_">GetMapping</span>(<span class="string">&quot;/getVideoInfo/&#123;id&#125;&quot;</span>)</span><br><span class="line">    public <span class="title class_">ResponseResult</span> <span class="title function_">getVideInfoById</span>(<span class="params">@PathVariable <span class="built_in">String</span> id</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">ResponseResult</span>.<span class="title function_">ok</span>().<span class="title function_">data</span>(<span class="string">&quot;item&quot;</span>, contentVideoService.<span class="title function_">getContentVideoInfoById</span>(id));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;b&gt;</span></span><br><span class="line"><span class="comment">     * 更新小节</span></span><br><span class="line"><span class="comment">     * &lt;/b&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    @<span class="title class_">ApiOperation</span>(value = <span class="string">&quot;更新小节&quot;</span>)</span><br><span class="line">    @<span class="title class_">PostMapping</span>(<span class="string">&quot;/updateVideoInfo&quot;</span>)</span><br><span class="line">    public <span class="title class_">ResponseResult</span> <span class="title function_">updateCourseInfoById</span>(<span class="params">@RequestBody ContentVideoInfoVO videoInfoForm</span>) &#123;</span><br><span class="line">        contentVideoService.<span class="title function_">updateVideoInfo</span>(videoInfoForm);</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">ResponseResult</span>.<span class="title function_">ok</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;b&gt;</span></span><br><span class="line"><span class="comment">     * 根据ID删除小节</span></span><br><span class="line"><span class="comment">     * &lt;/b&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    @<span class="title class_">ApiOperation</span>(value = <span class="string">&quot;根据ID删除小节&quot;</span>)</span><br><span class="line">    @<span class="title class_">PostMapping</span>(<span class="string">&quot;/deleteVideoInfo/&#123;id&#125;&quot;</span>)</span><br><span class="line">    public <span class="title class_">ResponseResult</span> <span class="title function_">removeById</span>(<span class="params">@PathVariable <span class="built_in">String</span> id</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (contentVideoService.<span class="title function_">deleteVideoById</span>(id)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title class_">ResponseResult</span>.<span class="title function_">ok</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title class_">ResponseResult</span>.<span class="title function_">error</span>().<span class="title function_">message</span>(<span class="string">&quot;删除失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ContentVideoService 接口内容如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 作品视频 服务类</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2021-04-08</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ContentVideoService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;ContentVideo&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;b&gt;</span></span><br><span class="line"><span class="comment">     * 根据章节ID查询是否存在小节</span></span><br><span class="line"><span class="comment">     * &lt;/b&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id 章节ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 是否存在小节</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isExistContentVideoWithChapterId</span><span class="params">(String id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;b&gt;</span></span><br><span class="line"><span class="comment">     * 新增小节</span></span><br><span class="line"><span class="comment">     * &lt;/b&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> contentVideoInfoVO 小节信息VO</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">saveVideoInfo</span><span class="params">(ContentVideoInfoVO contentVideoInfoVO)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;b&gt;</span></span><br><span class="line"><span class="comment">     * 根据ID查询小节</span></span><br><span class="line"><span class="comment">     * &lt;/b&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id 小节ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 小节信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ContentVideoInfoVO <span class="title function_">getContentVideoInfoById</span><span class="params">(String id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;b&gt;</span></span><br><span class="line"><span class="comment">     * 更新小节</span></span><br><span class="line"><span class="comment">     * &lt;/b&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> contentVideoInfoVO 小节信息VO</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">updateVideoInfo</span><span class="params">(ContentVideoInfoVO contentVideoInfoVO)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;b&gt;</span></span><br><span class="line"><span class="comment">     * 根据ID删除小节</span></span><br><span class="line"><span class="comment">     * &lt;/b&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id 小节ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 是否删除成功(true ： 删除成功 ， false ： 删除失败)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">deleteVideoById</span><span class="params">(String id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对应的 ContentVideoServiceImpl 实现类代码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 作品视频 服务实现类</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2021-04-08</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ContentVideoServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;ContentVideoMapper, ContentVideo&gt;</span><br><span class="line">        <span class="keyword">implements</span> <span class="title class_">ContentVideoService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isExistContentVideoWithChapterId</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        QueryWrapper&lt;ContentVideo&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;chapter_id&quot;</span>, id);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">count</span> <span class="operator">=</span> baseMapper.selectCount(queryWrapper);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span> != count &amp;&amp; count &gt; <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveVideoInfo</span><span class="params">(ContentVideoInfoVO contentVideoInfoVO)</span> &#123;</span><br><span class="line">        <span class="type">ContentVideo</span> <span class="variable">contentVideo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ContentVideo</span>();</span><br><span class="line">        BeanUtils.copyProperties(contentVideoInfoVO, contentVideo);</span><br><span class="line">        <span class="built_in">this</span>.save(contentVideo);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ContentVideoInfoVO <span class="title function_">getContentVideoInfoById</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        <span class="comment">// 从video表中取数据</span></span><br><span class="line">        <span class="type">ContentVideo</span> <span class="variable">contentVideo</span> <span class="operator">=</span> <span class="built_in">this</span>.getById(id);</span><br><span class="line">        <span class="keyword">if</span> (Objects.isNull(contentVideo)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BnTangException</span>(<span class="number">20001</span>, <span class="string">&quot;数据不存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建videoInfoForm对象</span></span><br><span class="line">        <span class="type">ContentVideoInfoVO</span> <span class="variable">contentVideoInfoVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ContentVideoInfoVO</span>();</span><br><span class="line">        BeanUtils.copyProperties(contentVideo, contentVideoInfoVO);</span><br><span class="line">        <span class="keyword">return</span> contentVideoInfoVO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateVideoInfo</span><span class="params">(ContentVideoInfoVO contentVideoInfoVO)</span> &#123;</span><br><span class="line">        <span class="type">ContentVideo</span> <span class="variable">contentVideo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ContentVideo</span>();</span><br><span class="line">        BeanUtils.copyProperties(contentVideoInfoVO, contentVideo);</span><br><span class="line">        <span class="built_in">this</span>.updateById(contentVideo);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">deleteVideoById</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        <span class="comment">// TODO 删除视频资源</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> baseMapper.deleteById(id);</span><br><span class="line">        <span class="keyword">return</span> result &gt; <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="前端-1"><a href="#前端-1" class="headerlink" title="前端"></a>前端</h3><p>在 api 当中定义 <code>content_video</code> 前端接口</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411093952061-315386762.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411093952061-315386762.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> api_name = <span class="string">&#x27;/service_video/content_video&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// 新增小节</span></span><br><span class="line">  <span class="title function_">saveVideoInfo</span>(<span class="params">videoInfo</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/saveVideoInfo`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: videoInfo</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 根据ID查询小节</span></span><br><span class="line">  <span class="title function_">getVideoInfoById</span>(<span class="params">id</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/getVideoInfo/<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 更新小节</span></span><br><span class="line">  <span class="title function_">updateVideoInfo</span>(<span class="params">videoInfo</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/updateVideoInfo`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: videoInfo</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 根据ID删除小节</span></span><br><span class="line">  <span class="title function_">deleteVideoById</span>(<span class="params">id</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/deleteVideoInfo/<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="新增小节"><a href="#新增小节" class="headerlink" title="新增小节"></a>新增小节</h4><p>定义 data 数据</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411094123840-647326632.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411094123840-647326632.png" alt="img"></a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 是否显示课时表单</span></span><br><span class="line"><span class="attr">dialogVideoFormVisible</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="comment">// 课时所在的章节id</span></span><br><span class="line"><span class="attr">chapterId</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line"><span class="comment">// 课时对象</span></span><br><span class="line"><span class="attr">contentVideo</span>: &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  <span class="attr">sort</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">isFree</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">videoSourceId</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>添加小节按钮点击事件</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411122944846-418817599.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411122944846-418817599.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-button type=&quot;text&quot;</span><br><span class="line">           @click=&quot;dialogVideoFormVisible=true;chapterId = chapter.id&quot;&gt;添加小节&lt;/el-button&gt;</span><br></pre></td></tr></table></figure>

<p>小节表单</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- </span><br><span class="line">添加和修改小节表单</span><br><span class="line">--&gt;</span><br><span class="line">&lt;el-dialog :visible.sync=&quot;dialogVideoFormVisible&quot; title=&quot;添加小节&quot;&gt;</span><br><span class="line">  &lt;el-form :model=&quot;contentVideo&quot; label-width=&quot;120px&quot;&gt;</span><br><span class="line">    &lt;el-form-item label=&quot;小节标题&quot;&gt;</span><br><span class="line">      &lt;el-input v-model=&quot;contentVideo.title&quot;/&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line">    &lt;el-form-item label=&quot;课时排序&quot;&gt;</span><br><span class="line">      &lt;el-input-number v-model=&quot;contentVideo.sort&quot; :min=&quot;0&quot; controls-position=&quot;right&quot;/&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line">    &lt;el-form-item label=&quot;是否免费&quot;&gt;</span><br><span class="line">      &lt;el-radio-group v-model=&quot;contentVideo.isFree&quot;&gt;</span><br><span class="line">        &lt;el-radio :label=&quot;true&quot;&gt;免费&lt;/el-radio&gt;</span><br><span class="line">        &lt;el-radio :label=&quot;false&quot;&gt;默认&lt;/el-radio&gt;</span><br><span class="line">      &lt;/el-radio-group&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line">    &lt;el-form-item label=&quot;上传视频&quot;&gt;</span><br><span class="line">      &lt;!-- 上传视频 --&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line">  &lt;/el-form&gt;</span><br><span class="line">  &lt;div slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">    &lt;el-button @click=&quot;dialogVideoFormVisible = false&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">    &lt;el-button type=&quot;primary&quot; @click=&quot;saveOrUpdateVideo&quot;&gt;确 定&lt;/el-button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/el-dialog&gt;</span><br></pre></td></tr></table></figure>

<p>实现添加小节按钮点击事件</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411123041706-864966159.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411123041706-864966159.png" alt="img"></a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 小节按钮点击</span></span><br><span class="line"><span class="title function_">saveOrUpdateVideo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">contentVideo</span>.<span class="property">id</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">saveDataVideo</span>()</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 保存小节数据信息</span></span><br><span class="line"><span class="title function_">saveDataVideo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">contentVideo</span>.<span class="property">contentId</span> = <span class="variable language_">this</span>.<span class="property">contentId</span>;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">contentVideo</span>.<span class="property">chapterId</span> = <span class="variable language_">this</span>.<span class="property">chapterId</span>;</span><br><span class="line">  contentVideo.<span class="title function_">saveVideoInfo</span>(<span class="variable language_">this</span>.<span class="property">contentVideo</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">      <span class="attr">message</span>: res.<span class="property">message</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 保存后, 更新相关数据</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">helpSaveVideo</span>()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>保存后, 更新相关数据</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411123217850-39115337.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411123217850-39115337.png" alt="img"></a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 保存后, 更新相关数据</span></span><br><span class="line"><span class="title function_">helpSaveVideo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">dialogVideoFormVisible</span> = <span class="literal">false</span>;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">getNestedTreeList</span>();</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">contentVideo</span> = &#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">sort</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">isFree</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">videoSourceId</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h4 id="编辑小节"><a href="#编辑小节" class="headerlink" title="编辑小节"></a>编辑小节</h4><p>添加编辑小节按钮点击事件</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411123407133-355967854.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411123407133-355967854.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-button type=&quot;text&quot; @click=&quot;editContentVideo(section.id)&quot;&gt;编辑&lt;/el-button&gt;</span><br><span class="line">&lt;el-button type=&quot;text&quot; @click=&quot;deleteContentVideo(section.id)&quot;&gt;删除&lt;/el-button&gt;</span><br></pre></td></tr></table></figure>

<p>实现数据回显</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411123518329-762173000.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411123518329-762173000.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 编辑小节按钮</span></span><br><span class="line"><span class="title function_">editContentVideo</span>(<span class="params">videoId</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">dialogVideoFormVisible</span> = <span class="literal">true</span>;</span><br><span class="line">  contentVideo.<span class="title function_">getVideoInfoById</span>(videoId).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">contentVideo</span> = response.<span class="property">data</span>.<span class="property">item</span>;</span><br><span class="line">  &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(error.<span class="property">message</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>编辑保存方法实现</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//更新小节信息</span></span><br><span class="line"><span class="title function_">updateDataVideo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  contentVideo.<span class="title function_">updateVideoInfo</span>(<span class="variable language_">this</span>.<span class="property">contentVideo</span>).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">      <span class="attr">message</span>: response.<span class="property">message</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 更新相关数据</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">helpSaveVideo</span>();</span><br><span class="line">  &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(error.<span class="property">message</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h4 id="删除小节"><a href="#删除小节" class="headerlink" title="删除小节"></a>删除小节</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">deleteContentVideo</span>(<span class="params">videoId</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.$confirm(<span class="string">&#x27;永久删除该记录, 是否继续?&#x27;</span>, <span class="string">&#x27;提示&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">confirmButtonText</span>: <span class="string">&#x27;确定&#x27;</span>,</span><br><span class="line">    <span class="attr">cancelButtonText</span>: <span class="string">&#x27;取消&#x27;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;warning&#x27;</span></span><br><span class="line">  &#125;).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> contentVideo.<span class="title function_">deleteVideoById</span>(videoId);</span><br><span class="line">  &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 刷新列表</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getNestedTreeList</span>();</span><br><span class="line">    <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">      <span class="attr">message</span>: res.<span class="property">message</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (response === <span class="string">&#x27;cancel&#x27;</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;info&#x27;</span>,</span><br><span class="line">        <span class="attr">message</span>: <span class="string">&#x27;已取消删除&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h2 id="30-作品管理-发布作品"><a href="#30-作品管理-发布作品" class="headerlink" title="30-作品管理-发布作品"></a>30-作品管理-发布作品</h2><h3 id="后端-2"><a href="#后端-2" class="headerlink" title="后端"></a>后端</h3><p>定义预览数据模型 VO, <code>ContentPreviewVO</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> S2.3.2Dev</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span> video_parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> Created in 2021/4/11 12:50</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 预览数据模型 VO</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ContentPreviewVO</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> String cover;</span><br><span class="line">    <span class="keyword">private</span> Integer contentNum;</span><br><span class="line">    <span class="keyword">private</span> String oneCategory;</span><br><span class="line">    <span class="keyword">private</span> String twoCategory;</span><br><span class="line">    <span class="keyword">private</span> String author;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 价格只用于显示所以为String</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String price;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 ContentController 当中定义接口方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;b&gt;</span></span><br><span class="line"><span class="comment"> * 获取作品的预览信息</span></span><br><span class="line"><span class="comment"> * &lt;/b&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;获取作品的预览信息&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/getContentPreView/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">getContentPreView</span><span class="params">(<span class="meta">@PathVariable</span> String id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> ResponseResult.ok().data(<span class="string">&quot;item&quot;</span>, contentService.getContentPreView(id));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改 ContentService 添加对应的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;b&gt;</span></span><br><span class="line"><span class="comment"> * 获取作品的预览信息</span></span><br><span class="line"><span class="comment"> * &lt;/b&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id 作品ID</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 预览信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">ContentPreviewVO <span class="title function_">getContentPreView</span><span class="params">(String id)</span>;</span><br></pre></td></tr></table></figure>

<p>修改 ContentServiceImpl</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411125803883-295710291.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411125803883-295710291.png" alt="img"></a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ContentPreviewVO <span class="title function_">getContentPreView</span><span class="params">(String id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> baseMapper.getContentPreviewVoById(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改 ContentMapper</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411125830692-651534126.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411125830692-651534126.png" alt="img"></a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;b&gt;</span></span><br><span class="line"><span class="comment"> * 获取作品的预览信息</span></span><br><span class="line"><span class="comment"> * &lt;/b&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id 作品ID</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 预览信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">ContentPreviewVO <span class="title function_">getContentPreviewVoById</span><span class="params">(String id)</span>;</span><br></pre></td></tr></table></figure>

<p>由于是多表之间的查询，所以不能用 MP 实现，需要自己手写SQL，修改 ContentMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;top.it6666.service_video.mapper.ContentMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getContentPreviewVoById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;top.it6666.service_video.entity.vo.ContentPreviewVO&quot;</span>&gt;</span></span><br><span class="line">        SELECT c.title,</span><br><span class="line">               c.cover,</span><br><span class="line">               c.content_num                   AS contentNum,</span><br><span class="line">               CONVERT(c.price, DECIMAL(8, 2)) AS price,</span><br><span class="line">               c1.title                        AS oneCategory,</span><br><span class="line">               c2.title                        AS twoCategory,</span><br><span class="line">               a.name                          AS author</span><br><span class="line">        FROM video_content c</span><br><span class="line">                     LEFT JOIN video_author a ON c.author_id = a.id</span><br><span class="line">                     LEFT JOIN video_category c1 ON c.category_parent_id = c1.id</span><br><span class="line">                     LEFT JOIN video_category c2 ON c.category_id = c2.id</span><br><span class="line">        WHERE c.id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>修改 <code>service_video</code> 微服务的配置文件，配置 mapper.xml 文件地址如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411130651783-2032626223.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411130651783-2032626223.png" alt="img"></a></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mapper-locations:</span> <span class="string">top/it6666/service_video/mapper/xml/*.xml</span></span><br></pre></td></tr></table></figure>

<p>而且还要配置一步，配置 maven 打包时不拦截 xml 文件，xml 也需要打包，注意是修改最外层的父工程的 <code>pom.xml</code></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411130902751-1907800683.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411130902751-1907800683.png" alt="img"></a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>发布作品</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;b&gt;</span></span><br><span class="line"><span class="comment"> * 发布作品</span></span><br><span class="line"><span class="comment"> * &lt;/b&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;发布作品&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/sendContent/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">sendContent</span><span class="params">(<span class="meta">@PathVariable</span> String id)</span> &#123;</span><br><span class="line">    contentService.sendContentWithId(id);</span><br><span class="line">    <span class="keyword">return</span> ResponseResult.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改 ContentService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;b&gt;</span></span><br><span class="line"><span class="comment"> * 发布作品</span></span><br><span class="line"><span class="comment"> * &lt;/b&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id 作品ID</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">sendContentWithId</span><span class="params">(String id)</span>;</span><br></pre></td></tr></table></figure>

<p>修改 ContentServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendContentWithId</span><span class="params">(String id)</span> &#123;</span><br><span class="line">    <span class="type">Content</span> <span class="variable">content</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Content</span>();</span><br><span class="line">    content.setId(id);</span><br><span class="line">    content.setStatus(<span class="string">&quot;Normal&quot;</span>);</span><br><span class="line">    baseMapper.updateById(content);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="前端-2"><a href="#前端-2" class="headerlink" title="前端"></a>前端</h3><p>前端界面</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411183855825-195320361.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411183855825-195320361.png" alt="img"></a></p>
<p>在 <code>conent.js</code> 当中定义 api 请求接口</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411182533858-956046926.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411182533858-956046926.png" alt="img"></a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取课程预览信息</span></span><br><span class="line"><span class="title function_">getContentPreview</span>(<span class="params">id</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/service_video/content/getContentPreView/<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 发布作品</span></span><br><span class="line"><span class="title function_">sendContent</span>(<span class="params">id</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/service_video/content/sendContent/<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 send.vue 当中定义数据模型</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411183631834-2061589320.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411183631834-2061589320.png" alt="img"></a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="comment">// 所属作品</span></span><br><span class="line">    <span class="attr">contentId</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="comment">// 预览信息实体</span></span><br><span class="line">    <span class="attr">contentSendObj</span>: &#123;&#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>导入 api</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411182921695-1935825356.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411182921695-1935825356.png" alt="img"></a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> content <span class="keyword">from</span> <span class="string">&quot;@/api/video/content/content&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>接收路由参数</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411182844777-1805961961.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411182844777-1805961961.png" alt="img"></a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">params</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">params</span>.<span class="property">id</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">contentId</span> = <span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">params</span>.<span class="property">id</span>;</span><br><span class="line">    <span class="comment">// 根据id获取作品基本信息</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getPreviewInfo</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据id获取作品基本信息</span></span><br><span class="line"><span class="title function_">getPreviewInfo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  content.<span class="title function_">getContentPreview</span>(<span class="variable language_">this</span>.<span class="property">contentId</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">contentSendObj</span> = res.<span class="property">data</span>.<span class="property">item</span>;</span><br><span class="line">  &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(error.<span class="property">message</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>定义界面，结构</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;contentInfo&quot;&gt;</span><br><span class="line">  &lt;img :src=&quot;contentSendObj.cover&quot;&gt;</span><br><span class="line">  &lt;div class=&quot;main&quot;&gt;</span><br><span class="line">    &lt;h2&gt;&#123;&#123; contentSendObj.title &#125;&#125;&lt;/h2&gt;</span><br><span class="line">    &lt;p class=&quot;gray&quot;&gt;&lt;span&gt;共&#123;&#123; contentSendObj.contentNum &#125;&#125;总数&lt;/span&gt;&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;&lt;span&gt;所属分类：&#123;&#123; contentSendObj.oneCategory &#125;&#125; — &#123;&#123; contentSendObj.twoCategory &#125;&#125;&lt;/span&gt;&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;作者：&#123;&#123; contentSendObj.author &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;h3 class=&quot;red&quot;&gt;￥&#123;&#123; contentSendObj.price &#125;&#125;&lt;/h3&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>样式如下</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">&lt;style scoped&gt;</span><br><span class="line"><span class="selector-class">.contentInfo</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#f5f5f5</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> dashed <span class="number">#DDD</span>;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">40px</span>;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.contentInfo</span> <span class="selector-tag">img</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#d6d6d6</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">500px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">278px</span>;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">border</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.contentInfo</span> <span class="selector-class">.main</span> &#123;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">520px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.contentInfo</span> <span class="selector-class">.main</span> <span class="selector-tag">h2</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">28px</span>;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: normal;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.contentInfo</span> <span class="selector-class">.main</span> <span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">word-wrap</span>: break-word;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">24px</span>;</span><br><span class="line">  <span class="attribute">max-height</span>: <span class="number">48px</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.contentInfo</span> <span class="selector-class">.main</span> <span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">word-wrap</span>: break-word;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">24px</span>;</span><br><span class="line">  <span class="attribute">max-height</span>: <span class="number">48px</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.contentInfo</span> <span class="selector-class">.main</span> <span class="selector-tag">h3</span> &#123;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">540px</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">28px</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#d32f24</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: normal;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>发布按钮点击</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411183757214-1083411520.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411183757214-1083411520.png" alt="img"></a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">send</span>(<span class="params"></span>) &#123;</span><br><span class="line">  content.<span class="title function_">sendContent</span>(<span class="variable language_">this</span>.<span class="property">contentId</span>).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 跳转到列表页</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123;<span class="attr">path</span>: <span class="string">&#x27;/content/list&#x27;</span>&#125;);</span><br><span class="line">  &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(error.<span class="property">message</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h2 id="31-作品管理-集成富文本编辑器"><a href="#31-作品管理-集成富文本编辑器" class="headerlink" title="31-作品管理-集成富文本编辑器"></a>31-作品管理-集成富文本编辑器</h2><h3 id="插件安装"><a href="#插件安装" class="headerlink" title="插件安装"></a>插件安装</h3><p><code>tinymce</code> 官方提供了一个 vue 的组件 <code>tinymce-vue</code> 安装指令如下</p>
<p>sh</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install @tinymce/tinymce-vue -S --no-fund</span><br></pre></td></tr></table></figure>

<p>sh</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install tinymce -S --no-fund</span><br></pre></td></tr></table></figure>

<p>在 <code>public</code> 文件夹中导入语言包，语言包下载地址为：<a target="_blank" rel="noopener" href="https://www.tiny.cloud/get-tiny/language-packages/">https://www.tiny.cloud/get-tiny/language-packages/</a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411184406076-368924090.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411184406076-368924090.png" alt="img"></a></p>
<p>在 node_modules 里面找到 <code>tinymce</code>, 将 <code>skins</code> 目录复制到 public&#x2F;tinymce 里面</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411185155053-1932014233.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411185155053-1932014233.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411185227592-223855948.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411185227592-223855948.png" alt="img"></a></p>
<p>语言包也要放进去</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411185307047-1532519173.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411185307047-1532519173.png" alt="img"></a></p>
<p>然后在 components 文件夹下新一个 <code>Tinymce.vue</code> 的组件内容如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411185447643-1449094900.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411185447643-1449094900.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;tinymce-box&quot;&gt;</span><br><span class="line">    &lt;editor v-model=&quot;myValue&quot;</span><br><span class="line">            :init=&quot;init&quot;</span><br><span class="line">            :disabled=&quot;disabled&quot;</span><br><span class="line">            @onClick=&quot;onClick&quot;&gt;</span><br><span class="line">    &lt;/editor&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import tinymce from &#x27;tinymce/tinymce&#x27; //tinymce默认hidden，不引入不显示</span><br><span class="line">import Editor from &#x27;@tinymce/tinymce-vue&#x27;</span><br><span class="line">import &#x27;tinymce/themes/silver&#x27;</span><br><span class="line">// 编辑器插件plugins</span><br><span class="line">// 更多插件参考：https://www.tiny.cloud/docs/plugins/</span><br><span class="line">import &#x27;tinymce/icons/default/icons.min.js&#x27;</span><br><span class="line">import &#x27;tinymce/plugins/image&#x27;// 插入上传图片插件</span><br><span class="line">import &#x27;tinymce/plugins/media&#x27;// 插入视频插件</span><br><span class="line">import &#x27;tinymce/plugins/table&#x27;// 插入表格插件</span><br><span class="line">import &#x27;tinymce/plugins/lists&#x27;// 列表插件</span><br><span class="line">import &#x27;tinymce/plugins/wordcount&#x27;// 字数统计插件</span><br><span class="line">import &#x27;tinymce/plugins/code&#x27;</span><br><span class="line">import &#x27;tinymce/plugins/link&#x27;</span><br><span class="line">import &#x27;tinymce/plugins/contextmenu&#x27;</span><br><span class="line">import &#x27;tinymce/themes/silver/theme&#x27;</span><br><span class="line">import &#x27;tinymce/plugins/colorpicker&#x27;</span><br><span class="line">import &#x27;tinymce/plugins/textcolor&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  components: &#123;</span><br><span class="line">    Editor</span><br><span class="line">  &#125;,</span><br><span class="line">  name: &#x27;tinymce&#x27;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    value: &#123;</span><br><span class="line">      type: String,</span><br><span class="line">      default: &#x27;&#x27;</span><br><span class="line">    &#125;,</span><br><span class="line">    disabled: &#123;</span><br><span class="line">      type: Boolean,</span><br><span class="line">      default: false</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: &#123;</span><br><span class="line">      type: [String, Array],</span><br><span class="line">      default: &#x27;link lists image code table colorpicker textcolor wordcount contextmenu&#x27;</span><br><span class="line">    &#125;,</span><br><span class="line">    toolbar: &#123;</span><br><span class="line">      type: [String, Array],</span><br><span class="line">      default: &#x27;bold italic underline strikethrough | fontsizeselect | forecolor backcolor | alignleft aligncenter alignright alignjustify | bullist numlist | outdent indent blockquote | undo redo | link unlink image code | removeformat&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      init: &#123;</span><br><span class="line">        language_url: &#x27;/tinymce/langs/zh_CN.js&#x27;,</span><br><span class="line">        language: &#x27;zh_CN&#x27;,</span><br><span class="line">        skin_url: &#x27;/tinymce/skins/ui/oxide&#x27;,</span><br><span class="line">        // skin_url: &#x27;tinymce/skins/ui/oxide-dark&#x27;,//暗色系</span><br><span class="line">        height: 400,</span><br><span class="line">        plugins: this.plugins,</span><br><span class="line">        toolbar: this.toolbar,</span><br><span class="line">        branding: false,</span><br><span class="line">        menubar: true,</span><br><span class="line">        // 此处为图片上传处理函数，这个直接用了base64的图片形式上传图片，</span><br><span class="line">        // 如需ajax上传可参考https://www.tiny.cloud/docs/configure/file-image-upload/#images_upload_handler</span><br><span class="line">        images_upload_handler: (blobInfo, success, failure) =&gt; &#123;</span><br><span class="line">          const img = &#x27;data:image/jpeg;base64,&#x27; + blobInfo.base64()</span><br><span class="line">          success(img)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      myValue: this.value</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted() &#123;</span><br><span class="line">    tinymce.init(&#123;&#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    // 添加相关的事件，可用的事件参照文档=&gt; https://github.com/tinymce/tinymce-vue =&gt; All available events</span><br><span class="line">    // 需要什么事件可以自己增加</span><br><span class="line">    onClick(e) &#123;</span><br><span class="line">      this.$emit(&#x27;onClick&#x27;, e, tinymce)</span><br><span class="line">    &#125;,</span><br><span class="line">    // 可以添加一些自己的自定义事件，如清空内容</span><br><span class="line">    clear() &#123;</span><br><span class="line">      this.myValue = &#x27;&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  watch: &#123;</span><br><span class="line">    value(newValue) &#123;</span><br><span class="line">      this.myValue = newValue</span><br><span class="line">    &#125;,</span><br><span class="line">    myValue(newValue) &#123;</span><br><span class="line">      this.$emit(&#x27;input&#x27;, newValue)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>然后在添加作品的时候，引用组件如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411185756753-363366872.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411185756753-363366872.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411185820812-1658466541.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210411185820812-1658466541.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;tinymce ref=&quot;editor&quot; v-model=&quot;contentVO.description&quot;/&gt;</span><br></pre></td></tr></table></figure>

<p>本博主在使用的时候已发现问题，高版本存在问题，你可以按照我如下的版本号进行锁定，你也可以试着高版本我的版本号如下图</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210413231935280-1892250264.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210413231935280-1892250264.png" alt="img"></a></p>
<p>如果修改了版本号需要重新执行一下 <code>npm install</code> 重新安装对应的依赖包</p>
<h2 id="32-作品管理-作品列表"><a href="#32-作品管理-作品列表" class="headerlink" title="32-作品管理-作品列表"></a>32-作品管理-作品列表</h2><h3 id="前端页面"><a href="#前端页面" class="headerlink" title="前端页面"></a>前端页面</h3><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210414000048982-944390826.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210414000048982-944390826.png" alt="img"></a></p>
<h3 id="后端-3"><a href="#后端-3" class="headerlink" title="后端"></a>后端</h3><p>定义列表分页查询的方法</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210413233802181-1170707460.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210413233802181-1170707460.png" alt="img"></a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;b&gt;</span></span><br><span class="line"><span class="comment"> * 分页查询作品列表方法</span></span><br><span class="line"><span class="comment"> * &lt;/b&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;分页查询作品列表方法&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/getContentPageQuery/&#123;page&#125;/&#123;limit&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">contentPageQuery</span><span class="params">(<span class="meta">@PathVariable</span> Long page, <span class="meta">@PathVariable</span> Long limit, ContentVO contentVO)</span> &#123;</span><br><span class="line">    Page&lt;Content&gt; pageParam = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page, limit);</span><br><span class="line">    contentService.contentPageQuery(pageParam, contentVO);</span><br><span class="line">    <span class="keyword">return</span> ResponseResult.ok().data(<span class="string">&quot;total&quot;</span>, pageParam.getTotal()).data(<span class="string">&quot;rows&quot;</span>, pageParam.getRecords());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改 <code>ContentService</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;b&gt;</span></span><br><span class="line"><span class="comment"> * 分页查询作品列表方法</span></span><br><span class="line"><span class="comment"> * &lt;/b&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> pageParam 分页信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> contentVO 过滤条件信息实体</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">contentPageQuery</span><span class="params">(Page&lt;Content&gt; pageParam, ContentVO contentVO)</span>;</span><br></pre></td></tr></table></figure>

<p>修改 ContentServiceImpl 实现对应的业务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contentPageQuery</span><span class="params">(Page&lt;Content&gt; pageParam, ContentVO contentVO)</span> &#123;</span><br><span class="line">    QueryWrapper&lt;Content&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.orderByDesc(<span class="string">&quot;gmt_create&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (contentVO == <span class="literal">null</span>) &#123;</span><br><span class="line">        baseMapper.selectPage(pageParam, queryWrapper);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(contentVO.getTitle())) &#123;</span><br><span class="line">        queryWrapper.like(<span class="string">&quot;title&quot;</span>, contentVO.getTitle());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(contentVO.getAuthorId())) &#123;</span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;author_id&quot;</span>, contentVO.getAuthorId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(contentVO.getCategoryParentId())) &#123;</span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;category_parent_id&quot;</span>, contentVO.getCategoryParentId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(contentVO.getCategoryId())) &#123;</span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;category_id&quot;</span>, contentVO.getCategoryId());</span><br><span class="line">    &#125;</span><br><span class="line">    baseMapper.selectPage(pageParam, queryWrapper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="前端-3"><a href="#前端-3" class="headerlink" title="前端"></a>前端</h3><p>在 content.js 当中定义请求接口</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210413234438969-1086535935.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210413234438969-1086535935.png" alt="img"></a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 作品列表</span></span><br><span class="line"><span class="title function_">getContentPageList</span>(<span class="params">page, limit, searchObj</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/service_video/content/getContentPageQuery/<span class="subst">$&#123;page&#125;</span>/<span class="subst">$&#123;limit&#125;</span>`</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">    <span class="attr">params</span>: searchObj</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 list.vue 当中引入相关组件与定义数据模型导入对应的 api 方法如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210413234252498-962153652.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210413234252498-962153652.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> content <span class="keyword">from</span> <span class="string">&quot;@/api/video/content/content&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> category <span class="keyword">from</span> <span class="string">&quot;@/api/video/category/category&quot;</span>;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210413234551836-1298067898.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210413234551836-1298067898.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="comment">// 是否显示loading信息</span></span><br><span class="line">    <span class="attr">listLoading</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// 数据列表</span></span><br><span class="line">    <span class="attr">list</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="comment">// 总记录数</span></span><br><span class="line">    <span class="attr">total</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="comment">// 页码</span></span><br><span class="line">    <span class="attr">page</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="comment">// 每页记录数</span></span><br><span class="line">    <span class="attr">limit</span>: <span class="number">10</span>,</span><br><span class="line">    <span class="comment">// 查询条件</span></span><br><span class="line">    <span class="attr">searchObj</span>: &#123;</span><br><span class="line">      <span class="attr">categoryParentId</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      <span class="attr">categoryId</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      <span class="attr">authorId</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 作者列表</span></span><br><span class="line">    <span class="attr">authorList</span>: [],</span><br><span class="line">    <span class="comment">// 一级分类列表</span></span><br><span class="line">    <span class="attr">oneCategoryList</span>: [],</span><br><span class="line">    <span class="comment">// 二级分类列表</span></span><br><span class="line">    <span class="attr">twoCategoryList</span>: []</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>初始化查询下拉列表数据</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210414220933935-1633134452.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210414220933935-1633134452.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 当页面加载时获取数据</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">getData</span>();</span><br><span class="line">  <span class="comment">// 初始化分类列表</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">getCategoryList</span>();</span><br><span class="line">  <span class="comment">// 获取讲师列表</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">initAuthorList</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">initAuthorList</span>(<span class="params"></span>) &#123;</span><br><span class="line">  content.<span class="title function_">getAuthorList</span>().<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">authorList</span> = res.<span class="property">data</span>.<span class="property">list</span>;</span><br><span class="line">  &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(error.<span class="property">message</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加载所有的分类</span></span><br><span class="line"><span class="title function_">getCategoryList</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 1.获取一级分类</span></span><br><span class="line">  category.<span class="title function_">getCategoryData</span>().<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">oneCategoryList</span> = res.<span class="property">data</span>.<span class="property">list</span>;</span><br><span class="line">  &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(error.<span class="property">message</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 当一级分类改变时调用的 方法  参数:当前一级分类选择的id</span></span><br><span class="line"><span class="title function_">oneCategoryChanged</span>(<span class="params">value</span>) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">oneCategoryList</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> category = <span class="variable language_">this</span>.<span class="property">oneCategoryList</span>[i];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (value === category.<span class="property">id</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">twoCategoryList</span> = category.<span class="property">children</span>;</span><br><span class="line">      <span class="comment">// 清空已经选择的二级分类</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">searchObj</span>.<span class="property">categoryId</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 调用api层获取数据库中的数据</span></span><br><span class="line"><span class="title function_">getData</span>(<span class="params">page = <span class="number">1</span></span>) &#123;</span><br><span class="line">  <span class="comment">// 当点击分页组件的切换按钮的时候，会传输一个当前页码的参数page</span></span><br><span class="line">  <span class="comment">// 解决分页无效问题</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">page</span> = page;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">listLoading</span> = <span class="literal">true</span>;</span><br><span class="line">  content.<span class="title function_">getContentPageList</span>(<span class="variable language_">this</span>.<span class="property">page</span>, <span class="variable language_">this</span>.<span class="property">limit</span>, <span class="variable language_">this</span>.<span class="property">searchObj</span>).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// debugger 设置断点调试</span></span><br><span class="line">    <span class="keyword">if</span> (response.<span class="property">success</span> === <span class="literal">true</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">list</span> = response.<span class="property">data</span>.<span class="property">rows</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">total</span> = response.<span class="property">data</span>.<span class="property">total</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">listLoading</span> = <span class="literal">false</span>;</span><br><span class="line">  &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(error.<span class="property">message</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">listLoading</span> = <span class="literal">false</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>搜索查询页面添加</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210414223219872-1003380283.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210414223219872-1003380283.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line">查询表单</span><br><span class="line">--&gt;</span><br><span class="line">&lt;el-form :inline=&quot;true&quot; class=&quot;demo-form-inline&quot;&gt;</span><br><span class="line">  &lt;!--</span><br><span class="line">  所属分类：级联下拉列表</span><br><span class="line">  --&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!--</span><br><span class="line">  一级分类</span><br><span class="line">  --&gt;</span><br><span class="line">  &lt;el-form-item label=&quot;分类&quot;&gt;</span><br><span class="line">    &lt;el-select</span><br><span class="line">      v-model=&quot;searchObj.categoryParentId&quot;</span><br><span class="line">      placeholder=&quot;请选择&quot;</span><br><span class="line">      @change=&quot;oneCategoryChanged&quot;&gt;</span><br><span class="line">      &lt;el-option</span><br><span class="line">        v-for=&quot;category in oneCategoryList&quot;</span><br><span class="line">        :key=&quot;category.id&quot;</span><br><span class="line">        :label=&quot;category.title&quot;</span><br><span class="line">        :value=&quot;category.id&quot;/&gt;</span><br><span class="line">    &lt;/el-select&gt;</span><br><span class="line">    &amp;nbsp;</span><br><span class="line">    &lt;!--</span><br><span class="line">    二级分类</span><br><span class="line">    --&gt;</span><br><span class="line">    &lt;el-select placeholder=&quot;请选择&quot; v-model=&quot;searchObj.categoryId&quot;&gt;</span><br><span class="line">      &lt;el-option v-for=&quot;twoCategory in twoCategoryList&quot;</span><br><span class="line">                 :key=&quot;twoCategory.id&quot;</span><br><span class="line">                 :label=&quot;twoCategory.title&quot;</span><br><span class="line">                 :value=&quot;twoCategory.id&quot;/&gt;</span><br><span class="line">    &lt;/el-select&gt;</span><br><span class="line">  &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- 标题 --&gt;</span><br><span class="line">  &lt;el-form-item&gt;</span><br><span class="line">    &lt;el-input v-model=&quot;searchObj.title&quot; placeholder=&quot;作品标题&quot;/&gt;</span><br><span class="line">  &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- 作者 --&gt;</span><br><span class="line">  &lt;el-form-item&gt;</span><br><span class="line">    &lt;el-select</span><br><span class="line">      v-model=&quot;searchObj.authorId&quot;</span><br><span class="line">      placeholder=&quot;请选择作者&quot;&gt;</span><br><span class="line">      &lt;el-option</span><br><span class="line">        v-for=&quot;author in authorList&quot;</span><br><span class="line">        :key=&quot;author.id&quot;</span><br><span class="line">        :label=&quot;author.name&quot;</span><br><span class="line">        :value=&quot;author.id&quot;/&gt;</span><br><span class="line">    &lt;/el-select&gt;</span><br><span class="line">  &lt;/el-form-item&gt;</span><br><span class="line">  &lt;el-button type=&quot;primary&quot; icon=&quot;el-icon-search&quot; @click=&quot;getData()&quot;&gt;查询&lt;/el-button&gt;</span><br><span class="line">  &lt;el-button type=&quot;default&quot; @click=&quot;resetData()&quot;&gt;清空&lt;/el-button&gt;</span><br><span class="line">&lt;/el-form&gt;</span><br></pre></td></tr></table></figure>

<p>清空方法实现</p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">resetData</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">searchObj</span> = &#123;&#125;;</span><br><span class="line">  <span class="comment">// 二级分类列表</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">twoCategoryList</span> = [];</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">getData</span>();</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>列表页面添加</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-row :gutter=&quot;15&quot;&gt;</span><br><span class="line">  &lt;el-col :span=&quot;5&quot; v-for=&quot;item in list&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;grid-content bg-purple&quot;&gt;</span><br><span class="line">      &lt;img :src=&quot;item.cover&quot; alt=&quot;scope.row.title&quot; width=&quot;100%&quot; height=&quot;150px&quot;&gt;</span><br><span class="line">      &lt;a href=&quot;#&quot; style=&quot;font-size: 14px; color: #333&quot;&gt;&#123;&#123; item.title &#125;&#125;&lt;/a&gt;</span><br><span class="line">      &lt;p style=&quot;margin-top: 0&quot;&gt;</span><br><span class="line">        &lt;router-link :to=&quot;&#x27;/content/info/&#x27;+item.id&quot;&gt;</span><br><span class="line">          &lt;el-button type=&quot;text&quot; size=&quot;mini&quot; icon=&quot;el-icon-edit&quot;&gt;编辑作品信息&lt;/el-button&gt;</span><br><span class="line">        &lt;/router-link&gt;</span><br><span class="line">        &lt;el-button style=&quot;margin-left: 100px&quot; type=&quot;text&quot; size=&quot;mini&quot;</span><br><span class="line">                   @click=&quot;deleteContentById(item.id)&quot; icon=&quot;el-icon-delete&quot;&gt;删除</span><br><span class="line">        &lt;/el-button&gt;</span><br><span class="line">      &lt;/p&gt;</span><br><span class="line">      &lt;p style=&quot;font-size: 14px; color: red; margin-top: -15px;&quot;&gt;</span><br><span class="line">        价格: &#123;&#123; Number(item.price) === 0 ? &#x27;免费&#x27; : &#x27;¥&#x27; + item.price.toFixed(2) &#125;&#125;</span><br><span class="line">      &lt;/p&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/el-col&gt;</span><br><span class="line">&lt;/el-row&gt;</span><br></pre></td></tr></table></figure>





<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 分页 --&gt;</span><br><span class="line">&lt;el-pagination</span><br><span class="line">  :current-page=&quot;page&quot;</span><br><span class="line">  :page-size=&quot;limit&quot;</span><br><span class="line">  :total=&quot;total&quot;</span><br><span class="line">  style=&quot;padding: 30px 0; text-align: center;&quot;</span><br><span class="line">  layout=&quot;total, prev, pager, next, jumper&quot;</span><br><span class="line">  @current-change=&quot;getData&quot;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>

<p>注意点：需要在最外层套一个 <code>div</code> 如下图，不然使用不了 element-ui</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210414223455533-1710072929.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210414223455533-1710072929.png" alt="img"></a></p>
<p>页面样式</p>
<p>css</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;style scoped&gt;</span><br><span class="line"><span class="selector-class">.app-container</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">1260px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.el-col</span> &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.grid-content</span> &#123;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">  <span class="attribute">min-height</span>: <span class="number">36px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">250px</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.row-bg</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#f9fafc</span>;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="33-作品管理-删除作品"><a href="#33-作品管理-删除作品" class="headerlink" title="33-作品管理-删除作品"></a>33-作品管理-删除作品</h2><h3 id="后端-4"><a href="#后端-4" class="headerlink" title="后端"></a>后端</h3><p>在 <code>ContentController</code> 当中定义接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;b&gt;</span></span><br><span class="line"><span class="comment"> * 根据作品id删除对应视频信息</span></span><br><span class="line"><span class="comment"> * &lt;/b&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;根据作品id删除对应视频信息&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/deleteContent/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">deleteContent</span><span class="params">(<span class="meta">@PathVariable</span> String id)</span> &#123;</span><br><span class="line">    contentService.deleteContentWithId(id);</span><br><span class="line">    <span class="keyword">return</span> ResponseResult.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改 ContentService 添加方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;b&gt;</span></span><br><span class="line"><span class="comment"> * 根据作品id删除对应视频信息</span></span><br><span class="line"><span class="comment"> * &lt;/b&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id 作品ID</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">deleteContentWithId</span><span class="params">(String id)</span>;</span><br></pre></td></tr></table></figure>

<p>修改 ContentServiceImpl 实现方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteContentWithId</span><span class="params">(String id)</span> &#123;</span><br><span class="line">    <span class="comment">// 根据作品的id删除作品</span></span><br><span class="line">    <span class="comment">// 1.作品章节</span></span><br><span class="line">    chapterService.deleteChapterWithContentId(id);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.作品小节视频</span></span><br><span class="line">    contentVideoService.deleteContentVideoByContentId(id);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.删除信息</span></span><br><span class="line">    baseMapper.deleteById(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改 ChapterService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;b&gt;</span></span><br><span class="line"><span class="comment"> * 根据作品id删除作品关联的所有章节</span></span><br><span class="line"><span class="comment"> * &lt;/b&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id 作品ID</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">deleteChapterWithContentId</span><span class="params">(String id)</span>;</span><br></pre></td></tr></table></figure>

<p>修改 ChapterServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteChapterWithContentId</span><span class="params">(String id)</span> &#123;</span><br><span class="line">    QueryWrapper&lt;Chapter&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(<span class="string">&quot;content_id&quot;</span>, id);</span><br><span class="line">    baseMapper.delete(queryWrapper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改 ContentVideoService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;b&gt;</span></span><br><span class="line"><span class="comment"> * 根据作品id删除对应的小节视频</span></span><br><span class="line"><span class="comment"> * &lt;/b&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id 作品id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">deleteContentVideoByContentId</span><span class="params">(String id)</span>;</span><br></pre></td></tr></table></figure>

<p>修改 ContentVideoServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteContentVideoByContentId</span><span class="params">(String id)</span> &#123;</span><br><span class="line">    QueryWrapper&lt;ContentVideo&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(<span class="string">&quot;content_id&quot;</span>, id);</span><br><span class="line">    baseMapper.delete(queryWrapper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="前端调用"><a href="#前端调用" class="headerlink" title="前端调用"></a>前端调用</h3><p>在 <code>content.js</code> 当中定义删除请求</p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除作品</span></span><br><span class="line"><span class="title function_">deleteContentById</span>(<span class="params">id</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/service_video/content/deleteContent/<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>删除按钮事件注册</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210414224247671-1554772116.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210414224247671-1554772116.png" alt="img"></a></p>
<p>实现删除事件方法</p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">deleteContentById</span>(<span class="params">id</span>) &#123;</span><br><span class="line">  <span class="comment">// debugger</span></span><br><span class="line">  <span class="variable language_">this</span>.$confirm(<span class="string">&#x27;真的的要删除该作品?&#x27;</span>, <span class="string">&#x27;提示&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">confirmButtonText</span>: <span class="string">&#x27;确定&#x27;</span>,</span><br><span class="line">    <span class="attr">cancelButtonText</span>: <span class="string">&#x27;取消&#x27;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;warning&#x27;</span></span><br><span class="line">  &#125;).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> content.<span class="title function_">deleteContentById</span>(id)</span><br><span class="line">  &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getData</span>()</span><br><span class="line">    <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">      <span class="attr">message</span>: res.<span class="property">message</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 失败</span></span><br><span class="line">  &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (response === <span class="string">&#x27;cancel&#x27;</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;info&#x27;</span>,</span><br><span class="line">        <span class="attr">message</span>: <span class="string">&#x27;已取消删除&#x27;</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h2 id="34-视频处理-阿里云视频点播技术"><a href="#34-视频处理-阿里云视频点播技术" class="headerlink" title="34-视频处理-阿里云视频点播技术"></a>34-视频处理-阿里云视频点播技术</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>视频点播（ApsaraVideo for VoD）是集音视频采集、编辑、上传、自动化转码处理、媒体资源管理、分发加速于一体的一站式音视频点播解决方案</p>
<p><strong>功能</strong></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210417121330890-116512853.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210417121330890-116512853.png" alt="img"></a></p>
<h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><p><strong>接入简单</strong></p>
<ul>
<li>几行代码就可快速接入</li>
<li>大大节省了自行开发的人力物力</li>
</ul>
<p><strong>私有加密</strong></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210417121511316-1485580635.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210417121511316-1485580635.png" alt="img"></a></p>
<ul>
<li>基于视频内容的加密, 可防止视频泄露, 有效保障视频的安全</li>
<li>每个媒体拥有独立的加密钥匙</li>
<li>提供了完善的管理机制子账号 + 播放凭证</li>
</ul>
<p><strong>视频 + AI 加速内容处理</strong></p>
<ul>
<li>视频内容智能审核</li>
<li>视频智能封面, 视频标签预测</li>
</ul>
<p><strong>窄带高清技术节省流量</strong></p>
<ul>
<li>不牺牲用户体验的前提下, 有效的节省了流量, 节约了预算</li>
</ul>
<p><strong>价格优惠</strong></p>
<ul>
<li>根据不同的需求选择不同的套餐包</li>
</ul>
<h3 id="开通地址"><a href="#开通地址" class="headerlink" title="开通地址"></a>开通地址</h3><p>阿里云 - 产品 → 视频点播</p>
<p>开通地址：<a target="_blank" rel="noopener" href="https://vod.console.aliyun.com/?spm=5176.12818093.products-grouped.dvod.49bb16d0T1n0SG#/guide">https://vod.console.aliyun.com/?spm=5176.12818093.products-grouped.dvod.49bb16d0T1n0SG#/guide</a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210417125402598-474988911.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210417125402598-474988911.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210417125331937-1135133531.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210417125331937-1135133531.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210417125349154-1902015680.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210417125349154-1902015680.png" alt="img"></a></p>
<h3 id="整体流程图"><a href="#整体流程图" class="headerlink" title="整体流程图"></a>整体流程图</h3><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210417125458815-1731518323.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210417125458815-1731518323.png" alt="img"></a></p>
<p>整体步骤如下</p>
<ul>
<li>用户获取上传授权</li>
<li>VoD 下发, 上传地址和凭证及 VideoId</li>
<li>用户上传视频保存视频 ID(VideoId)</li>
<li>用户服务端获取播放凭证</li>
<li>VoD 下发带时效的播放凭证</li>
<li>用户服务端将播放凭证下发给客户端完成视频播放</li>
</ul>
<h2 id="35-视频处理-视频点播工程创建"><a href="#35-视频处理-视频点播工程创建" class="headerlink" title="35-视频处理-视频点播工程创建"></a>35-视频处理-视频点播工程创建</h2><h4 id="创建视频点播微服务工程"><a href="#创建视频点播微服务工程" class="headerlink" title="创建视频点播微服务工程"></a>创建视频点播微服务工程</h4><p>创建工程，注意父工程为 <code>service</code></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210417130503954-698163355.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210417130503954-698163355.png" alt="img"></a></p>
<h5 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h5><p>修改总父工程依赖</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210417131759892-1074202248.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210417131759892-1074202248.png" alt="img"></a></p>
<p>xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mybatis-plus.version</span>&gt;</span>3.0.5<span class="tag">&lt;/<span class="name">mybatis-plus.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">velocity.version</span>&gt;</span>2.0<span class="tag">&lt;/<span class="name">velocity.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">swagger.version</span>&gt;</span>2.7.0<span class="tag">&lt;/<span class="name">swagger.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jodatime.version</span>&gt;</span>2.10.1<span class="tag">&lt;/<span class="name">jodatime.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">poi.version</span>&gt;</span>3.17<span class="tag">&lt;/<span class="name">poi.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">commons-fileupload.version</span>&gt;</span>1.3.1<span class="tag">&lt;/<span class="name">commons-fileupload.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">commons-io.version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">commons-io.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">httpclient.version</span>&gt;</span>4.5.1<span class="tag">&lt;/<span class="name">httpclient.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jwt.version</span>&gt;</span>0.7.0<span class="tag">&lt;/<span class="name">jwt.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aliyun-java-sdk-core.version</span>&gt;</span>4.3.3<span class="tag">&lt;/<span class="name">aliyun-java-sdk-core.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aliyun-sdk-oss.version</span>&gt;</span>3.10.2<span class="tag">&lt;/<span class="name">aliyun-sdk-oss.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aliyun-java-sdk-vod.version</span>&gt;</span>2.15.2<span class="tag">&lt;/<span class="name">aliyun-java-sdk-vod.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aliyun-sdk-vod-upload.version</span>&gt;</span>1.4.13<span class="tag">&lt;/<span class="name">aliyun-sdk-vod-upload.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fastjson.version</span>&gt;</span>1.2.28<span class="tag">&lt;/<span class="name">fastjson.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">gson.version</span>&gt;</span>2.8.2<span class="tag">&lt;/<span class="name">gson.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">json.version</span>&gt;</span>20170516<span class="tag">&lt;/<span class="name">json.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">commons-dbutils.version</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">commons-dbutils.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">canal.client.version</span>&gt;</span>1.1.0<span class="tag">&lt;/<span class="name">canal.client.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">docker.image.prefix</span>&gt;</span>zx<span class="tag">&lt;/<span class="name">docker.image.prefix</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">cloud-alibaba.version</span>&gt;</span>0.2.2.RELEASE<span class="tag">&lt;/<span class="name">cloud-alibaba.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--锁定依赖的版本--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--Spring Cloud--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>Hoxton.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;cloud-alibaba.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--mybatis-plus 持久层--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis-plus.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- velocity 模板引擎, Mybatis Plus 代码生成器需要 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.velocity<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>velocity-engine-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;velocity.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--swagger--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;swagger.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--swagger ui--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;swagger.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--aliyunOSS--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun.oss<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-sdk-oss<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;aliyun-sdk-oss.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--日期时间工具--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>joda-time<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>joda-time<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jodatime.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--xls--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;poi.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--xlsx--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi-ooxml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;poi.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--文件上传--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;commons-fileupload.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--commons-io--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;commons-io.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--httpclient--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;httpclient.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.code.gson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;gson.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- JWT --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jwt.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--aliyun--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-java-sdk-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;aliyun-java-sdk-core.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-java-sdk-vod<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;aliyun-java-sdk-vod.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-sdk-vod-upload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;aliyun-sdk-vod-upload.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;fastjson.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.json<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>json<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;json.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-dbutils<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-dbutils<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;commons-dbutils.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.otter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>canal.client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;canal.client.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>添加本地依赖，添加方式如下</p>
<p>sh</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn install:install-file -DgroupId=com.aliyun -DartifactId=aliyun-sdk-vod-upload -Dversion=1.4.13 -Dpackaging=jar -Dfile=aliyun-java-vod-upload-1.4.13.jar</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210417133929578-278203986.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210417133929578-278203986.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210417133852592-1075983752.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210417133852592-1075983752.png" alt="img"></a></p>
<p>service_vod 模块依赖如下</p>
<p>xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-java-sdk-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun.oss<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-sdk-oss<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-java-sdk-vod<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.28<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.json<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>json<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>20170516<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.code.gson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>joda-time<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>joda-time<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-sdk-vod-upload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在 <code>resources</code> 当中创建配置文件 <code>applicaiton.yml</code></p>
<p>yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application-dev.yml</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8003</span></span><br><span class="line"></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">pattern:</span></span><br><span class="line">    <span class="attr">console:</span> <span class="string">&quot;%clr(%5p) %clr(-)&#123;faint&#125; %clr(%-80.80logger&#123;79&#125;)&#123;cyan&#125; %clr(:) %m%n&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">service-vod</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">multipart:</span></span><br><span class="line">      <span class="attr">max-file-size:</span> <span class="string">1024MB</span></span><br><span class="line">      <span class="attr">max-request-size:</span> <span class="string">1024MB</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义oss相关属性</span></span><br><span class="line"><span class="attr">aliyun:</span></span><br><span class="line">  <span class="attr">keyid:</span> <span class="string">LTAI4GH19ep2P8caxW2E2N6A</span></span><br><span class="line">  <span class="attr">keysecret:</span> <span class="string">NAmWiBmKXofw7hs4JRcx7SLhF1MN6P</span></span><br></pre></td></tr></table></figure>

<p>如上配置文件当中的 <code>keyid</code> 和 <code>keysecret</code> 是我们之前做 OSS 配置文件当中的自行拷贝自己的即可如下图</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210417215823260-1144987211.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210417215823260-1144987211.png" alt="img"></a></p>
<p>在 service_vod 工程当中创建 <code>top.it6666.service_vod</code> 包在该包下创建启动类</p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication(exclude = DataSourceAutoConfiguration.class)</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &#123;&quot;top.it6666&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VodApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(VodApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建微服务点播工具类，在 utils 包中创建配置文件读取常量工具类 <code>VodConstant</code></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@project</span> video_parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 配置文件读取常量工具类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> Created in 2021/4/17 22:01</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VodConstant</span> <span class="keyword">implements</span> <span class="title class_">InitializingBean</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;aliyun.keyid&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String keyId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;aliyun.keysecret&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String keySecret;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String ACCESS_KEY_ID;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String ACCESS_KEY_SECRET;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> &#123;</span><br><span class="line">        ACCESS_KEY_ID = keyId;</span><br><span class="line">        ACCESS_KEY_SECRET = keySecret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 utils 包中创建阿里云点播初始化工具类</p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@project</span> video_parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 阿里云点播初始化工具类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> Created in 2021/4/17 22:03</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ALiYunVodSdkUtils</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> DefaultAcsClient <span class="title function_">initVodClient</span><span class="params">(String accessKeyId, String accessKeySecret)</span> <span class="keyword">throws</span> ClientException &#123;</span><br><span class="line">        <span class="comment">// 点播服务接入区域 不能修改</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">regionId</span> <span class="operator">=</span> <span class="string">&quot;cn-shanghai&quot;</span>;</span><br><span class="line">        <span class="type">DefaultProfile</span> <span class="variable">profile</span> <span class="operator">=</span> DefaultProfile.getProfile(</span><br><span class="line">                regionId,</span><br><span class="line">                accessKeyId,</span><br><span class="line">                accessKeySecret);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DefaultAcsClient</span>(profile);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210417220543823-1378154043.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210417220543823-1378154043.png" alt="img"></a></p>
<h5 id="请求接口与业务"><a href="#请求接口与业务" class="headerlink" title="请求接口与业务"></a>请求接口与业务</h5><p>在 Controller 包下创建 VodController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@project</span> video_parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 视频点播与上传请求接口与业务</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> Created in 2021/4/17 22:06</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/service_vod/vod&quot;)</span></span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;视频组&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VodController</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> VodService vodService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;b&gt;</span></span><br><span class="line"><span class="comment">     * 视频上传</span></span><br><span class="line"><span class="comment">     * &lt;/b&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;视频上传&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">uploadVideo</span><span class="params">(<span class="meta">@RequestParam(&quot;file&quot;)</span> MultipartFile file)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">videoId</span> <span class="operator">=</span> vodService.uploadVideo(file);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok().message(<span class="string">&quot;视频上传成功!&quot;</span>).data(<span class="string">&quot;videoId&quot;</span>, videoId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;b&gt;</span></span><br><span class="line"><span class="comment">     * 删除视频</span></span><br><span class="line"><span class="comment">     * &lt;/b&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;删除视频&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/delete-vod/&#123;videoId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">removeVideo</span><span class="params">(<span class="meta">@PathVariable</span> String videoId)</span> &#123;</span><br><span class="line">        vodService.deleteVideo(videoId);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok().message(<span class="string">&quot;视频删除成功!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上传业务与删除业务，在 service 包下创建 <code>VodService</code></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210417221230478-2126749140.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210417221230478-2126749140.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@project</span> video_parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 视频组业务</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> Created in 2021/4/17 22:10</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">VodService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 上传视频</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file 视频文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 上传结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">uploadVideo</span><span class="params">(MultipartFile file)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 根据 videoId 删除对应的视频</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> videoId 删除结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deleteVideo</span><span class="params">(String videoId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>紧接着在 service 包当中创建 impl 包在创建对应的 <code>VodServiceImpl</code> 实现类如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210417222155555-652302230.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210417222155555-652302230.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@project</span> video_parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 视频组业务实现类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> Created in 2021/4/17 22:13</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VodServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">VodService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">uploadVideo</span><span class="params">(MultipartFile file)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 获取文件输入流</span></span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> file.getInputStream();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 获取文件名</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> Optional.ofNullable(file.getOriginalFilename()).orElse(<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//截取标题</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">title</span> <span class="operator">=</span> originalFilename.substring(<span class="number">0</span>, originalFilename.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 获取上传请求</span></span><br><span class="line">            <span class="type">UploadStreamRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UploadStreamRequest</span>(</span><br><span class="line">                    VodConstant.ACCESS_KEY_ID,</span><br><span class="line">                    VodConstant.ACCESS_KEY_SECRET,</span><br><span class="line">                    title, originalFilename, inputStream);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 开始上传</span></span><br><span class="line">            <span class="type">UploadVideoImpl</span> <span class="variable">uploader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UploadVideoImpl</span>();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 上传完毕后,服务器给于响应</span></span><br><span class="line">            <span class="type">UploadStreamResponse</span> <span class="variable">response</span> <span class="operator">=</span> uploader.uploadStream(request);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 如果设置回调URL无效，不影响视频上传，可以返回VideoId同时会返回错误码。</span></span><br><span class="line">            <span class="comment">// 其他情况上传失败时，VideoId为空，此时需要根据返回错误码分析具体错误原因</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">videoId</span> <span class="operator">=</span> response.getVideoId();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!response.isSuccess()) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">errorMessage</span> <span class="operator">=</span></span><br><span class="line">                        <span class="string">&quot;阿里云上传错误：&quot;</span> + <span class="string">&quot;code：&quot;</span> + response.getCode() + <span class="string">&quot;, message：&quot;</span> + response.getMessage();</span><br><span class="line">                <span class="keyword">if</span> (StringUtils.isEmpty(videoId)) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BnTangException</span>(<span class="number">20001</span>, errorMessage);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> videoId;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BnTangException</span>(<span class="number">20001</span>, <span class="string">&quot;vod 服务上传失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteVideo</span><span class="params">(String videoId)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 获取客户端请求</span></span><br><span class="line">            <span class="type">DefaultAcsClient</span> <span class="variable">client</span> <span class="operator">=</span> ALiYunVodSdkUtils.initVodClient(</span><br><span class="line">                    VodConstant.ACCESS_KEY_ID,</span><br><span class="line">                    VodConstant.ACCESS_KEY_SECRET);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 创建删除请求</span></span><br><span class="line">            <span class="type">DeleteVideoRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeleteVideoRequest</span>();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 设置要删除的视频ID</span></span><br><span class="line">            request.setVideoIds(videoId);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 删除请求后服务器给予的响应</span></span><br><span class="line">            client.getAcsResponse(request);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClientException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BnTangException</span>(<span class="number">20001</span>, <span class="string">&quot;视频删除失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="36-视频处理-小节视频上传前端"><a href="#36-视频处理-小节视频上传前端" class="headerlink" title="36-视频处理-小节视频上传前端"></a>36-视频处理-小节视频上传前端</h2><p>在 nginx 当中配置上传地址与最大上传容量</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210417223059922-987319884.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210417223059922-987319884.png" alt="img"></a></p>
<p>text</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">client_max_body_size 1024m;</span><br></pre></td></tr></table></figure>

<p>text</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location ~ /service_vod &#123;</span><br><span class="line">	proxy_pass http://localhost:8003;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 api 当中创建 <code>vod.js</code> 前端请求文件</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210417225120234-806477469.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210417225120234-806477469.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">API_NAME</span> = <span class="string">&#x27;/service_vod/vod&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">deleteVodById</span>(<span class="params">id</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;API_NAME&#125;</span>/delete_vod/<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改后端首先是接口路径名称如下，然后紧接着就是修改 <code>ContentVideoInfoVO</code> 添加一个新的字段</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418102402175-1560501479.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418102402175-1560501479.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418102533481-1313532385.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418102533481-1313532385.png" alt="img"></a></p>
<p>在 chapte.vue 当中定义相关属性</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418102649547-1889437056.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418102649547-1889437056.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 小节视频标题</span></span><br><span class="line"><span class="attr">videoOriginalName</span>: <span class="string">&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 上传文件列表</span></span><br><span class="line"><span class="attr">fileList</span>: [],</span><br><span class="line"><span class="attr">BASE_API</span>: process.<span class="property">env</span>.<span class="property">VUE_APP_BASE_API</span></span><br></pre></td></tr></table></figure>

<p>导入 vod 请求文件</p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> vod <span class="keyword">from</span> <span class="string">&quot;@/api/video/vod/vod&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>添加上传组件</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418103200389-1125525207.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418103200389-1125525207.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-form-item label=&quot;上传视频&quot;&gt;</span><br><span class="line">  &lt;!-- 上传视频 --&gt;</span><br><span class="line">  &lt;el-upload</span><br><span class="line">    :on-success=&quot;handleVodUploadSuccess&quot;</span><br><span class="line">    :on-remove=&quot;handleVodRemove&quot;</span><br><span class="line">    :before-remove=&quot;beforeVodRemove&quot;</span><br><span class="line">    :on-exceed=&quot;handleUploadExceed&quot;</span><br><span class="line">    :file-list=&quot;fileList&quot;</span><br><span class="line">    :action=&quot;BASE_API+&#x27;/service_vod/vod/upload&#x27;&quot;</span><br><span class="line">    :limit=&quot;1&quot;</span><br><span class="line">    class=&quot;upload-demo&quot;&gt;</span><br><span class="line">    &lt;el-button size=&quot;small&quot; type=&quot;primary&quot;&gt;上传视频&lt;/el-button&gt;</span><br><span class="line">    &lt;el-tooltip placement=&quot;right-end&quot;&gt;</span><br><span class="line">      &lt;div slot=&quot;content&quot;&gt;最大支持1G，&lt;br&gt;</span><br><span class="line">        支持3GP、ASF、AVI、DAT、DV、FLV、F4V、&lt;br&gt;</span><br><span class="line">        GIF、M2T、M4V、MJ2、MJPEG、MKV、MOV、MP4、&lt;br&gt;</span><br><span class="line">        MPE、MPG、MPEG、MTS、OGG、QT、RM、RMVB、&lt;br&gt;</span><br><span class="line">        SWF、TS、VOB、WMV、WEBM 等视频格式上传</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;i class=&quot;el-icon-question&quot;/&gt;</span><br><span class="line">    &lt;/el-tooltip&gt;</span><br><span class="line">  &lt;/el-upload&gt;</span><br><span class="line">&lt;/el-form-item&gt;</span><br></pre></td></tr></table></figure>

<p>定义组件方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自动上传成功回调</span></span><br><span class="line"><span class="title function_">handleVodUploadSuccess</span>(<span class="params">response, file, fileList</span>) &#123;</span><br><span class="line">  <span class="comment">// 获取当前上传视频的ID</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">contentVideo</span>.<span class="property">videoSourceId</span> = response.<span class="property">data</span>.<span class="property">videoId</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取当前上传视频标题</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">contentVideo</span>.<span class="property">videoOriginalName</span> = file.<span class="property">name</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设置文件名回显</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">fileList</span> = [&#123;<span class="string">&#x27;name&#x27;</span>: <span class="variable language_">this</span>.<span class="property">contentVideo</span>.<span class="property">videoOriginalName</span>&#125;];</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 已经超过了指定数量时,调用此方法</span></span><br><span class="line"><span class="title function_">handleUploadExceed</span>(<span class="params">files, fileList</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">warning</span>(<span class="string">&#x27;请先删除已上传的视频!&#x27;</span>);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//删除之前提示信息</span></span><br><span class="line"><span class="title function_">beforeVodRemove</span>(<span class="params">file, fileList</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.$confirm(<span class="string">`确定删除 <span class="subst">$&#123;file.name&#125;</span>？`</span>);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//删除小节视频</span></span><br><span class="line"><span class="title function_">handleVodRemove</span>(<span class="params">file, fileList</span>) &#123;</span><br><span class="line">  vod.<span class="title function_">deleteVodById</span>(<span class="variable language_">this</span>.<span class="property">contentVideo</span>.<span class="property">videoSourceId</span>).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 清空当前小节视频id</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">contentVideo</span>.<span class="property">videoSourceId</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 清空当前小节视频标题</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">contentVideo</span>.<span class="property">videoOriginalName</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">fileList</span> = [];</span><br><span class="line">    <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">      <span class="attr">message</span>: response.<span class="property">message</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>更改之前的小节编辑回显代码如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">editorContentVideo</span>(<span class="params">id</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">dialogVideoFormVisible</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">  contentVideo.<span class="title function_">getVideoInfoById</span>(id).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">contentVideo</span> = res.<span class="property">data</span>.<span class="property">item</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果有视频, 显示视频标题</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">contentVideo</span>.<span class="property">videoOriginalName</span> !== <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">fileList</span> = [&#123;<span class="string">&#x27;name&#x27;</span>: <span class="variable language_">this</span>.<span class="property">contentVideo</span>.<span class="property">videoOriginalName</span>&#125;];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>可能还有一个小问题后面在解决</p>
<h2 id="37-视频处理-集成Nacos"><a href="#37-视频处理-集成Nacos" class="headerlink" title="37-视频处理-集成Nacos"></a>37-视频处理-集成Nacos</h2><p>在本地搭建一个 nacos</p>
<ul>
<li>搭建教程请参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/TangXiaoHuiHui/protected/articles/12467387.html">https://www.cnblogs.com/TangXiaoHuiHui/protected/articles/12467387.html</a></li>
<li>密码为：303158131</li>
</ul>
<p>为啥要集成 nacos 了呢，原因就是我们在删除小节的时候需要把对应的视频也一起进行删除这里就设计到了微服务之间的调用问题了，这个时候把 nacos 搭建起来里面包含了注册中心服务治理等等，在 service_video 当中调用 service_vod 服务当中的方法，首先处理 service_video 服务模块当中的配置，再次更换全局依赖，也就是最外层的那个 pom.xml 里面的依赖内容如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418130329488-159396780.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418130329488-159396780.png" alt="img"></a></p>
<p>xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mybatis-plus.version</span>&gt;</span>3.0.5<span class="tag">&lt;/<span class="name">mybatis-plus.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">velocity.version</span>&gt;</span>2.0<span class="tag">&lt;/<span class="name">velocity.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">swagger.version</span>&gt;</span>2.7.0<span class="tag">&lt;/<span class="name">swagger.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jodatime.version</span>&gt;</span>2.10.1<span class="tag">&lt;/<span class="name">jodatime.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">poi.version</span>&gt;</span>3.17<span class="tag">&lt;/<span class="name">poi.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">commons-fileupload.version</span>&gt;</span>1.3.1<span class="tag">&lt;/<span class="name">commons-fileupload.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">commons-io.version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">commons-io.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">httpclient.version</span>&gt;</span>4.5.1<span class="tag">&lt;/<span class="name">httpclient.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jwt.version</span>&gt;</span>0.7.0<span class="tag">&lt;/<span class="name">jwt.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aliyun-java-sdk-core.version</span>&gt;</span>4.3.3<span class="tag">&lt;/<span class="name">aliyun-java-sdk-core.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aliyun-sdk-oss.version</span>&gt;</span>3.10.2<span class="tag">&lt;/<span class="name">aliyun-sdk-oss.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aliyun-java-sdk-vod.version</span>&gt;</span>2.15.2<span class="tag">&lt;/<span class="name">aliyun-java-sdk-vod.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aliyun-sdk-vod-upload.version</span>&gt;</span>1.4.13<span class="tag">&lt;/<span class="name">aliyun-sdk-vod-upload.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fastjson.version</span>&gt;</span>1.2.28<span class="tag">&lt;/<span class="name">fastjson.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">gson.version</span>&gt;</span>2.8.2<span class="tag">&lt;/<span class="name">gson.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">json.version</span>&gt;</span>20170516<span class="tag">&lt;/<span class="name">json.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">commons-dbutils.version</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">commons-dbutils.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">canal.client.version</span>&gt;</span>1.1.0<span class="tag">&lt;/<span class="name">canal.client.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">docker.image.prefix</span>&gt;</span>zx<span class="tag">&lt;/<span class="name">docker.image.prefix</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">cloud-alibaba.version</span>&gt;</span>2.1.1.RELEASE<span class="tag">&lt;/<span class="name">cloud-alibaba.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--锁定依赖的版本--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--Spring Cloud--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>Hoxton.SR1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;cloud-alibaba.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--mybatis-plus 持久层--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis-plus.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- velocity 模板引擎, Mybatis Plus 代码生成器需要 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.velocity<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>velocity-engine-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;velocity.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--swagger--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;swagger.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--swagger ui--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;swagger.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--aliyunOSS--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun.oss<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-sdk-oss<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;aliyun-sdk-oss.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--日期时间工具--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>joda-time<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>joda-time<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jodatime.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--xls--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;poi.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--xlsx--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi-ooxml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;poi.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--文件上传--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;commons-fileupload.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--commons-io--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;commons-io.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--httpclient--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;httpclient.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.code.gson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;gson.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- JWT --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jwt.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--aliyun--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-java-sdk-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;aliyun-java-sdk-core.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-java-sdk-vod<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;aliyun-java-sdk-vod.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-sdk-vod-upload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;aliyun-sdk-vod-upload.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;fastjson.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.json<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>json<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;json.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-dbutils<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-dbutils<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;commons-dbutils.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.otter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>canal.client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;canal.client.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在 service 当中添加依赖</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418130300507-1397784040.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418130300507-1397784040.png" alt="img"></a></p>
<p>xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.csp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sentinel-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="添加配置"><a href="#添加配置" class="headerlink" title="添加配置"></a>添加配置</h3><p>在 service_video 配置文件当中添加 nacos 配置，我这里的 nacos 没有搭建集群不然可以直接配置的是 nginx 的配置我这里直接配置的 nacos 真实地址如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418130520383-59663878.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418130520383-59663878.png" alt="img"></a></p>
<p>yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cloud:</span></span><br><span class="line">  <span class="attr">nacos:</span></span><br><span class="line">    <span class="attr">discovery:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="number">192.168</span><span class="number">.31</span><span class="number">.45</span><span class="string">:8848</span></span><br><span class="line">  <span class="attr">sentinel:</span></span><br><span class="line">    <span class="attr">transport:</span></span><br><span class="line">      <span class="attr">dashboard:</span> <span class="string">localhost:8088</span></span><br></pre></td></tr></table></figure>

<p>当然这里也添加了 <code>sentinel</code> 相关的配置内容，搭建sentinel也在之前的文章当中有不在介绍多了，自行参考文章搭建即可然后对应的地址放入即可</p>
<p>在 service_video 启动类当中添加如下注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br></pre></td></tr></table></figure>

<h3 id="Feign-客户端调用"><a href="#Feign-客户端调用" class="headerlink" title="Feign 客户端调用"></a>Feign 客户端调用</h3><p>在 service_video 模块当中创建 client 包, 编写 Feign 调用客户端</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418180421679-518264770.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418180421679-518264770.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@FeignClient(name = &quot;service-vod&quot;, fallback = VodFeignClientFallBack.class)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">VodClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;b&gt;</span></span><br><span class="line"><span class="comment">     * 根据 videoId 删除视频</span></span><br><span class="line"><span class="comment">     * &lt;/b&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> videoId 视频ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 删除结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(value = &quot;/service_vod/vod/delete_vod/&#123;videoId&#125;&quot;)</span></span><br><span class="line">    ResponseResult <span class="title function_">deleteAliyunVideo</span><span class="params">(<span class="meta">@PathVariable(&quot;videoId&quot;)</span> String videoId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>降级处理方法</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418131918992-154666872.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418131918992-154666872.png" alt="img"></a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VodFeignClientFallBack</span> <span class="keyword">implements</span> <span class="title class_">VodClient</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">deleteAliYunVideo</span><span class="params">(String videoId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.error().message(<span class="string">&quot;熔断处理-调用超时！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="业务调用"><a href="#业务调用" class="headerlink" title="业务调用"></a>业务调用</h3><p>修改 ContentVideoController 中的 <code>removeById</code> 的实现类如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418132339537-1092800176.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418132339537-1092800176.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> VodClient vodClient;</span><br></pre></td></tr></table></figure>

<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">deleteVideoById</span><span class="params">(String id)</span> &#123;</span><br><span class="line">    <span class="comment">// 删除小节对应的视频</span></span><br><span class="line">    <span class="type">ContentVideo</span> <span class="variable">contentVideo</span> <span class="operator">=</span> baseMapper.selectById(id);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取小节对应的视频</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">videoSourceId</span> <span class="operator">=</span> contentVideo.getVideoSourceId();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 判断是否有小节视频</span></span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(videoSourceId)) &#123;</span><br><span class="line">        <span class="comment">// 删除视频</span></span><br><span class="line">        <span class="comment">// 服务之间调用 Nacos</span></span><br><span class="line">        <span class="type">ResponseResult</span> <span class="variable">result</span> <span class="operator">=</span> vodClient.deleteAliYunVideo(videoSourceId);</span><br><span class="line">        <span class="keyword">if</span> (!result.getSuccess()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BnTangException</span>(<span class="number">20001</span>, result.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> baseMapper.deleteById(id);</span><br><span class="line">    <span class="keyword">return</span> result &gt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>添加 Feign 与 Sentinel 的支持修改service_video模块的 application.yml</p>
<p>yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">sentinel:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>移动 nacos 和 Sentinel 配置内容的位置如下图</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418162708570-1142223172.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418162708570-1142223172.png" alt="img"></a></p>
<p>service_vod 模块配置文件内容如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418163256335-107352933.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418163256335-107352933.png" alt="img"></a></p>
<p>yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cloud:</span></span><br><span class="line">  <span class="attr">nacos:</span></span><br><span class="line">    <span class="attr">discovery:</span></span><br><span class="line">      <span class="comment"># nacos服务的地址，不要加http</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br></pre></td></tr></table></figure>

<p>service_upload 模块配置文件内容同上添加一样的内容进去</p>
<h3 id="修复问题"><a href="#修复问题" class="headerlink" title="修复问题"></a>修复问题</h3><p>添加章节成功之后再次点击添加章节上一次添加的数据没有清空效果如下图</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418164707763-1661271349.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418164707763-1661271349.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418165250252-1167379537.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418165250252-1167379537.png" alt="img"></a></p>
<p>编辑小节视频名称回显BUG，我就不复现了自行去修改</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418165608616-906412678.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418165608616-906412678.png" alt="img"></a></p>
<p>修改后端添加一个方法，用来清空已经删除的视频的信息如下，修改 <code>ContentVideoController</code></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418174722703-1666700713.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418174722703-1666700713.png" alt="img"></a></p>
<p>修改 <code>ContentVideoService</code></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;b&gt;</span></span><br><span class="line"><span class="comment"> * 根据视频ID删除小节视频</span></span><br><span class="line"><span class="comment"> * &lt;/b&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id 视频ID</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">deleteContentVideoById</span><span class="params">(String id)</span>;</span><br></pre></td></tr></table></figure>

<p>实现类如下</p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteContentVideoById</span><span class="params">(String id)</span> &#123;</span><br><span class="line">    QueryWrapper&lt;ContentVideo&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(<span class="string">&quot;video_source_id&quot;</span>, id);</span><br><span class="line"></span><br><span class="line">    <span class="type">ContentVideo</span> <span class="variable">contentVideo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ContentVideo</span>();</span><br><span class="line">    contentVideo.setVideoSourceId(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    contentVideo.setVideoOriginalName(<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    baseMapper.update(contentVideo, queryWrapper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改前端的 contentVideo.js 文件添加请求 api 方法如下</p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除小节视频</span></span><br><span class="line"><span class="title function_">deleteContentVideoById</span>(<span class="params">id</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/deleteContentVideoById/<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>修改 <code>chapter.vue</code> 改造删除小节视频方法如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418175219204-1787382928.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418175219204-1787382928.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除小节视频</span></span><br><span class="line"><span class="title function_">handleVodRemove</span>(<span class="params">file, fileList</span>) &#123;</span><br><span class="line">  vod.<span class="title function_">deleteVodById</span>(<span class="variable language_">this</span>.<span class="property">contentVideo</span>.<span class="property">videoSourceId</span>).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 清空当前小节视频id</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">contentVideo</span>.<span class="property">videoSourceId</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 清空当前小节视频标题</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">contentVideo</span>.<span class="property">videoOriginalName</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">fileList</span> = [];</span><br><span class="line">    <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">      <span class="attr">message</span>: response.<span class="property">message</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">  contentVideo.<span class="title function_">deleteContentVideoById</span>(<span class="variable language_">this</span>.<span class="property">contentVideo</span>.<span class="property">videoSourceId</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>修改 service 下的子模块的服务名称如下在中间加一个横杠如下图</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418181430763-1510846031.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418181430763-1510846031.png" alt="img"></a></p>
<h2 id="38-视频处理-添加网关gateway"><a href="#38-视频处理-添加网关gateway" class="headerlink" title="38-视频处理-添加网关gateway"></a>38-视频处理-添加网关gateway</h2><h3 id="创建网关微服务"><a href="#创建网关微服务" class="headerlink" title="创建网关微服务"></a>创建网关微服务</h3><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418182424730-1293532122.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418182424730-1293532122.png" alt="img"></a></p>
<h3 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h3><p>修改 gateway 服务的 pom.xml</p>
<p>xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>top.it6666<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>common_utils<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--gson--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.code.gson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--服务调用--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>创建 gateway 启动类</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418182911133-1127682913.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418182911133-1127682913.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GateWayApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(GateWayApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 resources 当中创建配置文件 <code>application.yml</code></p>
<p>yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">pattern:</span></span><br><span class="line">    <span class="attr">console:</span> <span class="string">&quot;%d&#123;HH:mm:ss.SSS&#125; %clr(%5p) %clr(-)&#123;faint&#125; %clr(%-80.80logger&#123;79&#125;)&#123;cyan&#125; %clr(:) %m%n&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9000</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="comment"># 此实例注册到服务端的name</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">gateway</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">locator:</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">service-video</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://service-video</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/service_video/**</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">service-vod</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://service-vod</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/service_vod/**</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">service-upload</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://service-upload</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/service_upload/**</span></span><br></pre></td></tr></table></figure>

<p>在 gateway 当中添加跨域配置处理如下, 创建 config 包, 在该包下创建跨域处理配置</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418183315735-1741061821.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418183315735-1741061821.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CorsConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CorsWebFilter <span class="title function_">corsFilter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">CorsConfiguration</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorsConfiguration</span>();</span><br><span class="line">        config.addAllowedMethod(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        config.addAllowedOrigin(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        config.addAllowedHeader(<span class="string">&quot;*&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">UrlBasedCorsConfigurationSource</span> <span class="variable">source</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UrlBasedCorsConfigurationSource</span>(<span class="keyword">new</span> <span class="title class_">PathPatternParser</span>());</span><br><span class="line">        source.registerCorsConfiguration(<span class="string">&quot;/**&quot;</span>, config);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CorsWebFilter</span>(source);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>取消控制器上的跨域注解, 把前端请求地址改成网关请求地址如下图，Controller 跨域注解全部去除</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418183415308-1393069558.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418183415308-1393069558.png" alt="img"></a></p>
<p>修改前端为 gateway 请求地址</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418183725384-877411091.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210418183725384-877411091.png" alt="img"></a></p>
<h2 id="39-权限控制-权限工程搭建"><a href="#39-权限控制-权限工程搭建" class="headerlink" title="39-权限控制-权限工程搭建"></a>39-权限控制-权限工程搭建</h2><h3 id="创建权限工程"><a href="#创建权限工程" class="headerlink" title="创建权限工程"></a>创建权限工程</h3><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210420151601975-740796822.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210420151601975-740796822.png" alt="img"></a></p>
<p>添加对应的启动类 <code>AuthApplication</code> 代码如下所示</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210421194013647-901501311.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210421194013647-901501311.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication()</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &#123;&quot;top.it6666&quot;&#125;)</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;top.it6666.service_auth.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(AuthApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在添加对应的配置文件 <code>application.yml</code> 内容如下，其中 redis 的配置我移除了后面在加上即可我会贴出来的</p>
<p>yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application-dev.yml</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8004</span></span><br><span class="line"></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">pattern:</span></span><br><span class="line">    <span class="attr">console:</span> <span class="string">&quot;%clr(%5p) %clr(-)&#123;faint&#125; %clr(%-80.80logger&#123;79&#125;)&#123;cyan&#125; %clr(:) %m%n&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">service-auth</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/video_db?serverTimezone=GMT%2B8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">hikari:</span></span><br><span class="line">      <span class="attr">connection-test-query:</span> <span class="string">SELECT</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">connection-timeout:</span> <span class="number">60000</span></span><br><span class="line">      <span class="attr">idle-timeout:</span> <span class="number">500000</span></span><br><span class="line">      <span class="attr">max-lifetime:</span> <span class="number">540000</span></span><br><span class="line">      <span class="attr">maximum-pool-size:</span> <span class="number">12</span></span><br><span class="line">      <span class="attr">minimum-idle:</span> <span class="number">10</span></span><br><span class="line">      <span class="attr">pool-name:</span> <span class="string">HikariPool</span></span><br><span class="line">  <span class="attr">jackson:</span></span><br><span class="line">    <span class="attr">date-format:</span> <span class="string">yyyy-MM-dd</span> <span class="string">HH:mm:ss</span></span><br><span class="line">    <span class="attr">time-zone:</span> <span class="string">GMT+8</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">top/it6666/service_auth/mapper/xml/*.xml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">sentinel:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h3 id="创建对应的数据库表"><a href="#创建对应的数据库表" class="headerlink" title="创建对应的数据库表"></a>创建对应的数据库表</h3><p>用户表 <code>auth_user</code></p>
<p>sql</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `auth_user` (</span><br><span class="line">  `id` <span class="type">char</span>(<span class="number">19</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;会员id&#x27;</span>,</span><br><span class="line">  `open_id` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;微信openid&#x27;</span>,</span><br><span class="line">  `password` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;密码&#x27;</span>,</span><br><span class="line">  `nick_name` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;昵称&#x27;</span>,</span><br><span class="line">  `salt` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户头像&#x27;</span>,</span><br><span class="line">  `token` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户签名&#x27;</span>,</span><br><span class="line">  `is_deleted` tinyint(<span class="number">1</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;逻辑删除 1（true）已删除， 0（false）未删除&#x27;</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `uk_username` (`open_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_0900_ai_ci COMMENT<span class="operator">=</span><span class="string">&#x27;用户表&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>角色表 <code>auth_role</code></p>
<p>sql</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `auth_role` (</span><br><span class="line">  `id` <span class="type">char</span>(<span class="number">19</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;角色id&#x27;</span>,</span><br><span class="line">  `role_name` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;角色名称&#x27;</span>,</span><br><span class="line">  `role_code` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;角色编码&#x27;</span>,</span><br><span class="line">  `remark` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;备注&#x27;</span>,</span><br><span class="line">  `is_deleted` tinyint(<span class="number">1</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;逻辑删除 1（true）已删除， 0（false）未删除&#x27;</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 COMMENT<span class="operator">=</span><span class="string">&#x27;角色&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>菜单权限表 <code>auth_menu</code></p>
<p>sql</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `auth_menu` (</span><br><span class="line">  `id` <span class="type">char</span>(<span class="number">19</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;编号&#x27;</span>,</span><br><span class="line">  `pid` <span class="type">char</span>(<span class="number">19</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;所属上级&#x27;</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;名称&#x27;</span>,</span><br><span class="line">  `type` tinyint(<span class="number">3</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;类型(1:菜单,2:按钮)&#x27;</span>,</span><br><span class="line">  `permission_value` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;权限值&#x27;</span>,</span><br><span class="line">  `path` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;访问路径&#x27;</span>,</span><br><span class="line">  `component` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;组件路径&#x27;</span>,</span><br><span class="line">  `icon` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;图标&#x27;</span>,</span><br><span class="line">  `status` tinyint(<span class="number">4</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;状态(0:禁止,1:正常)&#x27;</span>,</span><br><span class="line">  `is_deleted` tinyint(<span class="number">1</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;逻辑删除 1（true）已删除， 0（false）未删除&#x27;</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  KEY `idx_pid` (`pid`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_0900_ai_ci COMMENT<span class="operator">=</span><span class="string">&#x27;菜单权限&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>用户与角色关系表 <code>auth_user_role</code></p>
<p>sql</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `auth_user_role` (</span><br><span class="line">  `id` <span class="type">char</span>(<span class="number">19</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;主键id&#x27;</span>,</span><br><span class="line">  `role_id` <span class="type">char</span>(<span class="number">19</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;角色id&#x27;</span>,</span><br><span class="line">  `user_id` <span class="type">char</span>(<span class="number">19</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;用户id&#x27;</span>,</span><br><span class="line">  `is_deleted` tinyint(<span class="number">1</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;逻辑删除 1（true）已删除， 0（false）未删除&#x27;</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  KEY `idx_role_id` (`role_id`),</span><br><span class="line">  KEY `idx_user_id` (`user_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 COMMENT<span class="operator">=</span><span class="string">&#x27;用户角色&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>角色与菜单的关系表 <code>auth_role_menu</code></p>
<p>sql</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `auth_role_menu` (</span><br><span class="line">  `id` <span class="type">char</span>(<span class="number">19</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  `role_id` <span class="type">char</span>(<span class="number">19</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  `permission_id` <span class="type">char</span>(<span class="number">19</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  `is_deleted` tinyint(<span class="number">1</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;逻辑删除 1（true）已删除， 0（false）未删除&#x27;</span>,</span><br><span class="line">  `gmt_create` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  `gmt_modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  KEY `idx_role_id` (`role_id`),</span><br><span class="line">  KEY `idx_permission_id` (`permission_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 COMMENT<span class="operator">=</span><span class="string">&#x27;角色菜单&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>rbac 表对应的代码生成器代码如下放入 test 运行即可生成对应层级的代码</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210422092302504-225737665.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210422092302504-225737665.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CodeGeneratorTestCase</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rbacGenerator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 1、创建代码生成器</span></span><br><span class="line">        <span class="type">AutoGenerator</span> <span class="variable">mpg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AutoGenerator</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、全局配置</span></span><br><span class="line">        <span class="type">GlobalConfig</span> <span class="variable">gc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GlobalConfig</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 配置输出路径</span></span><br><span class="line">        gc.setOutputDir(<span class="string">&quot;D:\\Java\\VIDEO_Parent\\service\\service_auth\\src\\main\\java&quot;</span>);</span><br><span class="line">        gc.setAuthor(<span class="string">&quot;BNTang&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 生成后是否打开资源管理器</span></span><br><span class="line">        gc.setOpen(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 重新生成时文件是否覆盖</span></span><br><span class="line">        gc.setFileOverride(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// mp生成service层代码，默认接口名称第一个字母有 I</span></span><br><span class="line">        gc.setControllerName(<span class="string">&quot;%sController&quot;</span>);</span><br><span class="line">        gc.setServiceName(<span class="string">&quot;%sService&quot;</span>);</span><br><span class="line">        gc.setServiceImplName(<span class="string">&quot;%sServiceImpl&quot;</span>);</span><br><span class="line">        gc.setMapperName(<span class="string">&quot;%sMapper&quot;</span>);</span><br><span class="line">        gc.setXmlName(<span class="string">&quot;%sMapper&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 主键策略</span></span><br><span class="line">        gc.setIdType(IdType.ID_WORKER_STR);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 定义生成的实体类中日期类型</span></span><br><span class="line">        gc.setDateType(DateType.ONLY_DATE);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 开启Swagger2模式</span></span><br><span class="line">        gc.setSwagger2(<span class="literal">true</span>);</span><br><span class="line">        mpg.setGlobalConfig(gc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、数据源配置</span></span><br><span class="line">        <span class="type">DataSourceConfig</span> <span class="variable">dsc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataSourceConfig</span>();</span><br><span class="line">        dsc.setUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/video_db?serverTimezone=GMT%2B8&quot;</span>);</span><br><span class="line">        dsc.setDriverName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">        dsc.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        dsc.setPassword(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        dsc.setDbType(DbType.MYSQL);</span><br><span class="line">        mpg.setDataSource(dsc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、包配置</span></span><br><span class="line">        <span class="type">PackageConfig</span> <span class="variable">pc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PackageConfig</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 模块名</span></span><br><span class="line">        pc.setModuleName(<span class="string">&quot;service_auth&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// top.it6666.模块名称.功能 → top.it6666.service_auth.controller</span></span><br><span class="line">        pc.setParent(<span class="string">&quot;top.it6666&quot;</span>);</span><br><span class="line">        pc.setController(<span class="string">&quot;controller&quot;</span>);</span><br><span class="line">        pc.setEntity(<span class="string">&quot;entity&quot;</span>);</span><br><span class="line">        pc.setService(<span class="string">&quot;service&quot;</span>);</span><br><span class="line">        pc.setMapper(<span class="string">&quot;mapper&quot;</span>);</span><br><span class="line">        mpg.setPackageInfo(pc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5、策略配置</span></span><br><span class="line">        <span class="type">StrategyConfig</span> <span class="variable">strategy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StrategyConfig</span>();</span><br><span class="line">        strategy.setInclude(<span class="string">&quot;auth_menu&quot;</span>, <span class="string">&quot;auth_role&quot;</span>, <span class="string">&quot;auth_role_menu&quot;</span>, <span class="string">&quot;auth_user&quot;</span>, <span class="string">&quot;auth_user_role&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 数据库表映射到实体的命名策略 驼峰命名</span></span><br><span class="line">        strategy.setNaming(NamingStrategy.underline_to_camel);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 生成实体时去掉表前缀</span></span><br><span class="line">        strategy.setTablePrefix(<span class="string">&quot;auth_&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 数据库表字段映射到实体的命名策略</span></span><br><span class="line">        strategy.setColumnNaming(NamingStrategy.underline_to_camel);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// lombok 模型 @Accessors(chain = true) setter链式操作</span></span><br><span class="line">        strategy.setEntityLombokModel(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// restful api风格控制器</span></span><br><span class="line">        strategy.setRestControllerStyle(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// url中驼峰转连字符</span></span><br><span class="line">        strategy.setControllerMappingHyphenStyle(<span class="literal">true</span>);</span><br><span class="line">        mpg.setStrategy(strategy);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6、执行</span></span><br><span class="line">        mpg.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="40-权限控制-用户管理"><a href="#40-权限控制-用户管理" class="headerlink" title="40-权限控制-用户管理"></a>40-权限控制-用户管理</h2><h3 id="后端-5"><a href="#后端-5" class="headerlink" title="后端"></a>后端</h3><p>修改 UserController 添加对应的 CRUD 以及分批角色，删除用户要把对应的角色与用户的关系表数据也紧接着删除掉，代码如下</p>
<p>，如下编写的业务就是 RBAC 了，我就快速的贴代码了，重点是在后面的 Jwt + Security + OAuth2 的知识点</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 用户表 前端控制器</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2021-04-21</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/service_auth/admin/user&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;用户组&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RoleService roleService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;b&gt;</span></span><br><span class="line"><span class="comment">     * 获取管理用户，分页列表</span></span><br><span class="line"><span class="comment">     * &lt;/b&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;获取管理用户，分页列表&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/getUserList/&#123;page&#125;/&#123;limit&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">index</span><span class="params">(<span class="meta">@PathVariable</span> Long page, <span class="meta">@PathVariable</span> Long limit, User userQueryVo)</span> &#123;</span><br><span class="line">        IPage&lt;User&gt; pageParam = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page, limit);</span><br><span class="line"></span><br><span class="line">        QueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.isEmpty(userQueryVo.getOpenId())) &#123;</span><br><span class="line">            queryWrapper.like(<span class="string">&quot;open_id&quot;</span>, userQueryVo.getOpenId());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        IPage&lt;User&gt; pageModel = userService.page(pageParam, queryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok()</span><br><span class="line">                .data(<span class="string">&quot;items&quot;</span>, pageModel.getRecords())</span><br><span class="line">                .data(<span class="string">&quot;total&quot;</span>, pageModel.getTotal());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;b&gt;</span></span><br><span class="line"><span class="comment">     * 新增管理用户</span></span><br><span class="line"><span class="comment">     * &lt;/b&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;新增管理用户&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/saveUser&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span> &#123;</span><br><span class="line">        user.setPassword(Md5.encrypt(user.getPassword()));</span><br><span class="line">        userService.save(user);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;b&gt;</span></span><br><span class="line"><span class="comment">     * 修改管理用户</span></span><br><span class="line"><span class="comment">     * &lt;/b&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;修改管理用户&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/updateUser&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">updateById</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span> &#123;</span><br><span class="line">        user.setPassword(Md5.encrypt(user.getPassword()));</span><br><span class="line">        userService.updateById(user);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;b&gt;</span></span><br><span class="line"><span class="comment">     * 删除管理用户</span></span><br><span class="line"><span class="comment">     * &lt;/b&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;删除管理用户&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/removeUser/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">remove</span><span class="params">(<span class="meta">@PathVariable</span> String id)</span> &#123;</span><br><span class="line">        userService.removeById(id);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;b&gt;</span></span><br><span class="line"><span class="comment">     * 批量删除用户</span></span><br><span class="line"><span class="comment">     * &lt;/b&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;批量删除用户&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/batchRemoveUser&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">batchRemove</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;String&gt; idList)</span> &#123;</span><br><span class="line">        userService.removeByIds(idList);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;b&gt;</span></span><br><span class="line"><span class="comment">     * 根据用户id查询用户</span></span><br><span class="line"><span class="comment">     * &lt;/b&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;根据用户id查询用户&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/getUserById/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">getUser</span><span class="params">(<span class="meta">@PathVariable</span> String id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok().data(<span class="string">&quot;user&quot;</span>, userService.getById(id));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;b&gt;</span></span><br><span class="line"><span class="comment">     * 根据用户ID获取角色数据</span></span><br><span class="line"><span class="comment">     * &lt;/b&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;根据用户ID获取角色数据&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/getUserRoleData/&#123;userId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">toAssign</span><span class="params">(<span class="meta">@PathVariable</span> String userId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok().data(roleService.findRoleByUserId(userId));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;b&gt;</span></span><br><span class="line"><span class="comment">     * 根据用户ID分配用户角色</span></span><br><span class="line"><span class="comment">     * &lt;/b&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;根据用户ID分配用户角色&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/doAssignRole&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">doAssign</span><span class="params">(<span class="meta">@RequestParam</span> String userId, <span class="meta">@RequestParam</span> String[] roleId)</span> &#123;</span><br><span class="line">        roleService.saveUserRoleRelationShip(userId, roleId);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>紧接着修改 <code>RoleService</code> 接口，添加如下方法</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210424141928072-1610829892.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210424141928072-1610829892.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 角色 服务类</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2021-04-21</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RoleService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;Role&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;b&gt;</span></span><br><span class="line"><span class="comment">     * 根据用户ID获取角色数据</span></span><br><span class="line"><span class="comment">     * &lt;/b&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId 用户ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 角色数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Map&lt;String, Object&gt; <span class="title function_">findRoleByUserId</span><span class="params">(String userId)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;b&gt;</span></span><br><span class="line"><span class="comment">     * 根据用户ID分配用户角色</span></span><br><span class="line"><span class="comment">     * &lt;/b&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId 用户ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> roleId 角色ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">saveUserRoleRelationShip</span><span class="params">(String userId, String[] roleId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改 RoleServiceImpl</p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 角色 服务实现类</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2021-04-21</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RoleServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;RoleMapper, Role&gt; <span class="keyword">implements</span> <span class="title class_">RoleService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserRoleService userRoleService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;b&gt;</span></span><br><span class="line"><span class="comment">     * 根据用户ID获取角色数据</span></span><br><span class="line"><span class="comment">     * &lt;/b&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">findRoleByUserId</span><span class="params">(String userId)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.查询出所有的角色</span></span><br><span class="line">        List&lt;Role&gt; allRoles = baseMapper.selectList(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.当前用户选中的角色有哪些</span></span><br><span class="line">        QueryWrapper&lt;UserRole&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;UserRole&gt;()</span><br><span class="line">                .eq(<span class="string">&quot;user_id&quot;</span>, userId)</span><br><span class="line">                .select(<span class="string">&quot;role_id&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取到当前用户所在的角色关系</span></span><br><span class="line">        List&lt;UserRole&gt; userRoleList = userRoleService.list(queryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 取出所有的roleId 放到一个集合当中</span></span><br><span class="line">        List&lt;String&gt; roleIds = userRoleList.stream().map(UserRole::getRoleId).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据角色id,取出所有的角色对象</span></span><br><span class="line">        List&lt;Role&gt; userRoles = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        allRoles.forEach(role -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (roleIds.contains(role.getId())) &#123;</span><br><span class="line">                userRoles.add(role);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        Map&lt;String, Object&gt; roleMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 用户的角色</span></span><br><span class="line">        roleMap.put(<span class="string">&quot;assignRoles&quot;</span>, userRoles);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 所有的角色</span></span><br><span class="line">        roleMap.put(<span class="string">&quot;allRolesList&quot;</span>, allRoles);</span><br><span class="line">        <span class="keyword">return</span> roleMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;b&gt;</span></span><br><span class="line"><span class="comment">     * 根据用户ID分配用户角色</span></span><br><span class="line"><span class="comment">     * &lt;/b&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveUserRoleRelationShip</span><span class="params">(String userId, String[] roleId)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.删除原来角色与用户之间的关系</span></span><br><span class="line">        userRoleService.remove(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;UserRole&gt;().eq(<span class="string">&quot;user_id&quot;</span>, userId));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.重新建立关系</span></span><br><span class="line">        List&lt;UserRole&gt; userRoleArrayList = Stream.of(roleId).map(role -&gt; &#123;</span><br><span class="line">            <span class="type">UserRole</span> <span class="variable">userRole</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserRole</span>();</span><br><span class="line">            userRole.setUserId(userId);</span><br><span class="line">            userRole.setRoleId(role);</span><br><span class="line">            <span class="keyword">return</span> userRole;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.批量保存关系</span></span><br><span class="line">        userRoleService.saveBatch(userRoleArrayList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>移动之前 server_video 微服务当中的 AppConfig，目的为了就是其它微服务如果也需要用到分页的配置和逻辑删除就不用再继续写冗余的配置文件内容了，我们的 server_auth 模块中有分页查询用户逻辑删除用户等等，但是 video 微服务当中也需要这样大家都是 server 的子服务就都会有对应的配置内容了</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210424142110938-526669719.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210424142110938-526669719.png" alt="img"></a></p>
<p>修改 <code>gateway</code> 配置 server_auth 的网关服务转发规则，修改 gateway 的 application.yml</p>
<p>yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">service-auth</span></span><br><span class="line">  <span class="attr">uri:</span> <span class="string">lb://service-auth</span></span><br><span class="line">  <span class="attr">predicates:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Path=/service_auth/**</span></span><br></pre></td></tr></table></figure>

<p>配置逻辑删除和属性的自动填充如下，每个实体类都自己加一下，不然你也可以按照报错自行排查问题</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210424150821675-1429117866.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210424150821675-1429117866.png" alt="img"></a></p>
<h3 id="前端-4"><a href="#前端-4" class="headerlink" title="前端"></a>前端</h3><p>修改路由文件 index.js 在路由当中添加路由</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210424152508822-318130383.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210424152508822-318130383.png" alt="img"></a></p>
<p>内容如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210424152831819-1040448574.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210424152831819-1040448574.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;/auth&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="title class_">Layout</span>,</span><br><span class="line">  <span class="attr">redirect</span>: <span class="string">&#x27;/auth/user/list&#x27;</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;权限管理&#x27;</span>,</span><br><span class="line">  <span class="attr">meta</span>: &#123;<span class="attr">title</span>: <span class="string">&#x27;权限管理&#x27;</span>, <span class="attr">icon</span>: <span class="string">&#x27;tree&#x27;</span>&#125;,</span><br><span class="line">  <span class="attr">children</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;user/list&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;用户管理&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/video/auth/user/list&#x27;</span>),</span><br><span class="line">      <span class="attr">meta</span>: &#123;<span class="attr">title</span>: <span class="string">&#x27;用户管理&#x27;</span>&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;user/add&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;用户添加&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/video/auth/user/form&#x27;</span>),</span><br><span class="line">      <span class="attr">meta</span>: &#123;<span class="attr">title</span>: <span class="string">&#x27;用户添加&#x27;</span>&#125;,</span><br><span class="line">      <span class="attr">hidden</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;user/update/:id&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;用户修改&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/video/auth/user/form&#x27;</span>),</span><br><span class="line">      <span class="attr">meta</span>: &#123;<span class="attr">title</span>: <span class="string">&#x27;用户修改&#x27;</span>&#125;,</span><br><span class="line">      <span class="attr">hidden</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;user/role/:id&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;用户角色&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/video/auth/user/roleForm&#x27;</span>),</span><br><span class="line">      <span class="attr">meta</span>: &#123;<span class="attr">title</span>: <span class="string">&#x27;用户角色&#x27;</span>&#125;,</span><br><span class="line">      <span class="attr">hidden</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>在 api 包中添加 user.js 编写请求方法内容如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210424153854000-87288450.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210424153854000-87288450.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> api_name = <span class="string">&#x27;/service_auth/admin/user&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// 获取用户分页数据</span></span><br><span class="line">  <span class="title function_">getPageList</span>(<span class="params">page, limit, searchObj</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/getUserList/<span class="subst">$&#123;page&#125;</span>/<span class="subst">$&#123;limit&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">      <span class="comment">// url查询字符串或表单键值对</span></span><br><span class="line">      <span class="attr">params</span>: searchObj</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 根据用户id查询用户</span></span><br><span class="line">  <span class="title function_">getUserById</span>(<span class="params">id</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/getUserById/<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 保存用户</span></span><br><span class="line">  <span class="title function_">save</span>(<span class="params">user</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/saveUser`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: user</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 更新用户</span></span><br><span class="line">  <span class="title function_">updateById</span>(<span class="params">user</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/updateUser`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: user</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 根据用户id查询用户下角色信息</span></span><br><span class="line">  <span class="title function_">getAssign</span>(<span class="params">userId</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/getUserRoleData/<span class="subst">$&#123;userId&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 保存用户角色信息</span></span><br><span class="line">  <span class="title function_">saveAssign</span>(<span class="params">userId, roleId</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/doAssignRole`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">      <span class="attr">params</span>: &#123;userId, roleId&#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 删除用户</span></span><br><span class="line">  <span class="title function_">removeById</span>(<span class="params">id</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/removeUser/<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 批量删除用户</span></span><br><span class="line">  <span class="title function_">removeRows</span>(<span class="params">idList</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/batchRemoveUser`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: idList</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>都是之前写过的，我直接贴代码如下，如下是 <code>list.vue</code> 的内容</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210424154009223-1197920160.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210424154009223-1197920160.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line">    &lt;!--查询表单--&gt;</span><br><span class="line">    &lt;el-form :inline=&quot;true&quot; class=&quot;demo-form-inline&quot;&gt;</span><br><span class="line">      &lt;el-form-item&gt;</span><br><span class="line">        &lt;el-input v-model=&quot;searchObj.username&quot; placeholder=&quot;用户名&quot;/&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-button type=&quot;primary&quot; icon=&quot;el-icon-search&quot; @click=&quot;fetchData()&quot;&gt;查询&lt;/el-button&gt;</span><br><span class="line">      &lt;el-button type=&quot;default&quot; @click=&quot;resetData()&quot;&gt;清空&lt;/el-button&gt;</span><br><span class="line">    &lt;/el-form&gt;</span><br><span class="line">    &lt;!-- 工具条 --&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;el-button type=&quot;danger&quot; size=&quot;mini&quot; @click=&quot;addUser()&quot;&gt;添加&lt;/el-button&gt;</span><br><span class="line">      &lt;el-button type=&quot;danger&quot; size=&quot;mini&quot; @click=&quot;removeRows()&quot;&gt;批量删除&lt;/el-button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!--用户列表 --&gt;</span><br><span class="line">    &lt;el-table</span><br><span class="line">      v-loading=&quot;listLoading&quot;</span><br><span class="line">      :data=&quot;list&quot;</span><br><span class="line">      stripe</span><br><span class="line">      style=&quot;width: 100%&quot;</span><br><span class="line">      @selection-change=&quot;handleSelectionChange&quot;&gt;</span><br><span class="line">      &lt;el-table-column</span><br><span class="line">        type=&quot;selection&quot;</span><br><span class="line">        width=&quot;55&quot;/&gt;</span><br><span class="line">      &lt;el-table-column</span><br><span class="line">        label=&quot;序号&quot;</span><br><span class="line">        width=&quot;70&quot;</span><br><span class="line">        align=&quot;center&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">          &#123;&#123; (page - 1) * limit + scope.$index + 1 &#125;&#125;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;openId&quot; label=&quot;用户名&quot; align=&quot;center&quot;/&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;nickName&quot; label=&quot;用户昵称&quot; align=&quot;center&quot;/&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;操作&quot; align=&quot;center&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">          &lt;router-link :to=&quot;&#x27;/auth/user/role/&#x27;+scope.row.id&quot;&gt;</span><br><span class="line">            &lt;el-button type=&quot;success&quot; size=&quot;mini&quot;&gt;绑定角色&lt;/el-button&gt;</span><br><span class="line">          &lt;/router-link&gt;</span><br><span class="line">          &amp;nbsp;</span><br><span class="line">          &lt;router-link :to=&quot;&#x27;/auth/user/update/&#x27;+scope.row.id&quot;&gt;</span><br><span class="line">            &lt;el-button type=&quot;primary&quot; size=&quot;mini&quot;&gt;修改&lt;/el-button&gt;</span><br><span class="line">          &lt;/router-link&gt;</span><br><span class="line">          &amp;nbsp;</span><br><span class="line">          &lt;el-button type=&quot;danger&quot; @click=&quot;removeDataById(scope.row.id)&quot; size=&quot;mini&quot;&gt;删除&lt;/el-button&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">    &lt;/el-table&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 分页组件 --&gt;</span><br><span class="line">    &lt;el-pagination</span><br><span class="line">      :current-page=&quot;page&quot;</span><br><span class="line">      :total=&quot;total&quot;</span><br><span class="line">      :page-size=&quot;limit&quot;</span><br><span class="line">      :page-sizes=&quot;[5, 10, 20, 30, 40, 50, 100]&quot;</span><br><span class="line">      style=&quot;padding: 30px 0; text-align: center;&quot;</span><br><span class="line">      layout=&quot;sizes, prev, pager, next, jumper, -&gt;, total, slot&quot;</span><br><span class="line">      @current-change=&quot;fetchData&quot;</span><br><span class="line">      @size-change=&quot;changeSize&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import user from &#x27;@/api/video/auth/user&#x27;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;list&quot;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      // 数据是否正在加载</span><br><span class="line">      listLoading: true,</span><br><span class="line"></span><br><span class="line">      // 用户列表</span><br><span class="line">      list: null,</span><br><span class="line"></span><br><span class="line">      // 数据库中的总记录数</span><br><span class="line">      total: 0,</span><br><span class="line"></span><br><span class="line">      // 默认页码</span><br><span class="line">      page: 1,</span><br><span class="line"></span><br><span class="line">      // 每页记录数</span><br><span class="line">      limit: 10,</span><br><span class="line"></span><br><span class="line">      // 查询条件的表单对象</span><br><span class="line">      searchObj: &#123;&#125;,</span><br><span class="line"></span><br><span class="line">      // 批量选择中选择的记录列表</span><br><span class="line">      multipleSelection: []</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    // 加载页面数据</span><br><span class="line">    this.fetchData();</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    // 当页码发生改变的时候</span><br><span class="line">    changeSize(size) &#123;</span><br><span class="line">      this.limit = size;</span><br><span class="line">      this.fetchData(1);</span><br><span class="line">    &#125;,</span><br><span class="line">    addUser() &#123;</span><br><span class="line">      // 添加用户,跳转到添加路由</span><br><span class="line">      this.$router.push(&#123;path: &#x27;/auth/user/add&#x27;&#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 加载用户数据</span><br><span class="line">    fetchData(page = 1) &#123;</span><br><span class="line">      this.page = page;</span><br><span class="line">      user.getPageList(this.page, this.limit, this.searchObj).then(</span><br><span class="line">        response =&gt; &#123;</span><br><span class="line">          this.list = response.data.items;</span><br><span class="line">          this.total = response.data.total;</span><br><span class="line"></span><br><span class="line">          // 数据加载并绑定成功</span><br><span class="line">          this.listLoading = false;</span><br><span class="line">        &#125;</span><br><span class="line">      );</span><br><span class="line">    &#125;,</span><br><span class="line">    // 重置查询表单</span><br><span class="line">    resetData() &#123;</span><br><span class="line">      this.searchObj = &#123;&#125;;</span><br><span class="line">      this.fetchData();</span><br><span class="line">    &#125;,</span><br><span class="line">    // 根据id删除数据</span><br><span class="line">    removeDataById(id) &#123;</span><br><span class="line">      this.$confirm(&#x27;此操作将永久删除该记录, 是否继续?&#x27;, &#x27;提示&#x27;, &#123;</span><br><span class="line">        confirmButtonText: &#x27;确定&#x27;,</span><br><span class="line">        cancelButtonText: &#x27;取消&#x27;,</span><br><span class="line">        type: &#x27;warning&#x27;</span><br><span class="line">      &#125;).then(() =&gt; &#123;</span><br><span class="line">        // 点击确定，远程调用ajax</span><br><span class="line">        return user.removeById(id);</span><br><span class="line">      &#125;).then((response) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">        // 重新加载列表</span><br><span class="line">        this.fetchData(this.page);</span><br><span class="line">        if (response.success) &#123;</span><br><span class="line">          this.$message(&#123;</span><br><span class="line">            type: &#x27;success&#x27;,</span><br><span class="line">            message: response.message</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;).catch(() =&gt; &#123;</span><br><span class="line">        this.$message(&#123;</span><br><span class="line">          type: &#x27;info&#x27;,</span><br><span class="line">          message: &#x27;已取消删除&#x27;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    // 当表格复选框选项发生变化的时候触发</span><br><span class="line">    handleSelectionChange(selection) &#123;</span><br><span class="line">      this.multipleSelection = selection;</span><br><span class="line">    &#125;,</span><br><span class="line">    // 批量删除</span><br><span class="line">    removeRows() &#123;</span><br><span class="line">      if (this.multipleSelection.length === 0) &#123;</span><br><span class="line">        this.$message(&#123;</span><br><span class="line">          type: &#x27;warning&#x27;,</span><br><span class="line">          message: &#x27;请选择要删除的记录!&#x27;</span><br><span class="line">        &#125;)</span><br><span class="line">        return;</span><br><span class="line">      &#125;</span><br><span class="line">      this.$confirm(&#x27;此操作将永久删除该记录, 是否继续?&#x27;, &#x27;提示&#x27;, &#123;</span><br><span class="line">        confirmButtonText: &#x27;确定&#x27;,</span><br><span class="line">        cancelButtonText: &#x27;取消&#x27;,</span><br><span class="line">        type: &#x27;warning&#x27;</span><br><span class="line">      &#125;).then(() =&gt; &#123;</span><br><span class="line">        let idList = [];</span><br><span class="line">        this.multipleSelection.forEach(item =&gt; &#123;</span><br><span class="line">          idList.push(item.id);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        // 调用api</span><br><span class="line">        return user.removeRows(idList);</span><br><span class="line">      &#125;).then((response) =&gt; &#123;</span><br><span class="line">        this.fetchData(this.page)</span><br><span class="line">        if (response.success) &#123;</span><br><span class="line">          this.$message(&#123;</span><br><span class="line">            type: &#x27;success&#x27;,</span><br><span class="line">            message: response.message</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;).catch(() =&gt; &#123;</span><br><span class="line">        this.$message(&#123;</span><br><span class="line">          type: &#x27;info&#x27;,</span><br><span class="line">          message: &#x27;已取消删除&#x27;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>添加与更新页面，<code>form.vue</code> 内容如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210424164427568-1075774235.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210424164427568-1075774235.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;app-container&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">el-form</span> <span class="attr">ref</span>=<span class="string">&quot;user&quot;</span> <span class="attr">:model</span>=<span class="string">&quot;user&quot;</span> <span class="attr">:rules</span>=<span class="string">&quot;validateRules&quot;</span> <span class="attr">label-width</span>=<span class="string">&quot;120px&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;用户名&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;username&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;user.openId&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;用户昵称&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;user.nickName&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">v-if</span>=<span class="string">&quot;!user.id&quot;</span> <span class="attr">label</span>=<span class="string">&quot;用户密码&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;password&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;user.password&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">:disabled</span>=<span class="string">&quot;saveBtnDisabled&quot;</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;saveOrUpdate&quot;</span>&gt;</span>保存<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> userApi <span class="keyword">from</span> <span class="string">&#x27;@/api/video/auth/user&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> defaultForm = &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">openId</span>: <span class="string">&#x27;&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">nickName</span>: <span class="string">&#x27;&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">password</span>: <span class="string">&#x27;&#x27;</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> <span class="title function_">validatePass</span> = (<span class="params">rule, value, callback</span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">if</span> (value.<span class="property">length</span> &lt; <span class="number">6</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">callback</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;密码不能小于6位&#x27;</span>));</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125; <span class="keyword">else</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">callback</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">name</span>: <span class="string">&quot;form&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">user</span>: defaultForm,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// 保存按钮是否禁用,</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">saveBtnDisabled</span>: <span class="literal">false</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="attr">validateRules</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">openId</span>: [&#123;<span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span>, <span class="attr">message</span>: <span class="string">&#x27;用户名必须输入&#x27;</span>&#125;],</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">password</span>: [&#123;<span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">trigger</span>: <span class="string">&#x27;blur&#x27;</span>, <span class="attr">validator</span>: validatePass&#125;]</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// 监听器</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">watch</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 路由变化</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    $route(to, <span class="keyword">from</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">this</span>.<span class="title function_">init</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// 生命周期方法（在路由切换，组件不变的情况下不会被调用）</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">created</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">this</span>.<span class="title function_">init</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 表单初始化</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">init</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">params</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">params</span>.<span class="property">id</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">const</span> id = <span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">params</span>.<span class="property">id</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">this</span>.<span class="title function_">fetchDataById</span>(id);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125; <span class="keyword">else</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// 对象拓展运算符：拷贝对象，而不是赋值对象的引用</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">this</span>.<span class="property">user</span> = &#123;...defaultForm&#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">saveOrUpdate</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">user</span>.<span class="title function_">validate</span>(<span class="function"><span class="params">valid</span> =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">if</span> (valid) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="comment">// 防止表单重复提交</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="variable language_">this</span>.<span class="property">saveBtnDisabled</span> = <span class="literal">true</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">user</span>.<span class="property">id</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="variable language_">this</span>.<span class="title function_">saveData</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125; <span class="keyword">else</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="variable language_">this</span>.<span class="title function_">updateData</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 新增用户</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">saveData</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      userApi.<span class="title function_">save</span>(<span class="variable language_">this</span>.<span class="property">user</span>).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// debugger</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">if</span> (response.<span class="property">success</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="variable language_">this</span>.$message(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">message</span>: response.<span class="property">message</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123;<span class="attr">path</span>: <span class="string">&#x27;/auth/user/list&#x27;</span>&#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 根据id更新记录</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">updateData</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// teacher数据的获取</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      userApi.<span class="title function_">updateById</span>(<span class="variable language_">this</span>.<span class="property">user</span>).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">if</span> (response.<span class="property">success</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="variable language_">this</span>.$message(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="attr">message</span>: response.<span class="property">message</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123;<span class="attr">path</span>: <span class="string">&#x27;/auth/user/list&#x27;</span>&#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 根据id查询记录</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">fetchDataById</span>(<span class="params">id</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      userApi.<span class="title function_">getUserById</span>(id).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">this</span>.<span class="property">user</span> = response.<span class="property">data</span>.<span class="property">user</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>绑定角色的选择页面，<code>roleForm.vue</code> 内容如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210424224628964-1920210402.png"><img src="https://img2020.cnblogs.com/blog/2105804/202104/2105804-20210424224628964-1920210402.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line">    &lt;el-checkbox :indeterminate=&quot;isIndeterminate&quot;</span><br><span class="line">                 v-model=&quot;checkAll&quot;</span><br><span class="line">                 @change=&quot;handleCheckAllChange&quot;&gt;全选</span><br><span class="line">    &lt;/el-checkbox&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div style=&quot;margin: 15px 0;&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;el-checkbox-group v-model=&quot;checkedRoles&quot; @change=&quot;handlecheckedRolesChange&quot;&gt;</span><br><span class="line">      &lt;el-checkbox v-for=&quot;role in roles&quot;</span><br><span class="line">                   :label=&quot;role.id&quot;</span><br><span class="line">                   :key=&quot;role.id&quot;&gt;</span><br><span class="line">        &#123;&#123; role.roleName &#125;&#125;</span><br><span class="line">      &lt;/el-checkbox&gt;</span><br><span class="line">    &lt;/el-checkbox-group&gt;</span><br><span class="line">    &lt;br&gt;</span><br><span class="line">    &lt;el-button :disabled=&quot;saveBtnDisabled&quot; type=&quot;primary&quot; @click=&quot;update&quot;&gt;保存&lt;/el-button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">import userApi from &#x27;@/api/video/auth/user&#x27;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;roleForm&quot;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      // 是否全部选中</span><br><span class="line">      checkAll: false,</span><br><span class="line"></span><br><span class="line">      // 已选中列表</span><br><span class="line">      checkedRoles: [],</span><br><span class="line"></span><br><span class="line">      // 所有的角色</span><br><span class="line">      roles: [],</span><br><span class="line"></span><br><span class="line">      isIndeterminate: true,</span><br><span class="line">      userId: &#x27;&#x27;,</span><br><span class="line"></span><br><span class="line">      // 保存按钮是否禁用</span><br><span class="line">      saveBtnDisabled: false</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    this.init();</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    init() &#123;</span><br><span class="line">      if (this.$route.params &amp;&amp; this.$route.params.id) &#123;</span><br><span class="line">        // 获取用户id</span><br><span class="line">        this.userId = this.$route.params.id;</span><br><span class="line"></span><br><span class="line">        // 查询用户</span><br><span class="line">        this.getById(this.userId);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    getById(userId) &#123;</span><br><span class="line">      userApi.getAssign(userId).then(response =&gt; &#123;</span><br><span class="line">        // 获取用户角色</span><br><span class="line">        let jsonObj = response.data.assignRoles;</span><br><span class="line"></span><br><span class="line">        // 设置角色选中状态</span><br><span class="line">        this.checkedRoles = this.getJsonToList(jsonObj, &quot;id&quot;);</span><br><span class="line">        this.roles = response.data.allRolesList;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    // 把 json 数据转成 string 再转成对象，根据 Key 获取value数据</span><br><span class="line">    getJsonToList(json, key) &#123;</span><br><span class="line">      // 把JSON字符串转成对象</span><br><span class="line">      let list = JSON.parse(JSON.stringify(json));</span><br><span class="line">      let strText = [];</span><br><span class="line"></span><br><span class="line">      // 遍历这个集合对象，获取key的值</span><br><span class="line">      for (let i = 0; i &lt; list.length; i++) &#123;</span><br><span class="line">        strText.push(list[i][key]);</span><br><span class="line">      &#125;</span><br><span class="line">      return strText;</span><br><span class="line">    &#125;,</span><br><span class="line">    // 全选</span><br><span class="line">    handleCheckAllChange(val) &#123;</span><br><span class="line">      this.checkedRoles = val ? this.roles : [];</span><br><span class="line">      this.isIndeterminate = false;</span><br><span class="line">    &#125;,</span><br><span class="line">    // 切换角色</span><br><span class="line">    handlecheckedRolesChange(value) &#123;</span><br><span class="line">      let checkedCount = value.length;</span><br><span class="line">      this.checkAll = checkedCount === this.roles.length;</span><br><span class="line">      this.isIndeterminate = checkedCount &gt; 0 &amp;&amp; checkedCount &lt; this.roles.length;</span><br><span class="line">    &#125;,</span><br><span class="line">    // 更新提交</span><br><span class="line">    update() &#123;</span><br><span class="line">      // 防止表单重复提交</span><br><span class="line">      this.saveBtnDisabled = true;</span><br><span class="line"></span><br><span class="line">      let ids = this.checkedRoles.join(&quot;,&quot;);</span><br><span class="line"></span><br><span class="line">      //修改权限</span><br><span class="line">      userApi.saveAssign(this.userId, ids).then(response =&gt; &#123;</span><br><span class="line">        if (response.success) &#123;</span><br><span class="line">          this.$message(&#123;</span><br><span class="line">            type: &#x27;success&#x27;,</span><br><span class="line">            message: &#x27;保存成功&#x27;</span><br><span class="line">          &#125;);</span><br><span class="line">          this.$router.push(&#123;path: &#x27;/auth/user/list&#x27;&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>自行启动项目进行测试我自己已经测试过了</p>
<h2 id="41-权限控制-角色管理"><a href="#41-权限控制-角色管理" class="headerlink" title="41-权限控制-角色管理"></a>41-权限控制-角色管理</h2><p>修改 <code>auth_user</code> 表的，<code>open_id</code> 字段，因为这个表是给工作人员使用的，也就是内部自己使用的系统，后面我会编写一套专门提供给用户使用的那个会使用到微信登录所以字段取值为 open_id，把当前这个表的 open_id 改为 <code>username</code> SQL 如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE `video_db`.`auth_user` CHANGE COLUMN `open_id` `username` VARCHAR ( 20 ) CHARACTER </span><br><span class="line">SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL DEFAULT &#x27;&#x27; COMMENT &#x27;用户名&#x27; AFTER `id`;</span><br></pre></td></tr></table></figure>

<p>修改 <code>UserController</code> 的分页查询中的过滤条件如下图</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210501001116922-1148080581.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210501001116922-1148080581.png" alt="img"></a></p>
<p>修改前端 <code>list.vue</code> 修改内容如下图</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210501002612347-176434056.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210501002612347-176434056.png" alt="img"></a></p>
<p>还需要修改 <code>form.vue</code> 修改内容如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210501002902351-405537024.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210501002902351-405537024.png" alt="img"></a></p>
<h3 id="后端-6"><a href="#后端-6" class="headerlink" title="后端"></a>后端</h3><p>去除 <code>RoleMenu</code> 与 <code>UserRole</code> 类当中的逻辑删除分别如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210501214235650-1104659491.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210501214235650-1104659491.png" alt="img"></a></p>
<p>修改 RoleController</p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 角色 前端控制器</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2021-04-21</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;角色组&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/service_auth/admin/role&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RoleController</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RoleService roleService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;获取角色分页列表&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/getRolePageList/&#123;page&#125;/&#123;limit&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">index</span><span class="params">(<span class="meta">@ApiParam(name = &quot;page&quot;, value = &quot;当前页码&quot;, required = true)</span> <span class="meta">@PathVariable</span> Long page,</span></span><br><span class="line"><span class="params">                                <span class="meta">@ApiParam(name = &quot;limit&quot;, value = &quot;每页记录数&quot;, required = true)</span> <span class="meta">@PathVariable</span> Long limit,</span></span><br><span class="line"><span class="params">                                Role role)</span> &#123;</span><br><span class="line">        <span class="comment">// 开启分页</span></span><br><span class="line">        Page&lt;Role&gt; pageParam = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page, limit);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 构建查询条件</span></span><br><span class="line">        QueryWrapper&lt;Role&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.isEmpty(role.getRoleName())) &#123;</span><br><span class="line">            wrapper.like(<span class="string">&quot;role_name&quot;</span>, role.getRoleName());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据查询条件进行分页</span></span><br><span class="line">        roleService.page(pageParam, wrapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 返回结果</span></span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok()</span><br><span class="line">                .data(<span class="string">&quot;items&quot;</span>, pageParam.getRecords())</span><br><span class="line">                .data(<span class="string">&quot;total&quot;</span>, pageParam.getTotal());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;获取角色&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/getRoleById/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">get</span><span class="params">(<span class="meta">@PathVariable</span> String id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok().data(<span class="string">&quot;item&quot;</span>, roleService.getById(id));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;新增角色&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/saveRole&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> Role role)</span> &#123;</span><br><span class="line">        roleService.save(role);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;修改角色&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/updateRole&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">updateById</span><span class="params">(<span class="meta">@RequestBody</span> Role role)</span> &#123;</span><br><span class="line">        roleService.updateById(role);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;删除角色&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/removeRole/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">remove</span><span class="params">(<span class="meta">@PathVariable</span> String id)</span> &#123;</span><br><span class="line">        roleService.removeById(id);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;根据id列表删除角色(批量删除)&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/batchRemoveRole&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">batchRemove</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;String&gt; idList)</span> &#123;</span><br><span class="line">        roleService.removeByIds(idList);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改 RoleService</p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 角色 服务类</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2021-04-21</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RoleService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;Role&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;b&gt;</span></span><br><span class="line"><span class="comment">     * 根据用户ID获取角色数据</span></span><br><span class="line"><span class="comment">     * &lt;/b&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId 用户ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 角色数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Map&lt;String, Object&gt; <span class="title function_">findRoleByUserId</span><span class="params">(String userId)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;b&gt;</span></span><br><span class="line"><span class="comment">     * 根据用户ID分配用户角色</span></span><br><span class="line"><span class="comment">     * &lt;/b&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId 用户ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> roleId 角色ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">saveUserRoleRelationShip</span><span class="params">(String userId, String[] roleId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改 RoleServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 角色 服务实现类</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2021-04-21</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RoleServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;RoleMapper, Role&gt; <span class="keyword">implements</span> <span class="title class_">RoleService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserRoleService userRoleService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;b&gt;</span></span><br><span class="line"><span class="comment">     * 根据用户ID获取角色数据</span></span><br><span class="line"><span class="comment">     * &lt;/b&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">findRoleByUserId</span><span class="params">(String userId)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.查询出所有的角色</span></span><br><span class="line">        List&lt;Role&gt; allRoles = baseMapper.selectList(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.当前用户选中的角色有哪些</span></span><br><span class="line">        QueryWrapper&lt;UserRole&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;UserRole&gt;()</span><br><span class="line">                .eq(<span class="string">&quot;user_id&quot;</span>, userId)</span><br><span class="line">                .select(<span class="string">&quot;role_id&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取到当前用户所在的角色关系</span></span><br><span class="line">        List&lt;UserRole&gt; userRoleList = userRoleService.list(queryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 取出所有的roleId 放到一个集合当中</span></span><br><span class="line">        List&lt;String&gt; roleIds = userRoleList.stream().map(UserRole::getRoleId).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据角色id,取出所有的角色对象</span></span><br><span class="line">        List&lt;Role&gt; userRoles = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        allRoles.forEach(role -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (roleIds.contains(role.getId())) &#123;</span><br><span class="line">                userRoles.add(role);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        Map&lt;String, Object&gt; roleMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 用户的角色</span></span><br><span class="line">        roleMap.put(<span class="string">&quot;assignRoles&quot;</span>, userRoles);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 所有的角色</span></span><br><span class="line">        roleMap.put(<span class="string">&quot;allRolesList&quot;</span>, allRoles);</span><br><span class="line">        <span class="keyword">return</span> roleMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;b&gt;</span></span><br><span class="line"><span class="comment">     * 根据用户ID分配用户角色</span></span><br><span class="line"><span class="comment">     * &lt;/b&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveUserRoleRelationShip</span><span class="params">(String userId, String[] roleId)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.删除原来角色与用户之间的关系</span></span><br><span class="line">        userRoleService.remove(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;UserRole&gt;().eq(<span class="string">&quot;user_id&quot;</span>, userId));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.重新建立关系</span></span><br><span class="line">        List&lt;UserRole&gt; userRoleArrayList = Stream.of(roleId).map(role -&gt; &#123;</span><br><span class="line">            <span class="type">UserRole</span> <span class="variable">userRole</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserRole</span>();</span><br><span class="line">            userRole.setUserId(userId);</span><br><span class="line">            userRole.setRoleId(role);</span><br><span class="line">            <span class="keyword">return</span> userRole;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.批量保存关系</span></span><br><span class="line">        userRoleService.saveBatch(userRoleArrayList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="前端-5"><a href="#前端-5" class="headerlink" title="前端"></a>前端</h3><p>新增 api 文件 <code>role.js</code></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> api_name = <span class="string">&#x27;/service_auth/admin/role&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// 获取分页列表数据</span></span><br><span class="line">  <span class="title function_">getPageList</span>(<span class="params">page, limit, searchObj</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/getRolePageList/<span class="subst">$&#123;page&#125;</span>/<span class="subst">$&#123;limit&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">      <span class="comment">// url查询字符串或表单键值对</span></span><br><span class="line">      <span class="attr">params</span>: searchObj</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 根据ID获取角色</span></span><br><span class="line">  <span class="title function_">getById</span>(<span class="params">id</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/getRoleById/<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 保存角色</span></span><br><span class="line">  <span class="title function_">save</span>(<span class="params">role</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/saveRole`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: role</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 更新角色</span></span><br><span class="line">  <span class="title function_">updateById</span>(<span class="params">role</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/updateRole`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: role</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 删除角色</span></span><br><span class="line">  <span class="title function_">removeById</span>(<span class="params">id</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/removeRole/<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 批量删除</span></span><br><span class="line">  <span class="title function_">removeRows</span>(<span class="params">idList</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/batchRemoveRole`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: idList</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改路由文件 <code>index.js</code></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210501214933951-1940581737.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210501214933951-1940581737.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;role/list&#x27;</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;角色管理&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/video/auth/role/list&#x27;</span>),</span><br><span class="line">  <span class="attr">meta</span>: &#123;<span class="attr">title</span>: <span class="string">&#x27;角色管理&#x27;</span>&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;role/form&#x27;</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;添加角色&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/video/auth/role/form&#x27;</span>),</span><br><span class="line">  <span class="attr">meta</span>: &#123;<span class="attr">title</span>: <span class="string">&#x27;添加角色&#x27;</span>&#125;,</span><br><span class="line">  <span class="attr">hidden</span>: <span class="literal">true</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;role/update/:id&#x27;</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;修改角色&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/video/auth/role/form&#x27;</span>),</span><br><span class="line">  <span class="attr">meta</span>: &#123;<span class="attr">title</span>: <span class="string">&#x27;修改角色&#x27;</span>&#125;,</span><br><span class="line">  <span class="attr">hidden</span>: <span class="literal">true</span></span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;role/distribution/:id&#x27;</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;角色权限&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/video/auth/role/roleForm&#x27;</span>),</span><br><span class="line">  <span class="attr">meta</span>: &#123;<span class="attr">title</span>: <span class="string">&#x27;角色权限&#x27;</span>&#125;,</span><br><span class="line">  <span class="attr">hidden</span>: <span class="literal">true</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>新增对应的 vue 页面如下, form.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line">    &lt;el-form ref=&quot;role&quot; :model=&quot;role&quot; :rules=&quot;validateRules&quot; label-width=&quot;120px&quot;&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;角色名称&quot; prop=&quot;roleName&quot;&gt;</span><br><span class="line">        &lt;el-input v-model=&quot;role.roleName&quot;/&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-form-item&gt;</span><br><span class="line">        &lt;el-button :disabled=&quot;saveBtnDisabled&quot; type=&quot;primary&quot; @click=&quot;saveOrUpdate&quot;&gt;保存&lt;/el-button&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">    &lt;/el-form&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import roleApi from &#x27;@/api/video/auth/role&#x27;;</span><br><span class="line"></span><br><span class="line">const defaultForm = &#123;</span><br><span class="line">  roleName: &#x27;&#x27;</span><br><span class="line">&#125;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;form&quot;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      role: defaultForm,</span><br><span class="line"></span><br><span class="line">      // 保存按钮是否禁用</span><br><span class="line">      saveBtnDisabled: false,</span><br><span class="line">      validateRules: &#123;</span><br><span class="line">        roleName: [&#123;required: true, trigger: &#x27;blur&#x27;, message: &#x27;角色名必须输入&#x27;&#125;]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  // 监听器</span><br><span class="line">  watch: &#123;</span><br><span class="line">    $route(to, from) &#123;</span><br><span class="line">      this.init();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  // 生命周期方法（在路由切换，组件不变的情况下不会被调用）</span><br><span class="line">  created() &#123;</span><br><span class="line">    this.init()</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    // 表单初始化</span><br><span class="line">    init() &#123;</span><br><span class="line">      if (this.$route.params &amp;&amp; this.$route.params.id) &#123;</span><br><span class="line">        const id = this.$route.params.id;</span><br><span class="line">        this.fetchDataById(id);</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        // 对象拓展运算符：拷贝对象，而不是赋值对象的引用</span><br><span class="line">        this.role = &#123;...defaultForm&#125;;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    saveOrUpdate() &#123;</span><br><span class="line">      this.$refs.role.validate(valid =&gt; &#123;</span><br><span class="line">        if (valid) &#123;</span><br><span class="line">          // 防止表单重复提交</span><br><span class="line">          this.saveBtnDisabled = true;</span><br><span class="line">          if (!this.role.id) &#123;</span><br><span class="line">            this.saveData();</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            this.updateData();</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 新增讲师</span><br><span class="line">    saveData() &#123;</span><br><span class="line">      roleApi.save(this.role).then(response =&gt; &#123;</span><br><span class="line">        // debugger</span><br><span class="line">        if (response.success) &#123;</span><br><span class="line">          this.$message(&#123;</span><br><span class="line">            type: &#x27;success&#x27;,</span><br><span class="line">            message: response.message</span><br><span class="line">          &#125;)</span><br><span class="line">          this.$router.push(&#123;path: &#x27;/auth/role/list&#x27;&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 根据id更新记录</span><br><span class="line">    updateData() &#123;</span><br><span class="line">      // teacher数据的获取</span><br><span class="line">      roleApi.updateById(this.role).then(response =&gt; &#123;</span><br><span class="line">        if (response.success) &#123;</span><br><span class="line">          this.$message(&#123;</span><br><span class="line">            type: &#x27;success&#x27;,</span><br><span class="line">            message: response.message</span><br><span class="line">          &#125;)</span><br><span class="line">          this.$router.push(&#123;path: &#x27;/auth/role/list&#x27;&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 根据id查询记录</span><br><span class="line">    fetchDataById(id) &#123;</span><br><span class="line">      roleApi.getById(id).then(response =&gt; &#123;</span><br><span class="line">        this.role = response.data.item;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>list.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--查询表单--&gt;</span><br><span class="line">    &lt;el-form :inline=&quot;true&quot; class=&quot;demo-form-inline&quot;&gt;</span><br><span class="line">      &lt;el-form-item&gt;</span><br><span class="line">        &lt;el-input v-model=&quot;searchObj.roleName&quot; placeholder=&quot;角色名称&quot;/&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-button type=&quot;primary&quot; icon=&quot;el-icon-search&quot; @click=&quot;fetchData()&quot;&gt;查询&lt;/el-button&gt;</span><br><span class="line">      &lt;el-button type=&quot;default&quot; @click=&quot;resetData()&quot;&gt;清空&lt;/el-button&gt;</span><br><span class="line">    &lt;/el-form&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 工具条 --&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;el-button type=&quot;danger&quot; size=&quot;mini&quot; @click=&quot;addUser()&quot;&gt;添加&lt;/el-button&gt;</span><br><span class="line">      &lt;el-button type=&quot;danger&quot; size=&quot;mini&quot; @click=&quot;removeRows()&quot;&gt;批量删除&lt;/el-button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 角色列表 --&gt;</span><br><span class="line">    &lt;el-table</span><br><span class="line">      v-loading=&quot;listLoading&quot;</span><br><span class="line">      :data=&quot;list&quot;</span><br><span class="line">      stripe</span><br><span class="line">      style=&quot;width: 100%&quot;</span><br><span class="line">      @selection-change=&quot;handleSelectionChange&quot;&gt;</span><br><span class="line">      &lt;el-table-column type=&quot;selection&quot;/&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;序号&quot; align=&quot;center&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">          &#123;&#123; (page - 1) * limit + scope.$index + 1 &#125;&#125;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column align=&quot;center&quot; prop=&quot;roleName&quot; label=&quot;角色名称&quot;/&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;操作&quot; align=&quot;center&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">          &lt;router-link :to=&quot;&#x27;/auth/role/distribution/&#x27;+scope.row.id&quot;&gt;</span><br><span class="line">            分配权限</span><br><span class="line">          &lt;/router-link&gt;</span><br><span class="line">          &lt;router-link :to=&quot;&#x27;/auth/role/update/&#x27;+scope.row.id&quot;&gt;</span><br><span class="line">            编辑</span><br><span class="line">          &lt;/router-link&gt;</span><br><span class="line">          &lt;a @click=&quot;removeDataById(scope.row.id)&quot;&gt;删除&lt;/a&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">    &lt;/el-table&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 分页组件 --&gt;</span><br><span class="line">    &lt;el-pagination</span><br><span class="line">      :current-page=&quot;page&quot;</span><br><span class="line">      :total=&quot;total&quot;</span><br><span class="line">      :page-size=&quot;limit&quot;</span><br><span class="line">      :page-sizes=&quot;[5, 10, 20, 30, 40, 50, 100]&quot;</span><br><span class="line">      style=&quot;padding: 30px 0; text-align: center;&quot;</span><br><span class="line">      layout=&quot;sizes, prev, pager, next, jumper, -&gt;, total, slot&quot;</span><br><span class="line">      @current-change=&quot;fetchData&quot;</span><br><span class="line">      @size-change=&quot;changeSize&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import roleApi from &#x27;@/api/video/auth/role&#x27;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;list&quot;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      // 数据是否正在加载</span><br><span class="line">      listLoading: true,</span><br><span class="line"></span><br><span class="line">      // 讲师列表</span><br><span class="line">      list: null,</span><br><span class="line"></span><br><span class="line">      // 数据库中的总记录数</span><br><span class="line">      total: 0,</span><br><span class="line"></span><br><span class="line">      // 默认页码</span><br><span class="line">      page: 1,</span><br><span class="line"></span><br><span class="line">      // 每页记录数</span><br><span class="line">      limit: 10,</span><br><span class="line"></span><br><span class="line">      // 查询表单对象</span><br><span class="line">      searchObj: &#123;&#125;,</span><br><span class="line"></span><br><span class="line">      // 批量选择中选择的记录列表</span><br><span class="line">      multipleSelection: []</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  // 生命周期函数：内存准备完毕，页面尚未渲染</span><br><span class="line">  created() &#123;</span><br><span class="line">    this.fetchData()</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    // 当页码发生改变的时候</span><br><span class="line">    changeSize(size) &#123;</span><br><span class="line">      this.limit = size;</span><br><span class="line">      this.fetchData(1);</span><br><span class="line">    &#125;,</span><br><span class="line">    addUser() &#123;</span><br><span class="line">      this.$router.push(&#123;path: &#x27;/auth/role/form&#x27;&#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 加载讲师列表数据</span><br><span class="line">    fetchData(page = 1) &#123;</span><br><span class="line">      this.listLoading = true;</span><br><span class="line"></span><br><span class="line">      // 异步获取远程数据（ajax）</span><br><span class="line">      this.page = page;</span><br><span class="line">      roleApi.getPageList(this.page, this.limit, this.searchObj).then(response =&gt; &#123;</span><br><span class="line">          this.list = response.data.items;</span><br><span class="line">          this.total = response.data.total;</span><br><span class="line"></span><br><span class="line">          // 数据加载并绑定成功</span><br><span class="line">          this.listLoading = false;</span><br><span class="line">        &#125;</span><br><span class="line">      );</span><br><span class="line">    &#125;,</span><br><span class="line">    // 重置查询表单</span><br><span class="line">    resetData() &#123;</span><br><span class="line">      this.searchObj = &#123;&#125;;</span><br><span class="line">      this.fetchData();</span><br><span class="line">    &#125;,</span><br><span class="line">    // 根据id删除数据</span><br><span class="line">    removeDataById(id) &#123;</span><br><span class="line">      this.$confirm(&#x27;此操作将永久删除该记录, 是否继续?&#x27;, &#x27;提示&#x27;, &#123;</span><br><span class="line">        confirmButtonText: &#x27;确定&#x27;,</span><br><span class="line">        cancelButtonText: &#x27;取消&#x27;,</span><br><span class="line">        type: &#x27;warning&#x27;</span><br><span class="line">      &#125;).then(() =&gt; &#123;</span><br><span class="line">        // 点击确定，远程调用ajax</span><br><span class="line">        return roleApi.removeById(id);</span><br><span class="line">      &#125;).then((response) =&gt; &#123;</span><br><span class="line">        this.fetchData(this.page);</span><br><span class="line">        if (response.success) &#123;</span><br><span class="line">          this.$message(&#123;</span><br><span class="line">            type: &#x27;success&#x27;,</span><br><span class="line">            message: &#x27;删除成功!&#x27;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;).catch(() =&gt; &#123;</span><br><span class="line">        this.$message(&#123;</span><br><span class="line">          type: &#x27;info&#x27;,</span><br><span class="line">          message: &#x27;已取消删除&#x27;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 当表格复选框选项发生变化的时候触发</span><br><span class="line">    handleSelectionChange(selection) &#123;</span><br><span class="line">      this.multipleSelection = selection;</span><br><span class="line">    &#125;,</span><br><span class="line">    // 批量删除</span><br><span class="line">    removeRows() &#123;</span><br><span class="line">      if (this.multipleSelection.length === 0) &#123;</span><br><span class="line">        this.$message(&#123;</span><br><span class="line">          type: &#x27;warning&#x27;,</span><br><span class="line">          message: &#x27;请选择要删除的记录!&#x27;</span><br><span class="line">        &#125;);</span><br><span class="line">        return;</span><br><span class="line">      &#125;</span><br><span class="line">      this.$confirm(&#x27;此操作将永久删除该记录, 是否继续?&#x27;, &#x27;提示&#x27;, &#123;</span><br><span class="line">        confirmButtonText: &#x27;确定&#x27;,</span><br><span class="line">        cancelButtonText: &#x27;取消&#x27;,</span><br><span class="line">        type: &#x27;warning&#x27;</span><br><span class="line">      &#125;).then(() =&gt; &#123;</span><br><span class="line">        // 点击确定，远程调用ajax</span><br><span class="line">        // 遍历selection，将id取出放入id列表</span><br><span class="line">        let idList = [];</span><br><span class="line">        this.multipleSelection.forEach(item =&gt; &#123;</span><br><span class="line">          idList.push(item.id);</span><br><span class="line">        &#125;);</span><br><span class="line">        // 调用api</span><br><span class="line">        return roleApi.removeRows(idList);</span><br><span class="line">      &#125;).then((response) =&gt; &#123;</span><br><span class="line">        this.fetchData(this.page);</span><br><span class="line">        if (response.success) &#123;</span><br><span class="line">          this.$message(&#123;</span><br><span class="line">            type: &#x27;success&#x27;,</span><br><span class="line">            message: &#x27;删除成功!&#x27;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;).catch(() =&gt; &#123;</span><br><span class="line">        this.$message(&#123;</span><br><span class="line">          type: &#x27;info&#x27;,</span><br><span class="line">          message: &#x27;已取消删除&#x27;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>roleForm.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div style=&quot;margin: 20px 20px&quot;&gt;</span><br><span class="line">    &lt;el-tree</span><br><span class="line">      :data=&quot;data&quot;</span><br><span class="line">      show-checkbox</span><br><span class="line">      default-expand-all</span><br><span class="line">      node-key=&quot;id&quot;</span><br><span class="line">      ref=&quot;tree&quot;</span><br><span class="line">      highlight-current</span><br><span class="line">      :props=&quot;defaultProps&quot;&gt;</span><br><span class="line">    &lt;/el-tree&gt;</span><br><span class="line">    &lt;el-button :disabled=&quot;saveBtnDisabled&quot; type=&quot;primary&quot; @click=&quot;save&quot;&gt;保存&lt;/el-button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import menu from &#x27;@/api/video/auth/menu&#x27;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;roleForm&quot;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      saveBtnDisabled: false,</span><br><span class="line">      data: [],</span><br><span class="line">      defaultProps: &#123;</span><br><span class="line">        children: &#x27;children&#x27;,</span><br><span class="line">        label: &#x27;name&#x27;</span><br><span class="line">      &#125;,</span><br><span class="line">      roleId: &#x27;&#x27;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  // 监听器</span><br><span class="line">  watch: &#123;</span><br><span class="line">    $route(to, from) &#123;</span><br><span class="line">      this.init();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    this.init();</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    init() &#123;</span><br><span class="line">      if (this.$route.params &amp;&amp; this.$route.params.id) &#123;</span><br><span class="line">        this.roleId = this.$route.params.id;</span><br><span class="line">        this.fetchDataById(this.roleId);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    fetchDataById(roleId) &#123;</span><br><span class="line">      menu.getMenuWithRoleId(roleId).then(response =&gt; &#123;</span><br><span class="line">        this.data = response.data.children;</span><br><span class="line">        let jsonList = JSON.parse(JSON.stringify(this.data));</span><br><span class="line">        let list = [];</span><br><span class="line">        this.getJsonToList(list, jsonList[0][&#x27;children&#x27;]);</span><br><span class="line">        this.setCheckedKeys(list);</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    // 把json数据转成string再转成对象，根据Key获取value数据</span><br><span class="line">    getJsonToList(list, jsonList) &#123;</span><br><span class="line">      // 遍历这个集合对象，获取key的值</span><br><span class="line">      for (let i = 0; i &lt; jsonList.length; i++) &#123;</span><br><span class="line">        if (jsonList[i][&#x27;select&#x27;] === true &amp;&amp; jsonList[i][&#x27;level&#x27;] === 4) &#123;</span><br><span class="line">          list.push(jsonList[i][&#x27;id&#x27;]);</span><br><span class="line">        &#125;</span><br><span class="line">        if (jsonList[i][&#x27;children&#x27;] != null) &#123;</span><br><span class="line">          this.getJsonToList(list, jsonList[i][&#x27;children&#x27;]);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    getCheckedKeys() &#123;</span><br><span class="line">      console.log(this.$refs.tree.getCheckedKeys());</span><br><span class="line">    &#125;,</span><br><span class="line">    setCheckedKeys(list) &#123;</span><br><span class="line">      this.$refs.tree.setCheckedKeys(list);</span><br><span class="line">    &#125;,</span><br><span class="line">    save() &#123;</span><br><span class="line">      this.saveBtnDisabled = true;</span><br><span class="line">      let ids = this.$refs.tree.getCheckedKeys().join(&quot;,&quot;);</span><br><span class="line">      console.log(ids);</span><br><span class="line">      menu.doAssignRoleAuth(this.roleId, ids).then(response =&gt; &#123;</span><br><span class="line">        if (response.success) &#123;</span><br><span class="line">          this.$message(&#123;</span><br><span class="line">            type: &#x27;success&#x27;,</span><br><span class="line">            message: &#x27;保存成功&#x27;</span><br><span class="line">          &#125;)</span><br><span class="line">          this.$router.push(&#123;path: &#x27;/auth/role/list&#x27;&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>修改 <code>vue elementUI tree</code> 树形控件使得能够获取父节点ID的实例，不修改源码之前是获取不到的，也就是说点击了一个子节点获取不到父节点的 ID 如下图</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210501220038426-188105247.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210501220038426-188105247.png" alt="img"></a></p>
<p>修改 <code>node_modules\element-ui\lib\element-ui.common.js</code> 中的第 <code>25382</code> 行如下图</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210501220157914-195173393.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210501220157914-195173393.png" alt="img"></a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ((child.<span class="property">checked</span> || child.<span class="property">indeterminate</span>) &amp;&amp; (!leafOnly || leafOnly &amp;&amp; child.<span class="property">isLeaf</span>)) &#123;</span><br><span class="line">  checkedNodes.<span class="title function_">push</span>(child.<span class="property">data</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="42-权限控制-菜单管理"><a href="#42-权限控制-菜单管理" class="headerlink" title="42-权限控制-菜单管理"></a>42-权限控制-菜单管理</h2><h3 id="后端-7"><a href="#后端-7" class="headerlink" title="后端"></a>后端</h3><p>修改 <code>entity</code> 包下的 Menu，新增如下内容</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210501201542458-551299601.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210501201542458-551299601.png" alt="img"></a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 层级</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ApiModelProperty(value = &quot;层级&quot;)</span></span><br><span class="line"><span class="meta">@TableField(exist = false)</span></span><br><span class="line"><span class="keyword">private</span> Integer level;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 子菜单</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ApiModelProperty(value = &quot;子菜单&quot;)</span></span><br><span class="line"><span class="meta">@TableField(exist = false)</span></span><br><span class="line"><span class="keyword">private</span> List&lt;Menu&gt; children = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 是否为选中状态</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ApiModelProperty(value = &quot;是否为选中状态&quot;)</span></span><br><span class="line"><span class="meta">@TableField(exist = false)</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> isSelect;</span><br></pre></td></tr></table></figure>

<p>紧接着修改 <code>MenuController</code> 内容如下粘贴即可，业务比较简单，在完善 RBAC 的过程当中我会直接贴代码不在做过多的讲解了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 菜单权限 前端控制器</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2021-04-21</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;菜单组&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/service_auth/admin/menu&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MenuController</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> MenuService menuService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询所有菜单</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;查询所有菜单&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/getAllMenu&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">indexAllMenu</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok().data(<span class="string">&quot;children&quot;</span>, menuService.queryAllMenu());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 递归删除菜单</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;递归删除菜单&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;removeMenu/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">remove</span><span class="params">(<span class="meta">@PathVariable</span> String id)</span> &#123;</span><br><span class="line">        <span class="comment">// 删除当前菜单以及子菜单</span></span><br><span class="line">        menuService.removeChildById(id);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据角色获取菜单</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;根据角色获取菜单&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/getMenuWithRoleId/&#123;roleId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">toAssign</span><span class="params">(<span class="meta">@PathVariable</span> String roleId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok().data(<span class="string">&quot;children&quot;</span>, menuService.selectAllRoleMenu(roleId));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 给角色分配权限</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;给角色分配权限&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/doAssignRoleAuth&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">doAssign</span><span class="params">(<span class="meta">@RequestParam</span> String roleId, <span class="meta">@RequestParam</span> String[] menus)</span> &#123;</span><br><span class="line">        menuService.saveRoleMenuRelationShip(roleId, menus);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增菜单</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;新增菜单&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/saveMenu&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> Menu permission)</span> &#123;</span><br><span class="line">        menuService.save(permission);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改菜单</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;修改菜单&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/updateMenu&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">updateById</span><span class="params">(<span class="meta">@RequestBody</span> Menu menu)</span> &#123;</span><br><span class="line">        menuService.updateById(menu);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改 MenuService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 菜单权限 服务类</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2021-04-21</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MenuService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;Menu&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询所有菜单</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 菜单信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;Menu&gt; <span class="title function_">queryAllMenu</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 递归删除菜单</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id 菜单ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">removeChildById</span><span class="params">(String id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据角色获取菜单</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> roleId 角色ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 菜单信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;Menu&gt; <span class="title function_">selectAllRoleMenu</span><span class="params">(String roleId)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 给角色分配权限</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> roleId 角色ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> menus  分配的权限</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">saveRoleMenuRelationShip</span><span class="params">(String roleId, String[] menus)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改 MenuServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 菜单权限 服务实现类</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2021-04-21</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MenuServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;MenuMapper, Menu&gt; <span class="keyword">implements</span> <span class="title class_">MenuService</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RoleMenuService roleMenuService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Menu&gt; <span class="title function_">queryAllMenu</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 1.查询所有的菜单</span></span><br><span class="line">        List&lt;Menu&gt; menuList = baseMapper.selectList(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.构建树级菜单</span></span><br><span class="line">        <span class="keyword">return</span> buildTreeMenu(menuList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeChildById</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        <span class="comment">// 最终要删除的idList</span></span><br><span class="line">        List&lt;String&gt; idList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        idList.add(id);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 递归查找出所有的子菜单的id</span></span><br><span class="line">        selectChildMenu(id, idList);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 批量删除</span></span><br><span class="line">        baseMapper.deleteBatchIds(idList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Menu&gt; <span class="title function_">selectAllRoleMenu</span><span class="params">(String roleId)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.查询所有的菜单(利用CAST函数把ID转换为了整数: SIGNED，在排序)</span></span><br><span class="line">        QueryWrapper&lt;Menu&gt; qw = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;Menu&gt;().orderByAsc(<span class="string">&quot;CAST(id AS SIGNED)&quot;</span>);</span><br><span class="line">        List&lt;Menu&gt; menuList = baseMapper.selectList(qw);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.根据角色,查询角色对象的菜单权限</span></span><br><span class="line">        QueryWrapper&lt;RoleMenu&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;RoleMenu&gt;().eq(<span class="string">&quot;role_id&quot;</span>, roleId);</span><br><span class="line">        List&lt;RoleMenu&gt; roleMenuList = roleMenuService.list(queryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.确定哪些菜单成为选中状态</span></span><br><span class="line">        menuList.forEach(menu -&gt; roleMenuList.forEach(roleMenu -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (menu.getId().equals(roleMenu.getPermissionId())) &#123;</span><br><span class="line">                menu.setSelect(<span class="literal">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.构建树级菜单</span></span><br><span class="line">        <span class="keyword">return</span> buildTreeMenu(menuList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveRoleMenuRelationShip</span><span class="params">(String roleId, String[] menus)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.删除原来的角色权限</span></span><br><span class="line">        roleMenuService.remove(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;RoleMenu&gt;().eq(<span class="string">&quot;role_id&quot;</span>, roleId));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.重新构建角色权限</span></span><br><span class="line">        List&lt;RoleMenu&gt; roleMenuArrayList = Stream.of(menus).map(menu -&gt; &#123;</span><br><span class="line">            <span class="type">RoleMenu</span> <span class="variable">roleMenu</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RoleMenu</span>();</span><br><span class="line">            roleMenu.setRoleId(roleId);</span><br><span class="line">            roleMenu.setPermissionId(menu);</span><br><span class="line">            <span class="keyword">return</span> roleMenu;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.批量保存</span></span><br><span class="line">        roleMenuService.saveBatch(roleMenuArrayList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 构建树形菜单</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Menu&gt; <span class="title function_">buildTreeMenu</span><span class="params">(List&lt;Menu&gt; menuList)</span> &#123;</span><br><span class="line">        <span class="comment">// 最终返回的树级菜单</span></span><br><span class="line">        List&lt;Menu&gt; menus = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        menuList.forEach(menu -&gt; &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 查找最顶级的菜单</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="string">&quot;0&quot;</span>.equals(menu.getPid())) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 设置顶级菜单的级别</span></span><br><span class="line">                menu.setLevel(<span class="number">1</span>);</span><br><span class="line">                <span class="comment">// 构造子菜单</span></span><br><span class="line">                buildChildrenMenu(menu, menuList);</span><br><span class="line">                menus.add(menu);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> menus;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 构建子菜单</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">buildChildrenMenu</span><span class="params">(Menu menu, List&lt;Menu&gt; menuList)</span> &#123;</span><br><span class="line">        <span class="comment">// 从menuList当中查找当前的子菜单</span></span><br><span class="line">        menuList.forEach(m -&gt; &#123;</span><br><span class="line">            <span class="comment">// 判断是不是自己的子菜单</span></span><br><span class="line">            <span class="keyword">if</span> (menu.getId().equals(m.getPid())) &#123;</span><br><span class="line">                <span class="comment">// 是子菜单</span></span><br><span class="line">                <span class="type">int</span> <span class="variable">level</span> <span class="operator">=</span> menu.getLevel() + <span class="number">1</span>;</span><br><span class="line">                <span class="comment">// 设置级别</span></span><br><span class="line">                m.setLevel(level);</span><br><span class="line">                <span class="comment">// 递归设置子菜单</span></span><br><span class="line">                menu.getChildren().add(m);</span><br><span class="line">                buildChildrenMenu(m, menuList);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询子菜单</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">selectChildMenu</span><span class="params">(String id, List&lt;String&gt; idList)</span> &#123;</span><br><span class="line">        <span class="comment">// 查询出当前id子菜单的条件</span></span><br><span class="line">        QueryWrapper&lt;Menu&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;Menu&gt;().eq(<span class="string">&quot;pid&quot;</span>, id).select(<span class="string">&quot;id&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 开始查询</span></span><br><span class="line">        List&lt;Menu&gt; childMenuList = baseMapper.selectList(queryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (childMenuList.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 取出子菜单id放到集合当中</span></span><br><span class="line">            childMenuList.forEach(menu -&gt; &#123;</span><br><span class="line">                idList.add(menu.getId());</span><br><span class="line">                <span class="built_in">this</span>.selectChildMenu(menu.getId(), idList);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="前端-6"><a href="#前端-6" class="headerlink" title="前端"></a>前端</h3><p>新增 api 文件 <code>menu.js</code></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> api_name = <span class="string">&#x27;/service_auth/admin/menu&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// 获取所有菜单</span></span><br><span class="line">  <span class="title function_">getNestedTreeList</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/getAllMenu`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 删除菜单</span></span><br><span class="line">  <span class="title function_">removeById</span>(<span class="params">id</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/removeMenu/<span class="subst">$&#123;id&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&quot;post&quot;</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 保存菜单</span></span><br><span class="line">  <span class="title function_">saveMenu</span>(<span class="params">menu</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/saveMenu`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">      <span class="attr">data</span>: menu</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 更新菜单</span></span><br><span class="line">  <span class="title function_">update</span>(<span class="params">menu</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/updateMenu`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">      <span class="attr">data</span>: menu</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 根据角色获取菜单</span></span><br><span class="line">  <span class="title function_">getMenuWithRoleId</span>(<span class="params">roleId</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/getMenuWithRoleId/<span class="subst">$&#123;roleId&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 根据角色分配权限</span></span><br><span class="line">  <span class="title function_">doAssignRoleAuth</span>(<span class="params">roleId, menus</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/doAssignRoleAuth`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">      <span class="attr">params</span>: &#123;roleId, menus&#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>新增菜单管理的路由修改 <code>router\index.js</code></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210501204857599-1984168892.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210501204857599-1984168892.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;menu/list&#x27;</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;菜单管理&#x27;</span>,</span><br><span class="line">  <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;@/views/video/auth/menu/list&#x27;</span>),</span><br><span class="line">  <span class="attr">meta</span>: &#123;<span class="attr">title</span>: <span class="string">&#x27;菜单管理&#x27;</span>&#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>新增 <code>list.vue</code> 新增位置如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;app-container&quot;&gt;</span><br><span class="line">    &lt;!--</span><br><span class="line">    row-key,数据当中,哪一个字段能够唯一的标识一行</span><br><span class="line">    :expand-row-keys 要求传入的是一个数组</span><br><span class="line">    --&gt;</span><br><span class="line">    &lt;el-table</span><br><span class="line">      :data=&quot;menuList&quot;</span><br><span class="line">      style=&quot;width: 100%;margin-bottom: 20px;&quot;</span><br><span class="line">      :expand-row-keys=&quot;expands&quot;</span><br><span class="line">      row-key=&quot;id&quot;</span><br><span class="line">      ref=&quot;refTable&quot;</span><br><span class="line">      @row-click=&quot;clickTable&quot;</span><br><span class="line">      border</span><br><span class="line">      :tree-props=&quot;&#123;children: &#x27;children&#x27;, hasChildren: &#x27;hasChildren&#x27;&#125;&quot;&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;name&quot; label=&quot;名称&quot; sortable align=&quot;center&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;path&quot; label=&quot;访问路径&quot; sortable align=&quot;center&quot; width=&quot;180&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;component&quot; label=&quot;组件路径&quot; sortable align=&quot;center&quot; width=&quot;180&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column prop=&quot;permissionValue&quot; label=&quot;权限值&quot; align=&quot;center&quot;/&gt;</span><br><span class="line">      &lt;!--CRUD操作--&gt;</span><br><span class="line">      &lt;el-table-column label=&quot;操作&quot; align=&quot;center&quot;&gt;</span><br><span class="line">        &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">          &lt;el-button type=&quot;primary&quot; size=&quot;mini&quot;</span><br><span class="line">                     @click.native.stop=&quot;() =&gt; &#123;dialogFormVisible = true,menu.pid = scope.row.id&#125;&quot;&gt;添加菜单</span><br><span class="line">          &lt;/el-button&gt;</span><br><span class="line">          &lt;el-button type=&quot;success&quot; size=&quot;mini&quot;</span><br><span class="line">                     @click.native.stop=&quot;() =&gt; getById(scope.row)&quot;&gt;修改菜单</span><br><span class="line">          &lt;/el-button&gt;</span><br><span class="line">          &lt;el-button type=&quot;success&quot; size=&quot;mini&quot;</span><br><span class="line">                     @click.native.stop=&quot;() =&gt; &#123;dialogPermissionVisible = true, permission.pid = scope.row.id&#125;&quot;&gt;添加权限</span><br><span class="line">          &lt;/el-button&gt;</span><br><span class="line">          &lt;el-button type=&quot;primary&quot; size=&quot;mini&quot;</span><br><span class="line">                     @click.native.stop=&quot;() =&gt; updateFunction(scope.row)&quot;&gt;修改权限</span><br><span class="line">          &lt;/el-button&gt;</span><br><span class="line">          &lt;el-button type=&quot;danger&quot; size=&quot;mini&quot; icon=&quot;el-icon-delete&quot;</span><br><span class="line">                     @click.native.stop=&quot;() =&gt; remove(scope.row)&quot;&gt;&lt;/el-button&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">    &lt;/el-table&gt;</span><br><span class="line">    &lt;!--</span><br><span class="line">    添加菜单的窗口</span><br><span class="line">    --&gt;</span><br><span class="line">    &lt;el-dialog :visible.sync=&quot;dialogFormVisible&quot; :title=&quot;dialogFormValue&quot;&gt;</span><br><span class="line">      &lt;el-form ref=&quot;menu&quot; :model=&quot;menu&quot; :rules=&quot;menuValidateRules&quot; label-width=&quot;120px&quot;&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;菜单名称&quot; prop=&quot;name&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;menu.name&quot;/&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;访问路径&quot; prop=&quot;path&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;menu.path&quot;/&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;组件路径&quot; prop=&quot;component&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;menu.component&quot;/&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">      &lt;div slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        &lt;el-button @click=&quot;resetData()&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;addMenuClick()&quot;&gt;确 定&lt;/el-button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br><span class="line">    &lt;!--</span><br><span class="line">    添加权限的窗口</span><br><span class="line">    --&gt;</span><br><span class="line">    &lt;el-dialog :visible.sync=&quot;dialogPermissionVisible&quot; title=&quot;添加功能权限&quot;&gt;</span><br><span class="line">      &lt;el-form ref=&quot;permission&quot; :model=&quot;permission&quot; :rules=&quot;permissionValidateRules&quot; label-width=&quot;120px&quot;&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;功能名称&quot; prop=&quot;name&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;permission.name&quot;/&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;访问路径&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;permission.path&quot;/&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;组件路径&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;permission.component&quot;/&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;功能权限值&quot; prop=&quot;permissionValue&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;permission.permissionValue&quot;/&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">      &lt;div slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        &lt;el-button @click=&quot;resetData()&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;appendPermission()&quot;&gt;确 定&lt;/el-button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import menu from &#x27;@/api/video/auth/menu&#x27;;</span><br><span class="line"></span><br><span class="line">// 菜单实体</span><br><span class="line">const menuForm = &#123;</span><br><span class="line">  name: &#x27;&#x27;,</span><br><span class="line">  pid: 0,</span><br><span class="line">  path: &#x27;&#x27;,</span><br><span class="line">  component: &#x27;&#x27;,</span><br><span class="line">  type: 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 权限实体</span><br><span class="line">const perForm = &#123;</span><br><span class="line">  permissionValue: &#x27;&#x27;,</span><br><span class="line">  name: &#x27;&#x27;,</span><br><span class="line">  path: &#x27;&#x27;,</span><br><span class="line">  component: &#x27;&#x27;,</span><br><span class="line">  pid: 0,</span><br><span class="line">  type: 2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;list&quot;,</span><br><span class="line">  // 初始化相关属性</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      menuList: [],</span><br><span class="line">      defaultProps: &#123;</span><br><span class="line">        children: &#x27;children&#x27;,</span><br><span class="line">        label: &#x27;name&#x27;</span><br><span class="line">      &#125;,</span><br><span class="line">      dialogFormValue: &#x27;添加菜单&#x27;,</span><br><span class="line">      dialogFormVisible: false,</span><br><span class="line">      dialogPermissionVisible: false,</span><br><span class="line">      menu: &#123;...menuForm&#125;,</span><br><span class="line">      permission: &#123;...perForm&#125;,</span><br><span class="line">      menuValidateRules: &#123;</span><br><span class="line">        name: [&#123;required: true, trigger: &#x27;blur&#x27;, message: &#x27;菜单名必须输入&#x27;&#125;],</span><br><span class="line">        path: [&#123;required: true, trigger: &#x27;blur&#x27;, message: &#x27;菜单路径必须输入&#x27;&#125;],</span><br><span class="line">        component: [&#123;required: true, trigger: &#x27;blur&#x27;, message: &#x27;组件名称必须输入&#x27;&#125;]</span><br><span class="line">      &#125;,</span><br><span class="line">      permissionValidateRules: &#123;</span><br><span class="line">        name: [&#123;required: true, trigger: &#x27;blur&#x27;, message: &#x27;功能名称必须输入&#x27;&#125;],</span><br><span class="line">        permissionValue: [&#123;required: true, trigger: &#x27;blur&#x27;, message: &#x27;功能权限值必须输入&#x27;&#125;]</span><br><span class="line">      &#125;,</span><br><span class="line">      // 要展开的行，数值的元素是row的key值</span><br><span class="line">      expands: []</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    // 获取列表数据</span><br><span class="line">    this.fetchNodeList();</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    // table的方法,展开/折叠 行</span><br><span class="line">    clickTable(row, index, e) &#123;</span><br><span class="line">      // 调用,table的方法,展开/折叠 行</span><br><span class="line">      this.$refs.refTable.toggleRowExpansion(row);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 获取列表数据</span><br><span class="line">    fetchNodeList() &#123;</span><br><span class="line">      menu.getNestedTreeList().then(res =&gt; &#123;</span><br><span class="line">        if (res.success === true) &#123;</span><br><span class="line">          this.menuList = res.data.children;</span><br><span class="line">          this.expands.push(this.menuList[0].id);</span><br><span class="line">          this.resetData();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 删除菜单</span><br><span class="line">    remove(data) &#123;</span><br><span class="line">      this.$confirm(&#x27;此操作将永久删除该记录, 是否继续?&#x27;, &#x27;提示&#x27;, &#123;</span><br><span class="line">        confirmButtonText: &#x27;确定&#x27;,</span><br><span class="line">        cancelButtonText: &#x27;取消&#x27;,</span><br><span class="line">        type: &#x27;warning&#x27;</span><br><span class="line">      &#125;).then(() =&gt; &#123;</span><br><span class="line">        return menu.removeById(data.id);</span><br><span class="line">      &#125;).then(() =&gt; &#123;</span><br><span class="line">        // 刷新列表</span><br><span class="line">        this.fetchNodeList();</span><br><span class="line">        this.$message(&#123;</span><br><span class="line">          type: &#x27;success&#x27;,</span><br><span class="line">          message: &#x27;删除成功!&#x27;</span><br><span class="line">        &#125;);</span><br><span class="line">        // 失败</span><br><span class="line">      &#125;).catch((res) =&gt; &#123;</span><br><span class="line">        if (res === &#x27;cancel&#x27;) &#123;</span><br><span class="line">          this.$message(&#123;</span><br><span class="line">            type: &#x27;info&#x27;,</span><br><span class="line">            message: &#x27;已取消删除&#x27;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          this.$message(&#123;</span><br><span class="line">            type: &#x27;error&#x27;,</span><br><span class="line">            message: &#x27;删除失败&#x27;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 添加功能权限</span><br><span class="line">    appendPermission() &#123;</span><br><span class="line">      this.$refs.permission.validate(valid =&gt; &#123;</span><br><span class="line">        if (valid) &#123;</span><br><span class="line">          if (this.permission.id) &#123;</span><br><span class="line">            this.update(this.permission);</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            menu.saveMenu(this.permission).then(res =&gt; &#123;</span><br><span class="line">              this.dialogPermissionVisible = false;</span><br><span class="line">              this.$message(&#123;</span><br><span class="line">                type: &#x27;success&#x27;,</span><br><span class="line">                message: &#x27;添加权限成功&#x27;</span><br><span class="line">              &#125;);</span><br><span class="line">              // 刷新数据，展开菜单</span><br><span class="line">              menu.getNestedTreeList().then(res =&gt; &#123;</span><br><span class="line">                if (res.success === true) &#123;</span><br><span class="line">                  this.menuList = res.data.children;</span><br><span class="line">                  this.expands.push(this.permission.pid);</span><br><span class="line">                  this.resetData();</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 添加菜单点击</span><br><span class="line">    addMenuClick() &#123;</span><br><span class="line">      this.$refs.menu.validate(valid =&gt; &#123;</span><br><span class="line">        if (valid) &#123;</span><br><span class="line">          // 添加</span><br><span class="line">          if (!this.menu.id) &#123;</span><br><span class="line">            this.addMenu();</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            // 修改</span><br><span class="line">            this.update(this.menu);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    // 添加菜单</span><br><span class="line">    addMenu() &#123;</span><br><span class="line">      menu.saveMenu(this.menu).then(res =&gt; &#123;</span><br><span class="line">        this.dialogFormVisible = false</span><br><span class="line">        this.$message(&#123;</span><br><span class="line">          type: &#x27;success&#x27;,</span><br><span class="line">          message: &#x27;添加菜单成功&#x27;</span><br><span class="line">        &#125;)</span><br><span class="line">        // 刷新数据，展开菜单</span><br><span class="line">        menu.getNestedTreeList().then(response =&gt; &#123;</span><br><span class="line">          if (response.success === true) &#123;</span><br><span class="line">            this.menuList = response.data.children;</span><br><span class="line"></span><br><span class="line">            // 展开刚添加菜单的父级</span><br><span class="line">            this.expands.push(this.menu.pid);</span><br><span class="line">            this.resetData();</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;).catch(error =&gt; &#123;</span><br><span class="line">        this.dialogFormVisible = false;</span><br><span class="line"></span><br><span class="line">        this.$message(&#123;</span><br><span class="line">          type: &#x27;error&#x27;,</span><br><span class="line">          message: &#x27;添加菜单失败&#x27;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 修改菜单</span><br><span class="line">    update(obj) &#123;</span><br><span class="line">      menu.update(obj).then(res =&gt; &#123;</span><br><span class="line">        this.dialogFormVisible = false;</span><br><span class="line"></span><br><span class="line">        this.$message(&#123;</span><br><span class="line">          type: &#x27;success&#x27;,</span><br><span class="line">          message: &#x27;修改成功&#x27;</span><br><span class="line">        &#125;);</span><br><span class="line">        // 刷新页面</span><br><span class="line">        this.fetchNodeList();</span><br><span class="line">        this.resetData();</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    // 获取菜单信息</span><br><span class="line">    getById(data) &#123;</span><br><span class="line">      this.dialogFormVisible = true;</span><br><span class="line">      this.menu = data;</span><br><span class="line">    &#125;,</span><br><span class="line">    // 修改权限点击</span><br><span class="line">    updateFunction(data) &#123;</span><br><span class="line">      this.dialogPermissionVisible = true;</span><br><span class="line">      this.permission = data;</span><br><span class="line">    &#125;,</span><br><span class="line">    // 重置数据</span><br><span class="line">    resetData() &#123;</span><br><span class="line">      this.dialogPermissionVisible = false;</span><br><span class="line">      this.dialogFormVisible = false;</span><br><span class="line">      this.menu = &#123;...menuForm&#125;;</span><br><span class="line">      this.permission = &#123;...perForm&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>菜单相关数据插入 SQL</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`auth_menu` (`id`, `pid`, `name`, `type`, `permission_value`, `path`, `component`, `icon`, `status`, `is_deleted`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;全部数据&#x27;</span>, <span class="number">0</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">0</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`auth_menu` (`id`, `pid`, `name`, `type`, `permission_value`, `path`, `component`, `icon`, `status`, `is_deleted`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1195268474480156673&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;权限管理&#x27;</span>, <span class="number">1</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;/authority&#x27;</span>, <span class="string">&#x27;Layout&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">0</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`auth_menu` (`id`, `pid`, `name`, `type`, `permission_value`, `path`, `component`, `icon`, `status`, `is_deleted`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1195268616021139457&#x27;</span>, <span class="string">&#x27;1195268474480156673&#x27;</span>, <span class="string">&#x27;用户管理&#x27;</span>, <span class="number">1</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;user/list&#x27;</span>, <span class="string">&#x27;authority/user/list&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">0</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`auth_menu` (`id`, `pid`, `name`, `type`, `permission_value`, `path`, `component`, `icon`, `status`, `is_deleted`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1195268788138598401&#x27;</span>, <span class="string">&#x27;1195268474480156673&#x27;</span>, <span class="string">&#x27;角色管理&#x27;</span>, <span class="number">1</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;role/list&#x27;</span>, <span class="string">&#x27;authority/role/list&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">0</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`auth_menu` (`id`, `pid`, `name`, `type`, `permission_value`, `path`, `component`, `icon`, `status`, `is_deleted`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1195268893830864898&#x27;</span>, <span class="string">&#x27;1195268474480156673&#x27;</span>, <span class="string">&#x27;菜单管理&#x27;</span>, <span class="number">1</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;menu/list&#x27;</span>, <span class="string">&#x27;authority/menu/list&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">0</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`auth_menu` (`id`, `pid`, `name`, `type`, `permission_value`, `path`, `component`, `icon`, `status`, `is_deleted`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1195269143060602882&#x27;</span>, <span class="string">&#x27;1195268616021139457&#x27;</span>, <span class="string">&#x27;查看&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;user.list&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">0</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`auth_menu` (`id`, `pid`, `name`, `type`, `permission_value`, `path`, `component`, `icon`, `status`, `is_deleted`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1195269295926206466&#x27;</span>, <span class="string">&#x27;1195268616021139457&#x27;</span>, <span class="string">&#x27;添加&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;user.add&#x27;</span>, <span class="string">&#x27;user/add&#x27;</span>, <span class="string">&#x27;authority/user/form&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">0</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`auth_menu` (`id`, `pid`, `name`, `type`, `permission_value`, `path`, `component`, `icon`, `status`, `is_deleted`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1195269473479483394&#x27;</span>, <span class="string">&#x27;1195268616021139457&#x27;</span>, <span class="string">&#x27;修改&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;user.update&#x27;</span>, <span class="string">&#x27;user/update/:id&#x27;</span>, <span class="string">&#x27;authority/user/form&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">0</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`auth_menu` (`id`, `pid`, `name`, `type`, `permission_value`, `path`, `component`, `icon`, `status`, `is_deleted`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1195269547269873666&#x27;</span>, <span class="string">&#x27;1195268616021139457&#x27;</span>, <span class="string">&#x27;删除&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;user.remove&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">0</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`auth_menu` (`id`, `pid`, `name`, `type`, `permission_value`, `path`, `component`, `icon`, `status`, `is_deleted`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1195269821262782465&#x27;</span>, <span class="string">&#x27;1195268788138598401&#x27;</span>, <span class="string">&#x27;修改&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;role.update&#x27;</span>, <span class="string">&#x27;role/update/:id&#x27;</span>, <span class="string">&#x27;authority/role/form&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">0</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`auth_menu` (`id`, `pid`, `name`, `type`, `permission_value`, `path`, `component`, `icon`, `status`, `is_deleted`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1195269903542444034&#x27;</span>, <span class="string">&#x27;1195268788138598401&#x27;</span>, <span class="string">&#x27;查看&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;role.list&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">0</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`auth_menu` (`id`, `pid`, `name`, `type`, `permission_value`, `path`, `component`, `icon`, `status`, `is_deleted`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1195270037005197313&#x27;</span>, <span class="string">&#x27;1195268788138598401&#x27;</span>, <span class="string">&#x27;添加&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;role.add&#x27;</span>, <span class="string">&#x27;role/form&#x27;</span>, <span class="string">&#x27;authority/role/form&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">0</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`auth_menu` (`id`, `pid`, `name`, `type`, `permission_value`, `path`, `component`, `icon`, `status`, `is_deleted`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1195270442602782721&#x27;</span>, <span class="string">&#x27;1195268788138598401&#x27;</span>, <span class="string">&#x27;删除&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;role.remove&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">0</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`auth_menu` (`id`, `pid`, `name`, `type`, `permission_value`, `path`, `component`, `icon`, `status`, `is_deleted`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1195270621548568578&#x27;</span>, <span class="string">&#x27;1195268788138598401&#x27;</span>, <span class="string">&#x27;角色权限&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;role.acl&#x27;</span>, <span class="string">&#x27;role/distribution/:id&#x27;</span>, <span class="string">&#x27;authority/role/roleForm&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">0</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`auth_menu` (`id`, `pid`, `name`, `type`, `permission_value`, `path`, `component`, `icon`, `status`, `is_deleted`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1195270744097742849&#x27;</span>, <span class="string">&#x27;1195268893830864898&#x27;</span>, <span class="string">&#x27;查看&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;menu.list&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">0</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`auth_menu` (`id`, `pid`, `name`, `type`, `permission_value`, `path`, `component`, `icon`, `status`, `is_deleted`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1195270810560684034&#x27;</span>, <span class="string">&#x27;1195268893830864898&#x27;</span>, <span class="string">&#x27;添加&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;menu.add&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">0</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`auth_menu` (`id`, `pid`, `name`, `type`, `permission_value`, `path`, `component`, `icon`, `status`, `is_deleted`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1195270862100291586&#x27;</span>, <span class="string">&#x27;1195268893830864898&#x27;</span>, <span class="string">&#x27;修改&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;menu.update&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">0</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`auth_menu` (`id`, `pid`, `name`, `type`, `permission_value`, `path`, `component`, `icon`, `status`, `is_deleted`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1195270887933009922&#x27;</span>, <span class="string">&#x27;1195268893830864898&#x27;</span>, <span class="string">&#x27;删除&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;menu.remove&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">0</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`auth_menu` (`id`, `pid`, `name`, `type`, `permission_value`, `path`, `component`, `icon`, `status`, `is_deleted`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1195349439240048642&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;创作者管理&#x27;</span>, <span class="number">1</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;/author&#x27;</span>, <span class="string">&#x27;Layout&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">0</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`auth_menu` (`id`, `pid`, `name`, `type`, `permission_value`, `path`, `component`, `icon`, `status`, `is_deleted`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1195349699995734017&#x27;</span>, <span class="string">&#x27;1195349439240048642&#x27;</span>, <span class="string">&#x27;创作者列表&#x27;</span>, <span class="number">1</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;table&#x27;</span>, <span class="string">&#x27;video/author/list&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">0</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`auth_menu` (`id`, `pid`, `name`, `type`, `permission_value`, `path`, `component`, `icon`, `status`, `is_deleted`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1195349810561781761&#x27;</span>, <span class="string">&#x27;1195349439240048642&#x27;</span>, <span class="string">&#x27;添加创作者&#x27;</span>, <span class="number">1</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;save&#x27;</span>, <span class="string">&#x27;video/author/save&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">0</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`auth_menu` (`id`, `pid`, `name`, `type`, `permission_value`, `path`, `component`, `icon`, `status`, `is_deleted`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1195349876252971010&#x27;</span>, <span class="string">&#x27;1195349810561781761&#x27;</span>, <span class="string">&#x27;添加&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;author.add&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">0</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`auth_menu` (`id`, `pid`, `name`, `type`, `permission_value`, `path`, `component`, `icon`, `status`, `is_deleted`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1195349979797753857&#x27;</span>, <span class="string">&#x27;1195349699995734017&#x27;</span>, <span class="string">&#x27;查看&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;author.list&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">0</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`auth_menu` (`id`, `pid`, `name`, `type`, `permission_value`, `path`, `component`, `icon`, `status`, `is_deleted`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1195350117270261762&#x27;</span>, <span class="string">&#x27;1195349699995734017&#x27;</span>, <span class="string">&#x27;修改&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;author.update&#x27;</span>, <span class="string">&#x27;edit/:id&#x27;</span>, <span class="string">&#x27;video/author/save&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">0</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`auth_menu` (`id`, `pid`, `name`, `type`, `permission_value`, `path`, `component`, `icon`, `status`, `is_deleted`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1195350188359520258&#x27;</span>, <span class="string">&#x27;1195349699995734017&#x27;</span>, <span class="string">&#x27;删除&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;author.remove&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">0</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`auth_menu` (`id`, `pid`, `name`, `type`, `permission_value`, `path`, `component`, `icon`, `status`, `is_deleted`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1195350299365969922&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;作品分类&#x27;</span>, <span class="number">1</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;/video/category&#x27;</span>, <span class="string">&#x27;Layout&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">0</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`auth_menu` (`id`, `pid`, `name`, `type`, `permission_value`, `path`, `component`, `icon`, `status`, `is_deleted`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1195350397751758850&#x27;</span>, <span class="string">&#x27;1195350299365969922&#x27;</span>, <span class="string">&#x27;作品分类列表&#x27;</span>, <span class="number">1</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;list&#x27;</span>, <span class="string">&#x27;video/category/list&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">0</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`auth_menu` (`id`, `pid`, `name`, `type`, `permission_value`, `path`, `component`, `icon`, `status`, `is_deleted`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1195350500512206850&#x27;</span>, <span class="string">&#x27;1195350299365969922&#x27;</span>, <span class="string">&#x27;上传作品分类&#x27;</span>, <span class="number">1</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;import&#x27;</span>, <span class="string">&#x27;video/category/save&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">0</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`auth_menu` (`id`, `pid`, `name`, `type`, `permission_value`, `path`, `component`, `icon`, `status`, `is_deleted`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1195350612172967938&#x27;</span>, <span class="string">&#x27;1195350397751758850&#x27;</span>, <span class="string">&#x27;查看&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;category.list&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">0</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`auth_menu` (`id`, `pid`, `name`, `type`, `permission_value`, `path`, `component`, `icon`, `status`, `is_deleted`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1195350687590748161&#x27;</span>, <span class="string">&#x27;1195350500512206850&#x27;</span>, <span class="string">&#x27;导入&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;category.import&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">0</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`auth_menu` (`id`, `pid`, `name`, `type`, `permission_value`, `path`, `component`, `icon`, `status`, `is_deleted`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1195350831744782337&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;作品管理&#x27;</span>, <span class="number">1</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;/video/content&#x27;</span>, <span class="string">&#x27;Layout&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">0</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`auth_menu` (`id`, `pid`, `name`, `type`, `permission_value`, `path`, `component`, `icon`, `status`, `is_deleted`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1195350919074385921&#x27;</span>, <span class="string">&#x27;1195350831744782337&#x27;</span>, <span class="string">&#x27;作品列表&#x27;</span>, <span class="number">1</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;list&#x27;</span>, <span class="string">&#x27;video/content/list&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">0</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`auth_menu` (`id`, `pid`, `name`, `type`, `permission_value`, `path`, `component`, `icon`, `status`, `is_deleted`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1195351020463296513&#x27;</span>, <span class="string">&#x27;1195350831744782337&#x27;</span>, <span class="string">&#x27;添加作品&#x27;</span>, <span class="number">1</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;info&#x27;</span>, <span class="string">&#x27;video/content/info&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">0</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`auth_menu` (`id`, `pid`, `name`, `type`, `permission_value`, `path`, `component`, `icon`, `status`, `is_deleted`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1195351159672246274&#x27;</span>, <span class="string">&#x27;1195350919074385921&#x27;</span>, <span class="string">&#x27;发布作品&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;content.publish&#x27;</span>, <span class="string">&#x27;send/:id&#x27;</span>, <span class="string">&#x27;video/content/send&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">0</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`auth_menu` (`id`, `pid`, `name`, `type`, `permission_value`, `path`, `component`, `icon`, `status`, `is_deleted`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1195351326706208770&#x27;</span>, <span class="string">&#x27;1195350919074385921&#x27;</span>, <span class="string">&#x27;编辑课程&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;content.update&#x27;</span>, <span class="string">&#x27;info/:id&#x27;</span>, <span class="string">&#x27;video/content/info&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">0</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`auth_menu` (`id`, `pid`, `name`, `type`, `permission_value`, `path`, `component`, `icon`, `status`, `is_deleted`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1195351566221938690&#x27;</span>, <span class="string">&#x27;1195350919074385921&#x27;</span>, <span class="string">&#x27;章节信息&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;chapter.update&#x27;</span>, <span class="string">&#x27;chapter/:id&#x27;</span>, <span class="string">&#x27;video/content/chapter&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">0</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`auth_menu` (`id`, `pid`, `name`, `type`, `permission_value`, `path`, `component`, `icon`, `status`, `is_deleted`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1196301740985311234&#x27;</span>, <span class="string">&#x27;1195268616021139457&#x27;</span>, <span class="string">&#x27;分配角色&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;user.assgin&#x27;</span>, <span class="string">&#x27;user/role/:id&#x27;</span>, <span class="string">&#x27;authority/user/roleForm&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">0</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>, <span class="string">&#x27;2021-05-05 19:17:09&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`auth_menu` (`id`, `pid`, `name`, `type`, `permission_value`, `path`, `component`, `icon`, `status`, `is_deleted`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1388495490356727810&#x27;</span>, <span class="string">&#x27;1195349699995734017&#x27;</span>, <span class="string">&#x27;测试&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;test&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">1</span>, <span class="string">&#x27;2021-05-01 22:08:17&#x27;</span>, <span class="string">&#x27;2021-05-01 22:08:17&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `video_db`.`auth_menu` (`id`, `pid`, `name`, `type`, `permission_value`, `path`, `component`, `icon`, `status`, `is_deleted`, `gmt_create`, `gmt_modified`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1388495557524312066&#x27;</span>, <span class="string">&#x27;1195349699995734017&#x27;</span>, <span class="string">&#x27;test2&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;test2&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">1</span>, <span class="string">&#x27;2021-05-01 22:08:33&#x27;</span>, <span class="string">&#x27;2021-05-01 22:08:45&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="43-权限控制-security权限控制"><a href="#43-权限控制-security权限控制" class="headerlink" title="43-权限控制-security权限控制"></a>43-权限控制-security权限控制</h2><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210502120009690-1753787737.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210502120009690-1753787737.png" alt="img"></a></p>
<h3 id="添加依赖-1"><a href="#添加依赖-1" class="headerlink" title="添加依赖"></a>添加依赖</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;top.it6666&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;common_utils&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!-- Spring Security依赖 --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;jjwt&lt;/artifactId&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>

<p>common_security 包分别如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210504153342325-1556701066.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210504153342325-1556701066.png" alt="img"></a></p>
<h3 id="config"><a href="#config" class="headerlink" title="config"></a>config</h3><p>TokenWebSecurityConfig</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @author BNTang</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @project video_parent</span><br><span class="line"> * @description Security配置</span><br><span class="line"> * @since Created in 2021/5/2 002 12:02</span><br><span class="line"> **/</span><br><span class="line">@Configuration</span><br><span class="line">@EnableWebSecurity</span><br><span class="line">@EnableGlobalMethodSecurity(prePostEnabled = true)</span><br><span class="line">public class TokenWebSecurityConfig extends WebSecurityConfigurerAdapter &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 自定义查询数据库类</span><br><span class="line">     */</span><br><span class="line">    private UserDetailsService userDetailsService;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Token管理器</span><br><span class="line">     */</span><br><span class="line">    private TokenManager tokenManager;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 密码加密方式</span><br><span class="line">     */</span><br><span class="line">    private DefaultPasswordEncoder defaultPasswordEncoder;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * redis操作</span><br><span class="line">     */</span><br><span class="line">    private RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 自定义查询数据库</span><br><span class="line">     */</span><br><span class="line">    @Autowired</span><br><span class="line">    public TokenWebSecurityConfig(UserDetailsService userDetailsService,</span><br><span class="line">                                  DefaultPasswordEncoder defaultPasswordEncoder,</span><br><span class="line">                                  TokenManager tokenManager,</span><br><span class="line">                                  RedisTemplate redisTemplate) &#123;</span><br><span class="line">        this.userDetailsService = userDetailsService;</span><br><span class="line">        this.defaultPasswordEncoder = defaultPasswordEncoder;</span><br><span class="line">        this.tokenManager = tokenManager;</span><br><span class="line">        this.redisTemplate = redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 配置设置</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    protected void configure(HttpSecurity http) throws Exception &#123;</span><br><span class="line">        http.exceptionHandling()</span><br><span class="line">                .authenticationEntryPoint(new UnauthorizedEntryPoint())</span><br><span class="line">                .and().csrf().disable()</span><br><span class="line">                .authorizeRequests()</span><br><span class="line">                .anyRequest().authenticated()</span><br><span class="line">                .and().logout().logoutUrl(&quot;/service_auth/admin/index/logout&quot;)</span><br><span class="line">                .addLogoutHandler(new TokenLogoutHandler(tokenManager, redisTemplate)).and()</span><br><span class="line">                .addFilter(new TokenLoginFilter(authenticationManager(), tokenManager, redisTemplate))</span><br><span class="line">                .addFilter(new TokenAuthenticationFilter(authenticationManager(), tokenManager, redisTemplate)).httpBasic();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 密码处理</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public void configure(AuthenticationManagerBuilder auth) throws Exception &#123;</span><br><span class="line">        auth.userDetailsService(userDetailsService).passwordEncoder(defaultPasswordEncoder);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 配置哪些请求不拦截</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public void configure(WebSecurity web) &#123;</span><br><span class="line">        web.ignoring().antMatchers(</span><br><span class="line">                &quot;/api/**&quot;,</span><br><span class="line">                &quot;/swagger-resources/**&quot;,</span><br><span class="line">                &quot;/webjars/**&quot;,</span><br><span class="line">                &quot;/v2/**&quot;,</span><br><span class="line">                &quot;/swagger-ui.html/**&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="entity"><a href="#entity" class="headerlink" title="entity"></a>entity</h3><p>SecurityUser</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @author BNTang</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @project video_parent</span><br><span class="line"> * @description 安全认证用户详情信息</span><br><span class="line"> * @since Created in 2021/5/2 002 12:07</span><br><span class="line"> **/</span><br><span class="line">@Data</span><br><span class="line">@Slf4j</span><br><span class="line">public class SecurityUser implements UserDetails &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 当前登录用户</span><br><span class="line">     */</span><br><span class="line">    private transient User currentUserInfo;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 当前权限</span><br><span class="line">     */</span><br><span class="line">    private List&lt;String&gt; permissionValueList;</span><br><span class="line"></span><br><span class="line">    public SecurityUser(User user) &#123;</span><br><span class="line">        if (user != null) &#123;</span><br><span class="line">            this.currentUserInfo = user;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Collection&lt;? extends GrantedAuthority&gt; getAuthorities() &#123;</span><br><span class="line">        Collection&lt;GrantedAuthority&gt; authorities = new ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        permissionValueList.forEach(permissionValue -&gt; &#123;</span><br><span class="line">            if (StringUtils.isEmpty(permissionValue)) &#123;</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">            SimpleGrantedAuthority authority = new SimpleGrantedAuthority(permissionValue);</span><br><span class="line">            authorities.add(authority);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        return authorities;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String getPassword() &#123;</span><br><span class="line">        return currentUserInfo.getPassword();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String getUsername() &#123;</span><br><span class="line">        return currentUserInfo.getUsername();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean isAccountNonExpired() &#123;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean isAccountNonLocked() &#123;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean isCredentialsNonExpired() &#123;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean isEnabled() &#123;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>User</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @author BNTang</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @project video_parent</span><br><span class="line"> * @description 用户实体类</span><br><span class="line"> * @since Created in 2021/5/2 002 12:10</span><br><span class="line"> **/</span><br><span class="line">@Data</span><br><span class="line">@ApiModel(description = &quot;用户实体类&quot;)</span><br><span class="line">public class User implements Serializable &#123;</span><br><span class="line"></span><br><span class="line">    private static final long serialVersionUID = 1L;</span><br><span class="line"></span><br><span class="line">    @ApiModelProperty(value = &quot;用户名&quot;)</span><br><span class="line">    private String username;</span><br><span class="line"></span><br><span class="line">    @ApiModelProperty(value = &quot;密码&quot;)</span><br><span class="line">    private String password;</span><br><span class="line"></span><br><span class="line">    @ApiModelProperty(value = &quot;昵称&quot;)</span><br><span class="line">    private String nickName;</span><br><span class="line"></span><br><span class="line">    @ApiModelProperty(value = &quot;用户头像&quot;)</span><br><span class="line">    private String salt;</span><br><span class="line"></span><br><span class="line">    @ApiModelProperty(value = &quot;用户签名&quot;)</span><br><span class="line">    private String token;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h3><p>TokenAuthenticationFilter</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @author BNTang</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @project video_parent</span><br><span class="line"> * @description</span><br><span class="line"> * @since Created in 2021/5/2 002 12:11</span><br><span class="line"> **/</span><br><span class="line">public class TokenAuthenticationFilter extends BasicAuthenticationFilter &#123;</span><br><span class="line">    private final TokenManager tokenManager;</span><br><span class="line">    private final RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    public TokenAuthenticationFilter(AuthenticationManager authManager, TokenManager tokenManager,</span><br><span class="line">                                     RedisTemplate redisTemplate) &#123;</span><br><span class="line">        super(authManager);</span><br><span class="line">        this.tokenManager = tokenManager;</span><br><span class="line">        this.redisTemplate = redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void doFilterInternal(HttpServletRequest req, HttpServletResponse res, FilterChain chain)</span><br><span class="line">            throws IOException, ServletException &#123;</span><br><span class="line">        logger.info(&quot;RequestURI = &quot; + req.getRequestURI());</span><br><span class="line">        if (!req.getRequestURI().contains(&quot;admin&quot;)) &#123;</span><br><span class="line">            chain.doFilter(req, res);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        UsernamePasswordAuthenticationToken authentication = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            authentication = getAuthentication(req);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            ResponseUtil.out(res, ResponseResult.error());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (authentication != null) &#123;</span><br><span class="line">            SecurityContextHolder.getContext().setAuthentication(authentication);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            ResponseUtil.out(res, ResponseResult.error());</span><br><span class="line">        &#125;</span><br><span class="line">        chain.doFilter(req, res);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private UsernamePasswordAuthenticationToken getAuthentication(HttpServletRequest request) &#123;</span><br><span class="line">        // token置于header里</span><br><span class="line">        String token = request.getHeader(&quot;X-Token&quot;);</span><br><span class="line">        if (null != token &amp;&amp; !&quot;&quot;.equals(token.trim())) &#123;</span><br><span class="line">            String userName = tokenManager.getUserFromToken(token);</span><br><span class="line"></span><br><span class="line">            List&lt;String&gt; permissionValueList = (List&lt;String&gt;) redisTemplate.opsForValue().get(userName);</span><br><span class="line">            Collection&lt;GrantedAuthority&gt; authorities = new ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">            if (!CollectionUtils.isEmpty(permissionValueList)) &#123;</span><br><span class="line">                authorities = permissionValueList.stream().map(permissionValue -&gt; &#123;</span><br><span class="line">                    if (StringUtils.isEmpty(permissionValue)) &#123;</span><br><span class="line">                        return null;</span><br><span class="line">                    &#125;</span><br><span class="line">                    return new SimpleGrantedAuthority(permissionValue);</span><br><span class="line">                &#125;).collect(Collectors.toList());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if (!StringUtils.isEmpty(userName)) &#123;</span><br><span class="line">                return new UsernamePasswordAuthenticationToken(userName, token, authorities);</span><br><span class="line">            &#125;</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TokenLoginFilter</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @author BNTang</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @project video_parent</span><br><span class="line"> * @description 登录过滤器，继承UsernamePasswordAuthenticationFilter，对用户名密码进行登录校验</span><br><span class="line"> * @since Created in 2021/5/2 002 12:12</span><br><span class="line"> **/</span><br><span class="line">public class TokenLoginFilter extends UsernamePasswordAuthenticationFilter &#123;</span><br><span class="line"></span><br><span class="line">    private final AuthenticationManager authenticationManager;</span><br><span class="line">    private final TokenManager tokenManager;</span><br><span class="line">    private final RedisTemplate&lt;String, java.util.List&lt;String&gt;&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    public TokenLoginFilter(AuthenticationManager authenticationManager, TokenManager tokenManager,</span><br><span class="line">                            RedisTemplate&lt;String, java.util.List&lt;String&gt;&gt; redisTemplate) &#123;</span><br><span class="line">        this.authenticationManager = authenticationManager;</span><br><span class="line">        this.tokenManager = tokenManager;</span><br><span class="line">        this.redisTemplate = redisTemplate;</span><br><span class="line">        this.setPostOnly(false);</span><br><span class="line">        this.setRequiresAuthenticationRequestMatcher(new AntPathRequestMatcher(</span><br><span class="line">                &quot;/service_auth/admin/index/login&quot;,</span><br><span class="line">                &quot;POST&quot;));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Authentication attemptAuthentication(HttpServletRequest req, HttpServletResponse res)</span><br><span class="line">            throws AuthenticationException &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            User user = new ObjectMapper().readValue(req.getInputStream(), User.class);</span><br><span class="line">            return authenticationManager.authenticate(new UsernamePasswordAuthenticationToken(user.getUsername(),</span><br><span class="line">                    user.getPassword(), new ArrayList&lt;&gt;()));</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            throw new RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 登录成功</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    protected void successfulAuthentication(HttpServletRequest req, HttpServletResponse res, FilterChain chain,</span><br><span class="line">                                            Authentication auth) &#123;</span><br><span class="line">        SecurityUser user = (SecurityUser) auth.getPrincipal();</span><br><span class="line">        String token = tokenManager.createToken(user.getCurrentUserInfo().getUsername());</span><br><span class="line">        redisTemplate.opsForValue().set(user.getCurrentUserInfo().getUsername(), user.getPermissionValueList());</span><br><span class="line">        ResponseUtil.out(res, ResponseResult.ok().data(&quot;token&quot;, token));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 登录失败</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    protected void unsuccessfulAuthentication(HttpServletRequest request, HttpServletResponse response,</span><br><span class="line">                                              AuthenticationException e) &#123;</span><br><span class="line">        ResponseUtil.out(response, ResponseResult.error());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="security"><a href="#security" class="headerlink" title="security"></a>security</h3><blockquote>
<p>DefaultPasswordEncoder</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @author BNTang</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @project video_parent</span><br><span class="line"> * @description 密码的处理方法类型</span><br><span class="line"> * @since Created in 2021/5/2 002 12:13</span><br><span class="line"> **/</span><br><span class="line">@Component</span><br><span class="line">public class DefaultPasswordEncoder implements PasswordEncoder &#123;</span><br><span class="line"></span><br><span class="line">    public DefaultPasswordEncoder() &#123;</span><br><span class="line">        this(-1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public DefaultPasswordEncoder(int strength) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String encode(CharSequence rawPassword) &#123;</span><br><span class="line">        return Md5.encrypt(rawPassword.toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean matches(CharSequence rawPassword, String encodedPassword) &#123;</span><br><span class="line">        return encodedPassword.equals(Md5.encrypt(rawPassword.toString()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TokenLogoutHandler</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @author BNTang</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @project video_parent</span><br><span class="line"> * @description 登出业务逻辑类</span><br><span class="line"> * @since Created in 2021/5/2 002 12:13</span><br><span class="line"> **/</span><br><span class="line">public class TokenLogoutHandler implements LogoutHandler &#123;</span><br><span class="line"></span><br><span class="line">    private TokenManager tokenManager;</span><br><span class="line">    private RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    public TokenLogoutHandler(TokenManager tokenManager, RedisTemplate redisTemplate) &#123;</span><br><span class="line">        this.tokenManager = tokenManager;</span><br><span class="line">        this.redisTemplate = redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void logout(HttpServletRequest request, HttpServletResponse response, Authentication authentication) &#123;</span><br><span class="line">        String token = request.getHeader(&quot;X-Token&quot;);</span><br><span class="line">        if (token != null) &#123;</span><br><span class="line">            // 清空当前用户缓存中的权限数据</span><br><span class="line">            String userName = tokenManager.getUserFromToken(token);</span><br><span class="line">            redisTemplate.delete(userName);</span><br><span class="line">        &#125;</span><br><span class="line">        ResponseUtil.out(response, ResponseResult.ok());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TokenManager</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @author BNTang</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @project video_parent</span><br><span class="line"> * @description token管理</span><br><span class="line"> * @since Created in 2021/5/2 002 12:14</span><br><span class="line"> **/</span><br><span class="line">@Component</span><br><span class="line">public class TokenManager &#123;</span><br><span class="line"></span><br><span class="line">    private final String TOKEN_SIGNKEY = &quot;BNTang&quot;;</span><br><span class="line"></span><br><span class="line">    public String createToken(String username) &#123;</span><br><span class="line">        // token 过期时间</span><br><span class="line">        long tokenExpiration = 24 * 60 * 60 * 1000;</span><br><span class="line">        return Jwts.builder().setSubject(username)</span><br><span class="line">                .setExpiration(new Date(System.currentTimeMillis() + tokenExpiration))</span><br><span class="line">                .signWith(SignatureAlgorithm.HS512, TOKEN_SIGNKEY).compressWith(CompressionCodecs.GZIP).compact();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getUserFromToken(String token) &#123;</span><br><span class="line">        return Jwts.parser()</span><br><span class="line">                .setSigningKey(TOKEN_SIGNKEY)</span><br><span class="line">                .parseClaimsJws(token)</span><br><span class="line">                .getBody()</span><br><span class="line">                .getSubject();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UnauthorizedEntryPoint</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @author BNTang</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @project video_parent</span><br><span class="line"> * @description 未授权的统一处理方式</span><br><span class="line"> * @since Created in 2021/5/2 002 12:14</span><br><span class="line"> **/</span><br><span class="line">public class UnauthorizedEntryPoint implements AuthenticationEntryPoint &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void commence(HttpServletRequest request, HttpServletResponse response,</span><br><span class="line">                         AuthenticationException authException) &#123;</span><br><span class="line">        ResponseUtil.out(response, ResponseResult.error());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="common-utils-模块"><a href="#common-utils-模块" class="headerlink" title="common_utils 模块"></a>common_utils 模块</h3><h4 id="utils"><a href="#utils" class="headerlink" title="utils"></a>utils</h4><p>ResponseUtil</p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@project</span> video_parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> Created in 2021/5/2 002 13:06</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResponseUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">out</span><span class="params">(HttpServletResponse response, ResponseResult r)</span> &#123;</span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        response.setStatus(HttpStatus.OK.value());</span><br><span class="line">        response.setContentType(MediaType.APPLICATION_JSON_UTF8_VALUE);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            mapper.writeValue(response.getWriter(), r);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="44-权限控制-Token与JWT"><a href="#44-权限控制-Token与JWT" class="headerlink" title="44-权限控制-Token与JWT"></a>44-权限控制-Token与JWT</h2><h3 id="登录模型"><a href="#登录模型" class="headerlink" title="登录模型"></a>登录模型</h3><h4 id="单一服务器模式"><a href="#单一服务器模式" class="headerlink" title="单一服务器模式"></a>单一服务器模式</h4><p>单一服务器，用户认证，用户信息存储到 session 当中</p>
<h4 id="SSO-single-sign-on-模式"><a href="#SSO-single-sign-on-模式" class="headerlink" title="SSO(single sign on) 模式"></a>SSO(single sign on) 模式</h4><p>单点登录(Single Sign On，SSO)就是通过用户的一次性鉴别登录</p>
<p>当用户在身份认证服务器上登录一次以后，即可获得访问单点登录系统中其他关联系统和应用软件的权限，同时这种实现是不需要管理员对用户的登录状态或其他信息进行修改的，这意味着在多个应用系统中，用户只需一次登录就可以访问所有相互信任的应用系统</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210504180727496-832298179.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210504180727496-832298179.png" alt="img"></a></p>
<p>优点，用户身份信息独立管理，更好的分布式管理，可以自己扩展安全策略</p>
<p>缺点，认证服务器访问压力较大</p>
<h4 id="Token-模式"><a href="#Token-模式" class="headerlink" title="Token 模式"></a>Token 模式</h4><p>Token 是一种无状态、跨服务器、高性能的验证模式</p>
<p>特点，无状态、可扩展，支持移动设备，跨程序调用，安全</p>
<p><strong>原理</strong></p>
<p>基于 Token 的身份验证是无状态的，我们不用将用户信息存在服务器或 Session 中, 用户通过用户名和密码发送请求, 程序验证, 程序返回一个签名的 token 给客户端, 客户端储存 token, 并且每次请求都会附带它, 服务端验证 token 并返回数据</p>
<p><strong>原理图</strong></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210504181019158-416735389.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210504181019158-416735389.png" alt="img"></a></p>
<p>优点，无状态：token 无状态，session 是有状态的，基于标准化，你的 API 可以采用标准化的 JSON Web Token(JWT)</p>
<p>缺点，占用带宽，无法在服务器端销毁</p>
<h3 id="验证方式"><a href="#验证方式" class="headerlink" title="验证方式"></a>验证方式</h3><h4 id="传统用户身份验证"><a href="#传统用户身份验证" class="headerlink" title="传统用户身份验证"></a>传统用户身份验证</h4><p>特点，用户向服务器发送用户名和密码，服务器验证相关数据后（如用户角色，登录时间等）将保存在当前会话中，用户的每个后续请求都将通过在 Cookie 中取出 session_id 传给服务器，服务器收到 session_id 并对比之前保存的数据，确认用户的身份，服务器向用户返回 session_id，session 信息都会写入到用户的 Cookie</p>
<p>缺点，没有分布式架构，无法支持横向扩展</p>
<h4 id="session-共享"><a href="#session-共享" class="headerlink" title="session 共享"></a>session 共享</h4><p>将透明令牌存入 cookie，将用户身份信息存入 redis</p>
<h4 id="JWT-令牌"><a href="#JWT-令牌" class="headerlink" title="JWT 令牌"></a>JWT 令牌</h4><p>在微服务之间使用 JWT 共享信息</p>
<h3 id="JWT-令牌-1"><a href="#JWT-令牌-1" class="headerlink" title="JWT 令牌"></a>JWT 令牌</h3><h4 id="什么是-JWT"><a href="#什么是-JWT" class="headerlink" title="什么是 JWT"></a>什么是 JWT</h4><p>在微服务之间使用 JWT 共享信息</p>
<p>JSON Web Token（JWT）是一个开放的行业标准（RFC 7519）它定义了一种简介的、自包含的协议格式，用于在通信双方传递 JSON 对象, 传递的信息经过数字签名可以被验证和信任, JWT 可以使用 HMAC 算法或使用 RSA 的公钥 &#x2F; 私钥对来签名，防止被篡改, 对普通的信息进行加密处理后, 转成 JSON, 转过之后的数据称它是 token</p>
<h4 id="JWT-能做什么"><a href="#JWT-能做什么" class="headerlink" title="JWT 能做什么"></a>JWT 能做什么</h4><p>授权, 这是使用 JWT 的最常见方案。一旦用户登录，每个后续请求将包括 JWT，从而允许用户访问该令牌允许的路由，服务和资源, 登录成功之后, 生成一个 JWT 当中包含用户的信息</p>
<p>信息交换, JSON Web Token 是在各方之间安全地传输信息的好方法</p>
<h4 id="session-认证与-JWT-认证的区别"><a href="#session-认证与-JWT-认证的区别" class="headerlink" title="session 认证与 JWT 认证的区别"></a>session 认证与 JWT 认证的区别</h4><p>session: 基于 session 和基于 jwt 的方式的主要区别就是用户的状态保存的位置，session 是保存在服务端的，下一次再去从 session 当中取数据</p>
<p>jwt: 用户输入用户名与密码, 校验(从数据库当中查看有没有对应的数据)如果有对应的数据, 会把用户取出来, 把取出的用户数据, 转成 JWT，以 token 令牌的形式传给前端, 前端拿到数据之后, 会给存储到 cookie，以后每一次请求都要携带 token，服务器就会获取 token 之后, 再进行 jwt 解析, 读取用户数据, 如果没有数据, 就代表没有登录, 而 jwt 是保存在客户端的</p>
<h4 id="JWT-令牌的优缺点"><a href="#JWT-令牌的优缺点" class="headerlink" title="JWT 令牌的优缺点"></a>JWT 令牌的优缺点</h4><p>优点：jwt 基于 JSON，非常方便解析, 可以在令牌中自定义丰富的内容，易扩展, 通过 <code>非对称</code> 加密算法及数字签名技术，JWT 防止篡改，安全性高, 资源服务使用 JWT 可不依赖认证服务即可完成授权</p>
<p>缺点：JWT 令牌较长，占存储空间比较大</p>
<h4 id="令牌结构"><a href="#令牌结构" class="headerlink" title="令牌结构"></a>令牌结构</h4><p>JWT 令牌由三部分组成，每部分中间使用点（<code>.</code>）分隔, 比如：xxxxx<code>.</code>yyyyy<code>.</code>zzzzz</p>
<h3 id="三部分"><a href="#三部分" class="headerlink" title="三部分"></a>三部分</h3><h4 id="Header"><a href="#Header" class="headerlink" title="Header"></a>Header</h4><p>JWT 头部分是一个描述 JWT 元数据的 JSON 对象, 头部包括令牌的类型（即 JWT）及使用的哈希算法（如 HMAC SHA256 或 RSA）</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;alg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;HS256&quot;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;typ&quot;</span><span class="punctuation">:</span> <span class="string">&quot;JWT&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="Payload"><a href="#Payload" class="headerlink" title="Payload"></a>Payload</h4><p>第二部分是负载，内容也是一个 JSON 对象, JWT 指定七个默认字段供选择</p>
<ul>
<li>iss：发行人</li>
<li>exp：到期时间</li>
<li>sub：主题</li>
<li>aud：用户</li>
<li>nbf：在此之前不可用</li>
<li>iat：发布时间</li>
<li>jti：JWT ID 用于标识该 JWT</li>
</ul>
<p>除以上默认字段外，我们还可以自定义私有字段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	&quot;sub&quot;: &quot;1234567890&quot;,</span><br><span class="line">	&quot;name&quot;: &quot;456&quot;,</span><br><span class="line">	&quot;admin&quot;: true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此部分不建议存放敏感信息，因为此部分可以解码还原原始内容, 最后将第二部分负载使用 Base64Url 编码，得到一个字符串就是 JWT 令牌的第二部分</p>
<h4 id="Signature"><a href="#Signature" class="headerlink" title="Signature"></a>Signature</h4><p>第三部分签名哈希部分是对上面两部分数据签名，通过指定的算法生成哈希，以确保数据不会被篡改, 首先，需要指定一个密码（secret）该密码仅仅为保存在服务器中，并且不能向用户公开, 然后，使用标头中指定的签名算法（默认情况下为 HMAC SHA256）根据以下公式生成签名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HMACSHA256(</span><br><span class="line">	base64UrlEncode(header) + &quot;.&quot; +base64UrlEncode(payload),secret</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210504184003834-960750464.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210504184003834-960750464.png" alt="img"></a></p>
<h3 id="在工具类当中集成-JWT-令牌"><a href="#在工具类当中集成-JWT-令牌" class="headerlink" title="在工具类当中集成 JWT 令牌"></a>在工具类当中集成 JWT 令牌</h3><p>在 common_utils 微服务当中添加 jwt 依赖如下，你直接替换一下全部的内容吧 common_utils pom.xml 依赖如下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- JWT--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--工具类包--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang3<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.xml.bind<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jaxb-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.sun.xml.bind<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jaxb-impl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.sun.xml.bind<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jaxb-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.activation<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activation<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>创建 JwtUtils</p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@project</span> video_parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> jwt工具类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> Created in 2021/5/2 002 16:15</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtUtils</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 过期时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">EXPIRE</span> <span class="operator">=</span> <span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 密钥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">APP_SECRET</span> <span class="operator">=</span> <span class="string">&quot;BNTang&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id和昵称获取token</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getJwtToken</span><span class="params">(String id, String nickname)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Jwts.builder()</span><br><span class="line">                .setHeaderParam(<span class="string">&quot;typ&quot;</span>, <span class="string">&quot;JWT&quot;</span>)</span><br><span class="line">                .setHeaderParam(<span class="string">&quot;alg&quot;</span>, <span class="string">&quot;HS256&quot;</span>)</span><br><span class="line">                .setSubject(<span class="string">&quot;fm-user&quot;</span>)</span><br><span class="line">                .setIssuedAt(<span class="keyword">new</span> <span class="title class_">Date</span>())</span><br><span class="line">                .setExpiration(<span class="keyword">new</span> <span class="title class_">Date</span>(System.currentTimeMillis() + EXPIRE))</span><br><span class="line">                .claim(<span class="string">&quot;id&quot;</span>, id)</span><br><span class="line">                .claim(<span class="string">&quot;nickname&quot;</span>, nickname)</span><br><span class="line">                .signWith(SignatureAlgorithm.HS256, APP_SECRET)</span><br><span class="line">                .compact();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断token是否存在与有效</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">checkToken</span><span class="params">(String jwtToken)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(jwtToken)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Jwts.parser().setSigningKey(APP_SECRET).parseClaimsJws(jwtToken);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断token是否存在与有效</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">checkToken</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">jwtToken</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (StringUtils.isEmpty(jwtToken)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            Jwts.parser().setSigningKey(APP_SECRET).parseClaimsJws(jwtToken);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据token获取id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getUserIdByJwtToken</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">jwtToken</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(jwtToken)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Jws&lt;Claims&gt; claimsJws = Jwts.parser().setSigningKey(APP_SECRET).parseClaimsJws(jwtToken);</span><br><span class="line">        <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> claimsJws.getBody();</span><br><span class="line">        <span class="keyword">return</span> (String) claims.get(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="45-权限控制-auth工程当中添加用户验证"><a href="#45-权限控制-auth工程当中添加用户验证" class="headerlink" title="45-权限控制-auth工程当中添加用户验证"></a>45-权限控制-auth工程当中添加用户验证</h2><h3 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h3><p>创建 IndexService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@project</span> video_parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> Created in 2021/5/2 002 21:03</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IndexService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据token获取用户信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name 用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 用户信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Map&lt;String, Object&gt; <span class="title function_">getUserInfo</span><span class="params">(String name)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取当前登陆用户的菜单</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name 用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 用户菜单信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;JSONObject&gt; <span class="title function_">getMenu</span><span class="params">(String name)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改 MenuService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据用户ID查询用户权限</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id 用户ID</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 用户权限</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">List&lt;String&gt; <span class="title function_">selectPermissionValueByUserId</span><span class="params">(String id)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据用户id返回前端的菜单</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id 用户id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 前端的菜单</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">List&lt;JSONObject&gt; <span class="title function_">selectPermissionByUserId</span><span class="params">(String id)</span>;</span><br></pre></td></tr></table></figure>

<p>修改 RoleService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据用户id查询角色</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id 用户ID</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 用户对应的角色</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">List&lt;Role&gt; <span class="title function_">selectRoleByUserId</span><span class="params">(String id)</span>;</span><br></pre></td></tr></table></figure>

<p>修改 UserService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据用户名从数据库中取出用户信息</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> username 用户名</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 用户信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">User <span class="title function_">selectByUserName</span><span class="params">(String username)</span>;</span><br></pre></td></tr></table></figure>

<h3 id="Impl"><a href="#Impl" class="headerlink" title="Impl"></a>Impl</h3><p>创建 IndexServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@project</span> video_parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> Created in 2021/5/2 002 21:09</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IndexServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IndexService</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RoleService roleService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> MenuService menuService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, List&lt;String&gt;&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据用户名获取用户登录信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">getUserInfo</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; result = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">4</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.selectByUserName(username);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (ObjectUtils.isEmpty(user)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BnTangException</span>(<span class="number">200001</span>, <span class="string">&quot;没有该用户&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据用户id获取角色</span></span><br><span class="line">        List&lt;Role&gt; roleList = roleService.selectRoleByUserId(user.getId());</span><br><span class="line">        List&lt;String&gt; roleNameList = roleList.stream().map(Role::getRoleName).collect(Collectors.toList());</span><br><span class="line">        <span class="keyword">if</span> (roleNameList.size() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 前端框架必须返回一个角色，否则报错，如果没有角色，返回一个空角色</span></span><br><span class="line">            roleNameList.add(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据用户id获取操作权限值</span></span><br><span class="line">        List&lt;String&gt; permissionValueList = menuService.selectPermissionValueByUserId(user.getId());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 把权限缓存到redis当中</span></span><br><span class="line">        redisTemplate.opsForValue().set(username, permissionValueList);</span><br><span class="line"></span><br><span class="line">        result.put(<span class="string">&quot;name&quot;</span>, user.getUsername());</span><br><span class="line">        result.put(<span class="string">&quot;avatar&quot;</span>, user.getSalt());</span><br><span class="line">        result.put(<span class="string">&quot;roles&quot;</span>, roleNameList);</span><br><span class="line">        result.put(<span class="string">&quot;permissionValueList&quot;</span>, permissionValueList);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据用户名获取动态菜单</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;JSONObject&gt; <span class="title function_">getMenu</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="comment">// 根据用户id获取用户菜单权限</span></span><br><span class="line">        <span class="keyword">return</span> menuService.selectPermissionByUserId(userService.selectByUserName(username).getId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改 MenuServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> UserService userService;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;String&gt; <span class="title function_">selectPermissionValueByUserId</span><span class="params">(String id)</span> &#123;</span><br><span class="line">    List&lt;String&gt; selectPermissionValueList;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.isSysAdmin(id)) &#123;</span><br><span class="line">        <span class="comment">// 如果是系统管理员，获取所有权限</span></span><br><span class="line">        selectPermissionValueList = baseMapper.selectAllMenuValue();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 否则就不是系统管理员，根据用户查询菜单权限</span></span><br><span class="line">        selectPermissionValueList = baseMapper.selectMenuValueByUserId(id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> selectPermissionValueList;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;JSONObject&gt; <span class="title function_">selectPermissionByUserId</span><span class="params">(String id)</span> &#123;</span><br><span class="line">    List&lt;Menu&gt; selectMenuList;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.isSysAdmin(id)) &#123;</span><br><span class="line">        <span class="comment">// 如果是超级管理员，获取所有菜单</span></span><br><span class="line">        selectMenuList = baseMapper.selectList(<span class="literal">null</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        selectMenuList = baseMapper.selectMenuByUserId(id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 1.构建树形菜单</span></span><br><span class="line">    List&lt;Menu&gt; menuList = buildTreeMenu(selectMenuList);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.返回给前端json数据</span></span><br><span class="line">    <span class="keyword">return</span> buildMenuWebList(menuList);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> List&lt;JSONObject&gt; <span class="title function_">buildMenuWebList</span><span class="params">(List&lt;Menu&gt; menuList)</span> &#123;</span><br><span class="line">    List&lt;JSONObject&gt; menus = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (menuList.size() == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// 左侧一级菜单</span></span><br><span class="line">        menuList.get(<span class="number">0</span>).getChildren().forEach(oneMenu -&gt; &#123;</span><br><span class="line">            <span class="type">JSONObject</span> <span class="variable">oneMenuObj</span> <span class="operator">=</span> <span class="built_in">this</span>.generateJsonObj(oneMenu, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">            List&lt;JSONObject&gt; children = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            oneMenu.getChildren().forEach(twoMenu -&gt; &#123;</span><br><span class="line">                <span class="type">JSONObject</span> <span class="variable">twoMenuObj</span> <span class="operator">=</span> <span class="built_in">this</span>.generateJsonObj(twoMenu, <span class="literal">false</span>);</span><br><span class="line">                children.add(twoMenuObj);</span><br><span class="line"></span><br><span class="line">                twoMenu.getChildren().forEach(three -&gt; &#123;</span><br><span class="line">                    <span class="keyword">if</span> (StringUtils.isEmpty(three.getPath())) &#123;</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="type">JSONObject</span> <span class="variable">threeMenu</span> <span class="operator">=</span> <span class="built_in">this</span>.generateJsonObj(three, <span class="literal">true</span>);</span><br><span class="line">                    children.add(threeMenu);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">            oneMenuObj.put(<span class="string">&quot;children&quot;</span>, children);</span><br><span class="line">            menus.add(oneMenuObj);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> menus;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 生成菜单信息JSON对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> JSONObject <span class="title function_">generateJsonObj</span><span class="params">(Menu menu, Boolean whetherDisplay)</span> &#123;</span><br><span class="line">    <span class="type">JSONObject</span> <span class="variable">jsonObj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">    jsonObj.put(<span class="string">&quot;path&quot;</span>, menu.getPath());</span><br><span class="line">    jsonObj.put(<span class="string">&quot;component&quot;</span>, menu.getComponent());</span><br><span class="line">    jsonObj.put(<span class="string">&quot;hidden&quot;</span>, whetherDisplay);</span><br><span class="line"></span><br><span class="line">    <span class="type">JSONObject</span> <span class="variable">oneMeta</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">    oneMeta.put(<span class="string">&quot;title&quot;</span>, menu.getName());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(menu.getIcon())) &#123;</span><br><span class="line">        oneMeta.put(<span class="string">&quot;icon&quot;</span>, menu.getIcon());</span><br><span class="line">    &#125;</span><br><span class="line">    jsonObj.put(<span class="string">&quot;meta&quot;</span>, oneMeta);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> jsonObj;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 判断用户是否是系统管理员</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isSysAdmin</span><span class="params">(String userId)</span> &#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getById(userId);</span><br><span class="line">    <span class="keyword">return</span> !ObjectUtils.isEmpty(user) &amp;&amp; <span class="string">&quot;admin&quot;</span>.equals(user.getUsername());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改 RoleServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Role&gt; <span class="title function_">selectRoleByUserId</span><span class="params">(String id)</span> &#123;</span><br><span class="line">    <span class="comment">// 根据用户id查询拥有的角色id</span></span><br><span class="line">    List&lt;UserRole&gt; userRoleList = userRoleService.list(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;UserRole&gt;()</span><br><span class="line">            .eq(<span class="string">&quot;user_id&quot;</span>, id)</span><br><span class="line">            .select(<span class="string">&quot;role_id&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取所有角色id</span></span><br><span class="line">    List&lt;String&gt; roleIdList = userRoleList.stream().map(UserRole::getRoleId).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据角色id查询所有的角色信息</span></span><br><span class="line">    List&lt;Role&gt; roleList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (roleIdList.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        roleList = baseMapper.selectBatchIds(roleIdList);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> roleList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建 UserDetailsServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@project</span> video_parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 用户验证业务</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> Created in 2021/5/2 002 16:42</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDetailsServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDetailsService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> MenuService menuService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * 根据账号获取用户信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException &#123;</span><br><span class="line">        <span class="comment">// 从数据库中取出用户信息</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.selectByUserName(username);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 判断用户是否存在</span></span><br><span class="line">        <span class="keyword">if</span> (ObjectUtils.isEmpty(user)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UsernameNotFoundException</span>(<span class="string">&quot;用户不存在！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 返回UserDetails实现类</span></span><br><span class="line">        top.it6666.common_security.entity.<span class="type">User</span> <span class="variable">curUser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">top</span>.it6666.common_security.entity.User();</span><br><span class="line">        BeanUtils.copyProperties(user, curUser);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 查询用户权限</span></span><br><span class="line">        List&lt;String&gt; authorities = menuService.selectPermissionValueByUserId(user.getId());</span><br><span class="line">        <span class="type">SecurityUser</span> <span class="variable">securityUser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecurityUser</span>(curUser);</span><br><span class="line">        securityUser.setPermissionValueList(authorities);</span><br><span class="line">        <span class="keyword">return</span> securityUser;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改 UserServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">selectByUserName</span><span class="params">(String username)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> baseMapper.selectOne(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;User&gt;().eq(<span class="string">&quot;username&quot;</span>, username));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h3><p>创建 IndexController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@project</span> video_parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> Created in 2021/5/2 002 21:02</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;工作人员-用户组&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/service_auth/admin/index&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IndexController</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> IndexService indexService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据token获取用户信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;根据token获取用户信息&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;info&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">info</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 获取当前登录用户用户名</span></span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok().data(indexService.getUserInfo(SecurityContextHolder.getContext().getAuthentication().getName()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取当前登陆用户的菜单</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;获取当前登陆用户的菜单&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;menu&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">getMenu</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 获取当前登录用户用户名</span></span><br><span class="line">        List&lt;JSONObject&gt; menuList = indexService.getMenu(SecurityContextHolder.getContext().getAuthentication().getName());</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok().data(<span class="string">&quot;menuList&quot;</span>, menuList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改 application.yml 加入 Redis 的相关配置</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">redis:</span></span><br><span class="line">  <span class="attr">host:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">  <span class="attr">database:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">timeout:</span> <span class="number">1800000</span></span><br><span class="line">  <span class="attr">lettuce:</span></span><br><span class="line">    <span class="attr">pool:</span></span><br><span class="line">      <span class="attr">max-active:</span> <span class="number">20</span></span><br><span class="line">      <span class="attr">max-wait:</span> <span class="number">1</span></span><br><span class="line">      <span class="comment"># 最大阻塞等待时间</span></span><br><span class="line">      <span class="attr">max-idle:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">min-idle:</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>修改 service_auth 的 pom.xml 加入 security 安全认证</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;top.it6666&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;common_security&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Mapper"><a href="#Mapper" class="headerlink" title="Mapper"></a>Mapper</h3><p>修改 MenuMapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 菜单权限 Mapper 接口</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2021-04-21</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MenuMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Menu&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询所有的菜单</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 菜单信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;String&gt; <span class="title function_">selectAllMenuValue</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据用户ID查询用户菜单权限</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id 用户ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 菜单权限</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;String&gt; <span class="title function_">selectMenuValueByUserId</span><span class="params">(String id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据用户id获取菜单权限</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id 用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 菜单权限信息数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;Menu&gt; <span class="title function_">selectMenuByUserId</span><span class="params">(String id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改 MenuMapper.xml</p>
<p>xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;top.it6666.service_auth.mapper.MenuMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAllMenuValue&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.String&quot;</span>&gt;</span></span><br><span class="line">        SELECT permission_value</span><br><span class="line">        FROM auth_menu</span><br><span class="line">        WHERE type = 2</span><br><span class="line">          AND is_deleted = 0</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectMenuValueByUserId&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.String&quot;</span>&gt;</span></span><br><span class="line">        SELECT p.permission_value</span><br><span class="line">        FROM auth_user_role ur</span><br><span class="line">                     INNER JOIN auth_role_menu rp ON rp.role_id = ur.role_id</span><br><span class="line">                     INNER JOIN auth_menu p ON p.id = rp.permission_id</span><br><span class="line">        WHERE ur.user_id = #&#123;userId&#125;</span><br><span class="line">          AND p.type = 2</span><br><span class="line">          AND ur.is_deleted = 0</span><br><span class="line">          AND rp.is_deleted = 0</span><br><span class="line">          AND p.is_deleted = 0</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectMenuByUserId&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;top.it6666.service_auth.entity.Menu&quot;</span>&gt;</span></span><br><span class="line">        SELECT p.id,</span><br><span class="line">               p.pid,</span><br><span class="line">               p.name,</span><br><span class="line">               p.type,</span><br><span class="line">               p.permission_value,</span><br><span class="line">               path,</span><br><span class="line">               p.component,</span><br><span class="line">               p.icon,</span><br><span class="line">               p.status,</span><br><span class="line">               p.is_deleted</span><br><span class="line">        FROM auth_user_role ur</span><br><span class="line">                     INNER JOIN auth_role_menu rp ON rp.role_id = ur.role_id</span><br><span class="line">                     INNER JOIN auth_menu p ON p.id = rp.permission_id</span><br><span class="line">        WHERE ur.user_id = #&#123;userId&#125;</span><br><span class="line">          AND ur.is_deleted = 0</span><br><span class="line">          AND rp.is_deleted = 0</span><br><span class="line">          AND p.is_deleted = 0</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>修改 Menu 实体类去除逻辑删除</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210504194832533-2026546127.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210504194832533-2026546127.png" alt="img"></a></p>
<h2 id="46-权限控制-前端权限按钮控制"><a href="#46-权限控制-前端权限按钮控制" class="headerlink" title="46-权限控制-前端权限按钮控制"></a>46-权限控制-前端权限按钮控制</h2><p>创建 <code>button-control.js</code> 如下代码的含义为就是校验一下看看是否有对应的权限如果有就是返回 true 没有就是 false</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;@/store&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">hasBtnPermission</span>(<span class="params">value</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> myBtns = store.<span class="property">getters</span>.<span class="property">buttons</span></span><br><span class="line">  <span class="keyword">return</span> myBtns.<span class="title function_">indexOf</span>(value) &gt; -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将自定义的方法绑定到 vue 的实例上面这样我们就可以在 v-if 获取其它的标签当中直接使用我们的方法了如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210505181644255-90228828.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210505181644255-90228828.png" alt="img"></a></p>
<p>使用方式如下，看看是否有对应的权限值如果没有就不显示按钮给用户操作</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210505181719799-2023198645.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210505181719799-2023198645.png" alt="img"></a></p>
<p>修复一个 BUG 修改 user.js 如下添加如下内容即可修复，问题就是同一个用户登录，退出之后在登陆路由信息点击有问题就是重置路由的问题</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210505181901242-2070449372.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210505181901242-2070449372.png" alt="img"></a></p>
<h2 id="47-前端门户-服务端渲染SSR"><a href="#47-前端门户-服务端渲染SSR" class="headerlink" title="47-前端门户-服务端渲染SSR"></a>47-前端门户-服务端渲染SSR</h2><h3 id="关于服务端渲染"><a href="#关于服务端渲染" class="headerlink" title="关于服务端渲染"></a>关于服务端渲染</h3><blockquote>
<ul>
<li>服务端渲染又称 <code>SSR(Server Side Render)</code> 是在服务端完成页面的内容，而不是在客户端通过 AJAX 获取数据。</li>
<li>服务器端渲染 (SSR) 的优势主要在于：更好的 <code>SEO</code>，由于搜索引擎爬虫抓取工具可以直接查看完全渲染的页面。</li>
<li>使用服务器端渲染，我们可以获得更快的内容到达时间 (time-to-content) 无需等待所有的 JavaScript 都完成下载并执行，产生更好的用户体验。</li>
<li>简单理解就是将组件或页面通过服务器生成 HTML 字符串，再发送到浏览器，最后将静态标记 “混合” 为客户端上完全交互的应用程序。</li>
</ul>
</blockquote>
<h3 id="NUXT-js"><a href="#NUXT-js" class="headerlink" title="NUXT.js"></a>NUXT.js</h3><blockquote>
<ul>
<li><code>Nuxt.js</code> 是一个基于 <code>Vue.js</code> 的轻量级应用框架, 可用来创建服务端渲染 (SSR) 应用。</li>
<li>也可以充当静态站点引擎生成静态站点应用, 具有优雅的代码结构分层和热加载等特性。</li>
<li>官方地址：<a target="_blank" rel="noopener" href="https://zh.nuxtjs.org/">https://zh.nuxtjs.org</a></li>
<li>一个用于 Vue.js 开发 SSR 应用的一站式解决方案。</li>
<li>Nuxt.js 是使用 Webpack 和 Node.js 进行封装的基于 Vue 的 SSR 框架。</li>
</ul>
</blockquote>
<h4 id="NUXT-环境初始化"><a href="#NUXT-环境初始化" class="headerlink" title="NUXT 环境初始化"></a>NUXT 环境初始化</h4><p>有两种方式可以进行初始化</p>
<h5 id="第一种"><a href="#第一种" class="headerlink" title="第一种"></a>第一种</h5><p>就是直接去 GitHub 下载对应的模板</p>
<p>GitHub 地址：<a target="_blank" rel="noopener" href="https://github.com/nuxt-community/starter-template">https://github.com/nuxt-community/starter-template</a></p>
<h5 id="第二种"><a href="#第二种" class="headerlink" title="第二种"></a>第二种</h5><p>就是使用 vue-cli</p>
<p>安装 vue-cli</p>
<p>bash</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g @vue/cli-init</span><br></pre></td></tr></table></figure>

<p>bash</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vue init nuxt-community/starter-template video_portal</span><br></pre></td></tr></table></figure>

<p>选择一个存放位置如下图所示</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210509114654817-699452394.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210509114654817-699452394.png" alt="img"></a></p>
<p>在该项目当中使用安装相关依赖</p>
<p>bash</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210509130704696-1821498642.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210509130704696-1821498642.png" alt="img"></a></p>
<p>配置启动设置</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210509141537600-595648792.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210509141537600-595648792.png" alt="img"></a></p>
<h4 id="NUXT-目录结构"><a href="#NUXT-目录结构" class="headerlink" title="NUXT 目录结构"></a>NUXT 目录结构</h4><ul>
<li>资源目录：assets 用于组织未编译的静态资源如 LESS、SASS 或 JavaScript。</li>
<li>组件目录：components 用于组织应用的 Vue.js 组件。Nuxt.js 不会扩展增强该目录下 Vue.js 组件，即这些组件不会像页面组件那样有 asyncData 方法的特性。</li>
<li>布局目录：layouts 用于组织应用的布局组件。对整个页面进行整体划分布局。</li>
<li>页面目录：pages 用于组织应用的路由及视图。Nuxt.js 框架读取该目录下所有的 <code>.vue</code> 文件并自动生成对应的路由配置，具体的页面信息。</li>
<li>插件目录：plugins 用于组织那些需要在根 vue.js 应用实例化之前需要运行的 Javascript 插件。</li>
<li>nuxt.config.js：文件，<code>nuxt.config.js</code> 文件用于组织 Nuxt.js 应用的个性化配置，以便覆盖默认配置。</li>
</ul>
<h4 id="布局与页面"><a href="#布局与页面" class="headerlink" title="布局与页面"></a>布局与页面</h4><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210509214456564-786002433.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210509214456564-786002433.png" alt="img"></a></p>
<h3 id="页面整合"><a href="#页面整合" class="headerlink" title="页面整合"></a>页面整合</h3><h4 id="安装轮播图插件"><a href="#安装轮播图插件" class="headerlink" title="安装轮播图插件"></a>安装轮播图插件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install swiper vue-awesome-swiper --save</span><br></pre></td></tr></table></figure>

<h4 id="配置轮播图插件"><a href="#配置轮播图插件" class="headerlink" title="配置轮播图插件"></a>配置轮播图插件</h4><p>在 plugins 文件夹下新建文件 <code>nuxt-swiper-plugin.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import Vue from &#x27;vue&#x27;;</span><br><span class="line">import VueAwesomeSwiper from &#x27;vue-awesome-swiper&#x27;;</span><br><span class="line"></span><br><span class="line">Vue.use(VueAwesomeSwiper);</span><br></pre></td></tr></table></figure>

<p>在 <code>nuxt.config.js</code> 文件中配置轮播图插件，将 plugins 和 css 节点复制到 module.exports 节点下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210515111128939-1962923580.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210515111128939-1962923580.png" alt="img"></a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* plugins</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line"><span class="attr">plugins</span>: [</span><br><span class="line">  &#123;<span class="attr">src</span>: <span class="string">&#x27;~/plugins/nuxt-swiper-plugin.js&#x27;</span>, <span class="attr">ssr</span>: <span class="literal">false</span>&#125;</span><br><span class="line">],</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* CSS</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line"><span class="attr">css</span>: [</span><br><span class="line">  <span class="string">&#x27;swiper/swiper-bundle.css&#x27;</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h4 id="集成-Element-UI"><a href="#集成-Element-UI" class="headerlink" title="集成 Element-UI"></a>集成 Element-UI</h4><h5 id="安装-Element-UI"><a href="#安装-Element-UI" class="headerlink" title="安装 Element-UI"></a>安装 Element-UI</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install element-ui</span><br></pre></td></tr></table></figure>

<p>在 plugins 文件夹下，添加 <code>ElementUI.js</code> 文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import Vue from &#x27;vue&#x27;;</span><br><span class="line">import ElementUI from &#x27;element-ui&#x27;;</span><br><span class="line"></span><br><span class="line">Vue.use(ElementUI);</span><br></pre></td></tr></table></figure>

<p>在 nuxt.config.js 中添加 Element-UI 配置</p>
<p><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210515111537148-1867048462.png" alt="img"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;src: &#x27;~plugins/ElementUI&#x27;, ssr: true&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;element-ui/lib/theme-chalk/index.css&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="页面布局"><a href="#页面布局" class="headerlink" title="页面布局"></a>页面布局</h3><h4 id="复制静态资源"><a href="#复制静态资源" class="headerlink" title="复制静态资源"></a>复制静态资源</h4><p>将静态原型中的 css、img、js 目录拷贝至 assets 目录下, 将 favicon.ico 复制到 static 目录下，页面资源下载链接：<a target="_blank" rel="noopener" href="https://wwe.lanzoui.com/iQyhyp5jwab">https://wwe.lanzoui.com/iQyhyp5jwab</a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210515112035890-385520003.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210515112035890-385520003.png" alt="img"></a></p>
<h4 id="定义布局"><a href="#定义布局" class="headerlink" title="定义布局"></a>定义布局</h4><p>修改 layouts 目录下 <code>default.vue</code></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210515112150168-1525156400.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210515112150168-1525156400.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!-- 页头部分 --&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 内容的区域 --&gt;</span><br><span class="line">    &lt;nuxt/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 页尾部分 --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<p>定义首页页面, 修改 <code>pages/index.vue</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!-- 轮播图 开始 --&gt;</span><br><span class="line">    &lt;div class=&quot;warper&quot; style=&quot;position: relative&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;warper_content&quot;&gt;</span><br><span class="line">        &lt;!--分类--&gt;</span><br><span class="line">        &lt;div class=&quot;category&quot;&gt;</span><br><span class="line">          &lt;ul&gt;</span><br><span class="line">            &lt;li v-for=&quot;(cate, index) in categoryList&quot; v-bind:key=&quot;index&quot;&gt;</span><br><span class="line">              &lt;div class=&quot;coursex-item1&quot;&gt;</span><br><span class="line">                &lt;a class=&quot;shuang&quot;&gt;&#123;&#123; cate.title &#125;&#125;&lt;/a&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">          &lt;/ul&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;swiper :options=&quot;swiperOptions&quot; class=&quot;swiper-cus&quot;&gt;</span><br><span class="line">          &lt;swiper-slide v-for=&quot;banner in bannerList&quot; :key=&quot;banner.id&quot; :style=&quot;&#123;background:banner.imageBg&#125;&quot;&gt;</span><br><span class="line">            &lt;a target=&quot;_blank&quot; :href=&quot;banner.linkUrl&quot;&gt;</span><br><span class="line">              &lt;img width=&quot;1200&quot; height=&quot;380&quot; style=&quot;min-height: 380px;&quot;</span><br><span class="line">                   :src=&quot;banner.imageUrl&quot;</span><br><span class="line">                   :alt=&quot;banner.title&quot;/&gt;</span><br><span class="line">            &lt;/a&gt;</span><br><span class="line">          &lt;/swiper-slide&gt;</span><br><span class="line">          &lt;div class=&quot;swiper-pagination swiper-pagination-white&quot; slot=&quot;pagination&quot;&gt;&lt;/div&gt;</span><br><span class="line">          &lt;div style=&quot;left: 200px;&quot; class=&quot;swiper-button-prev swiper-button-white&quot; slot=&quot;button-prev&quot;&gt;&lt;/div&gt;</span><br><span class="line">          &lt;div style=&quot;right: 200px&quot; class=&quot;swiper-button-next swiper-button-white&quot; slot=&quot;button-next&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;/swiper&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- 轮播图 结束 --&gt;</span><br><span class="line">    &lt;!--列表--&gt;</span><br><span class="line">    &lt;div id=&quot;videoList&quot;&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;section class=&quot;container&quot;&gt;</span><br><span class="line">          &lt;header class=&quot;comm-title&quot;&gt;</span><br><span class="line">            &lt;h2 class=&quot;tac&quot;&gt;</span><br><span class="line">              &lt;span class=&quot;c-333&quot; style=&quot;float:left; border-left: 3px solid red; padding-left: 10px;&quot;&gt;热门视频&lt;/span&gt;</span><br><span class="line">              &lt;span class=&quot;c-333&quot; style=&quot;float:right; font-size: 18px; &quot;&gt;&lt;a href=&quot;#&quot;&gt;更多&lt;/a&gt;&lt;/span&gt;</span><br><span class="line">            &lt;/h2&gt;</span><br><span class="line">          &lt;/header&gt;</span><br><span class="line">          &lt;div&gt;</span><br><span class="line">            &lt;article class=&quot;comm-video-list&quot;&gt;</span><br><span class="line">              &lt;ul&gt;</span><br><span class="line">                &lt;li v-for=&quot;(content,index) in contentList&quot; class=&quot;fl&quot; v-bind:key=&quot;index&quot;&gt;</span><br><span class="line">                  &lt;div class=&quot;cc-l-wrap&quot;&gt;</span><br><span class="line">                    &lt;section class=&quot;video-img&quot;&gt;</span><br><span class="line">                      &lt;img style=&quot;width: 100%;height: 100%&quot;</span><br><span class="line">                           :src=&quot;content.cover&quot;</span><br><span class="line">                           class=&quot;img-responsive&quot;</span><br><span class="line">                      &gt;</span><br><span class="line">                      &lt;div class=&quot;cc-mask&quot;&gt;</span><br><span class="line">                        &lt;a :href=&quot;&#x27;/video/&#x27;+content.id&quot; class=&quot;comm-btn c-btn-1&quot;&gt;播放&lt;/a&gt;</span><br><span class="line">                      &lt;/div&gt;</span><br><span class="line">                    &lt;/section&gt;</span><br><span class="line">                    &lt;h3 class=&quot;hLh30 txtOf mt10&quot;&gt;</span><br><span class="line">                      &lt;a href=&quot;#&quot; class=&quot;course-title fsize18 c-333&quot;&gt;&#123;&#123; content.title &#125;&#125;&lt;/a&gt;</span><br><span class="line">                    &lt;/h3&gt;</span><br><span class="line">                    &lt;section class=&quot;mt10 hLh20 of&quot;&gt;</span><br><span class="line">                      &lt;span class=&quot;fr jgTag bg-orangered&quot; v-if=&quot;Number(content.price) === 0&quot;&gt;</span><br><span class="line">                        &lt;i class=&quot;c-fff fsize12 f-fA&quot;&gt;免费&lt;/i&gt;</span><br><span class="line">                        &lt;/span&gt;</span><br><span class="line">                      &lt;span class=&quot;fr jgTag bg-orangered&quot; v-else&gt;</span><br><span class="line">                          &lt;i class=&quot;c-fff fsize12 f-fA&quot;&gt; ￥&#123;&#123; content.price &#125;&#125;&lt;/i&gt;</span><br><span class="line">                        &lt;/span&gt;</span><br><span class="line">                      &lt;span class=&quot;fl jgAttr c-ccc f-fA&quot;&gt;</span><br><span class="line">                        &lt;i class=&quot;c-999 f-fA&quot;&gt;&#123;&#123; content.buyCount &#125;&#125; 人学习&lt;/i&gt;|</span><br><span class="line">                        &lt;i class=&quot;c-999 f-fA&quot;&gt;&#123;&#123; content.viewCount &#125;&#125; 人浏览&lt;/i&gt;</span><br><span class="line">                        &lt;/span&gt;</span><br><span class="line">                    &lt;/section&gt;</span><br><span class="line">                  &lt;/div&gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">              &lt;/ul&gt;</span><br><span class="line">            &lt;/article&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/section&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;!--</span><br><span class="line">      优秀创作者</span><br><span class="line">      --&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;section class=&quot;container&quot;&gt;</span><br><span class="line">          &lt;header class=&quot;comm-title&quot;&gt;</span><br><span class="line">            &lt;h2 class=&quot;tac&quot;&gt;</span><br><span class="line">              &lt;span class=&quot;c-333&quot; style=&quot;float:left; border-left: 3px solid red; padding-left: 10px;&quot;&gt;优秀创作者&lt;/span&gt;</span><br><span class="line">              &lt;span class=&quot;c-333&quot; style=&quot;float:right; font-size: 18px; &quot;&gt;&lt;a href=&quot;#&quot;&gt;更多&lt;/a&gt;&lt;/span&gt;</span><br><span class="line">            &lt;/h2&gt;</span><br><span class="line">          &lt;/header&gt;</span><br><span class="line">          &lt;div&gt;</span><br><span class="line">            &lt;article class=&quot;i-author-list&quot;&gt;</span><br><span class="line">              &lt;div v-for=&quot;(author,index) in authorList&quot; v-bind:key=&quot;index&quot; class=&quot;yd-open-course-card open-course-card&quot;&gt;</span><br><span class="line">                &lt;a :href=&#x27;&quot;/author/&quot;+author.id&#x27; :title=&quot;index.name&quot; style=&quot;color: #7F828B;text-decoration:none;&quot;&gt;</span><br><span class="line">                  &lt;div class=&quot;yd-open-course-card_avatar&quot;&gt;</span><br><span class="line">                    &lt;img :alt=&quot;author.name&quot; :src=&quot;author.avatar&quot;&gt;</span><br><span class="line">                  &lt;/div&gt;</span><br><span class="line">                  &lt;div class=&quot;yd-open-course-card_content_teacher&quot;&gt;</span><br><span class="line">                    &lt;div class=&quot;yd-open-course-card_content_teacher_tag&quot;&gt;&#123;&#123; author.name &#125;&#125;&lt;/div&gt;</span><br><span class="line">                  &lt;/div&gt;</span><br><span class="line">                  &lt;div&gt;&#123;&#123; author.intro &#125;&#125;&lt;/div&gt;</span><br><span class="line">                  &lt;span&gt;-------------------------&lt;/span&gt;</span><br><span class="line">                  &lt;div&gt;&#123;&#123; author.career &#125;&#125;&lt;/div&gt;</span><br><span class="line">                &lt;/a&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">              &lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;</span><br><span class="line">            &lt;/article&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/section&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import Swiper, &#123;Pagination, Navigation&#125; from &#x27;swiper&#x27;;</span><br><span class="line"></span><br><span class="line">Swiper.use([Pagination, Navigation]);</span><br><span class="line">import banner from &quot;@/api/banner&quot;;</span><br><span class="line">import index from &#x27;@/api/index&#x27;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      swiperOptions: &#123;</span><br><span class="line">        loop: true,</span><br><span class="line">        pagination: &#123;</span><br><span class="line">          el: &#x27;.swiper-pagination&#x27;</span><br><span class="line">        &#125;,</span><br><span class="line">        // 配置导航</span><br><span class="line">        navigation: &#123;</span><br><span class="line">          // 下一页dom节点</span><br><span class="line">          nextEl: &#x27;.swiper-button-next&#x27;,</span><br><span class="line">          // 前一页dom节点</span><br><span class="line">          prevEl: &#x27;.swiper-button-prev&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      bannerList: &#123;&#125;,</span><br><span class="line">      categoryList: &#123;&#125;,</span><br><span class="line">      authorList: &#123;&#125;,</span><br><span class="line">      contentList: &#123;&#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    this.initBanner();</span><br><span class="line">    this.initIndexData();</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    initBanner() &#123;</span><br><span class="line">      banner.getList().then(response =&gt; &#123;</span><br><span class="line">        this.bannerList = response.data.list;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    initIndexData() &#123;</span><br><span class="line">      index.getList().then(response =&gt; &#123;</span><br><span class="line">        this.authorList = response.data.authorList;</span><br><span class="line">        this.contentList = response.data.contentList;</span><br><span class="line">        this.categoryList = response.data.categoryList;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style lang=&quot;stylus&quot; scoped&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h3 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h3><h4 id="固定路由"><a href="#固定路由" class="headerlink" title="固定路由"></a>固定路由</h4><p>使用 router-link 构建路由，地址是 &#x2F;course，在 page 目录创建文件夹 video，在 video 目录创建 index.vue</p>
<h4 id="动态路由"><a href="#动态路由" class="headerlink" title="动态路由"></a>动态路由</h4><p>如果我们需要根据 id 查询一条记录，就需要使用动态路由，NUXT 的动态路由是以下划线开头的 vue 文件，参数名为下划线后边的文件名</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210515190031367-150648376.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210515190031367-150648376.png" alt="img"></a></p>
<h3 id="静态页面"><a href="#静态页面" class="headerlink" title="静态页面"></a>静态页面</h3><h4 id="布局页"><a href="#布局页" class="headerlink" title="布局页"></a>布局页</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;in-wrap&quot;&gt;</span><br><span class="line">    &lt;!--头部布局--&gt;</span><br><span class="line">    &lt;header id=&quot;header&quot;&gt;</span><br><span class="line">      &lt;section class=&quot;container&quot;&gt;</span><br><span class="line">        &lt;h1 id=&quot;logo&quot;&gt;</span><br><span class="line">          &lt;a href=&quot;#&quot; title=&quot;BNTang&quot;&gt;</span><br><span class="line">            &lt;img src=&quot;~/assets/img/logo.png&quot; height=&quot;100px&quot; alt=&quot;BNTang&quot;&gt;</span><br><span class="line">          &lt;/a&gt;</span><br><span class="line">        &lt;/h1&gt;</span><br><span class="line">        &lt;div class=&quot;h-r-nsl&quot;&gt;</span><br><span class="line">          &lt;ul class=&quot;nav&quot;&gt;</span><br><span class="line">            &lt;router-link to=&quot;/&quot; tag=&quot;li&quot; active-class=&quot;current&quot; exact&gt;</span><br><span class="line">              &lt;a&gt;首页&lt;/a&gt;</span><br><span class="line">            &lt;/router-link&gt;</span><br><span class="line">            &lt;router-link to=&quot;/video&quot; tag=&quot;li&quot; active-class=&quot;current&quot;&gt;</span><br><span class="line">              &lt;a&gt;全部视频&lt;/a&gt;</span><br><span class="line">            &lt;/router-link&gt;</span><br><span class="line">            &lt;router-link to=&quot;/author&quot; tag=&quot;li&quot; active-class=&quot;current&quot;&gt;</span><br><span class="line">              &lt;a&gt;创作者&lt;/a&gt;</span><br><span class="line">            &lt;/router-link&gt;</span><br><span class="line">            &lt;router-link to=&quot;/article&quot; tag=&quot;li&quot; active-class=&quot;current&quot;&gt;</span><br><span class="line">              &lt;a&gt;资讯信息&lt;/a&gt;</span><br><span class="line">            &lt;/router-link&gt;</span><br><span class="line">            &lt;router-link to=&quot;/qa&quot; tag=&quot;li&quot; active-class=&quot;current&quot;&gt;</span><br><span class="line">              &lt;a&gt;学习交流&lt;/a&gt;</span><br><span class="line">            &lt;/router-link&gt;</span><br><span class="line">          &lt;/ul&gt;</span><br><span class="line">          &lt;!-- / nav --&gt;</span><br><span class="line">          &lt;ul class=&quot;h-r-login&quot;&gt;</span><br><span class="line">            &lt;li id=&quot;no-login&quot;&gt;</span><br><span class="line">              &lt;a href=&quot;/login&quot;&gt;</span><br><span class="line">                &lt;em class=&quot;icon18 login-icon&quot;&gt;&amp;nbsp;&lt;/em&gt;</span><br><span class="line">                &lt;span class=&quot;vam ml5&quot;&gt;登录&lt;/span&gt;</span><br><span class="line">              &lt;/a&gt;</span><br><span class="line">              |</span><br><span class="line">              &lt;a href=&quot;/register&quot;&gt;</span><br><span class="line">                &lt;span class=&quot;vam ml5&quot;&gt;注册&lt;/span&gt;</span><br><span class="line">              &lt;/a&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">          &lt;/ul&gt;</span><br><span class="line">          &lt;aside class=&quot;h-r-search&quot;&gt;</span><br><span class="line">            &lt;form action=&quot;#&quot; method=&quot;post&quot;&gt;</span><br><span class="line">              &lt;label class=&quot;h-r-s-box&quot;&gt;</span><br><span class="line">                &lt;input type=&quot;text&quot; placeholder=&quot;搜索...&quot; value&gt;</span><br><span class="line">                &lt;button type=&quot;submit&quot; class=&quot;s-btn&quot;&gt;</span><br><span class="line">                  &lt;em class=&quot;icon18&quot;&gt;&amp;nbsp;&lt;/em&gt;</span><br><span class="line">                &lt;/button&gt;</span><br><span class="line">              &lt;/label&gt;</span><br><span class="line">            &lt;/form&gt;</span><br><span class="line">          &lt;/aside&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;aside class=&quot;mw-nav-btn&quot;&gt;</span><br><span class="line">          &lt;div class=&quot;mw-nav-icon&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;/aside&gt;</span><br><span class="line">        &lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;</span><br><span class="line">      &lt;/section&gt;</span><br><span class="line">    &lt;/header&gt;</span><br><span class="line">    &lt;!--引入主体--&gt;</span><br><span class="line">    &lt;nuxt/&gt;</span><br><span class="line">    &lt;!--尾部布局--&gt;</span><br><span class="line">    &lt;div class=&quot;footer&quot; style=&quot;height: 121px; background-color: #242A39; width: 100%;text-align: center;&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;three links&quot;&gt;友情链接：&lt;a style=&quot;color: #ffff;&quot; href=&quot;https://tool.oschina.net/codeformat/js/&quot;</span><br><span class="line">                                         target=&quot;_blank&quot;&gt;在线代码格式化&lt;/a&gt;&lt;a style=&quot;color: #ffff;&quot;&gt; &amp;nbsp;|&amp;nbsp; &lt;/a&gt;&lt;a</span><br><span class="line">          style=&quot;color: #ffff;&quot; href=&quot;https://www.processon.com/&quot; target=&quot;_blank&quot;&gt;在线UML&lt;/a&gt;&lt;a style=&quot;color: #ffff;&quot;&gt;&lt;/a&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;footer-words&quot;&gt;</span><br><span class="line">          &lt;span&gt;版权所有 © 2021 BNTang 科技有限公司 &amp;nbsp; &lt;/span&gt;&lt;span&gt;&lt;a href=&quot;http://www.beian.miit.gov.cn&quot; target=&quot;_blank&quot;</span><br><span class="line">                                                                 style=&quot;color: #C0C4CC;&quot;&gt;苏ICP备20019650号-1&lt;/a&gt; &amp;nbsp;&lt;/span&gt;</span><br><span class="line">          BNTang 技术有限公司 &lt;a style=&quot;padding-left: 14px;color:rgba(246,246,246,1);&quot; href=&quot;/sitemap.html&quot;&gt;网站地图&lt;/a&gt;&lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &quot;~/assets/css/reset.css&quot;;</span><br><span class="line">import &quot;~/assets/css/theme.css&quot;;</span><br><span class="line">import &quot;~/assets/css/global.css&quot;;</span><br><span class="line">import &quot;~/assets/css/web.css&quot;;</span><br><span class="line">import &quot;~/assets/css/content.css&quot;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;default&quot;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h3 id="封装-axios"><a href="#封装-axios" class="headerlink" title="封装 axios"></a>封装 axios</h3><h4 id="下载-axios"><a href="#下载-axios" class="headerlink" title="下载 axios"></a>下载 axios</h4><p>使用命令</p>
<p>sh</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install axios</span><br></pre></td></tr></table></figure>

<p>创建 utils 文件夹，utils 下创建 request.js</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210515190726697-1670871587.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210515190726697-1670871587.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">MessageBox</span>, <span class="title class_">Message</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;element-ui&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// create an axios instance</span></span><br><span class="line"><span class="keyword">const</span> service = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">  <span class="attr">baseURL</span>: <span class="string">&#x27;http://localhost:9000&#x27;</span>,</span><br><span class="line">  <span class="attr">timeout</span>: <span class="number">5000</span> <span class="comment">// request timeout</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">service.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> res = response.<span class="property">data</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// if the custom code is not 20000, it is judged as an error.</span></span><br><span class="line">    <span class="keyword">if</span> (res.<span class="property">code</span> !== <span class="number">20000</span>) &#123;</span><br><span class="line">      <span class="title class_">Message</span>(&#123;</span><br><span class="line">        <span class="attr">message</span>: res.<span class="property">message</span> || <span class="string">&#x27;Error&#x27;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">        <span class="attr">duration</span>: <span class="number">5</span> * <span class="number">1000</span></span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 50008: Illegal token; 50012: Other clients logged in; 50014: Token expired;</span></span><br><span class="line">      <span class="keyword">if</span> (res.<span class="property">code</span> === <span class="number">50008</span> || res.<span class="property">code</span> === <span class="number">50012</span> || res.<span class="property">code</span> === <span class="number">50014</span>) &#123;</span><br><span class="line">        <span class="comment">// to re-login</span></span><br><span class="line">        <span class="title class_">MessageBox</span>.<span class="title function_">confirm</span>(<span class="string">&#x27;You have been logged out, you can cancel to stay on this page, or log in again&#x27;</span>, <span class="string">&#x27;Confirm logout&#x27;</span>, &#123;</span><br><span class="line">          <span class="attr">confirmButtonText</span>: <span class="string">&#x27;Re-Login&#x27;</span>,</span><br><span class="line">          <span class="attr">cancelButtonText</span>: <span class="string">&#x27;Cancel&#x27;</span>,</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;warning&#x27;</span></span><br><span class="line">        &#125;).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          store.<span class="title function_">dispatch</span>(<span class="string">&#x27;user/resetToken&#x27;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            location.<span class="title function_">reload</span>();</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(res.<span class="property">message</span> || <span class="string">&#x27;Error&#x27;</span>));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title class_">Message</span>(&#123;</span><br><span class="line">      <span class="attr">message</span>: error.<span class="property">message</span>,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">      <span class="attr">duration</span>: <span class="number">5</span> * <span class="number">1000</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> service;</span><br></pre></td></tr></table></figure>

<h2 id="48-前端门户-banner微服务"><a href="#48-前端门户-banner微服务" class="headerlink" title="48-前端门户-banner微服务"></a>48-前端门户-banner微服务</h2><h3 id="创建-service-cms-工程"><a href="#创建-service-cms-工程" class="headerlink" title="创建 service_cms 工程"></a>创建 service_cms 工程</h3><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210515191720493-1564404877.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210515191720493-1564404877.png" alt="img"></a></p>
<h3 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `cms_banner` (</span><br><span class="line">	`id` CHAR ( 19 ) NOT NULL DEFAULT &#x27;&#x27; COMMENT &#x27;ID&#x27;,</span><br><span class="line">	`title` VARCHAR ( 20 ) DEFAULT &#x27;&#x27; COMMENT &#x27;标题&#x27;,</span><br><span class="line">	`image_url` VARCHAR ( 500 ) NOT NULL DEFAULT &#x27;&#x27; COMMENT &#x27;图片地址&#x27;,</span><br><span class="line">	`link_url` VARCHAR ( 500 ) DEFAULT &#x27;&#x27; COMMENT &#x27;链接地址&#x27;,</span><br><span class="line">	`image_bg` VARCHAR ( 500 ) DEFAULT &#x27;&#x27; COMMENT &#x27;背景颜色&#x27;,</span><br><span class="line">	`sort` INT ( 10 ) UNSIGNED NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;排序&#x27;,</span><br><span class="line">	`is_deleted` TINYINT ( 1 ) UNSIGNED NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;逻辑删除 1（true）已删除， 0（false）未删除&#x27;,</span><br><span class="line">	`gmt_create` datetime NOT NULL COMMENT &#x27;创建时间&#x27;,</span><br><span class="line">	`gmt_modified` datetime NOT NULL COMMENT &#x27;更新时间&#x27;,</span><br><span class="line">	PRIMARY KEY ( `id` ),</span><br><span class="line">UNIQUE KEY `uk_name` ( `title` ) </span><br><span class="line">) ENGINE = INNODB DEFAULT CHARSET = utf8mb4 COLLATE = utf8mb4_0900_ai_ci COMMENT = &#x27;首页banner表&#x27;;</span><br></pre></td></tr></table></figure>

<h3 id="使用代码生成器生成代码-1"><a href="#使用代码生成器生成代码-1" class="headerlink" title="使用代码生成器生成代码"></a>使用代码生成器生成代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CodeGenerator</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 1、创建代码生成器</span></span><br><span class="line">        <span class="type">AutoGenerator</span> <span class="variable">mpg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AutoGenerator</span>();</span><br><span class="line">        <span class="comment">// 2、全局配置</span></span><br><span class="line">        <span class="type">GlobalConfig</span> <span class="variable">gc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GlobalConfig</span>();</span><br><span class="line">        <span class="comment">//配置输出路径</span></span><br><span class="line">        gc.setOutputDir(<span class="string">&quot;D:\\Develop\\IdeaPro\\video_parent\\service\\service_cms\\src\\main\\java&quot;</span>);</span><br><span class="line">        gc.setOpen(<span class="literal">false</span>); <span class="comment">//生成后是否打开资源管理器</span></span><br><span class="line">        gc.setAuthor(<span class="string">&quot;BNTang&quot;</span>);</span><br><span class="line">        gc.setFileOverride(<span class="literal">false</span>); <span class="comment">//重新生成时文件是否覆盖</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * mp生成service层代码，默认接口名称第一个字母有 I</span></span><br><span class="line"><span class="comment">         * */</span></span><br><span class="line">        gc.setControllerName(<span class="string">&quot;%sController&quot;</span>);</span><br><span class="line">        gc.setServiceName(<span class="string">&quot;%sService&quot;</span>);</span><br><span class="line">        gc.setServiceImplName(<span class="string">&quot;%sServiceImpl&quot;</span>);</span><br><span class="line">        gc.setMapperName(<span class="string">&quot;%sMapper&quot;</span>);</span><br><span class="line">        gc.setXmlName(<span class="string">&quot;%sMapper&quot;</span>);</span><br><span class="line">        <span class="comment">// 主键策略</span></span><br><span class="line">        gc.setIdType(IdType.ID_WORKER_STR);</span><br><span class="line">        <span class="comment">// 定义生成的实体类中日期类型</span></span><br><span class="line">        gc.setDateType(DateType.ONLY_DATE);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 开启Swagger2模式</span></span><br><span class="line">        gc.setSwagger2(<span class="literal">true</span>);</span><br><span class="line">        mpg.setGlobalConfig(gc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、数据源配置</span></span><br><span class="line">        <span class="type">DataSourceConfig</span> <span class="variable">dsc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataSourceConfig</span>();</span><br><span class="line">        dsc.setUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/video_db?serverTimezone=GMT%2B8&quot;</span>);</span><br><span class="line">        dsc.setDriverName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">        dsc.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        dsc.setPassword(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        dsc.setDbType(DbType.MYSQL);</span><br><span class="line">        mpg.setDataSource(dsc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、包配置</span></span><br><span class="line">        <span class="type">PackageConfig</span> <span class="variable">pc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PackageConfig</span>();</span><br><span class="line">        pc.setModuleName(<span class="string">&quot;service_cms&quot;</span>); <span class="comment">//模块名</span></span><br><span class="line">        pc.setParent(<span class="string">&quot;top.it6666&quot;</span>);</span><br><span class="line">        pc.setController(<span class="string">&quot;controller&quot;</span>);</span><br><span class="line">        pc.setEntity(<span class="string">&quot;entity&quot;</span>);</span><br><span class="line">        pc.setService(<span class="string">&quot;service&quot;</span>);</span><br><span class="line">        pc.setMapper(<span class="string">&quot;mapper&quot;</span>);</span><br><span class="line">        mpg.setPackageInfo(pc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5、策略配置</span></span><br><span class="line">        <span class="type">StrategyConfig</span> <span class="variable">strategy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StrategyConfig</span>();</span><br><span class="line">        strategy.setInclude(<span class="string">&quot;cms_banner&quot;</span>);</span><br><span class="line">        <span class="comment">//数据库表映射到实体的命名策略 驼峰命名</span></span><br><span class="line">        strategy.setNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">        <span class="comment">//生成实体时去掉表前缀</span></span><br><span class="line">        strategy.setTablePrefix(<span class="string">&quot;cms_&quot;</span>);</span><br><span class="line">        <span class="comment">//数据库表字段映射到实体的命名策略</span></span><br><span class="line">        strategy.setColumnNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">        <span class="comment">// lombok 模型 @Accessors(chain = true) setter链式操作</span></span><br><span class="line">        strategy.setEntityLombokModel(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//restful api风格控制器</span></span><br><span class="line">        strategy.setRestControllerStyle(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//url中驼峰转连字符</span></span><br><span class="line">        strategy.setControllerMappingHyphenStyle(<span class="literal">true</span>);</span><br><span class="line">        mpg.setStrategy(strategy);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6、执行</span></span><br><span class="line">        mpg.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="添加配置文件"><a href="#添加配置文件" class="headerlink" title="添加配置文件"></a>添加配置文件</h3><p>创建 application.yml 内容如下</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application-dev.yml</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8005</span></span><br><span class="line"></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">pattern:</span></span><br><span class="line">    <span class="attr">console:</span> <span class="string">&quot;%clr(%5p) %clr(-)&#123;faint&#125; %clr(%-80.80logger&#123;79&#125;)&#123;cyan&#125; %clr(:) %m%n&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">service-cms</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/video_db?serverTimezone=GMT%2B8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">hikari:</span></span><br><span class="line">      <span class="attr">connection-test-query:</span> <span class="string">SELECT</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">connection-timeout:</span> <span class="number">60000</span></span><br><span class="line">      <span class="attr">idle-timeout:</span> <span class="number">500000</span></span><br><span class="line">      <span class="attr">max-lifetime:</span> <span class="number">540000</span></span><br><span class="line">      <span class="attr">maximum-pool-size:</span> <span class="number">12</span></span><br><span class="line">      <span class="attr">minimum-idle:</span> <span class="number">10</span></span><br><span class="line">      <span class="attr">pool-name:</span> <span class="string">HikariPool</span></span><br><span class="line">  <span class="attr">jackson:</span></span><br><span class="line">    <span class="attr">date-format:</span> <span class="string">yyyy-MM-dd</span> <span class="string">HH:mm:ss</span></span><br><span class="line">    <span class="attr">time-zone:</span> <span class="string">GMT+8</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">timeout:</span> <span class="number">1800000</span></span><br><span class="line">    <span class="attr">lettuce:</span></span><br><span class="line">      <span class="attr">pool:</span></span><br><span class="line">        <span class="attr">max-active:</span> <span class="number">20</span></span><br><span class="line">        <span class="attr">max-wait:</span> <span class="number">1</span></span><br><span class="line">        <span class="comment"># 最大阻塞等待时间</span></span><br><span class="line">        <span class="attr">max-idle:</span> <span class="number">5</span></span><br><span class="line">        <span class="attr">min-idle:</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">top/it6666/service_cms/mapper/xml/*.xml</span></span><br></pre></td></tr></table></figure>

<h3 id="添加网关地址"><a href="#添加网关地址" class="headerlink" title="添加网关地址"></a>添加网关地址</h3><p>修改网关服务的 application.yml</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210516000000724-1649586938.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210516000000724-1649586938.png" alt="img"></a></p>
<p>yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">service-cms</span></span><br><span class="line">  <span class="attr">uri:</span> <span class="string">lb://service-cms</span></span><br><span class="line">  <span class="attr">predicates:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Path=/service_cms/**</span></span><br></pre></td></tr></table></figure>

<h3 id="添加启动类"><a href="#添加启动类" class="headerlink" title="添加启动类"></a>添加启动类</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @author BNTang</span><br><span class="line"> */</span><br><span class="line">@SpringBootApplication</span><br><span class="line">@ComponentScan(basePackages = &#123;&quot;top.it6666&quot;&#125;)</span><br><span class="line">@EnableDiscoveryClient</span><br><span class="line">@MapperScan(&quot;top.it6666.service_cms.mapper&quot;)</span><br><span class="line">public class CmsApplication &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(CmsApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="接口与业务"><a href="#接口与业务" class="headerlink" title="接口与业务"></a>接口与业务</h3><p>修改 BannerController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 首页banner表 前端控制器</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2021-05-15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;首页banner组&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/service_cms/banner&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BannerController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> BannerService bannerService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询所有banner</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;查询所有banner&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/getAllBanner&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">getAllBanner</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;Banner&gt; list = bannerService.selectAllBanner();</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok().data(<span class="string">&quot;list&quot;</span>, list);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询banner</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;分页查询banner&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;pageBanner/&#123;page&#125;/&#123;limit&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">pageBanner</span><span class="params">(<span class="meta">@PathVariable</span> <span class="type">long</span> page, <span class="meta">@PathVariable</span> <span class="type">long</span> limit)</span> &#123;</span><br><span class="line">        Page&lt;Banner&gt; pageBanner = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page, limit);</span><br><span class="line">        bannerService.page(pageBanner, <span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok()</span><br><span class="line">                .data(<span class="string">&quot;items&quot;</span>, pageBanner.getRecords())</span><br><span class="line">                .data(<span class="string">&quot;total&quot;</span>, pageBanner.getTotal());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加banner</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;添加banner&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;addBanner&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">addBanner</span><span class="params">(<span class="meta">@RequestBody</span> Banner crmBanner)</span> &#123;</span><br><span class="line">        bannerService.save(crmBanner);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取Banner</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;获取Banner&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;get/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">get</span><span class="params">(<span class="meta">@PathVariable</span> String id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok().data(<span class="string">&quot;item&quot;</span>, bannerService.getById(id));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改Banner</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;修改Banner&quot;)</span></span><br><span class="line">    <span class="meta">@PutMapping(&quot;update&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">updateById</span><span class="params">(<span class="meta">@RequestBody</span> Banner banner)</span> &#123;</span><br><span class="line">        bannerService.updateById(banner);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除Banner</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;删除Banner&quot;)</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;remove/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">remove</span><span class="params">(<span class="meta">@PathVariable</span> String id)</span> &#123;</span><br><span class="line">        bannerService.removeById(id);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改 BannerService.java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * &lt;p&gt;</span><br><span class="line"> * 首页banner表 服务类</span><br><span class="line"> * &lt;/p&gt;</span><br><span class="line"> *</span><br><span class="line"> * @author BNTang</span><br><span class="line"> * @since 2021-05-15</span><br><span class="line"> */</span><br><span class="line">public interface BannerService extends IService&lt;Banner&gt; &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 查询所有banner</span><br><span class="line">     *</span><br><span class="line">     * @return banner信息</span><br><span class="line">     */</span><br><span class="line">    List&lt;Banner&gt; selectAllBanner();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改 BannerServiceImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 首页banner表 服务实现类</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2021-05-15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BannerServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;BannerMapper, Banner&gt; <span class="keyword">implements</span> <span class="title class_">BannerService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Cacheable(value = &quot;banner&quot;, key = &quot;&#x27;selectIndexList&#x27;&quot;)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Banner&gt; <span class="title function_">selectAllBanner</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 根据id进行降序排列，显示排列之后前两条记录</span></span><br><span class="line">        QueryWrapper&lt;Banner&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.orderByDesc(<span class="string">&quot;id&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// last方法，拼接sql语句</span></span><br><span class="line">        wrapper.last(<span class="string">&quot;limit 3&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> baseMapper.selectList(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在如上的 BannerServiceImpl 当中添加了 Redis 缓存</p>
<h3 id="SpringBoot-中-Redis-缓存注解介绍"><a href="#SpringBoot-中-Redis-缓存注解介绍" class="headerlink" title="SpringBoot 中 Redis 缓存注解介绍"></a>SpringBoot 中 Redis 缓存注解介绍</h3><h4 id="Cacheable"><a href="#Cacheable" class="headerlink" title="@Cacheable"></a>@Cacheable</h4><h5 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h5><p>根据方法对其返回结果进行缓存，下次请求时，如果缓存存在，则直接读取缓存数据返回；如果缓存不存在，则执行方法，并把返回的结果存入缓存中。</p>
<h5 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h5><ul>
<li>value：缓存名，必填，它指定了你的缓存存放在哪块命名空间。</li>
<li>cacheNames：与 value 差不多，二选一即可。</li>
<li>key：可选属性，可以使用 SpEL 标签自定义缓存的 key。</li>
</ul>
<h4 id="CachePut"><a href="#CachePut" class="headerlink" title="@CachePut"></a>@CachePut</h4><h5 id="作用-1"><a href="#作用-1" class="headerlink" title="作用"></a>作用</h5><p>使用该注解标志的方法，每次都会执行，并将结果存入指定的缓存中。其他方法可以直接从响应的缓存中读取缓存数据，而不需要再去查询数据库。一般用在新增方法上。</p>
<h5 id="属性-1"><a href="#属性-1" class="headerlink" title="属性"></a>属性</h5><ul>
<li>value：缓存名，必填，它指定了你的缓存存放在哪块命名空间。</li>
<li>cacheNames：与 value 差不多，二选一即可。</li>
<li>key：可选属性，可以使用 SpEL 标签自定义缓存的 key。</li>
</ul>
<h4 id="CacheEvict"><a href="#CacheEvict" class="headerlink" title="@CacheEvict"></a>@CacheEvict</h4><h5 id="作用-2"><a href="#作用-2" class="headerlink" title="作用"></a>作用</h5><p>使用该注解标志的方法，会清空指定的缓存。一般用在更新或者删除方法上。</p>
<h5 id="属性-2"><a href="#属性-2" class="headerlink" title="属性"></a>属性</h5><ul>
<li>value：缓存名，必填，它指定了你的缓存存放在哪块命名空间。</li>
<li>cacheNames：与 value 差不多，二选一即可。</li>
<li>key：可选属性，可以使用 SpEL 标签自定义缓存的 key。</li>
<li>allEntries：是否清空所有缓存，默认为 false。如果指定为 true，则方法调用后将立即清空所有的缓存。</li>
<li>beforeInvocation：是否在方法执行前就清空，默认为 false。如果指定为 true，则在方法执行前就会清空缓存。</li>
</ul>
<p>示例如上的代码参考即可</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210516001645385-1857554220.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210516001645385-1857554220.png" alt="img"></a></p>
<h3 id="banner-前端数据显示"><a href="#banner-前端数据显示" class="headerlink" title="banner 前端数据显示"></a>banner 前端数据显示</h3><p>创建 api 文件夹，创建 banner.js 文件内容如下</p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">getList</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&quot;/service_cms/banner/getAllBanner&quot;</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">      <span class="attr">headers</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在首页面引入，调用实现, 引入 banner.js</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210516092155209-1660948041.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210516092155209-1660948041.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> banner <span class="keyword">from</span> <span class="string">&quot;@/api/banner&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>在 data 当中定义 <code>bannerList: &#123;&#125;</code> 初始化时加载 banner</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210516092404703-1714344597.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210516092404703-1714344597.png" alt="img"></a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">initBanner</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">  <span class="title function_">initBanner</span>(<span class="params"></span>) &#123;</span><br><span class="line">    banner.<span class="title function_">getList</span>().<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">bannerList</span> = response.<span class="property">data</span>.<span class="property">list</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="页面渲染"><a href="#页面渲染" class="headerlink" title="页面渲染"></a>页面渲染</h4><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210516092652239-2011322036.png"><br><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210516092652239-2011322036.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;warper&quot; style=&quot;position: relative&quot;&gt;</span><br><span class="line">  &lt;div class=&quot;warper_content&quot;&gt;</span><br><span class="line">    &lt;!--</span><br><span class="line">    分类</span><br><span class="line">    --&gt;</span><br><span class="line">    &lt;div class=&quot;category&quot;&gt;</span><br><span class="line">      &lt;ul&gt;</span><br><span class="line">        &lt;li v-for=&quot;(cate, index) in categoryList&quot; v-bind:key=&quot;index&quot;&gt;</span><br><span class="line">          &lt;div class=&quot;coursex-item1&quot;&gt;</span><br><span class="line">            &lt;a class=&quot;shuang&quot;&gt;&#123;&#123; cate.title &#125;&#125;&lt;/a&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;swiper :options=&quot;swiperOptions&quot; class=&quot;swiper-cus&quot;&gt;</span><br><span class="line">      &lt;swiper-slide v-for=&quot;banner in bannerList&quot; :key=&quot;banner.id&quot; :style=&quot;&#123;background:banner.imageBg&#125;&quot;&gt;</span><br><span class="line">        &lt;a target=&quot;_blank&quot; :href=&quot;banner.linkUrl&quot;&gt;</span><br><span class="line">          &lt;img width=&quot;1200&quot; height=&quot;380&quot; style=&quot;min-height: 380px;&quot;</span><br><span class="line">               :src=&quot;banner.imageUrl&quot;</span><br><span class="line">               :alt=&quot;banner.title&quot;/&gt;</span><br><span class="line">        &lt;/a&gt;</span><br><span class="line">      &lt;/swiper-slide&gt;</span><br><span class="line">      &lt;div class=&quot;swiper-pagination swiper-pagination-white&quot; slot=&quot;pagination&quot;&gt;&lt;/div&gt;</span><br><span class="line">      &lt;div style=&quot;left: 200px;&quot; class=&quot;swiper-button-prev swiper-button-white&quot; slot=&quot;button-prev&quot;&gt;&lt;/div&gt;</span><br><span class="line">      &lt;div style=&quot;right: 200px&quot; class=&quot;swiper-button-next swiper-button-white&quot; slot=&quot;button-next&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;/swiper&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<h2 id="49-前端门户-门户首页数据显示"><a href="#49-前端门户-门户首页数据显示" class="headerlink" title="49-前端门户-门户首页数据显示"></a>49-前端门户-门户首页数据显示</h2><h3 id="修改-service-video-模块"><a href="#修改-service-video-模块" class="headerlink" title="修改 service_video 模块"></a>修改 service_video 模块</h3><p>在后台当中创建门户首页接口</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210516093211715-1634444494.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210516093211715-1634444494.png" alt="img"></a></p>
<h4 id="创建-IndexPortalController-java"><a href="#创建-IndexPortalController-java" class="headerlink" title="创建 IndexPortalController.java"></a>创建 IndexPortalController.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/service_video/index&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;门户首页组&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IndexPortalController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> IndexPortalService indexPortalService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取门户首页所有数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/getIndexData&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">index</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok()</span><br><span class="line">                .data(<span class="string">&quot;contentList&quot;</span>, indexPortalService.getContentIndexList())</span><br><span class="line">                .data(<span class="string">&quot;authorList&quot;</span>, indexPortalService.getAuthorIndexList())</span><br><span class="line">                .data(<span class="string">&quot;categoryList&quot;</span>, indexPortalService.getCategoryIndexList());</span><br><span class="line">    &#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h4><p>创建 IndexPortalService.jav</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IndexPortalService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取作品</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 作品列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Object <span class="title function_">getContentIndexList</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取创作者</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 创作者</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Object <span class="title function_">getAuthorIndexList</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取作品分类</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 分类</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Object <span class="title function_">getCategoryIndexList</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="实现类"><a href="#实现类" class="headerlink" title="实现类"></a>实现类</h4><p>创建 IndexPortalServiceImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IndexPortalServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IndexPortalService</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ContentService contentService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> AuthorService authorService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> CategoryService categoryService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Cacheable(value = &quot;index&quot;, key = &quot;&#x27;getContentIndexList&#x27;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Content&gt; <span class="title function_">getContentIndexList</span><span class="params">()</span> &#123;</span><br><span class="line">        QueryWrapper&lt;Content&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.orderByDesc(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">        wrapper.last(<span class="string">&quot;limit 8&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> contentService.list(wrapper);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Cacheable(value = &quot;index&quot;, key = &quot;&#x27;getAuthorIndexList&#x27;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Author&gt; <span class="title function_">getAuthorIndexList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 查询前4条作者</span></span><br><span class="line">        QueryWrapper&lt;Author&gt; wrapperAuthor = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapperAuthor.orderByDesc(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">        wrapperAuthor.last(<span class="string">&quot;limit 4&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> authorService.list(wrapperAuthor);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Cacheable(value = &quot;index&quot;, key = &quot;&#x27;getCategoryIndexList&#x27;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Category&gt; <span class="title function_">getCategoryIndexList</span><span class="params">()</span> &#123;</span><br><span class="line">        QueryWrapper&lt;Category&gt; wrapperCategory = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapperCategory.orderByDesc(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">        wrapperCategory.eq(<span class="string">&quot;parent_id&quot;</span>, <span class="string">&quot;0&quot;</span>);</span><br><span class="line">        wrapperCategory.last(<span class="string">&quot;limit 8&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> categoryService.list(wrapperCategory);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="前端-7"><a href="#前端-7" class="headerlink" title="前端"></a>前端</h3><p>在门户工程 api 当中创建 index.js 文件</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210516114357488-916655376.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210516114357488-916655376.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">getList</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`/service_video/index/getIndexData`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">      <span class="attr">headers</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在首页面引入，调用实现</p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> index <span class="keyword">from</span> <span class="string">&#x27;@/api/index&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210516114453684-843855904.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210516114453684-843855904.png" alt="img"></a></p>
<p>定义数据结果集</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210516114652148-1392501304.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210516114652148-1392501304.png" alt="img"></a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">categoryList</span>: &#123;&#125;,</span><br><span class="line"><span class="attr">authorList</span>: &#123;&#125;,</span><br><span class="line"><span class="attr">contentList</span>: &#123;&#125;,</span><br></pre></td></tr></table></figure>

<h4 id="请求数据"><a href="#请求数据" class="headerlink" title="请求数据"></a>请求数据</h4><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210516114751818-8177583.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210516114751818-8177583.png" alt="img"></a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="title function_">initIndexData</span>();</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">initIndexData</span>(<span class="params"></span>) &#123;</span><br><span class="line">  index.<span class="title function_">getList</span>().<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">authorList</span> = response.<span class="property">data</span>.<span class="property">authorList</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">contentList</span> = response.<span class="property">data</span>.<span class="property">contentList</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">categoryList</span> = response.<span class="property">data</span>.<span class="property">categoryList</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="渲染数据"><a href="#渲染数据" class="headerlink" title="渲染数据"></a>渲染数据</h4><h5 id="渲染分类"><a href="#渲染分类" class="headerlink" title="渲染分类"></a>渲染分类</h5><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210516115042258-1648395848.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210516115042258-1648395848.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;category&quot;&gt;</span><br><span class="line">  &lt;ul&gt;</span><br><span class="line">    &lt;li v-for=&quot;(cate, index) in categoryList&quot; v-bind:key=&quot;index&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;coursex-item1&quot;&gt;</span><br><span class="line">        &lt;a class=&quot;shuang&quot;&gt;&#123;&#123; cate.title &#125;&#125;&lt;/a&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/li&gt;</span><br><span class="line">  &lt;/ul&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<h5 id="渲染视频"><a href="#渲染视频" class="headerlink" title="渲染视频"></a>渲染视频</h5><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210516115154298-2011849339.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210516115154298-2011849339.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=&quot;videoList&quot;&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;section class=&quot;container&quot;&gt;</span><br><span class="line">      &lt;header class=&quot;comm-title&quot;&gt;</span><br><span class="line">        &lt;h2 class=&quot;tac&quot;&gt;</span><br><span class="line">          &lt;span class=&quot;c-333&quot; style=&quot;float:left; border-left: 3px solid red; padding-left: 10px;&quot;&gt;热门视频&lt;/span&gt;</span><br><span class="line">          &lt;span class=&quot;c-333&quot; style=&quot;float:right; font-size: 18px; &quot;&gt;&lt;a href=&quot;#&quot;&gt;更多&lt;/a&gt;&lt;/span&gt;</span><br><span class="line">        &lt;/h2&gt;</span><br><span class="line">      &lt;/header&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;article class=&quot;comm-video-list&quot;&gt;</span><br><span class="line">          &lt;ul&gt;</span><br><span class="line">            &lt;li v-for=&quot;(content,index) in contentList&quot; class=&quot;fl&quot; v-bind:key=&quot;index&quot;&gt;</span><br><span class="line">              &lt;div class=&quot;cc-l-wrap&quot;&gt;</span><br><span class="line">                &lt;section class=&quot;video-img&quot;&gt;</span><br><span class="line">                  &lt;img style=&quot;width: 100%;height: 100%&quot;</span><br><span class="line">                       :src=&quot;content.cover&quot;</span><br><span class="line">                       class=&quot;img-responsive&quot;</span><br><span class="line">                  &gt;</span><br><span class="line">                  &lt;div class=&quot;cc-mask&quot;&gt;</span><br><span class="line">                    &lt;a :href=&quot;&#x27;/video/&#x27;+content.id&quot; class=&quot;comm-btn c-btn-1&quot;&gt;播放&lt;/a&gt;</span><br><span class="line">                  &lt;/div&gt;</span><br><span class="line">                &lt;/section&gt;</span><br><span class="line">                &lt;h3 class=&quot;hLh30 txtOf mt10&quot;&gt;</span><br><span class="line">                  &lt;a href=&quot;#&quot; class=&quot;course-title fsize18 c-333&quot;&gt;&#123;&#123; content.title &#125;&#125;&lt;/a&gt;</span><br><span class="line">                &lt;/h3&gt;</span><br><span class="line">                &lt;section class=&quot;mt10 hLh20 of&quot;&gt;</span><br><span class="line">                  &lt;span class=&quot;fr jgTag bg-orangered&quot; v-if=&quot;Number(content.price) === 0&quot;&gt;</span><br><span class="line">                    &lt;i class=&quot;c-fff fsize12 f-fA&quot;&gt;免费&lt;/i&gt;</span><br><span class="line">                    &lt;/span&gt;</span><br><span class="line">                  &lt;span class=&quot;fr jgTag bg-orangered&quot; v-else&gt;</span><br><span class="line">                      &lt;i class=&quot;c-fff fsize12 f-fA&quot;&gt; ￥&#123;&#123; content.price &#125;&#125;&lt;/i&gt;</span><br><span class="line">                    &lt;/span&gt;</span><br><span class="line">                  &lt;span class=&quot;fl jgAttr c-ccc f-fA&quot;&gt;</span><br><span class="line">                    &lt;i class=&quot;c-999 f-fA&quot;&gt;&#123;&#123; content.buyCount &#125;&#125; 人学习&lt;/i&gt;|</span><br><span class="line">                    &lt;i class=&quot;c-999 f-fA&quot;&gt;&#123;&#123; content.viewCount &#125;&#125; 人浏览&lt;/i&gt;</span><br><span class="line">                    &lt;/span&gt;</span><br><span class="line">                &lt;/section&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">          &lt;/ul&gt;</span><br><span class="line">        &lt;/article&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/section&gt;</span><br><span class="line">  &lt;/div&gt;</span><br></pre></td></tr></table></figure>

<h5 id="渲染作者"><a href="#渲染作者" class="headerlink" title="渲染作者"></a>渲染作者</h5><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210516115250887-303572701.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210516115250887-303572701.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;section class=&quot;container&quot;&gt;</span><br><span class="line">    &lt;header class=&quot;comm-title&quot;&gt;</span><br><span class="line">      &lt;h2 class=&quot;tac&quot;&gt;</span><br><span class="line">        &lt;span class=&quot;c-333&quot; style=&quot;float:left; border-left: 3px solid red; padding-left: 10px;&quot;&gt;优秀创作者&lt;/span&gt;</span><br><span class="line">        &lt;span class=&quot;c-333&quot; style=&quot;float:right; font-size: 18px; &quot;&gt;&lt;a href=&quot;#&quot;&gt;更多&lt;/a&gt;&lt;/span&gt;</span><br><span class="line">      &lt;/h2&gt;</span><br><span class="line">    &lt;/header&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;article class=&quot;i-author-list&quot;&gt;</span><br><span class="line">        &lt;div v-for=&quot;(author,index) in authorList&quot; v-bind:key=&quot;index&quot; class=&quot;yd-open-course-card open-course-card&quot;&gt;</span><br><span class="line">          &lt;a :href=&#x27;&quot;/author/&quot;+author.id&#x27; :title=&quot;index.name&quot; style=&quot;color: #7F828B;text-decoration:none;&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;yd-open-course-card_avatar&quot;&gt;</span><br><span class="line">              &lt;img :alt=&quot;author.name&quot; :src=&quot;author.avatar&quot;/&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div class=&quot;yd-open-course-card_content_teacher&quot;&gt;</span><br><span class="line">              &lt;div class=&quot;yd-open-course-card_content_teacher_tag&quot;&gt;&#123;&#123; author.name &#125;&#125;&lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div&gt;&#123;&#123; author.intro &#125;&#125;&lt;/div&gt;</span><br><span class="line">            &lt;span&gt;-------------------------&lt;/span&gt;</span><br><span class="line">            &lt;div&gt;&#123;&#123; author.career &#125;&#125;&lt;/div&gt;</span><br><span class="line">          &lt;/a&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;</span><br><span class="line">      &lt;/article&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/section&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<h2 id="50-门户登录-用户前端登录注册"><a href="#50-门户登录-用户前端登录注册" class="headerlink" title="50-门户登录-用户前端登录注册"></a>50-门户登录-用户前端登录注册</h2><p>登录与注册按钮点击跳转到指定的页面处，如下图</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210520221524363-748223496.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210520221524363-748223496.png" alt="img"></a></p>
<p>在 Layout 当中添加新布局 <code>loginLayout.vue</code> 如下图</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210520231239311-369371634.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210520231239311-369371634.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;login&quot;&gt;</span><br><span class="line">    &lt;!--头部布局--&gt;</span><br><span class="line">    &lt;header id=&quot;header&quot;&gt;</span><br><span class="line">      &lt;section class=&quot;container&quot;&gt;</span><br><span class="line">        &lt;h1 id=&quot;logo&quot;&gt;</span><br><span class="line">          &lt;a href=&quot;#&quot; title=&quot;BNTang&quot;&gt;</span><br><span class="line">            &lt;img src=&quot;~/assets/img/logo.png&quot; height=&quot;100px&quot; alt=&quot;BNTang&quot;&gt;</span><br><span class="line">          &lt;/a&gt;</span><br><span class="line">        &lt;/h1&gt;</span><br><span class="line">        &lt;div class=&quot;h-r-nsl&quot;&gt;</span><br><span class="line">          &lt;!--导航--&gt;</span><br><span class="line">          &lt;ul class=&quot;nav&quot;&gt;</span><br><span class="line">            &lt;router-link to=&quot;/&quot; tag=&quot;li&quot; active-class=&quot;current&quot; exact&gt;</span><br><span class="line">              &lt;a&gt;首页&lt;/a&gt;</span><br><span class="line">            &lt;/router-link&gt;</span><br><span class="line">            &lt;router-link to=&quot;/video&quot; tag=&quot;li&quot; active-class=&quot;current&quot;&gt;</span><br><span class="line">              &lt;a&gt;全部视频&lt;/a&gt;</span><br><span class="line">            &lt;/router-link&gt;</span><br><span class="line">            &lt;router-link to=&quot;/author&quot; tag=&quot;li&quot; active-class=&quot;current&quot;&gt;</span><br><span class="line">              &lt;a&gt;创作者&lt;/a&gt;</span><br><span class="line">            &lt;/router-link&gt;</span><br><span class="line">            &lt;router-link to=&quot;/article&quot; tag=&quot;li&quot; active-class=&quot;current&quot;&gt;</span><br><span class="line">              &lt;a&gt;资讯信息&lt;/a&gt;</span><br><span class="line">            &lt;/router-link&gt;</span><br><span class="line">            &lt;router-link to=&quot;/qa&quot; tag=&quot;li&quot; active-class=&quot;current&quot;&gt;</span><br><span class="line">              &lt;a&gt;学习交流&lt;/a&gt;</span><br><span class="line">            &lt;/router-link&gt;</span><br><span class="line">          &lt;/ul&gt;</span><br><span class="line">          &lt;!--搜索--&gt;</span><br><span class="line">          &lt;aside class=&quot;h-r-search&quot;&gt;</span><br><span class="line">            &lt;form action=&quot;#&quot; method=&quot;post&quot;&gt;</span><br><span class="line">              &lt;label class=&quot;h-r-s-box&quot;&gt;</span><br><span class="line">                &lt;input type=&quot;text&quot; placeholder=&quot;搜索...&quot; name=&quot;queryCourse.courseName&quot; value&gt;</span><br><span class="line">                &lt;button type=&quot;submit&quot; class=&quot;s-btn&quot;&gt;</span><br><span class="line">                  &lt;em class=&quot;icon18&quot;&gt;&amp;nbsp;&lt;/em&gt;</span><br><span class="line">                &lt;/button&gt;</span><br><span class="line">              &lt;/label&gt;</span><br><span class="line">            &lt;/form&gt;</span><br><span class="line">          &lt;/aside&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;aside class=&quot;mw-nav-btn&quot;&gt;</span><br><span class="line">          &lt;div class=&quot;mw-nav-icon&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;/aside&gt;</span><br><span class="line">        &lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;</span><br><span class="line">      &lt;/section&gt;</span><br><span class="line">    &lt;/header&gt;</span><br><span class="line">    &lt;!--页面信息--&gt;</span><br><span class="line">    &lt;nuxt/&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;loginLayout&quot;,</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">#logo a img&#123;</span><br><span class="line">  width: 110px !important;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>在 pages 文件夹下，创建登录与注册页面</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210522085141573-616418148.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210522085141573-616418148.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;main&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;login-up-container&quot;&gt;</span><br><span class="line">      &lt;el-tabs v-model=&quot;activeName&quot;  @tab-click=&quot;handleClick&quot;&gt;</span><br><span class="line">        &lt;el-tab-pane label=&quot;用户登录&quot; name=&quot;first&quot;&gt;&lt;/el-tab-pane&gt;</span><br><span class="line">        &lt;el-tab-pane label=&quot;立即注册&quot; name=&quot;second&quot;&gt;&lt;/el-tab-pane&gt;</span><br><span class="line">        &lt;div class=&quot;login-up-container&quot;&gt;</span><br><span class="line">          &lt;el-form ref=&quot;userForm&quot; :model=&quot;params&quot;&gt;</span><br><span class="line">            &lt;!--用户昵称--&gt;</span><br><span class="line">            &lt;el-form-item class=&quot;input-prepend restyle&quot; prop=&quot;nickname&quot;</span><br><span class="line">                          v-if=&quot;!isLogin&quot;&gt;</span><br><span class="line">              &lt;div&gt;</span><br><span class="line">                &lt;el-input type=&quot;text&quot; placeholder=&quot;用户昵称&quot; v-model=&quot;params.nickname&quot;/&gt;</span><br><span class="line">                &lt;i class=&quot;iconfont icon-user&quot;/&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">            &lt;!--用户手机号--&gt;</span><br><span class="line">            &lt;el-form-item class=&quot;input-prepend restyle no-radius&quot;&gt;</span><br><span class="line">              &lt;div&gt;</span><br><span class="line">                &lt;el-input type=&quot;text&quot; placeholder=&quot;手机号&quot; v-model=&quot;params.phone&quot; /&gt;</span><br><span class="line">                &lt;i class=&quot;iconfont icon-phone&quot;/&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">            &lt;!--用户密码--&gt;</span><br><span class="line">            &lt;el-form-item class=&quot;input-prepend restyle no-radius&quot; prop=&quot;password&quot;</span><br><span class="line">                          v-if=&quot;isLogin&quot;&gt;</span><br><span class="line">              &lt;div&gt;</span><br><span class="line">                &lt;el-input type=&quot;text&quot; placeholder=&quot;用户密码&quot;</span><br><span class="line">                          v-model=&quot;params.password&quot; /&gt;</span><br><span class="line">                &lt;i class=&quot;iconfont icon-password&quot;/&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">            &lt;!--验证码--&gt;</span><br><span class="line">            &lt;el-form-item class=&quot;input-prepend restyle no-radius&quot; prop=&quot;code&quot;</span><br><span class="line">                          v-if=&quot;!isLogin&quot;&gt;</span><br><span class="line">              &lt;div style=&quot;width: 100%;display: block;float: left;position: relative&quot;&gt;</span><br><span class="line">                &lt;el-input type=&quot;text&quot; placeholder=&quot;验证码&quot;</span><br><span class="line">                          v-model=&quot;params.code&quot;/&gt;</span><br><span class="line">                &lt;i class=&quot;iconfont icon-phone&quot;/&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">              &lt;div class=&quot;btn&quot; style=&quot;position:absolute;right: -10px;top: 6px;width: 40%;&quot;&gt;</span><br><span class="line">                &lt;a href=&quot;javascript:&quot; type=&quot;button&quot;</span><br><span class="line">                   @click=&quot;getCodeFun()&quot;</span><br><span class="line">                   :value=&quot;codeValue&quot; style=&quot;color: orangered&quot;&gt;</span><br><span class="line">                  &#123;&#123;codeValue&#125;&#125;</span><br><span class="line">                &lt;/a&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line">            &lt;!--设置密码--&gt;</span><br><span class="line">            &lt;el-form-item class=&quot;input-prepend&quot; prop=&quot;password&quot; v-if=&quot;!isLogin&quot;&gt;</span><br><span class="line">              &lt;div&gt;</span><br><span class="line">                &lt;el-input type=&quot;password&quot; placeholder=&quot;设置密码&quot; v-model=&quot;params.password&quot;/&gt;</span><br><span class="line">                &lt;i class=&quot;iconfont icon-password&quot;/&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">            &lt;/el-form-item&gt;</span><br><span class="line"></span><br><span class="line">            &lt;div class=&quot;btn&quot;&gt;</span><br><span class="line">              &lt;input type=&quot;button&quot; v-model=&quot;btn_value&quot; class=&quot;login-up-button&quot; @click=&quot;btnClick()&quot;&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;p class=&quot;login-up-msg&quot; v-if=&quot;!isLogin&quot;&gt;</span><br><span class="line">              点击 “注册” 即表示您同意并愿意遵守简书</span><br><span class="line">              &lt;br&gt;</span><br><span class="line">              &lt;a target=&quot;_blank&quot; href=&quot;http://www.jianshu.com/p/c44d171298ce&quot;&gt;用户协议&lt;/a&gt;</span><br><span class="line">              和</span><br><span class="line">              &lt;a target=&quot;_blank&quot; href=&quot;http://www.jianshu.com/p/2ov8x3&quot;&gt;隐私政策&lt;/a&gt; 。</span><br><span class="line">            &lt;/p&gt;</span><br><span class="line">          &lt;/el-form&gt;</span><br><span class="line">          &lt;!-- 更多注册方式 --&gt;</span><br><span class="line">          &lt;div class=&quot;more-sign&quot;&gt;</span><br><span class="line">            &lt;h6&gt;社交帐号直接注册&lt;/h6&gt;</span><br><span class="line">            &lt;ul&gt;</span><br><span class="line">              &lt;li&gt;</span><br><span class="line">                &lt;a id=&quot;weixin&quot; class=&quot;weixin&quot; target=&quot;_blank&quot;</span><br><span class="line">                   href=&quot;http://huaan.free.idcfengye.com/api/ucenter/wx/login&quot;&gt;</span><br><span class="line">                  &lt;i class=&quot;iconfont icon-weixin&quot;/&gt;&lt;/a&gt;</span><br><span class="line">              &lt;/li&gt;</span><br><span class="line">              &lt;li&gt;</span><br><span class="line">                &lt;a id=&quot;qq&quot; class=&quot;qq&quot; target=&quot;_blank&quot; href=&quot;#&quot;&gt;&lt;i class=&quot;iconfont icon-qq&quot;/&gt;&lt;/a&gt;</span><br><span class="line">              &lt;/li&gt;</span><br><span class="line">            &lt;/ul&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/el-tabs&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#x27;assets/css/login.css&#x27;</span><br><span class="line">import &#x27;~/assets/css/iconfont.css&#x27;</span><br><span class="line">export default &#123;</span><br><span class="line">  layout: &#x27;loginLayout&#x27;,</span><br><span class="line">  data () &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      // 记录当前是否为登录状态</span><br><span class="line">      isLogin:true,</span><br><span class="line">      // 记录当前选择的tabs</span><br><span class="line">      activeName: &#x27;first&#x27;,</span><br><span class="line">      // 封装注册输入数据</span><br><span class="line">      params: &#123;</span><br><span class="line">        phone: &#x27;&#x27;,</span><br><span class="line">        // 验证码</span><br><span class="line">        code: &#x27;&#x27;,</span><br><span class="line">        // 用户昵称</span><br><span class="line">        nickname: &#x27;&#x27;,</span><br><span class="line">        password: &#x27;&#x27;</span><br><span class="line">      &#125;,</span><br><span class="line">      // 是否发送验证码</span><br><span class="line">      isSend: true,</span><br><span class="line">      // 倒计时间</span><br><span class="line">      second: 60,        </span><br><span class="line">      codeValue: &#x27;获取验证码&#x27;,</span><br><span class="line">      btn_value:&#x27;登录&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    handleClick(tab, event) &#123;</span><br><span class="line">      if (tab.index == 0)&#123;</span><br><span class="line">        this.isLogin = true;</span><br><span class="line">        this.btn_value = &quot;登录&quot;;</span><br><span class="line">      &#125;else &#123;</span><br><span class="line">        this.isLogin = false;</span><br><span class="line">        this.btn_value = &quot;注册&quot;;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    checkPhone (rule, value, callback) &#123;</span><br><span class="line">      if (!(/^1[34578]\d&#123;9&#125;$/.test(value))) &#123;</span><br><span class="line">        return callback(new Error(&#x27;手机号码格式不正确&#x27;));</span><br><span class="line">      &#125;</span><br><span class="line">      return callback();</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>在 api 当中创建 <code>login.js</code> 与 <code>regist.js</code></p>
<h3 id="login-js"><a href="#login-js" class="headerlink" title="login.js"></a>login.js</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// 登录</span></span><br><span class="line">  <span class="title function_">login</span>(<span class="params">userInfo</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`/service_user/user/login`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: userInfo</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 根据token获取用户信息</span></span><br><span class="line">  <span class="title function_">getLoginInfo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`/service_user/user/auth/getLoginInfo`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 验证是否已经登录</span></span><br><span class="line">  <span class="title function_">checkLogin</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`/service_user/user/wx/checkLogin`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="register-js"><a href="#register-js" class="headerlink" title="register.js"></a>register.js</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// 根据手机号发验证码</span></span><br><span class="line">  <span class="title function_">sendCode</span>(<span class="params">phone</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`/service_sms/api/sms/send/<span class="subst">$&#123;phone&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 注册的方法</span></span><br><span class="line">  <span class="title function_">register</span>(<span class="params">formItem</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`/service_user/user/register`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: formItem</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 login.vue 页面当中引入 api 中创建的如上的两个 js 文件</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210522085638330-1514720477.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210522085638330-1514720477.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> registerApi <span class="keyword">from</span> <span class="string">&quot;@/api/register&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> loginApi <span class="keyword">from</span> <span class="string">&quot;@/api/login&quot;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="获取验证码"><a href="#获取验证码" class="headerlink" title="获取验证码"></a>获取验证码</h3><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210522090233941-626821839.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210522090233941-626821839.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210522092314171-1184001901.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210522092314171-1184001901.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取验证码</span></span><br><span class="line"><span class="title function_">timeDown</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> result = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    --<span class="variable language_">this</span>.<span class="property">second</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">codeValue</span> = <span class="variable language_">this</span>.<span class="property">second</span>+<span class="string">&quot;秒后重发&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">second</span> &lt; <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="built_in">clearInterval</span>(result);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">isSend</span> = <span class="literal">true</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">second</span> = <span class="number">60</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">codeValue</span> = <span class="string">&quot;获取验证码&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 通过输入的手机号发送验证码</span></span><br><span class="line"><span class="title function_">getCodeFun</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isSend</span>)&#123;</span><br><span class="line">    registerApi.<span class="title function_">sendCode</span>(<span class="variable language_">this</span>.<span class="property">params</span>.<span class="property">phone</span>)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 调用倒计时的方法</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">timeDown</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">isSend</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">// 提示注册成功</span></span><br><span class="line">        <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">          <span class="attr">message</span>: <span class="string">&quot;短信发送成功&quot;</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="注册功能"><a href="#注册功能" class="headerlink" title="注册功能"></a>注册功能</h3><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210522093938670-1909220464.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210522093938670-1909220464.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210522094100075-1068321921.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210522094100075-1068321921.png" alt="img"></a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">btnClick</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 登录</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isLogin</span>)&#123;</span><br><span class="line"></span><br><span class="line">  &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 注册</span></span><br><span class="line">    registerApi.<span class="title function_">register</span>(<span class="variable language_">this</span>.<span class="property">params</span>).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 提示注册成功</span></span><br><span class="line">        <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">          <span class="attr">message</span>: <span class="string">&quot;注册成功&quot;</span></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 跳转登录页面</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">activeName</span> = <span class="string">&quot;first&quot;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">isLogin</span> = <span class="literal">true</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">btn_value</span> = <span class="string">&quot;登录&quot;</span>;</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h3 id="登录功能"><a href="#登录功能" class="headerlink" title="登录功能"></a>登录功能</h3><h4 id="安装-js-cookie-插件"><a href="#安装-js-cookie-插件" class="headerlink" title="安装 js-cookie 插件"></a>安装 js-cookie 插件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install js-cookie</span><br></pre></td></tr></table></figure>

<p>引入 js-cookie</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210522094416646-1639153066.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210522094416646-1639153066.png" alt="img"></a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cookie <span class="keyword">from</span> <span class="string">&#x27;js-cookie&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>登录逻辑</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210522094555784-1920242010.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210522094555784-1920242010.png" alt="img"></a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">loginApi.<span class="title function_">login</span>(<span class="variable language_">this</span>.<span class="property">params</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(res.<span class="property">success</span>)&#123;</span><br><span class="line">    <span class="comment">// 把token存在cookie中</span></span><br><span class="line">    cookie.<span class="title function_">set</span>(<span class="string">&#x27;login_token&#x27;</span>, res.<span class="property">data</span>.<span class="property">token</span>, &#123; <span class="attr">domain</span>: <span class="string">&#x27;localhost&#x27;</span> &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 登录成功根据token获取用户信息</span></span><br><span class="line">    loginApi.<span class="title function_">getLoginInfo</span>().<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 将用户信息记录cookie</span></span><br><span class="line">      cookie.<span class="title function_">set</span>(<span class="string">&#x27;portal_user&#x27;</span>, response.<span class="property">data</span>.<span class="property">userInfo</span>, &#123; <span class="attr">domain</span>: <span class="string">&#x27;localhost&#x27;</span> &#125;);</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 跳转页面</span></span><br><span class="line">      <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = <span class="string">&quot;/&quot;</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="首页中用户信息显示"><a href="#首页中用户信息显示" class="headerlink" title="首页中用户信息显示"></a>首页中用户信息显示</h3><p>定义属性信息</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210523213131867-6780759.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210523213131867-6780759.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">loginInfo</span>: &#123;</span><br><span class="line">      <span class="attr">id</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      <span class="attr">avatar</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      <span class="attr">nickname</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>在 created 方法当中加载用户信息</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210523213450993-944335052.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210523213450993-944335052.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">showInfo</span>();</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">  <span class="title function_">showInfo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> jsonStr = cookie.<span class="title function_">get</span>(<span class="string">&quot;portal_user&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (jsonStr) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">loginInfo</span> = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(jsonStr);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">logout</span>(<span class="params"></span>) &#123;</span><br><span class="line">    cookie.<span class="title function_">set</span>(<span class="string">&#x27;portal_user&#x27;</span>, <span class="string">&quot;&quot;</span>, &#123;<span class="attr">domain</span>: <span class="string">&#x27;localhost&#x27;</span>&#125;);</span><br><span class="line">    cookie.<span class="title function_">set</span>(<span class="string">&#x27;login_token&#x27;</span>, <span class="string">&quot;&quot;</span>, &#123;<span class="attr">domain</span>: <span class="string">&#x27;localhost&#x27;</span>&#125;);</span><br><span class="line">    <span class="comment">// 跳转页面</span></span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = <span class="string">&quot;/&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在首页当中显示登录成功之后的用户信息</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210523213632174-737565404.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210523213632174-737565404.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul class=&quot;h-r-login&quot;&gt;</span><br><span class="line">  &lt;li v-if=&quot;!loginInfo.id&quot; id=&quot;no-login&quot;&gt;</span><br><span class="line">    &lt;a href=&quot;/login&quot;&gt;</span><br><span class="line">      &lt;em class=&quot;icon18 login-icon&quot;&gt;&amp;nbsp;&lt;/em&gt;</span><br><span class="line">      &lt;span class=&quot;vam ml5&quot;&gt;登录&lt;/span&gt;</span><br><span class="line">    &lt;/a&gt;</span><br><span class="line">    |</span><br><span class="line">    &lt;a href=&quot;/register&quot;&gt;</span><br><span class="line">      &lt;span class=&quot;vam ml5&quot;&gt;注册&lt;/span&gt;</span><br><span class="line">    &lt;/a&gt;</span><br><span class="line">  &lt;/li&gt;</span><br><span class="line">  &lt;!--退出--&gt;</span><br><span class="line">  &lt;li v-if=&quot;loginInfo.id&quot; id=&quot;is-login-two&quot; class=&quot;h-r-user&quot;&gt;</span><br><span class="line">    &lt;a href=&quot;#&quot; title&gt;</span><br><span class="line">      &lt;img</span><br><span class="line">        :src=&quot;loginInfo.avatar&quot;</span><br><span class="line">        width=&quot;30&quot;</span><br><span class="line">        height=&quot;30&quot;</span><br><span class="line">        class=&quot;vam picImg&quot;</span><br><span class="line">        alt</span><br><span class="line">      &gt;</span><br><span class="line">      &lt;span id=&quot;userName&quot; class=&quot;vam disIb&quot;&gt;&#123;&#123; loginInfo.nickname &#125;&#125;&lt;/span&gt;</span><br><span class="line">    &lt;/a&gt;</span><br><span class="line">    &lt;a href=&quot;javascript:void(0);&quot; title=&quot;退出&quot; @click=&quot;logout()&quot; class=&quot;ml5&quot;&gt;退出&lt;/a&gt;</span><br><span class="line">  &lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure>

<p>在 default.vue 当中引入 js-cookie</p>
<p>sh</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import cookie from <span class="string">&#x27;js-cookie&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>修改 utils&#x2F;request.js axios 的封装方法修改内容如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210524133116848-1661723140.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210524133116848-1661723140.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210524133136932-1012707088.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210524133136932-1012707088.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">MessageBox</span>, <span class="title class_">Message</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;element-ui&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> cookie <span class="keyword">from</span> <span class="string">&#x27;js-cookie&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> service = axios.<span class="title function_">create</span>(&#123;</span><br><span class="line">  <span class="attr">baseURL</span>: <span class="string">&#x27;http://localhost:9000&#x27;</span>,</span><br><span class="line">  <span class="comment">// request timeout</span></span><br><span class="line">  <span class="attr">timeout</span>: <span class="number">50000</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">service.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> res = response.<span class="property">data</span>;</span><br><span class="line">    <span class="keyword">if</span> (res.<span class="property">code</span> !== <span class="number">20000</span>) &#123;</span><br><span class="line">      <span class="title class_">Message</span>(&#123;</span><br><span class="line">        <span class="attr">message</span>: res.<span class="property">message</span> || <span class="string">&#x27;Error&#x27;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">        <span class="attr">duration</span>: <span class="number">5</span> * <span class="number">1000</span></span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">if</span> (res.<span class="property">code</span> === <span class="number">50008</span> || res.<span class="property">code</span> === <span class="number">50012</span> || res.<span class="property">code</span> === <span class="number">50014</span>) &#123;</span><br><span class="line">        <span class="comment">// to re-login</span></span><br><span class="line">        <span class="title class_">MessageBox</span>.<span class="title function_">confirm</span>(<span class="string">&#x27;You have been logged out, you can cancel to stay on this page, or log in again&#x27;</span>, <span class="string">&#x27;Confirm logout&#x27;</span>, &#123;</span><br><span class="line">          <span class="attr">confirmButtonText</span>: <span class="string">&#x27;Re-Login&#x27;</span>,</span><br><span class="line">          <span class="attr">cancelButtonText</span>: <span class="string">&#x27;Cancel&#x27;</span>,</span><br><span class="line">          <span class="attr">type</span>: <span class="string">&#x27;warning&#x27;</span></span><br><span class="line">        &#125;).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          store.<span class="title function_">dispatch</span>(<span class="string">&#x27;user/resetToken&#x27;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            location.<span class="title function_">reload</span>()</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(res.<span class="property">message</span> || <span class="string">&#x27;Error&#x27;</span>));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title class_">Message</span>(&#123;</span><br><span class="line">      <span class="attr">message</span>: error.<span class="property">message</span>,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">      <span class="attr">duration</span>: <span class="number">5</span> * <span class="number">1000</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">service.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(</span><br><span class="line">  <span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (cookie.<span class="title function_">get</span>(<span class="string">&#x27;login_token&#x27;</span>)) &#123;</span><br><span class="line">      config.<span class="property">headers</span>[<span class="string">&#x27;token&#x27;</span>] = cookie.<span class="title function_">get</span>(<span class="string">&#x27;login_token&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> config;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(err);</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> service;</span><br></pre></td></tr></table></figure>

<h2 id="51-门户登录-短信微服务"><a href="#51-门户登录-短信微服务" class="headerlink" title="51-门户登录-短信微服务"></a>51-门户登录-短信微服务</h2><h3 id="创建短信微服务工程"><a href="#创建短信微服务工程" class="headerlink" title="创建短信微服务工程"></a>创建短信微服务工程</h3><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210522111945091-1775632471.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210522111945091-1775632471.png" alt="img"></a></p>
<h3 id="添加配置文件-1"><a href="#添加配置文件-1" class="headerlink" title="添加配置文件"></a>添加配置文件</h3><p>application.yml</p>
<p>yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application-dev.yml</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8006</span></span><br><span class="line"></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">pattern:</span></span><br><span class="line">    <span class="attr">console:</span> <span class="string">&quot;%clr(%5p) %clr(-)&#123;faint&#125; %clr(%-80.80logger&#123;79&#125;)&#123;cyan&#125; %clr(:) %m%n&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">service-sms</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">jackson:</span></span><br><span class="line">    <span class="attr">date-format:</span> <span class="string">yyyy-MM-dd</span> <span class="string">HH:mm:ss</span></span><br><span class="line">    <span class="attr">time-zone:</span> <span class="string">GMT+8</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">timeout:</span> <span class="number">1800000</span></span><br><span class="line">    <span class="comment"># password: 1234</span></span><br><span class="line">    <span class="attr">lettuce:</span></span><br><span class="line">      <span class="attr">pool:</span></span><br><span class="line">        <span class="attr">max-active:</span> <span class="number">20</span></span><br><span class="line">        <span class="attr">max-wait:</span> <span class="number">1</span></span><br><span class="line">        <span class="comment"># 最大阻塞等待时间</span></span><br><span class="line">        <span class="attr">max-idle:</span> <span class="number">5</span></span><br><span class="line">        <span class="attr">min-idle:</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>

<h3 id="创建启动类"><a href="#创建启动类" class="headerlink" title="创建启动类"></a>创建启动类</h3><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210522112350420-877119426.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210522112350420-877119426.png" alt="img"></a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@SpringBootApplication</span>(exclude = DataSourceAutoConfiguration.class) 取消数据源自动配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ComponentScan(&#123;&quot;top.it6666&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmsApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(SmsApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="发送短信"><a href="#发送短信" class="headerlink" title="发送短信"></a>发送短信</h3><p>签名</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210522112439574-1678615459.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210522112439574-1678615459.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210522112503799-2120112744.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210522112503799-2120112744.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210522112522275-602991188.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210522112522275-602991188.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210522112604011-1101454507.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210522112604011-1101454507.png" alt="img"></a></p>
<p>进入查看 API 的页面之后就有对应语言发送代码的 Demo 了如下</p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">DefaultProfile</span> <span class="variable">profile</span> <span class="operator">=</span> DefaultProfile.getProfile(<span class="string">&quot;cn-hangzhou&quot;</span>, <span class="string">&quot;LTAIqImmxZn7yCpS&quot;</span>, <span class="string">&quot;pJ4OOiDnHYdZZZOkxlPN8HyXiaatZe&quot;</span>);</span><br><span class="line">    <span class="type">IAcsClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultAcsClient</span>(profile);</span><br><span class="line"></span><br><span class="line">    <span class="type">CommonRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CommonRequest</span>();</span><br><span class="line">    request.setMethod(MethodType.POST);</span><br><span class="line">    request.setDomain(<span class="string">&quot;dysmsapi.aliyuncs.com&quot;</span>);</span><br><span class="line">    request.setVersion(<span class="string">&quot;2017-05-25&quot;</span>);</span><br><span class="line">    request.setAction(<span class="string">&quot;SendSms&quot;</span>);</span><br><span class="line">    request.putQueryParameter(<span class="string">&quot;RegionId&quot;</span>, <span class="string">&quot;cn-hangzhou&quot;</span>);</span><br><span class="line">    request.putQueryParameter(<span class="string">&quot;PhoneNumbers&quot;</span>, <span class="string">&quot;1599767931&quot;</span>);</span><br><span class="line">    request.putQueryParameter(<span class="string">&quot;SignName&quot;</span>, <span class="string">&quot;BNTang&quot;</span>);</span><br><span class="line">    request.putQueryParameter(<span class="string">&quot;TemplateCode&quot;</span>, <span class="string">&quot;SMS_169111508&quot;</span>);</span><br><span class="line">    request.putQueryParameter(<span class="string">&quot;TemplateParam&quot;</span>, <span class="string">&quot;&#123;code:910612&#125;&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">CommonResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.getCommonResponse(request);</span><br><span class="line">        System.out.println(response.getData());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ServerException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ClientException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="添加依赖-2"><a href="#添加依赖-2" class="headerlink" title="添加依赖"></a>添加依赖</h3><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210522112928658-986950734.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210522112928658-986950734.png" alt="img"></a></p>
<p>xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-java-sdk-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="创建-SmsController"><a href="#创建-SmsController" class="headerlink" title="创建 SmsController"></a>创建 SmsController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/service_sms/api/sms&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmsController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SmsService smsService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发送完短信后, 把生成的验证码写到redis</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, String&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/send/&#123;phone&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">code</span><span class="params">(<span class="meta">@PathVariable</span> String phone)</span> &#123;</span><br><span class="line">        <span class="comment">// 查看redis当中是否有当前手机对应的验证码   手机号当作key</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> redisTemplate.opsForValue().get(phone);</span><br><span class="line">        <span class="keyword">if</span>(!StringUtils.isEmpty(code)) &#123;</span><br><span class="line">            <span class="comment">// 已经发送过了 还没有过期</span></span><br><span class="line">            <span class="keyword">return</span> ResponseResult.ok();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 生成新的验证码</span></span><br><span class="line">        code = randomCode();</span><br><span class="line">        Map&lt;String,Object&gt; param = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">// 把验证码写到参数当中去</span></span><br><span class="line">        param.put(<span class="string">&quot;code&quot;</span>, code);</span><br><span class="line">        <span class="comment">// 发送短信</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isSend</span> <span class="operator">=</span> smsService.send(phone, <span class="string">&quot;SMS_169111508&quot;</span>, param);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 发送成功</span></span><br><span class="line">        <span class="keyword">if</span>(isSend) &#123;</span><br><span class="line">            <span class="comment">// 把验证码写到Redis当中</span></span><br><span class="line">            redisTemplate.opsForValue().set(phone, code,<span class="number">5</span>, TimeUnit.MINUTES);</span><br><span class="line">            <span class="keyword">return</span> ResponseResult.ok();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 提示用户失败</span></span><br><span class="line">        <span class="keyword">return</span> ResponseResult.error().message(<span class="string">&quot;发送短信失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成4位的数字验证码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 验证码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">randomCode</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">            sb.append(<span class="keyword">new</span> <span class="title class_">Random</span>().nextInt(<span class="number">10</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建短信发送业务类，SmsService.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SmsService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发送短信</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> phone 手机号</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sms sms模板</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> param 参数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 发送结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">send</span><span class="params">(String phone, String sms, Map&lt;String, Object&gt; param)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SmsServiceImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmsServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">SmsService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">send</span><span class="params">(String phoneNumbers, String templateCode, Map&lt;String, Object&gt; param)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(StringUtils.isEmpty(phoneNumbers)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">DefaultProfile</span> <span class="variable">profile</span> <span class="operator">=</span></span><br><span class="line">                DefaultProfile.getProfile(</span><br><span class="line">                        <span class="string">&quot;cn-hangzhou&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;LTAI4GH19ep2P8caxW2E2N6A&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;NAmWiBmKXofw7hs4JRcx7SLhF1MN6P&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">IAcsClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultAcsClient</span>(profile);</span><br><span class="line">        <span class="type">CommonRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CommonRequest</span>();</span><br><span class="line">        request.setMethod(MethodType.POST);</span><br><span class="line">        request.setDomain(<span class="string">&quot;dysmsapi.aliyuncs.com&quot;</span>);</span><br><span class="line">        request.setVersion(<span class="string">&quot;2017-05-25&quot;</span>);</span><br><span class="line">        request.setAction(<span class="string">&quot;SendSms&quot;</span>);</span><br><span class="line">        request.putQueryParameter(<span class="string">&quot;PhoneNumbers&quot;</span>, phoneNumbers);</span><br><span class="line">        request.putQueryParameter(<span class="string">&quot;SignName&quot;</span>, <span class="string">&quot;BNTang&quot;</span>);</span><br><span class="line">            request.putQueryParameter(<span class="string">&quot;TemplateCode&quot;</span>, templateCode);</span><br><span class="line">        request.putQueryParameter(<span class="string">&quot;TemplateParam&quot;</span>, JSONObject.toJSONString(param));</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            client.getCommonResponse(request);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="52-门户登录-用户微服务"><a href="#52-门户登录-用户微服务" class="headerlink" title="52-门户登录-用户微服务"></a>52-门户登录-用户微服务</h2><h3 id="创建用户微服务"><a href="#创建用户微服务" class="headerlink" title="创建用户微服务"></a>创建用户微服务</h3><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210522201922734-466592243.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210522201922734-466592243.png" alt="img"></a></p>
<h3 id="创建用户表"><a href="#创建用户表" class="headerlink" title="创建用户表"></a>创建用户表</h3><p>sql</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `portal_user` (</span><br><span class="line">	`id` <span class="type">CHAR</span> ( <span class="number">19</span> ) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户id&#x27;</span>,</span><br><span class="line">	`openid` <span class="type">VARCHAR</span> ( <span class="number">128</span> ) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;微信openid&#x27;</span>,</span><br><span class="line">	`mobile` <span class="type">VARCHAR</span> ( <span class="number">11</span> ) <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span> COMMENT <span class="string">&#x27;手机号&#x27;</span>,</span><br><span class="line">	`password` <span class="type">VARCHAR</span> ( <span class="number">255</span> ) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;密码&#x27;</span>,</span><br><span class="line">	`nickname` <span class="type">VARCHAR</span> ( <span class="number">50</span> ) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;昵称&#x27;</span>,</span><br><span class="line">	`sex` TINYINT ( <span class="number">2</span> ) UNSIGNED <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;性别 1 女，2 男&#x27;</span>,</span><br><span class="line">	`age` TINYINT ( <span class="number">3</span> ) UNSIGNED <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;年龄&#x27;</span>,</span><br><span class="line">	`avatar` <span class="type">VARCHAR</span> ( <span class="number">255</span> ) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户头像&#x27;</span>,</span><br><span class="line">	`sign` <span class="type">VARCHAR</span> ( <span class="number">100</span> ) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户签名&#x27;</span>,</span><br><span class="line">	`is_disabled` TINYINT ( <span class="number">1</span> ) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;是否禁用 1（true）已禁用，  0（false）未禁用&#x27;</span>,</span><br><span class="line">	`is_deleted` TINYINT ( <span class="number">1</span> ) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;逻辑删除 1（true）已删除， 0（false）未删除&#x27;</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY ( `id` ) </span><br><span class="line">) ENGINE <span class="operator">=</span> INNODB <span class="keyword">DEFAULT</span> CHARSET <span class="operator">=</span> utf8mb4 COMMENT <span class="operator">=</span> <span class="string">&#x27;用户表&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>使用代码生成器生成代码</p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CodeGenerator</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 1、创建代码生成器</span></span><br><span class="line">        <span class="type">AutoGenerator</span> <span class="variable">mpg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AutoGenerator</span>();</span><br><span class="line">        <span class="comment">// 2、全局配置</span></span><br><span class="line">        <span class="type">GlobalConfig</span> <span class="variable">gc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GlobalConfig</span>();</span><br><span class="line">        <span class="comment">// 配置输出路径</span></span><br><span class="line">        gc.setOutputDir(<span class="string">&quot;D:\\Develop\\IdeaPro\\video_parent\\service\\service_user\\src\\main\\java&quot;</span>);</span><br><span class="line">        <span class="comment">// 生成后是否打开资源管理器</span></span><br><span class="line">        gc.setOpen(<span class="literal">false</span>);</span><br><span class="line">        gc.setAuthor(<span class="string">&quot;BNTang&quot;</span>);</span><br><span class="line">        <span class="comment">// 重新生成时文件是否覆盖</span></span><br><span class="line">        gc.setFileOverride(<span class="literal">false</span>);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * mp生成service层代码，默认接口名称第一个字母有 I</span></span><br><span class="line"><span class="comment">         * */</span></span><br><span class="line">        gc.setControllerName(<span class="string">&quot;%sController&quot;</span>);</span><br><span class="line">        gc.setServiceName(<span class="string">&quot;%sService&quot;</span>);</span><br><span class="line">        gc.setServiceImplName(<span class="string">&quot;%sServiceImpl&quot;</span>);</span><br><span class="line">        gc.setMapperName(<span class="string">&quot;%sMapper&quot;</span>);</span><br><span class="line">        gc.setXmlName(<span class="string">&quot;%sMapper&quot;</span>);</span><br><span class="line">        <span class="comment">// 主键策略</span></span><br><span class="line">        gc.setIdType(IdType.ID_WORKER_STR);</span><br><span class="line">        <span class="comment">// 定义生成的实体类中日期类型</span></span><br><span class="line">        gc.setDateType(DateType.ONLY_DATE);</span><br><span class="line">        <span class="comment">// 开启Swagger2模式</span></span><br><span class="line">        gc.setSwagger2(<span class="literal">true</span>);</span><br><span class="line">        mpg.setGlobalConfig(gc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、数据源配置</span></span><br><span class="line">        <span class="type">DataSourceConfig</span> <span class="variable">dsc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataSourceConfig</span>();</span><br><span class="line">        dsc.setUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/video_db?serverTimezone=GMT%2B8&quot;</span>);</span><br><span class="line">        dsc.setDriverName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">        dsc.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        dsc.setPassword(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        dsc.setDbType(DbType.MYSQL);</span><br><span class="line">        mpg.setDataSource(dsc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、包配置</span></span><br><span class="line">        <span class="type">PackageConfig</span> <span class="variable">pc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PackageConfig</span>();</span><br><span class="line">        <span class="comment">// 模块名</span></span><br><span class="line">        pc.setModuleName(<span class="string">&quot;service_user&quot;</span>);</span><br><span class="line">        pc.setParent(<span class="string">&quot;top.it6666&quot;</span>);</span><br><span class="line">        pc.setController(<span class="string">&quot;controller&quot;</span>);</span><br><span class="line">        pc.setEntity(<span class="string">&quot;entity&quot;</span>);</span><br><span class="line">        pc.setService(<span class="string">&quot;service&quot;</span>);</span><br><span class="line">        pc.setMapper(<span class="string">&quot;mapper&quot;</span>);</span><br><span class="line">        mpg.setPackageInfo(pc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5、策略配置</span></span><br><span class="line">        <span class="type">StrategyConfig</span> <span class="variable">strategy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StrategyConfig</span>();</span><br><span class="line">        strategy.setInclude(<span class="string">&quot;portal_user&quot;</span>);</span><br><span class="line">        <span class="comment">// 数据库表映射到实体的命名策略 驼峰命名</span></span><br><span class="line">        strategy.setNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">        <span class="comment">// 生成实体时去掉表前缀</span></span><br><span class="line">        strategy.setTablePrefix(<span class="string">&quot;portal_&quot;</span>);</span><br><span class="line">        <span class="comment">// 数据库表字段映射到实体的命名策略</span></span><br><span class="line">        strategy.setColumnNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">        <span class="comment">// lombok 模型 @Accessors(chain = true) setter链式操作</span></span><br><span class="line">        strategy.setEntityLombokModel(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">// restful api风格控制器</span></span><br><span class="line">        strategy.setRestControllerStyle(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">// url中驼峰转连字符</span></span><br><span class="line">        strategy.setControllerMappingHyphenStyle(<span class="literal">true</span>);</span><br><span class="line">        mpg.setStrategy(strategy);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6、执行</span></span><br><span class="line">        mpg.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210522202520942-417318644.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210522202520942-417318644.png" alt="img"></a></p>
<h3 id="添加配置文件-2"><a href="#添加配置文件-2" class="headerlink" title="添加配置文件"></a>添加配置文件</h3><p>application.yml</p>
<p>yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application-dev.yml</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8007</span></span><br><span class="line"></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">pattern:</span></span><br><span class="line">    <span class="attr">console:</span> <span class="string">&quot;%clr(%5p) %clr(-)&#123;faint&#125; %clr(%-80.80logger&#123;79&#125;)&#123;cyan&#125; %clr(:) %m%n&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">service-user</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/video_db?serverTimezone=GMT%2B8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">hikari:</span></span><br><span class="line">      <span class="attr">connection-test-query:</span> <span class="string">SELECT</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">connection-timeout:</span> <span class="number">60000</span></span><br><span class="line">      <span class="attr">idle-timeout:</span> <span class="number">500000</span></span><br><span class="line">      <span class="attr">max-lifetime:</span> <span class="number">540000</span></span><br><span class="line">      <span class="attr">maximum-pool-size:</span> <span class="number">12</span></span><br><span class="line">      <span class="attr">minimum-idle:</span> <span class="number">10</span></span><br><span class="line">      <span class="attr">pool-name:</span> <span class="string">HikariPool</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">timeout:</span> <span class="number">1800000</span></span><br><span class="line">    <span class="comment"># password: 1234</span></span><br><span class="line">    <span class="attr">lettuce:</span></span><br><span class="line">      <span class="attr">pool:</span></span><br><span class="line">        <span class="attr">max-active:</span> <span class="number">20</span></span><br><span class="line">        <span class="attr">max-wait:</span> <span class="number">1</span></span><br><span class="line">        <span class="comment"># 最大阻塞等待时间</span></span><br><span class="line">        <span class="attr">max-idle:</span> <span class="number">5</span></span><br><span class="line">        <span class="attr">min-idle:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">jackson:</span></span><br><span class="line">    <span class="attr">date-format:</span> <span class="string">yyyy-MM-dd</span> <span class="string">HH:mm:ss</span></span><br><span class="line">    <span class="attr">time-zone:</span> <span class="string">GMT+8</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">top/it6666/service_user/mapper/xml/*.xml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">sentinel:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h3 id="添加启动类-1"><a href="#添加启动类-1" class="headerlink" title="添加启动类"></a>添加启动类</h3><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210522202958638-863555390.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210522202958638-863555390.png" alt="img"></a></p>
<p>UserApplication.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ComponentScan(&#123;&quot;top.it6666&quot;&#125;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;top.it6666.service_user.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(UserApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建 LoginVo 和 RegisterVo 用于数据封装</p>
<p>LoginVo.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginVo</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 手机号</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 密码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>RegisterVo.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RegisterVo</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 昵称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String nickname;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 手机号</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 密码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 验证码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210522203309829-1163948693.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210522203309829-1163948693.png" alt="img"></a></p>
<p>创建用户业务类</p>
<p>UserService.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 用户表 服务类</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2021-05-22</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;User&gt; &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 登录</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> loginVo</span></span><br><span class="line"><span class="comment">     *            登录信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> token</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">login</span><span class="params">(LoginVo loginVo)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注册</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> registerVo</span></span><br><span class="line"><span class="comment">     *            注册信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">register</span><span class="params">(RegisterVo registerVo)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UserServiceImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 用户表 服务实现类</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2021-05-22</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserMapper, User&gt; <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, String&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">login</span><span class="params">(LoginVo loginVo)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">phone</span> <span class="operator">=</span> loginVo.getPhone();</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> loginVo.getPassword();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 校验参数</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(phone) || StringUtils.isEmpty(password)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BnTangException</span>(<span class="number">20001</span>, <span class="string">&quot;缺少参数&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 获取用户</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> baseMapper.selectOne(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;User&gt;().eq(<span class="string">&quot;mobile&quot;</span>, phone));</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == user) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BnTangException</span>(<span class="number">20001</span>, <span class="string">&quot;用户不存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 校验密码</span></span><br><span class="line">        <span class="keyword">if</span> (!Md5.encrypt(password).equals(user.getPassword())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BnTangException</span>(<span class="number">20001</span>, <span class="string">&quot;密码错误&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 校验是否被禁用</span></span><br><span class="line">        <span class="keyword">if</span> (user.getIsDisabled()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BnTangException</span>(<span class="number">20001</span>, <span class="string">&quot;用户被禁用&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 使用JWT生成token字符串</span></span><br><span class="line">        <span class="keyword">return</span> JwtUtils.getJwtToken(user.getId(), user.getNickname());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">register</span><span class="params">(RegisterVo registerVo)</span> &#123;</span><br><span class="line">        <span class="comment">// 获取注册信息，进行校验</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">nickname</span> <span class="operator">=</span> registerVo.getNickname();</span><br><span class="line">        <span class="type">String</span> <span class="variable">phone</span> <span class="operator">=</span> registerVo.getPhone();</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> registerVo.getPassword();</span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> registerVo.getCode();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 校验参数</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(phone) || StringUtils.isEmpty(nickname) || StringUtils.isEmpty(password)</span><br><span class="line">            || StringUtils.isEmpty(code)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BnTangException</span>(<span class="number">20001</span>, <span class="string">&quot;缺少参数&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 校验校验验证码</span></span><br><span class="line">        <span class="comment">// 从redis获取发送的验证码</span></span><br><span class="line">        <span class="keyword">if</span> (!code.equals(redisTemplate.opsForValue().get(phone))) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BnTangException</span>(<span class="number">20001</span>, <span class="string">&quot;验证码错误&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 查询数据库中是否存在相同的手机号码</span></span><br><span class="line">        <span class="keyword">if</span> (baseMapper.selectCount(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;User&gt;().eq(<span class="string">&quot;mobile&quot;</span>, phone)) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BnTangException</span>(<span class="number">20001</span>, <span class="string">&quot;手机号已被使用&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加注册信息到数据库</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">member</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        member.setNickname(nickname);</span><br><span class="line">        member.setMobile(registerVo.getPhone());</span><br><span class="line">        member.setPassword(Md5.encrypt(password));</span><br><span class="line">        member.setIsDisabled(<span class="literal">false</span>);</span><br><span class="line">        member.setAvatar(<span class="string">&quot;https://xiaohuihuit.github.io/images/avatar.jpg&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.save(member);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建用户请求 api 控制器</p>
<p>UserController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 用户表 前端控制器</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2021-05-22</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/service_user/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户登录</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;用户登录&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">login</span><span class="params">(<span class="meta">@RequestBody</span> LoginVo loginVo)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> userService.login(loginVo);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok().data(<span class="string">&quot;token&quot;</span>, token);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户注册</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;用户注册&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/register&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">register</span><span class="params">(<span class="meta">@RequestBody</span> RegisterVo registerVo)</span> &#123;</span><br><span class="line">        userService.register(registerVo);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取用户登陆成功之后的用户信息</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;获取用户登陆成功之后的用户信息&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;auth/getLoginInfo&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">getLoginInfo</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 查询数据库根据用户id获取用户信息</span></span><br><span class="line">            <span class="keyword">return</span> ResponseResult.ok().data(<span class="string">&quot;userInfo&quot;</span>, userService.getById(JwtUtils.getUserIdByJwtToken(request)));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BnTangException</span>(<span class="number">20001</span>, <span class="string">&quot;获取失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="53-门户登录-微信登录"><a href="#53-门户登录-微信登录" class="headerlink" title="53-门户登录-微信登录"></a>53-门户登录-微信登录</h2><h3 id="OAuth2-开放授权"><a href="#OAuth2-开放授权" class="headerlink" title="OAuth2 开放授权"></a>OAuth2 开放授权</h3><h4 id="什么是-OAuth2"><a href="#什么是-OAuth2" class="headerlink" title="什么是 OAuth2"></a>什么是 OAuth2</h4><p>是开放授权的一个标准，旨在让用户允许第三方应用去访问该用户在某服务器中的特定私有的资源，而可以不提供其在某服务器的账号密码给到第三方应用。</p>
<h4 id="运行流程"><a href="#运行流程" class="headerlink" title="运行流程"></a>运行流程</h4><h5 id="名词说明"><a href="#名词说明" class="headerlink" title="名词说明"></a>名词说明</h5><ul>
<li>Third-party application：第三方应用程序, 又称 “客户端”（client）比如打开视频网站，使用第三方登录，选择微信登录，这时候视频网站就是客户端。</li>
<li>HTTP service：HTTP 服务提供商，简称 “服务提供商” 即微信。</li>
<li>Resource Owner：资源所有者，登录用户。</li>
<li>User Agent：用户代理，指浏览器, 手机。</li>
<li>Authorization server：认证服务器, 即服务提供商专门用来处理认证的服务器。</li>
<li>Resource server：资源服务器，即服务提供商存放用户生成的资源的服务器。它与认证服务器，可以是同一台服务器，也可以是不同的服务器。</li>
</ul>
<h5 id="运行流程图"><a href="#运行流程图" class="headerlink" title="运行流程图"></a>运行流程图</h5><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210523221041544-1533943113.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210523221041544-1533943113.png" alt="img"></a></p>
<h4 id="交互过程"><a href="#交互过程" class="headerlink" title="交互过程"></a>交互过程</h4><ul>
<li>OAuth 在 “客户端” 与 “服务提供商” 之间，设置了一个授权层（authorization layer）</li>
<li>“客户端” 不能直接登录 “服务提供商”，只能登录授权层，以此将用户与客户端区分开来。</li>
<li>“客户端” 登录授权层所用的令牌（token）与用户的密码不同。用户可以在登录的时候，指定授权层令牌的权限范围和有效期。</li>
<li>“客户端” 登录授权层以后，“服务提供商” 根据令牌的权限范围和有效期，向 “客户端” 开放用户储存的资料。</li>
</ul>
<h4 id="交互流程图"><a href="#交互流程图" class="headerlink" title="交互流程图"></a>交互流程图</h4><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210523222107714-285249540.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210523222107714-285249540.png" alt="img"></a></p>
<h4 id="令牌的访问与刷新"><a href="#令牌的访问与刷新" class="headerlink" title="令牌的访问与刷新"></a>令牌的访问与刷新</h4><h5 id="Access-Token"><a href="#Access-Token" class="headerlink" title="Access Token"></a>Access Token</h5><ul>
<li>Access Token 是客户端访问资源服务器的令牌。拥有这个令牌代表着得到用户的授权。</li>
<li>这个授权应该是临时的，有一定的有效期。这是因为，Access Token 在使用的过程中可能会泄露。</li>
<li>给 Access Token 限定一个较短的有效期可以降低因 Access Token 泄露而带来的风险。</li>
<li>每当 Access Token 过期，客户端就必须重新向用户索要授权。这样用户可能每隔几天，甚至每天都需要进行授权操作。这是一件非常影响用户体验的事情。</li>
</ul>
<h5 id="Refresh-Token"><a href="#Refresh-Token" class="headerlink" title="Refresh Token"></a>Refresh Token</h5><ul>
<li>Refresh Token 的作用是用来刷新 Access Token。认证服务器提供一个刷新接口，例如如下链接所示。</li>
</ul>
<p><a target="_blank" rel="noopener" href="http://www.vx.com/refresh?refresh_token=&client_id=">http://www.VX.com/refresh?refresh_token&#x3D;&amp;client_id&#x3D;</a></p>
<ul>
<li>传入 refresh_token 和 client_id，认证服务器验证通过后，返回一个新的 Access Token。</li>
</ul>
<p>为了安全，OAuth2.0 引入了两个措施</p>
<ul>
<li>OAuth2.0 要求，Refresh Token 一定是保存在客户端的服务器上，而绝不能存放在狭义的客户端（例如 App、PC 端软件）上。调用 refresh 接口的时候，一定是从服务器到服务器的访问。</li>
</ul>
<p>OAuth2.0 引入了 client_secret 机制</p>
<ul>
<li>即每一个 client_id 都对应一个 client_secret。</li>
<li>这个 client_secret 会在客户端申请 client_id 时，随 client_id 一起分配给客户端。</li>
<li>客户端必须把 client_secret 妥善保管在服务器上，决不能泄露。</li>
<li>刷新 Access Token 时，需要验证这个 client_secret。</li>
</ul>
<p><a target="_blank" rel="noopener" href="http://www.baidu.com/refresh?refresh_token=&amp;client_id=&amp;client_secret=">http://www.baidu.com/refresh?refresh_token=&amp;client_id=&amp;client_secret=</a></p>
<p>Refresh Token 的有效期非常长，会在用户授权时，随 Access Token 一起重定向到回调 URL，传递给客户端。</p>
<h4 id="授权模式"><a href="#授权模式" class="headerlink" title="授权模式"></a>授权模式</h4><p>客户端必须得到用户的授权（authorization grant）才能获得令牌（access token）OAuth 2.0 定义了四种授权方式。</p>
<h4 id="简化模式"><a href="#简化模式" class="headerlink" title="简化模式"></a>简化模式</h4><p>简化模式，不推荐使用，简化模式适用于纯静态页面应用。所谓纯静态页面应用，也就是应用没有在服务器上执行代码的权限，只有前端 JS 代码的控制权。这种场景下，应用是没有持久化存储的能力的。因此，按照 OAuth2.0 的规定，这种应用是拿不到 Refresh Token 的。其整个授权流程如下。</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210524221218670-1924585188.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210524221218670-1924585188.png" alt="img"></a></p>
<p>该模式下，access_token 容易泄露且不可刷新。</p>
<h5 id="授权码模式"><a href="#授权码模式" class="headerlink" title="授权码模式"></a>授权码模式</h5><p>授权码模式适用于有自己的服务器的应用，它是一个一次性的临时凭证，用来换取 access_token 和 refresh_token。</p>
<p><a target="_blank" rel="noopener" href="https://www.baidu.com/exchange?code=&amp;client_id=&amp;client_secret=">https://www.baidu.com/exchange?code=&amp;client_id=&amp;client_secret=</a></p>
<p>需要传入 code、client_id 以及 client_secret。验证通过后，返回 access_token 和 refresh_token。一旦换取成功，code 立即作废，不能再使用第二次。</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210524221844203-1825714311.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210524221844203-1825714311.png" alt="img"></a></p>
<p>这个 code 的作用是保护 token 的安全性，在第 4 步当中直接把 token 返回给应用。而这一步容易被拦截、窃听。引入了 code 之后，即使攻击者能够窃取到 code，但是由于他无法获得应用保存在服务器的 client_secret，因此也无法通过 code 换取 token。第 5 步，为什么不容易被拦截、窃听呢？这是因为，首先，这是一个从服务器到服务器的访问，黑客比较难捕捉到；其次，这个请求通常要求是 HTTPS 的实现。即使能窃听到数据包也无法解析出内容。</p>
<h5 id="密码模式"><a href="#密码模式" class="headerlink" title="密码模式"></a>密码模式</h5><p>密码模式中，用户向客户端提供自己的用户名和密码。客户端使用这些信息，向 “服务商提供” 索要授权。在这种模式中，用户必须把自己的密码给客户端，但是客户端不得储存密码。这通常用在用户对客户端高度信任的情况下，比如客户端是操作系统的一部分。</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210524222720622-892907112.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210524222720622-892907112.png" alt="img"></a></p>
<p>适用于同一公司内部的多个系统，不适用于不受信的第三方应用。</p>
<h5 id="客户端模式"><a href="#客户端模式" class="headerlink" title="客户端模式"></a>客户端模式</h5><p>如果信任关系再进一步，或者调用者是一个后端的模块，没有用户界面的时候，可以使用客户端模式。鉴权服务器直接对客户端进行身份验证，验证通过后，返回 token。</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210524230610079-1585368523.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210524230610079-1585368523.png" alt="img"></a></p>
<h3 id="微信登录"><a href="#微信登录" class="headerlink" title="微信登录"></a>微信登录</h3><h4 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h4><h5 id="注册账号"><a href="#注册账号" class="headerlink" title="注册账号"></a>注册账号</h5><ul>
<li>注册地址：<a target="_blank" rel="noopener" href="https://open.weixin.qq.com/">https://open.weixin.qq.com</a></li>
<li>注册微信开发平台账号</li>
</ul>
<h5 id="开发者资质认证"><a href="#开发者资质认证" class="headerlink" title="开发者资质认证"></a>开发者资质认证</h5><p>准备营业执照，1-2 个工作日审批、300 元。</p>
<h5 id="创建网站应用"><a href="#创建网站应用" class="headerlink" title="创建网站应用"></a>创建网站应用</h5><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210527225442936-110012026.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210527225442936-110012026.png" alt="img"></a></p>
<p>提交审核，7 个工作日审批。</p>
<h5 id="开发流程"><a href="#开发流程" class="headerlink" title="开发流程"></a>开发流程</h5><p><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/doc/oplatform/Website_App/WeChat_Login/Wechat_Login.html">https://developers.weixin.qq.com/doc/oplatform/Website_App/WeChat_Login/Wechat_Login.html</a></p>
<h4 id="前端开发"><a href="#前端开发" class="headerlink" title="前端开发"></a>前端开发</h4><p>login.js 中添加验证登录请求，我记得之前的文章当中好像添加了，不过这里我还是列举出来，也把对应的代码放在下面。</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210527225752644-1335493257.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210527225752644-1335493257.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 验证是否已经登录</span></span><br><span class="line"><span class="title function_">checkLogin</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/service_user/user/wx/checkLogin`</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 login.vue 当中添加属性</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210527230158912-1152453589.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210527230158912-1152453589.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">head</span>: &#123;</span><br><span class="line">  <span class="attr">script</span>: [</span><br><span class="line">    &#123;<span class="attr">src</span>: <span class="string">&#x27;http://res.wx.qq.com/connect/zh_CN/htmledition/js/wxLogin.js&#x27;</span>&#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">wxDialog</span>: <span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p>添加微信登录的对话框</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210527231256983-1096964311.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210527231256983-1096964311.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--@opened 对话框打开后的回调--&gt;</span><br><span class="line">&lt;el-dialog</span><br><span class="line">  :visible.sync=&quot;wxDialog&quot;</span><br><span class="line">  @opened=&quot;wxOpen&quot;</span><br><span class="line">  width=&quot;30%&quot;</span><br><span class="line">  center&gt;</span><br><span class="line">  &lt;div id=&quot;qrCode&quot; style=&quot;padding-left: 110px;&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/el-dialog&gt;</span><br></pre></td></tr></table></figure>

<p>点击微信登录</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210527231410965-1676824759.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210527231410965-1676824759.png" alt="img"></a></p>
<p>html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">&quot;weixin&quot;</span> <span class="attr">class</span>=<span class="string">&quot;weixin&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;wxDialog=true&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>弹框后在生成二维码</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210527231620083-16857908.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210527231620083-16857908.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">wxCreate</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> obj = <span class="keyword">new</span> <span class="title class_">WxLogin</span>(&#123;</span><br><span class="line">    <span class="attr">self_redirect</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">id</span>: <span class="string">&quot;qrCode&quot;</span>,</span><br><span class="line">    <span class="attr">appid</span>: <span class="string">&quot;wx92b6693b8c01fc87&quot;</span>,</span><br><span class="line">    <span class="attr">scope</span>: <span class="string">&quot;snsapi_login&quot;</span>,</span><br><span class="line">    <span class="attr">redirect_uri</span>: <span class="string">&quot;http://www.sphskla.cn/service_user/user/wx/callBack&quot;</span>,</span><br><span class="line">    <span class="attr">state</span>: <span class="string">&quot;fm&quot;</span>,</span><br><span class="line">    <span class="attr">style</span>: <span class="string">&quot;black&quot;</span>,</span><br><span class="line">    <span class="attr">href</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;,</span><br><span class="line"><span class="title function_">wxOpen</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 生成登录二维码</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">wxCreate</span>();</span><br><span class="line">  <span class="comment">// 验证是否已经扫码</span></span><br><span class="line">  loginApi.<span class="title function_">checkLogin</span>().<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (response.<span class="property">success</span>) &#123;</span><br><span class="line">      <span class="comment">// 携带token跳转到首页</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(&#123;<span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>, <span class="attr">query</span>: &#123;<span class="attr">token</span>: response.<span class="property">data</span>.<span class="property">token</span>&#125;&#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">        <span class="attr">message</span>: <span class="string">&quot;登录失败, 请重试&quot;</span></span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">wxOpen</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>登录成功跳转到首页后的处理修改 <code>default.vue</code> 如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210527232258961-1587439215.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210527232258961-1587439215.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 获取token</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">token</span> = <span class="variable language_">this</span>.<span class="property">$route</span>.<span class="property">query</span>.<span class="property">token</span>;</span><br><span class="line">  <span class="comment">// 判断路径是否有token值</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">token</span>) &#123;</span><br><span class="line">    <span class="comment">// 存储token与user</span></span><br><span class="line">    cookie.<span class="title function_">set</span>(<span class="string">&#x27;login_token&#x27;</span>, <span class="variable language_">this</span>.<span class="property">token</span>, &#123;<span class="attr">domain</span>: <span class="string">&#x27;localhost&#x27;</span>&#125;);</span><br><span class="line">    cookie.<span class="title function_">set</span>(<span class="string">&#x27;portal_user&#x27;</span>, <span class="string">&#x27;&#x27;</span>, &#123;<span class="attr">domain</span>: <span class="string">&#x27;localhost&#x27;</span>&#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取用户信息</span></span><br><span class="line">    loginApi.<span class="title function_">getLoginInfo</span>().<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">loginInfo</span> = response.<span class="property">data</span>.<span class="property">userInfo</span>;</span><br><span class="line">      cookie.<span class="title function_">set</span>(<span class="string">&#x27;portal_user&#x27;</span>, <span class="variable language_">this</span>.<span class="property">loginInfo</span>, &#123;<span class="attr">domain</span>: <span class="string">&#x27;localhost&#x27;</span>&#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">showInfo</span>();</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h4 id="后端开发"><a href="#后端开发" class="headerlink" title="后端开发"></a>后端开发</h4><p>在 service_user 工程当中添加配置</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210528212131682-1413163493.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210528212131682-1413163493.png" alt="img"></a></p>
<p>yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">wx:</span></span><br><span class="line">  <span class="attr">open:</span></span><br><span class="line">    <span class="comment"># 微信开放平台 openid</span></span><br><span class="line">    <span class="attr">app_id:</span> <span class="string">wx92b6693b8c01fc87</span></span><br><span class="line">    <span class="comment"># 微信开放平台 appsecret</span></span><br><span class="line">    <span class="attr">app_secret:</span> <span class="string">d734ba63f66b7dsadscdcb958eea</span></span><br><span class="line">    <span class="comment"># 重定向url</span></span><br><span class="line">    <span class="attr">redirect_url:</span> <span class="string">http://www.sphskla.cn/wechat/callBack</span></span><br></pre></td></tr></table></figure>

<p>创建常量类 WxConstantUtil.java</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210528212652367-1967757810.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210528212652367-1967757810.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@project</span> video_parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 微信相关常量工具类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> Created in 2021/5/28 028 21:24</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WxConstantUtil</span> <span class="keyword">implements</span> <span class="title class_">InitializingBean</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;wx.open.app_id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String appId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;wx.open.app_secret&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String appSecret;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;wx.open.redirect_url&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String redirectUrl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String WX_OPEN_APP_ID;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String WX_OPEN_APP_SECRET;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String WX_OPEN_REDIRECT_URL;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> &#123;</span><br><span class="line">        WX_OPEN_APP_ID = appId;</span><br><span class="line">        WX_OPEN_APP_SECRET = appSecret;</span><br><span class="line">        WX_OPEN_REDIRECT_URL = redirectUrl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>添加 HTTP 请求的工具类</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210529082212601-1466113653.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210529082212601-1466113653.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@project</span> video_parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 发送 HTTP 请求工具类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> Created in 2021/5/28 028 21:39</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpClientUtil</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发送get 网络请求</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">get</span><span class="params">(String uri)</span> &#123;</span><br><span class="line">        <span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">HttpGet</span> <span class="variable">get</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpGet</span>(uri);</span><br><span class="line">        <span class="type">CloseableHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            httpClient = HttpClients.createDefault();</span><br><span class="line">            response = httpClient.execute(get);</span><br><span class="line">            <span class="type">int</span> <span class="variable">statusCode</span> <span class="operator">=</span> response.getStatusLine().getStatusCode();</span><br><span class="line">            <span class="keyword">if</span> (statusCode == <span class="number">200</span>) &#123;</span><br><span class="line">                <span class="type">HttpEntity</span> <span class="variable">entity</span> <span class="operator">=</span> response.getEntity();</span><br><span class="line">                <span class="keyword">return</span> EntityUtils.toString(entity, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="literal">null</span> != response) &#123;</span><br><span class="line">                    response.close();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (<span class="literal">null</span> != httpClient) &#123;</span><br><span class="line">                    httpClient.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改 UserService.java 添加新的用户业务方法</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210529082513155-1694226520.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210529082513155-1694226520.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;b&gt; 根据openId获取用户 &lt;/b&gt;</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> openId</span></span><br><span class="line"><span class="comment"> *            微信openId</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 通过openId获取的用户</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">User <span class="title function_">getByOpenId</span><span class="params">(String openId)</span>;</span><br></pre></td></tr></table></figure>

<p>修改 UserServiceImpl.java 实现该方法</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210529082642988-558625650.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210529082642988-558625650.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">getByOpenId</span><span class="params">(String openId)</span> &#123;</span><br><span class="line">    QueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(<span class="string">&quot;openid&quot;</span>, openId);</span><br><span class="line">    <span class="keyword">return</span> baseMapper.selectOne(queryWrapper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果想要在本地上调试微信扫描登录需要配置一下，因为微信回调的地址是在公网，我们需要配置一下 HOST 文件以及 nginx 的反向代理如下图所示</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210529090235598-1809198739.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210529090235598-1809198739.png" alt="img"></a></p>
<p>修改 HOST 有专门修改 HOST 文件的工具我这里没有列举出来</p>
<p>修改 <code>C:\Windows\System32\drivers\etc\host</code></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210529091100545-848048920.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210529091100545-848048920.png" alt="img"></a></p>
<p>text</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1		www.sphskla.cn</span><br></pre></td></tr></table></figure>

<p>修改 nginx.conf</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210529091316970-592108341.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210529091316970-592108341.png" alt="img"></a></p>
<p>text</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location ~ /wx &#123;</span><br><span class="line">	proxy_pass http://localhost:8007;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>重启 nginx 然后在自行测试微信登录即可，重启命令如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210529091446379-1432669436.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210529091446379-1432669436.png" alt="img"></a></p>
<p>sh</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx.exe -s stop</span><br></pre></td></tr></table></figure>

<p>在 Controller 当中创建 WxController</p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@project</span> video_parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 微信请求控制器</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> Created in 2021/5/29 029 8:27</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/service_user/user/wx&quot;)</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WxController</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserService userService;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 记录当前是否已经登录</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> isLogin;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 记录当前是否扫码登录失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> isLoginFail;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 当前登录用户token</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String jwtToken;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;b&gt;微信登录后端回调业务&lt;/b&gt;</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code</span></span><br><span class="line"><span class="comment">     *            code</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> state</span></span><br><span class="line"><span class="comment">     *            站点状态</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/callBack&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">callback</span><span class="params">(String code, String state)</span> &#123;</span><br><span class="line">        <span class="comment">// 从redis中将state获取出来，和当前传入的state作比较</span></span><br><span class="line">        <span class="comment">// 如果一致则放行，如果不一致则抛出异常：非法访问</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 需修改为自己的app环境</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">getToken</span> <span class="operator">=</span> <span class="string">&quot;https://api.weixin.qq.com/sns/oauth2/access_token?&quot;</span> + <span class="string">&quot;appid=%s&quot;</span> + <span class="string">&quot;&amp;secret=%s&quot;</span></span><br><span class="line">                + <span class="string">&quot;&amp;code=%s&quot;</span> + <span class="string">&quot;&amp;grant_type=authorization_code&quot;</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 拼接请求地址</span></span><br><span class="line">            getToken = String.format(getToken, WxConstantUtil.WX_OPEN_APP_ID, WxConstantUtil.WX_OPEN_APP_SECRET, code);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 回调获得code，通过用户授权的code去获取微信令牌</span></span><br><span class="line">            Map&lt;String, Object&gt; map = JSON.parseObject(HttpClientUtil.get(getToken));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 获取到了关键的令牌和openid后，</span></span><br><span class="line">            <span class="comment">// 就可以正式开始查询微信用户的信息，完成我们要做的微信绑定</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">accessToken</span> <span class="operator">=</span> (String)map.get(<span class="string">&quot;access_token&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">openId</span> <span class="operator">=</span> (String)map.get(<span class="string">&quot;openid&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 查询数据库当中有没有该用户</span></span><br><span class="line">            <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getByOpenId(openId);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 如果没有用户</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> == user) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">userInfo</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span> + <span class="string">&quot;https://api.weixin.qq.com/sns/userinfo?&quot;</span> + <span class="string">&quot;access_token=%s&quot;</span> + <span class="string">&quot;&amp;openid=%s&quot;</span>;</span><br><span class="line">                userInfo = String.format(userInfo, accessToken, openId);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 获取微信用户信息</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">wxUserInfo</span> <span class="operator">=</span> HttpClientUtil.get(userInfo);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 解析用户json信息</span></span><br><span class="line">                Map&lt;String, Object&gt; info = JSON.parseObject(wxUserInfo);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 获取昵称与头像</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">nickname</span> <span class="operator">=</span> (String)info.get(<span class="string">&quot;nickname&quot;</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">headImgUrl</span> <span class="operator">=</span> (String)info.get(<span class="string">&quot;headimgurl&quot;</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 向数据库中插入一条记录</span></span><br><span class="line">                user = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">                user.setNickname(nickname);</span><br><span class="line">                user.setOpenid(openId);</span><br><span class="line">                user.setAvatar(headImgUrl);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 保存用户信息</span></span><br><span class="line">                userService.save(user);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 使用jwt根据user对象生成token字符串</span></span><br><span class="line">            jwtToken = JwtUtils.getJwtToken(user.getId(), user.getNickname());</span><br><span class="line">            <span class="built_in">this</span>.isLogin = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="built_in">this</span>.isLoginFail = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * &lt;b&gt;校验是否已经登录&lt;/b&gt;</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 校验结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/checkLogin&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">checkLogin</span><span class="params">()</span> &#123;</span><br><span class="line">        ResponseResult result;</span><br><span class="line">        <span class="type">int</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="comment">// 如果登录状态已经,登录,返回用户token</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.isLogin) &#123;</span><br><span class="line">                result = ResponseResult.ok().data(<span class="string">&quot;token&quot;</span>, <span class="built_in">this</span>.jwtToken);</span><br><span class="line">                <span class="comment">// 状态复位</span></span><br><span class="line">                isLogin = <span class="literal">false</span>;</span><br><span class="line">                <span class="comment">// 退出</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 扫描登录失败 返回错误信息</span></span><br><span class="line">            <span class="keyword">if</span> (isLoginFail) &#123;</span><br><span class="line">                result = ResponseResult.error();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 每500毫秒查询一下状态</span></span><br><span class="line">                Thread.sleep(<span class="number">500</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 超时处理</span></span><br><span class="line">            <span class="keyword">if</span> (flag &gt; <span class="number">500</span>) &#123;</span><br><span class="line">                result = ResponseResult.error();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            flag++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改前端的 <code>default.vue</code> 导入 loginApi 如下图</p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> loginApi <span class="keyword">from</span> <span class="string">&quot;@/api/login&quot;</span>;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210529102017282-750649762.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210529102017282-750649762.png" alt="img"></a></p>
<h2 id="54-作品展示与播放-作者列表与详情"><a href="#54-作品展示与播放-作者列表与详情" class="headerlink" title="54-作品展示与播放-作者列表与详情"></a>54-作品展示与播放-作者列表与详情</h2><h3 id="接口准备"><a href="#接口准备" class="headerlink" title="接口准备"></a>接口准备</h3><h4 id="创建-author-js"><a href="#创建-author-js" class="headerlink" title="创建 author.js"></a>创建 author.js</h4><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210529111729002-1846210249.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210529111729002-1846210249.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> api_name = <span class="string">&#x27;/service_video/author&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">authorWebList</span>(<span class="params">page, limit</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/pageList/<span class="subst">$&#123;page&#125;</span>/<span class="subst">$&#123;limit&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">      <span class="attr">headers</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 获取作者的信息  个人信息与作品信息</span></span><br><span class="line">  <span class="title function_">getAuthorById</span>(<span class="params">authorId</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`<span class="subst">$&#123;api_name&#125;</span>/getAuthorById/<span class="subst">$&#123;authorId&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="后端服务"><a href="#后端服务" class="headerlink" title="后端服务"></a>后端服务</h4><p>修改 AuthorController.java</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210530091423720-1315393335.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210530091423720-1315393335.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;b&gt; 根据作者ID查询作者信息以及作者的作品 &lt;/b&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(value = &quot;getAuthorById/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> String id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> ResponseResult.ok().data(<span class="string">&quot;author&quot;</span>, authorService.getById(id)).data(<span class="string">&quot;contentList&quot;</span>,</span><br><span class="line">        contentService.selectByAuthorId(id));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改 ContentService.java</p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;b&gt; 根据作者id查询这个作者的作品列表 &lt;/b&gt;</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> authorId</span></span><br><span class="line"><span class="comment"> *            作者ID</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 作品</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">List&lt;Content&gt; <span class="title function_">selectByAuthorId</span><span class="params">(String authorId)</span>;</span><br></pre></td></tr></table></figure>

<p>修改 ContentServiceImpl.java</p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Content&gt; <span class="title function_">selectByAuthorId</span><span class="params">(String authorId)</span> &#123;</span><br><span class="line">    QueryWrapper&lt;Content&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;Content&gt;();</span><br><span class="line">    queryWrapper.eq(<span class="string">&quot;author_id&quot;</span>, authorId);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 按照最后更新时间倒序排列</span></span><br><span class="line">    queryWrapper.orderByDesc(<span class="string">&quot;gmt_modified&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> baseMapper.selectList(queryWrapper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="列表展示"><a href="#列表展示" class="headerlink" title="列表展示"></a>列表展示</h3><p>在 pages 下创建 author 文件夹，在 author 文件夹下面创建两个 vue 组件页面如下图</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210530091717776-1765369842.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210530091717776-1765369842.png" alt="img"></a></p>
<p>两个页面的内容都是之前写过的，不在一一说明直接上代码了，里面就用到了一个新的内容就是异步加载如下图所示</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210530191840326-447728567.png"><img src="https://img2020.cnblogs.com/blog/2105804/202105/2105804-20210530191840326-447728567.png" alt="img"></a></p>
<p>_id.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;section class=&quot;container&quot;&gt;</span><br><span class="line">    &lt;header class=&quot;comm-title&quot;&gt;</span><br><span class="line">      &lt;h2 class=&quot;fl tac&quot;&gt;</span><br><span class="line">        &lt;span class=&quot;c-333&quot;&gt;作者介绍&lt;/span&gt;</span><br><span class="line">      &lt;/h2&gt;</span><br><span class="line">    &lt;/header&gt;</span><br><span class="line">    &lt;div class=&quot;t-infor-wrap&quot;&gt;</span><br><span class="line">      &lt;!--</span><br><span class="line">      作者基本信息</span><br><span class="line">      --&gt;</span><br><span class="line">      &lt;section class=&quot;fl t-infor-box c-desc-content&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;mt20 ml20&quot;&gt;</span><br><span class="line">          &lt;section class=&quot;t-infor-pic&quot;&gt;</span><br><span class="line">            &lt;img :src=&quot;author.avatar&quot;&gt;</span><br><span class="line">          &lt;/section&gt;</span><br><span class="line">          &lt;h3 class=&quot;hLh30&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;fsize24 c-333&quot;&gt;</span><br><span class="line">              &#123;&#123; author.name &#125;&#125;&amp;nbsp; &#123;&#123; author.level === 1 ? &#x27;普通作者&#x27; : &#x27;特邀作者&#x27; &#125;&#125;</span><br><span class="line">            &lt;/span&gt;</span><br><span class="line">          &lt;/h3&gt;</span><br><span class="line">          &lt;section class=&quot;mt10&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;t-tag-bg&quot;&gt;&#123;&#123; author.intro &#125;&#125;&lt;/span&gt;</span><br><span class="line">          &lt;/section&gt;</span><br><span class="line">          &lt;section class=&quot;t-infor-txt&quot;&gt;</span><br><span class="line">            &lt;p class=&quot;mt20&quot;&gt;&#123;&#123; author.career &#125;&#125;&lt;/p&gt;</span><br><span class="line">          &lt;/section&gt;</span><br><span class="line">          &lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/section&gt;</span><br><span class="line">      &lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;section class=&quot;mt30&quot;&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;header class=&quot;comm-title all-teacher-title c-course-content&quot;&gt;</span><br><span class="line">          &lt;h2 class=&quot;fl tac&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;c-333&quot;&gt;作品信息&lt;/span&gt;</span><br><span class="line">          &lt;/h2&gt;</span><br><span class="line">          &lt;section class=&quot;c-tab-title&quot;&gt;</span><br><span class="line">            &lt;a href=&quot;javascript: void(0)&quot;&gt;&amp;nbsp;&lt;/a&gt;</span><br><span class="line">          &lt;/section&gt;</span><br><span class="line">        &lt;/header&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--</span><br><span class="line">        没有数据</span><br><span class="line">        --&gt;</span><br><span class="line">        &lt;section class=&quot;no-data-wrap&quot; v-if=&quot;contentList.length==0&quot;&gt;</span><br><span class="line">          &lt;em class=&quot;icon30 no-data-ico&quot;&gt;&amp;nbsp;&lt;/em&gt;</span><br><span class="line">          &lt;span class=&quot;c-666 fsize14 ml10 vam&quot;&gt;该作品还未发布作品&lt;/span&gt;</span><br><span class="line">        &lt;/section&gt;</span><br><span class="line">        &lt;article class=&quot;comm-video-list&quot;&gt;</span><br><span class="line">          &lt;ul class=&quot;of&quot; id=&quot;bna&quot;&gt;</span><br><span class="line">            &lt;li v-for=&quot;content in contentList&quot; :key=&quot;content.id&quot;&gt;</span><br><span class="line">              &lt;div class=&quot;cc-l-wrap&quot;&gt;</span><br><span class="line">                &lt;section class=&quot;video-img&quot;&gt;</span><br><span class="line">                  &lt;img :src=&quot;content.cover&quot; class=&quot;img-responsive&quot;&gt;</span><br><span class="line">                  &lt;div class=&quot;cc-mask&quot;&gt;</span><br><span class="line">                    &lt;a :href=&quot;&#x27;/video/&#x27;+content.id&quot; class=&quot;comm-btn c-btn-1&quot;&gt;播放&lt;/a&gt;</span><br><span class="line">                  &lt;/div&gt;</span><br><span class="line">                &lt;/section&gt;</span><br><span class="line">                &lt;h3 class=&quot;hLh30 txtOf mt10&quot;&gt;</span><br><span class="line">                  &lt;a :href=&quot;&#x27;/video/&#x27;+content.id&quot; class=&quot;course-title fsize18 c-333&quot;&gt;&#123;&#123; content.title &#125;&#125;&lt;/a&gt;</span><br><span class="line">                &lt;/h3&gt;</span><br><span class="line">                &lt;section class=&quot;mt10 hLh20 of&quot;&gt;</span><br><span class="line">                      &lt;span class=&quot;fr jgTag bg-orange&quot; v-if=&quot;Number(content.price) === 0&quot;&gt;</span><br><span class="line">                        &lt;i class=&quot;c-fff fsize12 f-fA&quot;&gt;免费&lt;/i&gt;</span><br><span class="line">                        &lt;/span&gt;</span><br><span class="line">                  &lt;span class=&quot;fr jgTag bg-orange&quot; v-else&gt;</span><br><span class="line">                        &lt;i class=&quot;c-fff fsize12 f-fA&quot;&gt; ￥&#123;&#123; content.price &#125;&#125;&lt;/i&gt;</span><br><span class="line">                        &lt;/span&gt;</span><br><span class="line">                  &lt;span class=&quot;fl jgAttr c-ccc f-fA&quot;&gt;</span><br><span class="line">                        &lt;i class=&quot;c-999 f-fA&quot;&gt;&#123;&#123; content.buyCount &#125;&#125; 人学习&lt;/i&gt;</span><br><span class="line">                                                |</span><br><span class="line">                        &lt;i class=&quot;c-999 f-fA&quot;&gt;&#123;&#123; content.viewCount &#125;&#125; 人浏览&lt;/i&gt;</span><br><span class="line">                        &lt;/span&gt;</span><br><span class="line">                &lt;/section&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">          &lt;/ul&gt;</span><br><span class="line">          &lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;/article&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/section&gt;</span><br><span class="line">  &lt;/section&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import author from &quot;@/api/author&quot;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  /*</span><br><span class="line">  接收参数：params内容为路由参数</span><br><span class="line">  * */</span><br><span class="line">  asyncData(&#123;params, error&#125;) &#123;</span><br><span class="line">    return author.getAuthorById(params.id).then(response =&gt; &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        // 作者信息</span><br><span class="line">        author: response.data.author,</span><br><span class="line">        // 作品列表</span><br><span class="line">        contentList: response.data.contentList</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>index.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=&quot;videoList&quot; class=&quot;bg-fa of&quot;&gt;</span><br><span class="line">    &lt;section class=&quot;container&quot; style=&quot;min-height: 600px;&quot;&gt;</span><br><span class="line">      &lt;section class=&quot;c-sort-box unBr&quot;&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &lt;!--</span><br><span class="line">          列表展示</span><br><span class="line">          --&gt;</span><br><span class="line">          &lt;article class=&quot;i-author-list&quot; style=&quot;padding-top: 50px;&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;yd-open-course-card open-course-card&quot; v-for=&quot;author in list&quot; :key=&quot;author.id&quot;&gt;</span><br><span class="line">              &lt;a :href=&quot;&#x27;/author/&#x27;+author.id&quot; style=&quot;color: #7F828B;text-decoration:none;&quot;&gt;</span><br><span class="line">                &lt;div class=&quot;yd-open-course-card_avatar&quot;&gt;</span><br><span class="line">                  &lt;img :src=&quot;author.avatar&quot; :alt=&quot;author.name&quot;&gt;&lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;yd-open-course-card_content_teacher&quot;&gt;</span><br><span class="line">                  &lt;div class=&quot;yd-open-course-card_content_teacher_tag&quot;&gt;&#123;&#123; author.name &#125;&#125;&lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;div&gt;&#123;&#123; author.intro &#125;&#125;&lt;/div&gt;</span><br><span class="line">                &lt;span&gt;-------------------------&lt;/span&gt;</span><br><span class="line">                &lt;div&gt;&#123;&#123; author.career &#125;&#125;&lt;/div&gt;</span><br><span class="line">              &lt;/a&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;</span><br><span class="line">          &lt;/article&gt;</span><br><span class="line">          &lt;!--</span><br><span class="line">          没有数据</span><br><span class="line">          --&gt;</span><br><span class="line">          &lt;section class=&quot;no-data-wrap&quot; v-if=&quot;total==0&quot;&gt;</span><br><span class="line">            &lt;em class=&quot;icon30 no-data-ico&quot;&gt;&amp;nbsp;&lt;/em&gt;</span><br><span class="line">            &lt;span class=&quot;c-666 fsize14 ml10 vam&quot;&gt;没有相关数据...&lt;/span&gt;</span><br><span class="line">          &lt;/section&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--</span><br><span class="line">        分页</span><br><span class="line">        --&gt;</span><br><span class="line">        &lt;el-pagination</span><br><span class="line">          style=&quot;padding: 30px 0; text-align: center&quot;</span><br><span class="line">          background</span><br><span class="line">          :current-page=&quot;page&quot;</span><br><span class="line">          :page-size=&quot;limit&quot;</span><br><span class="line">          layout=&quot;total, prev, pager, next, jumper &quot;</span><br><span class="line">          :total=&quot;total&quot;</span><br><span class="line">          @current-change=&quot;getData&quot;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;/section&gt;</span><br><span class="line">    &lt;/section&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import author from &quot;@/api/author&quot;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  asyncData(&#123;params, error&#125;) &#123;</span><br><span class="line">    return author.authorWebList(1, 3).then(response =&gt; &#123;</span><br><span class="line">      if (response.success === true) &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">          // 作者信息</span><br><span class="line">          list: response.data.rows,</span><br><span class="line">          // 作品列表</span><br><span class="line">          total: response.data.total</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    // 定义变量与初始值</span><br><span class="line">    return &#123;</span><br><span class="line">      // 数据列表</span><br><span class="line">      list: null,</span><br><span class="line">      // 总记录数</span><br><span class="line">      total: 0,</span><br><span class="line">      // 页码</span><br><span class="line">      page: 1,</span><br><span class="line">      // 每页记录数</span><br><span class="line">      limit: 3</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    // 分页切换  page:当前页</span><br><span class="line">    getData(page = 1) &#123;</span><br><span class="line">      // 调用api层获取数据库中的数据</span><br><span class="line">      this.page = page;</span><br><span class="line">      author.authorWebList(this.page, this.limit).then(response =&gt; &#123;</span><br><span class="line">        if (response.success === true) &#123;</span><br><span class="line">          this.list = response.data.rows;</span><br><span class="line">          this.total = response.data.total;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">::v-deep .el-pagination.is-background .el-pager li:not(.disabled).active &#123;</span><br><span class="line">  background-color: orangered;</span><br><span class="line">  color: #fff;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.open-course-card &#123;</span><br><span class="line">  width: 375px;</span><br><span class="line">  margin-top: 5px;</span><br><span class="line">  background: white;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.yd-open-course-card_avatar &#123;</span><br><span class="line">  float: left;</span><br><span class="line">  width: 80px;</span><br><span class="line">  height: 102px;</span><br><span class="line">  margin-right: 20px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.yd-open-course-card_avatar img &#123;</span><br><span class="line">  width: 100%;</span><br><span class="line">  height: 100%;</span><br><span class="line">  border-radius: 4px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.yd-open-course-card &#123;</span><br><span class="line">  font-family: PingFang SC;</span><br><span class="line">  padding: 12px;</span><br><span class="line">  box-sizing: border-box;</span><br><span class="line">  border: 1px solid rgba(153, 153, 153, 0.15);</span><br><span class="line">  border-radius: 8px;</span><br><span class="line">  height: 143px;</span><br><span class="line">  min-width: 300px;</span><br><span class="line">  max-width: 385px;</span><br><span class="line">  cursor: pointer;</span><br><span class="line">  float: left;</span><br><span class="line">  margin-right: 5px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.yd-open-course-card_content_teacher_tag &#123;</span><br><span class="line">  display: inline-block;</span><br><span class="line">  height: 17px;</span><br><span class="line">  font-weight: 600;</span><br><span class="line">  font-size: 12px;</span><br><span class="line">  line-height: 17px;</span><br><span class="line">  color: #f4ad0b;</span><br><span class="line">  background: rgba(244, 173, 11, 0.06);</span><br><span class="line">  border: 0.5px solid rgba(244, 173, 11, 0.4);</span><br><span class="line">  border-radius: 4px;</span><br><span class="line">  padding: 2px 4px;</span><br><span class="line">  margin-bottom: 10px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h3 id="修改前端"><a href="#修改前端" class="headerlink" title="修改前端"></a>修改前端</h3><p>创建 content.js</p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">getPageList</span>(<span class="params">page, limit, searchObj</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`/service_video/content/getContentPageQuery/<span class="subst">$&#123;page&#125;</span>/<span class="subst">$&#123;limit&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: searchObj</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 查询所有分类的方法</span></span><br><span class="line">  <span class="title function_">getAllCategory</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&#x27;/service_video/category/getTreeCategory&#x27;</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 根据作品id获取作品详情信息</span></span><br><span class="line">  <span class="title function_">geContentDetailById</span>(<span class="params">contentId</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`/service_video/content/getContentDeatail/<span class="subst">$&#123;contentId&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 pages 目录下的 video 文件夹下创建一个 _id.vue 组件如下图并且修改 index.vue 的内容, 修改内容如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605081650423-1942154246.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605081650423-1942154246.png" alt="img"></a></p>
<p>index.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=&quot;aCoursesList&quot; class=&quot;bg-fa of&quot;&gt;</span><br><span class="line">    &lt;section class=&quot;container&quot;&gt;</span><br><span class="line">      &lt;header class=&quot;comm-title&quot;&gt;</span><br><span class="line">      &lt;/header&gt;</span><br><span class="line">      &lt;section class=&quot;c-sort-box&quot;&gt;</span><br><span class="line">        &lt;section class=&quot;c-s-dl&quot;&gt;</span><br><span class="line">          &lt;dl&gt;</span><br><span class="line">            &lt;dt&gt;</span><br><span class="line">              &lt;span class=&quot;c-999 fsize14&quot;&gt;作品分类&lt;/span&gt;</span><br><span class="line">            &lt;/dt&gt;</span><br><span class="line">            &lt;dd class=&quot;c-s-dl-li&quot;&gt;</span><br><span class="line">              &lt;ul class=&quot;clearfix&quot;&gt;</span><br><span class="line">                &lt;li v-for=&quot;(item,index) in oneCategoryList&quot; :key=&quot;index&quot; :class=&quot;&#123;active:oneIndex==index&#125;&quot;&gt;</span><br><span class="line">                  &lt;a :title=&quot;item.title&quot; href=&quot;#&quot; @click=&quot;searchOne(item.id,index)&quot;&gt;&#123;&#123; item.title &#125;&#125; &lt;/a&gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">              &lt;/ul&gt;</span><br><span class="line">            &lt;/dd&gt;</span><br><span class="line">          &lt;/dl&gt;</span><br><span class="line">          &lt;dl&gt;</span><br><span class="line">            &lt;dt&gt;</span><br><span class="line">              &lt;span class=&quot;c-999 fsize14&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;/dt&gt;</span><br><span class="line">            &lt;dd class=&quot;c-s-dl-li&quot;&gt;</span><br><span class="line">              &lt;ul class=&quot;clearfix&quot;&gt;</span><br><span class="line">                &lt;li v-for=&quot;(item,index) in twoCategoryList&quot; :key=&quot;index&quot; :class=&quot;&#123;active:twoIndex==index&#125;&quot;&gt;</span><br><span class="line">                  &lt;a :title=&quot;item.title&quot; href=&quot;#&quot; @click=&quot;searchTwo(item.id,index)&quot;&gt;&#123;&#123; item.title &#125;&#125;&lt;/a&gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">              &lt;/ul&gt;</span><br><span class="line">            &lt;/dd&gt;</span><br><span class="line">          &lt;/dl&gt;</span><br><span class="line">          &lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;/section&gt;</span><br><span class="line">        &lt;div class=&quot;js-wrap&quot;&gt;</span><br><span class="line">          &lt;section class=&quot;fr&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;c-ccc&quot;&gt;</span><br><span class="line">              &lt;i class=&quot;c-master f-fM&quot;&gt;1&lt;/i&gt;/</span><br><span class="line">              &lt;i class=&quot;c-666 f-fM&quot;&gt;1&lt;/i&gt;</span><br><span class="line">            &lt;/span&gt;</span><br><span class="line">          &lt;/section&gt;</span><br><span class="line">          &lt;section class=&quot;fl&quot;&gt;</span><br><span class="line">            &lt;ol class=&quot;js-tap clearfix&quot;&gt;</span><br><span class="line">              &lt;li :class=&quot;&#123;&#x27;current bg-orangered&#x27;:buyCountSort!=&#x27;&#x27;&#125;&quot;&gt;</span><br><span class="line">                &lt;a title=&quot;销量&quot; href=&quot;javascript:void(0);&quot; @click=&quot;searchBuyCount()&quot;&gt;畅销</span><br><span class="line">                  &lt;span :class=&quot;&#123;hide:buyCountSort==&#x27;&#x27;&#125;&quot;&gt;↓&lt;/span&gt;</span><br><span class="line">                &lt;/a&gt;</span><br><span class="line">              &lt;/li&gt;</span><br><span class="line">              &lt;li :class=&quot;&#123;&#x27;current bg-orangered&#x27;:gmtCreateSort!=&#x27;&#x27;&#125;&quot;&gt;</span><br><span class="line">                &lt;a title=&quot;最新&quot; href=&quot;javascript:void(0);&quot; @click=&quot;searchGmtCreate()&quot;&gt;最新</span><br><span class="line">                  &lt;span :class=&quot;&#123;hide:gmtCreateSort==&#x27;&#x27;&#125;&quot;&gt;↓&lt;/span&gt;</span><br><span class="line">                &lt;/a&gt;</span><br><span class="line">              &lt;/li&gt;</span><br><span class="line">              &lt;li :class=&quot;&#123;&#x27;current bg-orangered&#x27;:priceSort!=&#x27;&#x27;&#125;&quot;&gt;</span><br><span class="line">                &lt;a title=&quot;价格&quot; href=&quot;javascript:void(0);&quot; @click=&quot;searchPrice()&quot;&gt;价格&amp;nbsp;</span><br><span class="line">                  &lt;span :class=&quot;&#123;hide:priceSort==&#x27;&#x27;&#125;&quot;&gt;↓&lt;/span&gt;</span><br><span class="line">                &lt;/a&gt;</span><br><span class="line">              &lt;/li&gt;</span><br><span class="line">            &lt;/ol&gt;</span><br><span class="line">          &lt;/section&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;mt40&quot;&gt;</span><br><span class="line">          &lt;!--</span><br><span class="line">          无数据提示 开始</span><br><span class="line">          --&gt;</span><br><span class="line">          &lt;section class=&quot;no-data-wrap&quot; v-if=&quot;data.length == 0&quot;&gt;</span><br><span class="line">            &lt;em class=&quot;icon30 no-data-ico&quot;&gt;&amp;nbsp;&lt;/em&gt;</span><br><span class="line">            &lt;span class=&quot;c-666 fsize14 ml10 vam&quot;&gt;没有相关数据...&lt;/span&gt;</span><br><span class="line">          &lt;/section&gt;</span><br><span class="line"></span><br><span class="line">          &lt;article class=&quot;comm-video-list&quot; style=&quot;min-height: 450px;&quot;&gt;</span><br><span class="line">            &lt;ul class=&quot;of&quot; id=&quot;bna&quot;&gt;</span><br><span class="line">              &lt;li v-for=&quot;item in data&quot; :key=&quot;item.id&quot;&gt;</span><br><span class="line">                &lt;div class=&quot;cc-l-wrap&quot;&gt;</span><br><span class="line">                  &lt;section class=&quot;video-img&quot;&gt;</span><br><span class="line">                    &lt;img :src=&quot;item.cover&quot; class=&quot;img-responsive&quot;&gt;</span><br><span class="line">                    &lt;div class=&quot;cc-mask&quot;&gt;</span><br><span class="line">                      &lt;a :href=&quot;&#x27;/video/&#x27;+item.id&quot; class=&quot;comm-btn c-btn-1&quot;&gt;播放&lt;/a&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                  &lt;/section&gt;</span><br><span class="line">                  &lt;h3 class=&quot;hLh30 txtOf mt10&quot;&gt;</span><br><span class="line">                    &lt;a :href=&quot;&#x27;/video/&#x27;+item.id&quot; class=&quot;course-title fsize18 c-333&quot;&gt;&#123;&#123; item.title &#125;&#125;&lt;/a&gt;</span><br><span class="line">                  &lt;/h3&gt;</span><br><span class="line">                  &lt;section class=&quot;mt10 hLh20 of&quot;&gt;</span><br><span class="line">                    &lt;span class=&quot;fr jgTag bg-orangered&quot; v-if=&quot;Number(item.price) === 0&quot;&gt;</span><br><span class="line">                        &lt;i class=&quot;c-fff fsize12 f-fA&quot;&gt;免费&lt;/i&gt;</span><br><span class="line">                    &lt;/span&gt;</span><br><span class="line">                    &lt;span class=&quot;fr jgTag bg-orangered&quot; v-else&gt;</span><br><span class="line">                        &lt;i class=&quot;c-fff fsize12 f-fA&quot;&gt; ￥&#123;&#123; item.price &#125;&#125;&lt;/i&gt;</span><br><span class="line">                        &lt;/span&gt;</span><br><span class="line">                    &lt;span class=&quot;fl jgAttr c-ccc f-fA&quot;&gt;</span><br><span class="line">                        &lt;i class=&quot;c-999 f-fA&quot;&gt;&#123;&#123; item.buyCount &#125;&#125; 人学习&lt;/i&gt;</span><br><span class="line">                                                |</span><br><span class="line">                        &lt;i class=&quot;c-999 f-fA&quot;&gt;&#123;&#123; item.viewCount &#125;&#125; 人浏览&lt;/i&gt;</span><br><span class="line">                    &lt;/span&gt;</span><br><span class="line">                  &lt;/section&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">              &lt;/li&gt;</span><br><span class="line">            &lt;/ul&gt;</span><br><span class="line">            &lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;</span><br><span class="line">          &lt;/article&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--</span><br><span class="line">        分页</span><br><span class="line">        --&gt;</span><br><span class="line">        &lt;el-pagination</span><br><span class="line">          style=&quot;padding: 30px 0; text-align: center&quot;</span><br><span class="line">          background</span><br><span class="line">          :current-page=&quot;page&quot;</span><br><span class="line">          :page-size=&quot;limit&quot;</span><br><span class="line">          layout=&quot;total, prev, pager, next, jumper &quot;</span><br><span class="line">          :total=&quot;total&quot;</span><br><span class="line">          @current-change=&quot;gotoPage&quot;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;/section&gt;</span><br><span class="line">    &lt;/section&gt;</span><br><span class="line">    &lt;!--</span><br><span class="line">    课程列表 结束</span><br><span class="line">    --&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import content from &#x27;@/api/content&#x27;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    // 定义变量与初始值</span><br><span class="line">    return &#123;</span><br><span class="line">      // 数据列表</span><br><span class="line">      list: null,</span><br><span class="line"></span><br><span class="line">      // 总记录数</span><br><span class="line">      total: 0,</span><br><span class="line"></span><br><span class="line">      // 页码</span><br><span class="line">      page: 1,</span><br><span class="line"></span><br><span class="line">      // 每页记录数</span><br><span class="line">      limit: 4,</span><br><span class="line">      data: [],</span><br><span class="line"></span><br><span class="line">      // 查询表单对象</span><br><span class="line">      searchObj: &#123;&#125;,</span><br><span class="line"></span><br><span class="line">      // 一级分类列表</span><br><span class="line">      oneCategoryList: [],</span><br><span class="line"></span><br><span class="line">      // 二级分类列表</span><br><span class="line">      twoCategoryList: [],</span><br><span class="line"></span><br><span class="line">      // 记录一级选中状态角标</span><br><span class="line">      oneIndex: -1,</span><br><span class="line"></span><br><span class="line">      // 记录二级选中状态角标</span><br><span class="line">      twoIndex: -1,</span><br><span class="line"></span><br><span class="line">      // 畅销排序</span><br><span class="line">      buyCountSort: &quot;&quot;,</span><br><span class="line"></span><br><span class="line">      // 日期排序</span><br><span class="line">      gmtCreateSort: &quot;&quot;,</span><br><span class="line"></span><br><span class="line">      // 价格排序</span><br><span class="line">      priceSort: &quot;&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  // 加载数据(异步)</span><br><span class="line">  async asyncData(&#123;params, error&#125;) &#123;</span><br><span class="line">    let [request1Data, request2Data] = await Promise.all([</span><br><span class="line">      content.getPageList(1, 4, &#123;&#125;),</span><br><span class="line">      content.getAllCategory()</span><br><span class="line">    ]);</span><br><span class="line">    return &#123;</span><br><span class="line">      data: request1Data.data.rows,</span><br><span class="line">      total: request1Data.data.total,</span><br><span class="line">      oneCategoryList: request2Data.data.list,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    // 分页查询</span><br><span class="line">    gotoPage(page) &#123;</span><br><span class="line">      this.page = page;</span><br><span class="line">      content.getPageList(page, this.limit, this.searchObj).then(response =&gt; &#123;</span><br><span class="line">        this.data = response.data.rows;</span><br><span class="line">        this.total = response.data.total;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 点击某个一级分类，查询对应二级分类</span><br><span class="line">    searchOne(categoryParentId, index) &#123;</span><br><span class="line">      // 把传递index值赋值给oneIndex,为了active样式生效</span><br><span class="line">      this.oneIndex = index;</span><br><span class="line"></span><br><span class="line">      this.twoIndex = -1;</span><br><span class="line">      this.searchObj.categoryId = &quot;&quot;;</span><br><span class="line">      this.twoCategoryList = [];</span><br><span class="line"></span><br><span class="line">      // 把一级分类点击id值，赋值给searchObj</span><br><span class="line">      this.searchObj.categoryParentId = categoryParentId;</span><br><span class="line"></span><br><span class="line">      // 点击某个一级分类进行条件查询;</span><br><span class="line">      this.gotoPage(1);</span><br><span class="line"></span><br><span class="line">      // 拿着点击一级分类id 和 所有一级分类id进行比较，</span><br><span class="line">      // 如果id相同，从一级分类里面获取对应的二级分类</span><br><span class="line">      for (let i = 0; i &lt; this.oneCategoryList.length; i++) &#123;</span><br><span class="line">        // 获取每个一级分类</span><br><span class="line">        let oneCategory = this.oneCategoryList[i];</span><br><span class="line">        // 比较id是否相同</span><br><span class="line">        if (categoryParentId === oneCategory.id) &#123;</span><br><span class="line">          // 从一级分类里面获取对应的二级分类</span><br><span class="line">          this.twoCategoryList = oneCategory.children;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    // 点击某个二级分类实现查询</span><br><span class="line">    searchTwo(categoryId, index) &#123;</span><br><span class="line">      // 把index赋值,为了样式生效</span><br><span class="line">      this.twoIndex = index;</span><br><span class="line"></span><br><span class="line">      // 把二级分类点击id值，赋值给searchObj</span><br><span class="line">      this.searchObj.categoryId = categoryId;</span><br><span class="line"></span><br><span class="line">      //点击某个二级分类进行条件查询</span><br><span class="line">      this.gotoPage(1);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    // 根据销量排序</span><br><span class="line">    searchBuyCount() &#123;</span><br><span class="line">      // 设置对应变量值，为了样式生效</span><br><span class="line">      this.buyCountSort = &quot;1&quot;;</span><br><span class="line">      this.gmtCreateSort = &quot;&quot;;</span><br><span class="line">      this.priceSort = &quot;&quot;;</span><br><span class="line"></span><br><span class="line">      // 把值赋值到searchObj</span><br><span class="line">      this.searchObj.buyCountSort = this.buyCountSort;</span><br><span class="line">      this.searchObj.gmtCreateSort = this.gmtCreateSort;</span><br><span class="line">      this.searchObj.priceSort = this.priceSort;</span><br><span class="line"></span><br><span class="line">      // 调用方法查询</span><br><span class="line">      this.gotoPage(1);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    // 最新排序</span><br><span class="line">    searchGmtCreate() &#123;</span><br><span class="line">      // 设置对应变量值，为了样式生效</span><br><span class="line">      this.buyCountSort = &quot;&quot;;</span><br><span class="line">      this.gmtCreateSort = &quot;1&quot;;</span><br><span class="line">      this.priceSort = &quot;&quot;;</span><br><span class="line"></span><br><span class="line">      // 把值赋值到searchObj</span><br><span class="line">      this.searchObj.buyCountSort = this.buyCountSort;</span><br><span class="line">      this.searchObj.gmtCreateSort = this.gmtCreateSort;</span><br><span class="line">      this.searchObj.priceSort = this.priceSort;</span><br><span class="line"></span><br><span class="line">      // 调用方法查询</span><br><span class="line">      this.gotoPage(1);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    // 价格排序</span><br><span class="line">    searchPrice() &#123;</span><br><span class="line">      // 设置对应变量值，为了样式生效</span><br><span class="line">      this.buyCountSort = &quot;&quot;;</span><br><span class="line">      this.gmtCreateSort = &quot;&quot;;</span><br><span class="line">      this.priceSort = &quot;1&quot;;</span><br><span class="line"></span><br><span class="line">      // 把值赋值到searchObj</span><br><span class="line">      this.searchObj.buyCountSort = this.buyCountSort;</span><br><span class="line">      this.searchObj.gmtCreateSort = this.gmtCreateSort;</span><br><span class="line">      this.searchObj.priceSort = this.priceSort;</span><br><span class="line"></span><br><span class="line">      // 调用方法查询</span><br><span class="line">      this.gotoPage(1);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">/*</span><br><span class="line">如果需要修改 element-ui的样式前面需要加上如下前缀 ::v-deep</span><br><span class="line">*/</span><br><span class="line">::v-deep .el-pagination.is-background .el-pager li:not(.disabled).active &#123;</span><br><span class="line">  background-color: orangered;</span><br><span class="line">  color: #fff;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.active &#123;</span><br><span class="line">  background: orangered;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.active a &#123;</span><br><span class="line">  color: white;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.active a:hover &#123;</span><br><span class="line">  color: white;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.hide &#123;</span><br><span class="line">  display: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.show &#123;</span><br><span class="line">  display: block;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>前面的章节当中已经讲解过了所以这里就直接上代码了, 如上是 index.vue 的内容 _id.vue 组件的内容如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=&quot;videoList&quot; class=&quot;bg-fa of&quot;&gt;</span><br><span class="line">    &lt;section class=&quot;container&quot;&gt;</span><br><span class="line">      &lt;section class=&quot;path-wrap txtOf hLh30&quot;&gt;</span><br><span class="line">        &lt;a href=&quot;#&quot; title class=&quot;c-999 fsize14&quot;&gt;首页&lt;/a&gt;</span><br><span class="line">        \</span><br><span class="line">        &lt;a href=&quot;/course&quot; title class=&quot;c-999 fsize14&quot;&gt;作品列表&lt;/a&gt;</span><br><span class="line">        \</span><br><span class="line">        &lt;span class=&quot;c-333 fsize14&quot;&gt;&#123;&#123; content.oneCategoryName &#125;&#125;&lt;/span&gt;</span><br><span class="line">        \</span><br><span class="line">        &lt;span class=&quot;c-333 fsize14&quot;&gt;&#123;&#123; content.twoCategoryName &#125;&#125;&lt;/span&gt;</span><br><span class="line">      &lt;/section&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;div class=&quot;content-box&quot;&gt;</span><br><span class="line">          &lt;div class=&quot;fl&quot;&gt;</span><br><span class="line">            &lt;img width=&quot;450&quot; height=&quot;250&quot; :src=&quot;content.cover&quot;/&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;div class=&quot;fl u-coursetitle&quot;&gt;</span><br><span class="line">            &lt;h2&gt;</span><br><span class="line">              &lt;span class=&quot;u-coursetitle_title&quot;&gt;&#123;&#123; content.title &#125;&#125;&lt;/span&gt;</span><br><span class="line">            &lt;/h2&gt;</span><br><span class="line">            &lt;div style=&quot;margin-top: 10px; &quot;&gt;</span><br><span class="line">              &lt;div class=&quot;fl&quot;&gt;&#123;&#123; content.buyCount &#125;&#125;人学过&lt;/div&gt;</span><br><span class="line">              &lt;div class=&quot;fl hot&quot;&gt;</span><br><span class="line">                &lt;el-rate</span><br><span class="line">                  v-model=&quot;value&quot;</span><br><span class="line">                  disabled</span><br><span class="line">                  show-score</span><br><span class="line">                  text-color=&quot;#ff9900&quot;</span><br><span class="line">                  score-template=&quot;&#123;value&#125;&quot;&gt;</span><br><span class="line">                &lt;/el-rate&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">              &lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div v-if=&quot;Number(content.price) != 0&quot; style=&quot;font-size: 28px; margin-top: 30px;&quot;&gt;</span><br><span class="line">              ¥ &#123;&#123; content.price &#125;&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div class=&quot;join&quot;&gt;</span><br><span class="line">              &lt;a @click=&quot;createOrders&quot; class=&quot;learnbtn&quot;</span><br><span class="line">                 v-if=&quot;Number(content.price) != 0 &amp;&amp; isBuy == false&quot;&gt;&lt;span&gt;立即购买&lt;/span&gt;&lt;/a&gt;</span><br><span class="line">              &lt;a href=&quot;#&quot; class=&quot;j-do-trailer&quot;</span><br><span class="line">                 v-if=&quot;Number(content.price) === 0 || isBuy== true&quot;&gt;&lt;span&gt;立即学习&lt;/span&gt;</span><br><span class="line">              &lt;/a&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class=&quot;mt20 c-infor-box&quot;&gt;</span><br><span class="line">        &lt;article class=&quot;fl col-7&quot;&gt;</span><br><span class="line">          &lt;section class=&quot;mr30&quot;&gt;</span><br><span class="line">            &lt;el-tabs v-model=&quot;activeName&quot; @tab-click=&quot;handleClick&quot;&gt;</span><br><span class="line">              &lt;el-tab-pane style=&quot;padding-left: 20px&quot; label=&quot;视频介绍&quot; name=&quot;first&quot;&gt;</span><br><span class="line">                &lt;div&gt;</span><br><span class="line">                  &lt;h6 class=&quot;c-i-content c-infor-title&quot;&gt;</span><br><span class="line">                    &lt;span&gt;课程介绍&lt;/span&gt;</span><br><span class="line">                  &lt;/h6&gt;</span><br><span class="line">                  &lt;div class=&quot;course-txt-body-wrap&quot;&gt;</span><br><span class="line">                    &lt;section class=&quot;course-txt-body&quot; style=&quot;padding: 20px;&quot;&gt;</span><br><span class="line">                      &lt;div v-html=&quot;content.description&quot;&gt;&lt;/div&gt;</span><br><span class="line">                    &lt;/section&gt;</span><br><span class="line">                  &lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">              &lt;/el-tab-pane&gt;</span><br><span class="line">              &lt;el-tab-pane label=&quot;视频目录&quot; name=&quot;second&quot;&gt;</span><br><span class="line">                &lt;div&gt;</span><br><span class="line">                  &lt;div class=&quot;f-cb&quot;&gt;</span><br><span class="line">                    &lt;h2 class=&quot;u-ctit f-thide f-fl&quot;&gt;目录&lt;/h2&gt;</span><br><span class="line">                  &lt;/div&gt;</span><br><span class="line">                  &lt;div class=&quot;m-chapterList f-pr&quot;&gt;</span><br><span class="line">                    &lt;div class=&quot;chapter&quot; v-for=&quot;(chapter,index) in chapterList&quot; :key=&quot;chapter.id&quot;&gt;</span><br><span class="line">                      &lt;div class=&quot;chapterhead&quot;&gt;</span><br><span class="line">                        &lt;span class=&quot;f-fl f-thide chaptertitle&quot;&gt;章节&#123;&#123; index + 1 &#125;&#125;:&lt;/span&gt;</span><br><span class="line">                        &lt;span class=&quot;f-fl f-thide chaptername&quot;&gt;&#123;&#123; chapter.title &#125;&#125;&lt;/span&gt;</span><br><span class="line">                      &lt;/div&gt;</span><br><span class="line">                      &lt;div&gt;</span><br><span class="line">                        &lt;div class=&quot;section&quot; v-for=&quot;(video,i) in chapter.children&quot; :key=&quot;video.id&quot;&gt;</span><br><span class="line">                          &lt;!--</span><br><span class="line">                          &lt;a  :href=&quot;&#x27;/player/&#x27;+video.videoSourceId+&#x27;_&#x27;+contentId&quot; &gt;</span><br><span class="line">                          --&gt;</span><br><span class="line">                          &lt;a @click=&quot;playClick(video.videoSourceId+&#x27;_&#x27;+contentId,video.isFree,$event)&quot;&gt;</span><br><span class="line">                            &lt;span class=&quot;f-fl f-thide ks&quot;&gt;小节&#123;&#123; i + 1 &#125;&#125;&lt;/span&gt;&lt;span class=&quot;f-fl type-title&quot;&gt;视频&lt;/span&gt;</span><br><span class="line">                            &lt;span class=&quot;f-fl f-thide ksname&quot;&gt;&#123;&#123; video.title &#125;&#125;&lt;/span&gt;</span><br><span class="line">                            &lt;a class=&quot;f-fr ksjbtn j-hovershow&quot; style=&quot;display: none;&quot;&gt;</span><br><span class="line">                              &lt;span class=&quot;f-fr&quot; v-if=&quot;video.isFree === true&quot;&gt;可试看&lt;/span&gt;</span><br><span class="line">                              &lt;div class=&quot;f-fr ksjicon-look&quot;&gt;&lt;/div&gt;</span><br><span class="line">                            &lt;/a&gt;</span><br><span class="line">                            &lt;span class=&quot;f-fr ksinfo j-hoverhide&quot; style=&quot;display: block;&quot;&gt;</span><br><span class="line">                                &lt;span class=&quot;f-fr f-thide kstime&quot;&gt;&#123;&#123; video.duration &#125;&#125;&lt;/span&gt;</span><br><span class="line">                                &lt;span class=&quot;f-fr ksinfoicon ksinfoicon-2&quot; title=&quot;视频&quot;&gt;&lt;/span&gt;</span><br><span class="line">                                &lt;span class=&quot;f-fr canPreview&quot; v-if=&quot;video.isFree === true&quot;&gt;可试看&lt;/span&gt;</span><br><span class="line">                              &lt;/span&gt;</span><br><span class="line">                          &lt;/a&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                      &lt;/div&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                  &lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">              &lt;/el-tab-pane&gt;</span><br><span class="line">            &lt;/el-tabs&gt;</span><br><span class="line">          &lt;/section&gt;</span><br><span class="line">        &lt;/article&gt;</span><br><span class="line">        &lt;aside class=&quot;fl col-3&quot;&gt;</span><br><span class="line">          &lt;div class=&quot;i-box&quot;&gt;</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">              &lt;section class=&quot;c-infor-tabTitle c-tab-title&quot;&gt;</span><br><span class="line">                &lt;a title href=&quot;javascript:void(0)&quot;&gt;作者&lt;/a&gt;</span><br><span class="line">              &lt;/section&gt;</span><br><span class="line">              &lt;section class=&quot;stud-act-list&quot;&gt;</span><br><span class="line">                &lt;ul style=&quot;height: auto;&quot;&gt;</span><br><span class="line">                  &lt;li&gt;</span><br><span class="line">                    &lt;div class=&quot;u-face&quot;&gt;</span><br><span class="line">                      &lt;a :href=&quot;&#x27;/author/&#x27;+content.authorId&quot;&gt;</span><br><span class="line">                        &lt;img :src=&quot;content.avatar&quot; width=&quot;50&quot; height=&quot;50&quot; alt&gt;</span><br><span class="line">                      &lt;/a&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    &lt;section class=&quot;hLh30 txtOf&quot;&gt;</span><br><span class="line">                      &lt;a class=&quot;c-333 fsize16 fl&quot; href=&quot;#&quot;&gt;&#123;&#123; content.authorName &#125;&#125;&lt;/a&gt;</span><br><span class="line">                    &lt;/section&gt;</span><br><span class="line">                    &lt;section class=&quot;hLh20 txtOf&quot;&gt;</span><br><span class="line">                      &lt;span class=&quot;c-999&quot;&gt;&#123;&#123; content.intro &#125;&#125;&lt;/span&gt;</span><br><span class="line">                    &lt;/section&gt;</span><br><span class="line">                  &lt;/li&gt;</span><br><span class="line">                &lt;/ul&gt;</span><br><span class="line">              &lt;/section&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/aside&gt;</span><br><span class="line">        &lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/section&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import content from &quot;@/api/content&quot;;</span><br><span class="line">import order from &quot;@/api/order&quot;;</span><br><span class="line">import cookie from &#x27;js-cookie&#x27;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  async asyncData(app) &#123;</span><br><span class="line">    //在nuxt中如果没有做任何处理, 是不能直接获取到cookie node.js</span><br><span class="line">    let content_id = app.params.id;</span><br><span class="line">    return content.geContentDetailById(content_id, app).then(response =&gt; &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        contentId: content_id,</span><br><span class="line">        content: response.data.content,</span><br><span class="line">        chapterList: response.data.chapterVoList,</span><br><span class="line">        isBuy: response.data.isBuyContent</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      content: &#x27;&#x27;,</span><br><span class="line">      chapterList: &#x27;&#x27;,</span><br><span class="line">      contentId: &#x27;&#x27;,</span><br><span class="line">      activeName: &#x27;second&#x27;,</span><br><span class="line">      value: 4.5,</span><br><span class="line">      isBuy: false</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    playClick(videoId, isFree, e) &#123;</span><br><span class="line">      if (isFree) &#123;</span><br><span class="line">        // nuxt 中 使用到了jquery</span><br><span class="line">        $(e.currentTarget).attr(&#x27;href&#x27;, &#x27;/player/&#x27; + videoId);</span><br><span class="line">        $(e.currentTarget).trigger(&#x27;click&#x27;);</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        // 有没有登录</span><br><span class="line">        if (this.isLogin()) &#123;</span><br><span class="line">          if (this.isBuy) &#123;</span><br><span class="line">            $(e.currentTarget).attr(&#x27;href&#x27;, &#x27;/player/&#x27; + videoId);</span><br><span class="line">            $(e.currentTarget).trigger(&#x27;click&#x27;);</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            this.$message.warning(&quot;购买后才能观看&quot;);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          this.$message.warning(&quot;请先登录...&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    handleClick(tab, event) &#123;</span><br><span class="line">      this.activeName = tab.paneName;</span><br><span class="line">    &#125;,</span><br><span class="line">    // 生成订单</span><br><span class="line">    createOrders() &#123;</span><br><span class="line">      if (this.isLogin()) &#123;</span><br><span class="line">        order.createOrders(this.contentId)</span><br><span class="line">          .then(response =&gt; &#123;</span><br><span class="line">            // 获取返回订单号</span><br><span class="line">            // 生成订单之后，跳转订单显示页面</span><br><span class="line">            this.$router.push(&#123;path: &#x27;/order/&#x27; + response.data.orderId&#125;);</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        this.$message.warning(&quot;请先登录...&quot;);</span><br><span class="line">        return;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    isLogin() &#123;</span><br><span class="line">      let user = cookie.get(&#x27;portal_user&#x27;, &#123;domain: &#x27;localhost&#x27;&#125;);</span><br><span class="line">      if (user) &#123;</span><br><span class="line">        return true;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        false;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">&gt;&gt;&gt; .el-tabs__nav-scroll &#123;</span><br><span class="line">  background: white;</span><br><span class="line">  height: 40px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; .el-tabs__nav:first-child &#123;</span><br><span class="line">  margin-left: 15px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; .el-tab-pane &#123;</span><br><span class="line">  background: white;</span><br><span class="line">  border: 1px solid #f0f0f0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; .el-tab-pane:first-child &#123;</span><br><span class="line">  padding-top: 20px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; .el-rate__icon &#123;</span><br><span class="line">  margin-right: -2px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="55-作品展示与播放-作品详情页"><a href="#55-作品展示与播放-作品详情页" class="headerlink" title="55-作品展示与播放-作品详情页"></a>55-作品展示与播放-作品详情页</h2><h4 id="后端-8"><a href="#后端-8" class="headerlink" title="后端"></a>后端</h4><h5 id="创建-VO"><a href="#创建-VO" class="headerlink" title="创建 VO"></a>创建 VO</h5><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605175752293-1229354206.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605175752293-1229354206.png" alt="img"></a></p>
<p>ContentWebVO.java</p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@project</span> video_parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> Created in 2021/6/5 005 8:49</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ContentWebVO</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 作品标题</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 销售价格</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 合辑视频图</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer contentNum;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 封面图片路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String cover;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 销售数量</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long buyCount;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 浏览数量</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long viewCount;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 作品简介</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 作者ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String authorId;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 作者姓名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String authorName;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 作者简介</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String intro;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 作者头像</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String avatar;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 作品一级分类ID </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String oneCategoryId;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 一级类别名称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String oneCategoryName;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 二级分类ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String twoCategoryId;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 二级分类名称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String twoCategoryName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="接口准备-1"><a href="#接口准备-1" class="headerlink" title="接口准备"></a>接口准备</h5><p>修改 ContentController.java</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605175905509-2080562173.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605175905509-2080562173.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据作品id获取作品详情信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;根据作品id获取作品详情信息&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/getContentDeatail/&#123;contentId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> String contentId, HttpServletRequest request)</span> &#123;</span><br><span class="line">    <span class="comment">// 查询作品信息和作者信息</span></span><br><span class="line">    <span class="type">ContentWebVO</span> <span class="variable">contentWebVo</span> <span class="operator">=</span> contentService.selectContentDetailById(contentId);</span><br><span class="line">    <span class="comment">// 查询当前作品的章节信息</span></span><br><span class="line">    List&lt;ChapterVO&gt; chapterVoList = chapterService.getChapterContentVideo(contentId);</span><br><span class="line">    <span class="keyword">return</span> ResponseResult.ok().data(<span class="string">&quot;content&quot;</span>, contentWebVo).data(<span class="string">&quot;chapterVoList&quot;</span>, chapterVoList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改 ContentService.java</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605175951667-1370064017.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605175951667-1370064017.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取作品信息</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> contentId</span></span><br><span class="line"><span class="comment"> *            作品Id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 作品信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">ContentWebVO <span class="title function_">selectContentDetailById</span><span class="params">(String contentId)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 更新作品浏览数</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> *            作品ID</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">updatePageViewCount</span><span class="params">(String id)</span>;</span><br></pre></td></tr></table></figure>

<p>修改 ContentServiceImpl.java</p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ContentWebVO <span class="title function_">selectContentDetailById</span><span class="params">(String contentId)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.updatePageViewCount(contentId);</span><br><span class="line">    <span class="keyword">return</span> baseMapper.getContentDetailById(contentId);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 更新播放信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updatePageViewCount</span><span class="params">(String id)</span> &#123;</span><br><span class="line">    <span class="type">Content</span> <span class="variable">content</span> <span class="operator">=</span> baseMapper.selectById(id);</span><br><span class="line">    content.setViewCount(content.getViewCount() + <span class="number">1</span>);</span><br><span class="line">    baseMapper.updateById(content);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改 ContentMapper.java</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605182257444-395642040.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605182257444-395642040.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取作品信息</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> contentId</span></span><br><span class="line"><span class="comment"> *            作品ID</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 作品信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">ContentWebVO <span class="title function_">getContentDetailById</span><span class="params">(String contentId)</span>;</span><br></pre></td></tr></table></figure>

<p>修改 ContentMapper.xml</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605182342373-1454095575.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605182342373-1454095575.png" alt="img"></a></p>
<p>xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getContentDetailById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;top.it6666.common_utils.entity.ContentWebVO&quot;</span>&gt;</span></span><br><span class="line">    SELECT c.id,</span><br><span class="line">           c.title,</span><br><span class="line">           c.cover,</span><br><span class="line">           CONVERT(c.price, DECIMAL(8, 2)) AS price,</span><br><span class="line">           c.content_num                   AS contentNum,</span><br><span class="line">           c.cover,</span><br><span class="line">           c.buy_count                     AS buyCount,</span><br><span class="line">           c.view_count                    AS viewCount,</span><br><span class="line">           cd.description,</span><br><span class="line">           t.id                            AS authorId,</span><br><span class="line">           t.name                          AS authorName,</span><br><span class="line">           t.intro,</span><br><span class="line">           t.avatar,</span><br><span class="line">           s1.id                           AS oneCategoryId,</span><br><span class="line">           s1.title                        AS oneCategoryName,</span><br><span class="line">           s2.id                           AS twoCategoryId,</span><br><span class="line">           s2.title                        AS twoCategoryName</span><br><span class="line">    FROM video_content c</span><br><span class="line">                 LEFT JOIN video_content_description cd ON c.id = cd.id</span><br><span class="line">                 LEFT JOIN video_author t ON c.author_id = t.id</span><br><span class="line">                 LEFT JOIN video_category s1 ON c.category_parent_id = s1.id</span><br><span class="line">                 LEFT JOIN video_category s2 ON c.category_id = s2.id</span><br><span class="line">    WHERE c.id = #&#123;contentId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后在紧接着修改 ChapterService.java</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605180300381-628271375.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605180300381-628271375.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询当前作品的章节信息</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> contentId</span></span><br><span class="line"><span class="comment"> *            作品ID</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 章节信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">List&lt;ChapterVO&gt; <span class="title function_">getChapterContentVideo</span><span class="params">(String contentId)</span>;</span><br></pre></td></tr></table></figure>

<p>修改 ChapterServiceImpl.java</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605180341362-1015320856.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605180341362-1015320856.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;ChapterVO&gt; <span class="title function_">getChapterContentVideo</span><span class="params">(String contentId)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.根据作品的id查询所有的作品章节</span></span><br><span class="line">    QueryWrapper&lt;Chapter&gt; chapterQueryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    chapterQueryWrapper.eq(<span class="string">&quot;content_id&quot;</span>, contentId);</span><br><span class="line"></span><br><span class="line">    List&lt;Chapter&gt; chapterList = baseMapper.selectList(chapterQueryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.根据作品的id查询所有的作品小节</span></span><br><span class="line">    QueryWrapper&lt;ContentVideo&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(<span class="string">&quot;content_id&quot;</span>, contentId);</span><br><span class="line">    List&lt;ContentVideo&gt; contentVideoList = contentVideoService.list(queryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.封装数据</span></span><br><span class="line">    List&lt;ChapterVO&gt; resList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 遍历所有的章节信息</span></span><br><span class="line">    chapterList.forEach(chapter -&gt; &#123;</span><br><span class="line">        <span class="comment">// 把章节信息转成ChapterVO</span></span><br><span class="line">        <span class="type">ChapterVO</span> <span class="variable">chapterVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChapterVO</span>();</span><br><span class="line">        BeanUtils.copyProperties(chapter, chapterVO);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// chapterVO封装小节数据</span></span><br><span class="line">        List&lt;ContentVideoVO&gt; children = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        contentVideoList.forEach(contentVideo -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (contentVideo.getChapterId().equals(chapter.getId())) &#123;</span><br><span class="line">                <span class="comment">// 是当前章节的小节</span></span><br><span class="line">                <span class="type">ContentVideoVO</span> <span class="variable">contentVideoVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ContentVideoVO</span>();</span><br><span class="line">                BeanUtils.copyProperties(contentVideo, contentVideoVO);</span><br><span class="line">                children.add(contentVideoVO);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        chapterVO.setChildren(children);</span><br><span class="line">        resList.add(chapterVO);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> resList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如上后端的内容已经写完了接下来看看前端, 如下图中的链接跳转在上一节的文章当中已经完成了所以在这里只是为了理逻辑, 列表页点击跳转到作品详情页, 是如下的位置进行跳转的</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605180642934-1487141581.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605180642934-1487141581.png" alt="img"></a></p>
<p>前端的内容其实我们在上一节当中已经写完了这里是只来说一下 video 文件夹下的 _id.vue 里面的结构只要分为那几块</p>
<p>分类信息</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605181357553-1459712993.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605181357553-1459712993.png" alt="img"></a></p>
<p>作品信息</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605181929022-1679971653.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605181929022-1679971653.png" alt="img"></a></p>
<p>作者信息</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605182006668-758885150.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605182006668-758885150.png" alt="img"></a></p>
<p>目录信息</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605182050478-1214561569.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605182050478-1214561569.png" alt="img"></a></p>
<h2 id="56-作品展示与播放-播放器页面"><a href="#56-作品展示与播放-播放器页面" class="headerlink" title="56-作品展示与播放-播放器页面"></a>56-作品展示与播放-播放器页面</h2><h4 id="后端-9"><a href="#后端-9" class="headerlink" title="后端"></a>后端</h4><p>在返回页面当中, 要有 video_source_id, 修改 ContentVideoVO.java</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605182543093-197183625.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605182543093-197183625.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 视频sourcedId</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> String videoSourceId;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 期间</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> Float duration;</span><br></pre></td></tr></table></figure>

<p>新增根据视频 id 获取视频凭证 api 如下图修改 service_vod 微服务</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605182653619-2137136062.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605182653619-2137136062.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据视频id获取视频凭证</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;根据视频id获取视频凭证&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;getPlayAuth/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">getPlayAuth</span><span class="params">(<span class="meta">@PathVariable</span> String id)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 创建初始化对象</span></span><br><span class="line">        <span class="type">DefaultAcsClient</span> <span class="variable">client</span> <span class="operator">=</span></span><br><span class="line">            ALiYunVodSdkUtils.initVodClient(VodConstant.ACCESS_KEY_ID, VodConstant.ACCESS_KEY_SECRET);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建获取凭证request和response对象</span></span><br><span class="line">        <span class="type">GetVideoPlayAuthRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GetVideoPlayAuthRequest</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 向request设置视频id</span></span><br><span class="line">        request.setVideoId(id);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 调用方法得到凭证</span></span><br><span class="line">        <span class="type">GetVideoPlayAuthResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.getAcsResponse(request);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok().data(<span class="string">&quot;playAuth&quot;</span>, response.getPlayAuth());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BnTangException</span>(<span class="number">20001</span>, <span class="string">&quot;获取凭证失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="修改前端-1"><a href="#修改前端-1" class="headerlink" title="修改前端"></a>修改前端</h4><p>创建 vod.js</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605182939868-244018837.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605182939868-244018837.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// 请求播放凭证</span></span><br><span class="line">  <span class="title function_">getPlayAuth</span>(<span class="params">vid</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">`/service_vod/vod/getPlayAuth/<span class="subst">$&#123;vid&#125;</span>`</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 layout 当中创建 video 布局页面</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605183033672-516228720.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605183033672-516228720.png" alt="img"></a></p>
<p>创建 <code>video.vue</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;video_body&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;content&quot;&gt;</span><br><span class="line">      &lt;nuxt/&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>在 pages 当中创建 player 文件夹在当中创建 <code>_vid.vue</code> 页面内容如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605184015410-663144811.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605184015410-663144811.png" alt="img"></a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;!--</span><br><span class="line">    阿里云视频播放器样式</span><br><span class="line">    --&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot;</span><br><span class="line">          href=&quot;https://g.alicdn.com/de/prismplayer/2.8.1/skins/default/aliplayer-min.css&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--</span><br><span class="line">    阿里云视频播放器脚本</span><br><span class="line">    --&gt;</span><br><span class="line">    &lt;script charset=&quot;utf-8&quot; type=&quot;text/javascript&quot;</span><br><span class="line">            src=&quot;https://g.alicdn.com/de/prismplayer/2.8.1/aliplayer-min.js&quot;/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--</span><br><span class="line">    播放器页面布局</span><br><span class="line">    --&gt;</span><br><span class="line">    &lt;div class=&quot;video_content&quot;&gt;</span><br><span class="line">      &lt;!--</span><br><span class="line">      左侧播放器</span><br><span class="line">      --&gt;</span><br><span class="line">      &lt;div class=&quot;back_button&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--</span><br><span class="line">        视频上方返回链接</span><br><span class="line">        --&gt;</span><br><span class="line">        &lt;a :href=&quot;&#x27;/video/&#x27;+contentId&quot;&gt;</span><br><span class="line">          &lt;i class=&quot;el-icon-back&quot; style=&quot;font-size: 25px; color: white; position: absolute; left: 12px; top: 28px;&quot;/&gt;|</span><br><span class="line">          &lt;span&gt;&#123;&#123; content.title &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;/a&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;!--</span><br><span class="line">      播放器信息</span><br><span class="line">      --&gt;</span><br><span class="line">      &lt;div id=&quot;J_prismPlayer&quot; class=&quot;prism-player&quot;/&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--</span><br><span class="line">    右侧目录</span><br><span class="line">    --&gt;</span><br><span class="line">    &lt;div class=&quot;catalogue&quot;&gt;</span><br><span class="line">      &lt;!--</span><br><span class="line">      顶部作品信息</span><br><span class="line">      --&gt;</span><br><span class="line">      &lt;div class=&quot;videoPlay_right_top&quot;&gt;</span><br><span class="line">        &lt;img :src=&quot;content.cover&quot;&gt;</span><br><span class="line">        &lt;span&gt;</span><br><span class="line">          &lt;p class=&quot;dan&quot;&gt;&#123;&#123; content.title &#125;&#125;&lt;/p&gt;</span><br><span class="line">          &lt;span style=&quot;color:white&quot;&gt;购买人数：&lt;/span&gt;</span><br><span class="line">            &lt;i class=&quot;pinfen_num&quot;&gt;&#123;&#123; content.buyCount &#125;&#125;&lt;/i&gt;</span><br><span class="line">         &lt;/span&gt;</span><br><span class="line">        &lt;div class=&quot;clearfix&quot;&gt;&lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class=&quot;line&quot;&gt;&lt;/div&gt;</span><br><span class="line">      &lt;div class=&quot;m-chapterList&quot;&gt;</span><br><span class="line">        &lt;div v-for=&quot;(chapter,index) in chapterList&quot; :key=&quot;chapter.id&quot;&gt;</span><br><span class="line">          &lt;div class=&quot;chapter&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;f-fl ch&quot;&gt;章节&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;f-fl f-thide chaptericon&quot;&gt;&lt;span&gt;&#123;&#123; index + 1 &#125;&#125;&lt;/span&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;f-fl f-thide chaptername&quot;&gt;&#123;&#123; chapter.title &#125;&#125;&lt;/span&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;div class=&quot;section&quot;</span><br><span class="line">               :class=&quot;video.videoSourceId == vid?&#x27;video_active&#x27;:&#x27;&#x27;&quot;</span><br><span class="line">               v-for=&quot;video in chapter.children&quot; :key=&quot;video.id&quot;</span><br><span class="line">               @click=&quot;videoClick(video.videoSourceId,video.isFree)&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;f-fl f-thide ks&quot; style=&quot;color: rgb(153, 153, 153);&quot;&gt;&amp;nbsp;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;f-fl ksw&quot; style=&quot;background: rgb(245, 247, 250);&quot;&gt;</span><br><span class="line">                &lt;span class=&quot;u-clicon ksicon ksicon-20&quot; title=&quot;进行中&quot;&gt;&lt;/span&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;f-fl ksname&quot; style=&quot;color: rgb(153, 153, 153);&quot;&gt;&#123;&#123; video.title &#125;&#125;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;f-fr ksinfo&quot;&gt;&lt;span class=&quot;f-fr ksinfoicon ksinfoicon-2&quot; title=&quot;视频&quot;&gt;&lt;/span&gt;</span><br><span class="line">                &lt;span class=&quot;f-fr kstime&quot;&gt;&#123;&#123; video.duration &#125;&#125;&lt;/span&gt;&lt;span class=&quot;f-fr flag flag-10&quot;&gt;&lt;/span&gt;</span><br><span class="line">              &lt;/span&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import vod from &#x27;@/api/vod&#x27;</span><br><span class="line">import content from &quot;@/api/content&quot;;</span><br><span class="line">import &quot;~/assets/css/video.css&quot;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  // 应用video布局</span><br><span class="line">  layout: &#x27;video&#x27;,</span><br><span class="line">  async asyncData(&#123;params, error&#125;) &#123;</span><br><span class="line"></span><br><span class="line">    // 传入了两个参数,使用_分隔 拆分参数</span><br><span class="line">    let arr = params.vid.split(&quot;_&quot;);</span><br><span class="line">    let vid = arr[0];</span><br><span class="line">    let contentId = arr[1];</span><br><span class="line">    let [request1Data, request2Data] = await Promise.all([</span><br><span class="line">      vod.getPlayAuth(vid),</span><br><span class="line">      content.geContentDetailById(contentId)</span><br><span class="line">    ]);</span><br><span class="line">    return &#123;</span><br><span class="line">      vid: vid,</span><br><span class="line">      playAuth: request1Data.data.playAuth,</span><br><span class="line">      content: request2Data.data.content,</span><br><span class="line">      chapterList: request2Data.data.chapterVoList</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      vid: &#x27;&#x27;,</span><br><span class="line">      contentId: &#x27;&#x27;,</span><br><span class="line">      aliPlayer: &#x27;&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    videoClick(vid) &#123;</span><br><span class="line">      this.vid = vid;</span><br><span class="line">      vod.getPlayAuth(vid).then(response =&gt; &#123;</span><br><span class="line">        this.playAuth = response.data.playAuth;</span><br><span class="line">        this.aliPlayer.replayByVidAndPlayAuth(vid, this.playAuth);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted() &#123;</span><br><span class="line">    // 页面渲染之后  created</span><br><span class="line">    this.aliPlayer = new Aliplayer(&#123;</span><br><span class="line">      id: &#x27;J_prismPlayer&#x27;,</span><br><span class="line">      // 视频id</span><br><span class="line">      vid: this.vid,</span><br><span class="line"></span><br><span class="line">      // 播放凭证</span><br><span class="line">      playauth: this.playAuth,</span><br><span class="line"></span><br><span class="line">      // 如果播放加密视频，则需设置encryptType=1，非加密视频无需设置此项</span><br><span class="line">      encryptType: &#x27;1&#x27;,</span><br><span class="line">      width: &#x27;1500px&#x27;,</span><br><span class="line">      height: &#x27;815px&#x27;,</span><br><span class="line"></span><br><span class="line">      // 以下可选设置 清晰度排序</span><br><span class="line">      qualitySort: &#x27;asc&#x27;,</span><br><span class="line"></span><br><span class="line">      // 返回音频还是视频</span><br><span class="line">      mediaType: &#x27;video&#x27;,</span><br><span class="line"></span><br><span class="line">      // 自动播放</span><br><span class="line">      autoplay: false,</span><br><span class="line"></span><br><span class="line">      // 直播</span><br><span class="line">      isLive: false,</span><br><span class="line"></span><br><span class="line">      // 循环播放</span><br><span class="line">      rePlay: false,</span><br><span class="line">      preload: true,</span><br><span class="line"></span><br><span class="line">      // 控制条的显示方式：鼠标悬停</span><br><span class="line">      controlBarVisibility: &#x27;hover&#x27;,</span><br><span class="line"></span><br><span class="line">      // 播放器类型：html5</span><br><span class="line">      useH5Prism: true,</span><br><span class="line">    &#125;, function (player) &#123;</span><br><span class="line">      console.log(&#x27;播放器创建成功&#x27;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h5 id="安装-jquery"><a href="#安装-jquery" class="headerlink" title="安装 jquery"></a>安装 jquery</h5><p>在当前项目中的命令行窗口中输入如下指令进行安装</p>
<p>sh</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install jquery</span><br></pre></td></tr></table></figure>

<p>安装好了还需要配置一下配置方式如下所示</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605183633201-2042668358.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605183633201-2042668358.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605183708522-2010452126.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605183708522-2010452126.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">plugins</span>: [</span><br><span class="line">  <span class="keyword">new</span> webpack.<span class="title class_">ProvidePlugin</span>(&#123;</span><br><span class="line">    <span class="string">&#x27;$&#x27;</span> : <span class="string">&#x27;jquery&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>跳转到播放器页面, 如上安装 jquery 主要是为了在跳转的时候添加一些逻辑不单单只是跳转, 还可能是有一些登录 ,支付的校验等等所以就没有使用跳转标签来跳转了</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605183801235-554242704.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605183801235-554242704.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605183931940-2104284185.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605183931940-2104284185.png" alt="img"></a></p>
<h2 id="57-支付操作-准备工作"><a href="#57-支付操作-准备工作" class="headerlink" title="57-支付操作-准备工作"></a>57-支付操作-准备工作</h2><h3 id="创建数据库表"><a href="#创建数据库表" class="headerlink" title="创建数据库表"></a>创建数据库表</h3><h4 id="订单表"><a href="#订单表" class="headerlink" title="订单表"></a>订单表</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `pay_order` (</span><br><span class="line">	`id` CHAR ( 19 ) NOT NULL DEFAULT &#x27;主键&#x27;,</span><br><span class="line">	`order_no` VARCHAR ( 20 ) NOT NULL DEFAULT &#x27;&#x27; COMMENT &#x27;订单号&#x27;,</span><br><span class="line">	`content_id` VARCHAR ( 19 ) NOT NULL DEFAULT &#x27;&#x27; COMMENT &#x27;作品id&#x27;,</span><br><span class="line">	`content_title` VARCHAR ( 100 ) DEFAULT NULL COMMENT &#x27;作品名称&#x27;,</span><br><span class="line">	`content_cover` VARCHAR ( 255 ) DEFAULT NULL COMMENT &#x27;作品封面&#x27;,</span><br><span class="line">	`author_name` VARCHAR ( 20 ) DEFAULT NULL COMMENT &#x27;作者名称&#x27;,</span><br><span class="line">	`user_id` VARCHAR ( 19 ) NOT NULL DEFAULT &#x27;&#x27; COMMENT &#x27;用户id&#x27;,</span><br><span class="line">	`nickname` VARCHAR ( 50 ) DEFAULT NULL COMMENT &#x27;用户昵称&#x27;,</span><br><span class="line">	`mobile` VARCHAR ( 11 ) DEFAULT NULL COMMENT &#x27;用户手机&#x27;,</span><br><span class="line">	`total_fee` DECIMAL ( 10, 2 ) DEFAULT &#x27;0.01&#x27; COMMENT &#x27;订单金额（分）&#x27;,</span><br><span class="line">	`pay_type` TINYINT ( 3 ) DEFAULT NULL COMMENT &#x27;支付类型（1：微信 2：支付宝）&#x27;,</span><br><span class="line">	`status` TINYINT ( 3 ) DEFAULT NULL COMMENT &#x27;订单状态（0：未支付 1：已支付）&#x27;,</span><br><span class="line">	`is_deleted` TINYINT ( 1 ) UNSIGNED NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;逻辑删除 1（true）已删除， 0（false）未删除&#x27;,</span><br><span class="line">	PRIMARY KEY ( `id` ),</span><br><span class="line">	UNIQUE KEY `ux_order_no` ( `order_no` ),</span><br><span class="line">	KEY `idx_content_id` ( `content_id` ),</span><br><span class="line">KEY `idx_user_id` ( `user_id` ) </span><br><span class="line">) ENGINE = INNODB DEFAULT CHARSET = utf8mb4 COMMENT = &#x27;订单&#x27;;</span><br></pre></td></tr></table></figure>

<h4 id="支付日志表"><a href="#支付日志表" class="headerlink" title="支付日志表"></a>支付日志表</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `pay_log` (</span><br><span class="line">	`id` CHAR ( 19 ) NOT NULL DEFAULT &#x27;主键&#x27;,</span><br><span class="line">	`order_no` VARCHAR ( 20 ) NOT NULL DEFAULT &#x27;&#x27; COMMENT &#x27;订单号&#x27;,</span><br><span class="line">	`pay_time` datetime DEFAULT NULL COMMENT &#x27;支付完成时间&#x27;,</span><br><span class="line">	`total_fee` DECIMAL ( 10, 2 ) DEFAULT &#x27;0.01&#x27; COMMENT &#x27;支付金额（分）&#x27;,</span><br><span class="line">	`transaction_id` VARCHAR ( 30 ) DEFAULT NULL COMMENT &#x27;交易流水号&#x27;,</span><br><span class="line">	`trade_state` CHAR ( 20 ) DEFAULT NULL COMMENT &#x27;交易状态&#x27;,</span><br><span class="line">	`pay_type` TINYINT ( 3 ) NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;支付类型（1：微信 2：支付宝）&#x27;,</span><br><span class="line">	`attr` text COMMENT &#x27;其他属性&#x27;,</span><br><span class="line">	`is_deleted` TINYINT ( 1 ) UNSIGNED NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;逻辑删除 1（true）已删除， 0（false）未删除&#x27;,</span><br><span class="line">	PRIMARY KEY ( `id` ),</span><br><span class="line">UNIQUE KEY `uk_order_no` ( `order_no` ) </span><br><span class="line">) ENGINE = INNODB DEFAULT CHARSET = utf8mb4 COMMENT = &#x27;支付日志表&#x27;;</span><br></pre></td></tr></table></figure>

<h3 id="创建支付微服务生成相关代码"><a href="#创建支付微服务生成相关代码" class="headerlink" title="创建支付微服务生成相关代码"></a>创建支付微服务生成相关代码</h3><p>创建 <code>service_pay</code> 支付微服务</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605200845600-1198966703.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605200845600-1198966703.png" alt="img"></a></p>
<p>代码生成器</p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CodeGenerator</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 1、创建代码生成器</span></span><br><span class="line">        <span class="type">AutoGenerator</span> <span class="variable">autoGenerator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AutoGenerator</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、全局配置</span></span><br><span class="line">        <span class="type">GlobalConfig</span> <span class="variable">gc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GlobalConfig</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 配置输出路径</span></span><br><span class="line">        gc.setOutputDir(<span class="string">&quot;D:\\Develop\\IdeaPro\\video_parent\\service\\service_pay\\src\\main\\java&quot;</span>);</span><br><span class="line">        gc.setAuthor(<span class="string">&quot;BNTang&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 生成后是否打开资源管理器</span></span><br><span class="line">        gc.setOpen(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 重新生成时文件是否覆盖</span></span><br><span class="line">        gc.setFileOverride(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// mp生成service层代码，默认接口名称第一个字母有 I</span></span><br><span class="line">        gc.setControllerName(<span class="string">&quot;%sController&quot;</span>);</span><br><span class="line">        gc.setServiceName(<span class="string">&quot;%sService&quot;</span>);</span><br><span class="line">        gc.setServiceImplName(<span class="string">&quot;%sServiceImpl&quot;</span>);</span><br><span class="line">        gc.setMapperName(<span class="string">&quot;%sMapper&quot;</span>);</span><br><span class="line">        gc.setXmlName(<span class="string">&quot;%sMapper&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 主键策略</span></span><br><span class="line">        gc.setIdType(IdType.ID_WORKER_STR);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 定义生成的实体类中日期类型</span></span><br><span class="line">        gc.setDateType(DateType.ONLY_DATE);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 开启Swagger2模式</span></span><br><span class="line">        gc.setSwagger2(<span class="literal">true</span>);</span><br><span class="line">        autoGenerator.setGlobalConfig(gc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、数据源配置</span></span><br><span class="line">        <span class="type">DataSourceConfig</span> <span class="variable">dsc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataSourceConfig</span>();</span><br><span class="line">        dsc.setUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/video_db?serverTimezone=GMT%2B8&quot;</span>);</span><br><span class="line">        dsc.setDriverName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">        dsc.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        dsc.setPassword(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        dsc.setDbType(DbType.MYSQL);</span><br><span class="line">        autoGenerator.setDataSource(dsc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、包配置</span></span><br><span class="line">        <span class="type">PackageConfig</span> <span class="variable">pc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PackageConfig</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 模块名</span></span><br><span class="line">        pc.setModuleName(<span class="string">&quot;service_pay&quot;</span>);</span><br><span class="line">        pc.setParent(<span class="string">&quot;top.it6666&quot;</span>);</span><br><span class="line">        pc.setController(<span class="string">&quot;controller&quot;</span>);</span><br><span class="line">        pc.setEntity(<span class="string">&quot;entity&quot;</span>);</span><br><span class="line">        pc.setService(<span class="string">&quot;service&quot;</span>);</span><br><span class="line">        pc.setMapper(<span class="string">&quot;mapper&quot;</span>);</span><br><span class="line">        autoGenerator.setPackageInfo(pc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5、策略配置</span></span><br><span class="line">        <span class="type">StrategyConfig</span> <span class="variable">strategy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StrategyConfig</span>();</span><br><span class="line">        strategy.setInclude(<span class="string">&quot;pay_log&quot;</span>, <span class="string">&quot;pay_order&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 数据库表映射到实体的命名策略 驼峰命名</span></span><br><span class="line">        strategy.setNaming(NamingStrategy.underline_to_camel);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 生成实体时去掉表前缀</span></span><br><span class="line">        strategy.setTablePrefix(<span class="string">&quot;_&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 数据库表字段映射到实体的命名策略</span></span><br><span class="line">        strategy.setColumnNaming(NamingStrategy.underline_to_camel);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// lombok 模型 @Accessors(chain = true) setter链式操作</span></span><br><span class="line">        strategy.setEntityLombokModel(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// restful api风格控制器</span></span><br><span class="line">        strategy.setRestControllerStyle(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// url中驼峰转连字符</span></span><br><span class="line">        strategy.setControllerMappingHyphenStyle(<span class="literal">true</span>);</span><br><span class="line">        autoGenerator.setStrategy(strategy);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6、执行</span></span><br><span class="line">        autoGenerator.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改 service_pay 微服务当中的 pom.xml 添加 pom 依赖</p>
<p>xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.xml.bind<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jaxb-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.sun.xml.bind<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jaxb-impl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.sun.xml.bind<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jaxb-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.activation<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activation<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    alipay</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alipay.sdk<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>alipay-sdk-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.11.8.ALL<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    fastjson</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>紧接着添加启动类</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605201730785-1096740105.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605201730785-1096740105.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &#123;&quot;top.it6666&quot;&#125;)</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;top.it6666.service_pay.mapper&quot;)</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PayApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(PayApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建 application.yml</p>
<p>yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8008</span></span><br><span class="line"></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">pattern:</span></span><br><span class="line">    <span class="attr">console:</span> <span class="string">&quot;%clr(%5p) %clr(-)&#123;faint&#125; %clr(%-80.80logger&#123;79&#125;)&#123;cyan&#125; %clr(:) %m%n&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">service-pay</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/video_db?serverTimezone=GMT%2B8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">hikari:</span></span><br><span class="line">      <span class="attr">connection-test-query:</span> <span class="string">SELECT</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">connection-timeout:</span> <span class="number">60000</span></span><br><span class="line">      <span class="attr">idle-timeout:</span> <span class="number">500000</span></span><br><span class="line">      <span class="attr">max-lifetime:</span> <span class="number">540000</span></span><br><span class="line">      <span class="attr">maximum-pool-size:</span> <span class="number">12</span></span><br><span class="line">      <span class="attr">minimum-idle:</span> <span class="number">10</span></span><br><span class="line">      <span class="attr">pool-name:</span> <span class="string">HikariPool</span></span><br><span class="line">  <span class="attr">jackson:</span></span><br><span class="line">    <span class="attr">date-format:</span> <span class="string">yyyy-MM-dd</span> <span class="string">HH:mm:ss</span></span><br><span class="line">    <span class="attr">time-zone:</span> <span class="string">GMT+8</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">transport:</span></span><br><span class="line">        <span class="attr">dashboard:</span> <span class="string">localhost:8088</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">top/it6666/service_pay/mapper/xml/*.xml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">sentinel:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>修改 gateway 添加我们刚创建的支付模块的服务转发规则如下图</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605203327201-1278875932.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210605203327201-1278875932.png" alt="img"></a></p>
<p>yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">service-pay</span></span><br><span class="line">  <span class="attr">uri:</span> <span class="string">lb://service-pay</span></span><br><span class="line">  <span class="attr">predicates:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Path=/service_pay/**</span></span><br></pre></td></tr></table></figure>

<h2 id="58-支付操作-订单接口"><a href="#58-支付操作-订单接口" class="headerlink" title="58-支付操作-订单接口"></a>58-支付操作-订单接口</h2><h3 id="远程数据准备"><a href="#远程数据准备" class="headerlink" title="远程数据准备"></a>远程数据准备</h3><p>在 service_video 工程 ContentController 当中创建根据 <code>作品id</code> 获取作品信息的请求</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606085547675-1152391343.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606085547675-1152391343.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据作品id查询作品信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;根据作品id查询作品信息&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/getContentInfoOrder/&#123;contentId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ContentWebVO <span class="title function_">getContentInfoOrder</span><span class="params">(<span class="meta">@PathVariable</span> String contentId)</span> &#123;</span><br><span class="line">    <span class="comment">// 查询作品信息和作者信息</span></span><br><span class="line">    <span class="keyword">return</span> contentService.selectContentDetailById(contentId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 service_user 工程 UserController 当中创建根据 <code>用户id</code> 获取用户信息的请求</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606085807822-1364867252.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606085807822-1364867252.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据用户id获取用户信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;根据用户id获取用户信息&quot;)</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/getUserInfoOrderById/&#123;userId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">getUserInfoOrderById</span><span class="params">(<span class="meta">@PathVariable</span> String userId)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> userService.getById(userId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 service_pay 工程当中创建 <code>FeignClient</code> 远程调用接口</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606090147163-1303422883.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606090147163-1303422883.png" alt="img"></a></p>
<p>创建 ContentClient.java 接口</p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@project</span> video_parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 作品内容远程调用Feign客户端</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> Created in 2021/6/6 006 8:59</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@FeignClient(name = &quot;service-video&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ContentClient</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据作品id查询课程信息</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> contentId</span></span><br><span class="line"><span class="comment">     *            作品Id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 课程信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/service_video/content/getContentInfoOrder/&#123;contentId&#125;&quot;)</span></span><br><span class="line">    ContentWebVO <span class="title function_">getContentInfoOrder</span><span class="params">(<span class="meta">@PathVariable(&quot;contentId&quot;)</span> String contentId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在创建第二个 Feign 调用客户端的时候发现需要使用到 service_user 微服务当中的一个 User.java 实体类, 将 User.java 实体类抽取到 common_utils 工程当中去如下图</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606090741390-1483227570.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606090741390-1483227570.png" alt="img"></a></p>
<p>移动 mybatis-plus 的依赖原本是在 common_base 当中移动到父工程当中也就是 common 的 pom.xml 当中如下图</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606091421884-1131007307.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606091421884-1131007307.png" alt="img"></a></p>
<p>xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--mybatis-plus--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如上的步骤完成了之后我们就可以创建 UserClient.java 接口了内容如下放置的位置和上图中的那个 Feign 位置是一样的</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606091631798-1354200043.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606091631798-1354200043.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@project</span> video_parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 门户系统用户Feign调用客户端</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> Created in 2021/6/6 006 9:02</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@FeignClient(name = &quot;service-user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserClient</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据用户id获取用户信息</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment">     *            用户Id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 用户信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(value = &quot;/service_user/user/getUserInfoOrderById/&#123;userId&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">getUserInfoOrderById</span><span class="params">(<span class="meta">@PathVariable(&quot;userId&quot;)</span> String userId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="添加工具类"><a href="#添加工具类" class="headerlink" title="添加工具类"></a>添加工具类</h3><p>在 common_utils 工程当中添加 UUIDUtil.java 工具类内容如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606092408425-722969396.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606092408425-722969396.png" alt="img"></a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@project</span> video_parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> UUID工具类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> Created in 2021/6/6 006 9:20</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UUIDUtil</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成指定位数的随机字符串 (纯数字)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getRandomNumber</span><span class="params">(Integer number)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> RandomStringUtils.randomNumeric(number);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成随机[a-z]字符串，包含大小写</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getRandomString</span><span class="params">(Integer number)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> RandomStringUtils.randomAlphabetic(number);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成从ASCII 32到126组成的随机字符串</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getRandomAscii</span><span class="params">(Integer number)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> RandomStringUtils.randomAscii(number);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成没有 &quot;-&quot; 的uuid随机字符串 (包含字母和数字)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getUuid</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// replace(&quot;-&quot;,&quot;&quot;) : 把 &quot;-&quot; 该为空字符串 &quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> UUID.randomUUID().toString().replace(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 PayOrderController 当中创建根据 <code>作品id</code> 和 <code>用户id</code> 创建订单请求</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606093021264-12039116.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606093021264-12039116.png" alt="img"></a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 订单 前端控制器</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2021-06-05</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/service_pay/pay-order&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;订单组&quot;)</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PayOrderController</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> PayOrderService orderService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据作品id和用户id创建订单，返回订单id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;根据作品id和用户id创建订单，返回订单id&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;createOrder/&#123;contentId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">save</span><span class="params">(<span class="meta">@PathVariable</span> String contentId, HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok().data(<span class="string">&quot;orderId&quot;</span>,</span><br><span class="line">            orderService.saveOrder(contentId, JwtUtil.getUserIdByJwtToken(request)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改 PayOrderService.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 订单 服务类</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2021-06-05</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PayOrderService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;PayOrder&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据作品id和用户id创建订单，返回订单id</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> contentId</span></span><br><span class="line"><span class="comment">     *            作品ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment">     *            用户Id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 订单号</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">saveOrder</span><span class="params">(String contentId, String userId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改 PayOrderServiceImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 订单 服务实现类</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2021-06-05</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PayOrderServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;PayOrderMapper, PayOrder&gt; <span class="keyword">implements</span> <span class="title class_">PayOrderService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserClient userClient;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ContentClient contentClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">saveOrder</span><span class="params">(String contentId, String userId)</span> &#123;</span><br><span class="line">        <span class="comment">// 通过远程调用根据用户id获取用户信息</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">userInfo</span> <span class="operator">=</span> userClient.getUserInfoOrderById(userId);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 通过远程调用根据作品id获取作品信息</span></span><br><span class="line">        <span class="type">ContentWebVO</span> <span class="variable">contentInfo</span> <span class="operator">=</span> contentClient.getContentInfoOrder(contentId);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建Order对象，向order对象里面设置需要的数据</span></span><br><span class="line">        <span class="type">PayOrder</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PayOrder</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 订单号</span></span><br><span class="line">        order.setOrderNo(UUIDUtil.getRandomNumber(<span class="number">16</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 课程id</span></span><br><span class="line">        order.setContentId(contentId);</span><br><span class="line">        order.setContentTitle(contentInfo.getTitle());</span><br><span class="line">        order.setContentCover(contentInfo.getCover());</span><br><span class="line">        order.setAuthorName(contentInfo.getAuthorName());</span><br><span class="line">        order.setTotalFee(contentInfo.getPrice());</span><br><span class="line">        order.setUserId(userId);</span><br><span class="line">        order.setMobile(userInfo.getMobile());</span><br><span class="line">        order.setNickname(userInfo.getNickname());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 订单状态（0：未支付 1：已支付）</span></span><br><span class="line">        order.setStatus(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 支付类型 ，支付宝2</span></span><br><span class="line">        order.setPayType(<span class="number">2</span>);</span><br><span class="line">        baseMapper.insert(order);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 返回订单号</span></span><br><span class="line">        <span class="keyword">return</span> order.getOrderNo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 PayOrderController 当中创建根据 <code>订单id</code> 查询订单信息请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据订单id查询订单信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;根据订单id查询订单信息&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/getOrderInfo/&#123;orderNo&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">getOrderInfo</span><span class="params">(<span class="meta">@PathVariable</span> String orderNo)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> ResponseResult.ok().data(<span class="string">&quot;item&quot;</span>, orderService.getOrderByOrderNo(orderNo));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改 PayOrderService.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据订单id查询订单信息</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> orderNo</span></span><br><span class="line"><span class="comment"> *            订单Id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 订单信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">PayOrder <span class="title function_">getOrderByOrderNo</span><span class="params">(String orderNo)</span>;</span><br></pre></td></tr></table></figure>

<p>修改 PayOrderServiceImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> PayOrder <span class="title function_">getOrderByOrderNo</span><span class="params">(String orderNo)</span> &#123;</span><br><span class="line">    QueryWrapper&lt;PayOrder&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(<span class="string">&quot;order_no&quot;</span>, orderNo);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.getOne(queryWrapper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 PayOrderController 当中创建根据 <code>用户id</code> 和 <code>作品id</code> 查询该用户是否已经购买该作品请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据 `用户id` 和 `作品id` 查询该用户是否已经购买该作品请求</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;根据 `用户id` 和 `作品id` 查询该用户是否已经购买该作品请求&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/isBuyContent/&#123;userid&#125;/&#123;contentId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isBuyContent</span><span class="params">(<span class="meta">@PathVariable</span> String userid, <span class="meta">@PathVariable</span> String contentId)</span> &#123;</span><br><span class="line">    <span class="comment">// 订单状态 是1表示支付成功</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> orderService</span><br><span class="line">        .count(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;PayOrder&gt;().eq(<span class="string">&quot;user_id&quot;</span>, userid).eq(<span class="string">&quot;content_id&quot;</span>, contentId).eq(<span class="string">&quot;status&quot;</span>, <span class="number">1</span>));</span><br><span class="line">    <span class="keyword">return</span> count &gt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="59-支付操作-前端处理"><a href="#59-支付操作-前端处理" class="headerlink" title="59-支付操作-前端处理"></a>59-支付操作-前端处理</h2><h3 id="添加查询该课程有没有支付"><a href="#添加查询该课程有没有支付" class="headerlink" title="添加查询该课程有没有支付"></a>添加查询该课程有没有支付</h3><p>服务器获取作品信息请求 api 修改，首先把对应的 Feign 客户端写完在来修改对应的控制器层，因为这个业务就直接写在 Controller 当中了，没有创建对应的接口方法和在对应的实现类当中完成了，创建 OrderClient.java</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606095536743-929141427.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606095536743-929141427.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@project</span> video_parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 订单微服务 Feign 客户端调用</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> Created in 2021/6/6 006 9:53</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@FeignClient(name = &quot;service-pay&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderClient</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据 `用户id` 和 `作品id` 查询该用户是否已经购买该作品请求</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userid</span></span><br><span class="line"><span class="comment">     *            用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> contentId</span></span><br><span class="line"><span class="comment">     *            作品id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 是否购买过该作品</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/service_pay/pay-order/isBuyContent/&#123;userid&#125;/&#123;contentId&#125;&quot;)</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isBuyContent</span><span class="params">(<span class="meta">@PathVariable</span> String userid, <span class="meta">@PathVariable</span> String contentId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如上完成了之后就可以修改控制器层了修改 ContentController.java</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606095900364-1455312747.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606095900364-1455312747.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> OrderClient orderClient;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606095946789-1795313837.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606095946789-1795313837.png" alt="img"></a></p>
<p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据作品id获取作品详情信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;根据作品id获取作品详情信息&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/getContentDeatail/&#123;contentId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> String contentId, HttpServletRequest request)</span> &#123;</span><br><span class="line">    <span class="comment">// 查询作品信息和作者信息</span></span><br><span class="line">    <span class="type">ContentWebVO</span> <span class="variable">contentWebVo</span> <span class="operator">=</span> contentService.selectContentDetailById(contentId);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询当前作品的章节信息</span></span><br><span class="line">    List&lt;ChapterVO&gt; chapterVoList = chapterService.getChapterContentVideo(contentId);</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">uid</span> <span class="operator">=</span> JwtUtil.getUserIdByJwtToken(request);</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">isBuy</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(uid)) &#123;</span><br><span class="line">        <span class="comment">// 查询是否已经付费过了</span></span><br><span class="line">        isBuy = orderClient.isBuyContent(uid, contentId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ResponseResult.ok().data(<span class="string">&quot;content&quot;</span>, contentWebVo).data(<span class="string">&quot;chapterVoList&quot;</span>, chapterVoList)</span><br><span class="line">        .data(<span class="string">&quot;isBuyContent&quot;</span>, isBuy);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="前端处理"><a href="#前端处理" class="headerlink" title="前端处理"></a>前端处理</h3><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606100144846-925112515.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606100144846-925112515.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606100216042-609046201.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606100216042-609046201.png" alt="img"></a></p>
<h3 id="安装-cookie-universal-nuxt"><a href="#安装-cookie-universal-nuxt" class="headerlink" title="安装 cookie-universal-nuxt"></a>安装 cookie-universal-nuxt</h3><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606100348418-1903258685.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606100348418-1903258685.png" alt="img"></a></p>
<p>sh</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install cookie-universal-nuxt</span><br></pre></td></tr></table></figure>

<p>配置 cookie-universal-nuxt 修改 <code>nuxt.config.js</code></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606100513369-1637580868.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606100513369-1637580868.png" alt="img"></a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">modules</span>: [</span><br><span class="line">  <span class="string">&#x27;cookie-universal-nuxt&#x27;</span>, [<span class="string">&#x27;cookie-universal-nuxt&#x27;</span>, &#123;<span class="attr">parseJSON</span>: <span class="literal">true</span>&#125;],</span><br><span class="line">],</span><br></pre></td></tr></table></figure>

<h4 id="详情页请求"><a href="#详情页请求" class="headerlink" title="详情页请求"></a>详情页请求</h4><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606143306496-1573950269.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606143306496-1573950269.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606145138115-569052278.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606145138115-569052278.png" alt="img"></a></p>
<h3 id="处理播放状态"><a href="#处理播放状态" class="headerlink" title="处理播放状态"></a>处理播放状态</h3><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606145324040-541837289.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606145324040-541837289.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606145405724-659978273.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606145405724-659978273.png" alt="img"></a></p>
<p>如上的代码呢，前面的文章当中已经加入进去了所以不在贴出来了，创建 <code>order.js</code></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606145614421-1762136672.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606145614421-1762136672.png" alt="img"></a></p>
<p>javascript</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request <span class="keyword">from</span> <span class="string">&#x27;@/utils/request&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// 生成订单</span></span><br><span class="line">  <span class="title function_">createOrders</span>(<span class="params">contentId</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&#x27;/service_pay/pay-order/createOrder/&#x27;</span> + contentId,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 根据 `订单id` 查询订单信息</span></span><br><span class="line">  <span class="title function_">getOrdersInfo</span>(<span class="params">orderId</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&#x27;/service_pay/pay-order/getOrderInfo/&#x27;</span> + orderId,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 支付接口</span></span><br><span class="line">  <span class="title function_">aliPay</span>(<span class="params">orderNo</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&#x27;/service_pay/pay-log/aliPay/&#x27;</span> + orderNo,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建订单点击"><a href="#创建订单点击" class="headerlink" title="创建订单点击"></a>创建订单点击</h3><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606145719576-113472665.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606145719576-113472665.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606145759413-1547240022.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606145759413-1547240022.png" alt="img"></a></p>
<h3 id="创建订单页面"><a href="#创建订单页面" class="headerlink" title="创建订单页面"></a>创建订单页面</h3><p>在 pages 下创建 order 文件夹在该文件夹中创建 _oid.vue 内容如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;order&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;um-order-ux-order-v2-ct-top&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;um-order-ux-order-v2-ct-top-title&quot;&gt;</span><br><span class="line">        &lt;h1&gt;确认订单信息&lt;/h1&gt;</span><br><span class="line">        &lt;h4&gt;请在2小时内完成支付，否则订单会被自动取消&lt;/h4&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class=&quot;um-order-ux-order-account f-cb&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;um-order-ux-order-account_avatar f-fl&quot;&gt;</span><br><span class="line">          &lt;img :src=&quot;loginInfo.avatar&quot;&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;um-order-ux-order-account_info f-fl&quot;&gt;</span><br><span class="line">          &lt;div class=&quot;um-order-ux-order-account_info_nickName&quot;&gt;购买帐号：&#123;&#123; loginInfo.nickname &#125;&#125;&lt;/div&gt;</span><br><span class="line">          &lt;!--Regular if16--&gt;</span><br><span class="line">          &lt;div class=&quot;um-order-ux-order-account_info_tips&quot;&gt;注意：购买后不支持退款、转让，请确认开课时间或有效期后再提交订单&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class=&quot;um-order-ux-order-v2-pay-method&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;um-order-ux-order-v2-pay-method_head&quot;&gt;支付方式&lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;um-order-ux-order-v2-pay-method_body&quot;&gt;</span><br><span class="line">          &lt;div class=&quot;order-v2-pay_current f-cb&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;order-v2-pay_current_icon current_icon_alipay f-fl&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;order-v2-pay_current_type f-fl&quot;&gt;支付宝&lt;/span&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div class=&quot;um-order-ux-order-school-list&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;um-order-ux-order-school-list_title&quot;&gt;购买课程&lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;um-order-ux-order-school-list_list&quot;&gt;</span><br><span class="line">          &lt;div class=&quot;um-order-ux-order-school&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;um-order-ux-order-school_courselist&quot;&gt;</span><br><span class="line">              &lt;div class=&quot;um-order-ux-order-course&quot;&gt;</span><br><span class="line">                &lt;div class=&quot;um-order-ux-order-course_card f-cb&quot;&gt;</span><br><span class="line">                  &lt;div class=&quot;um-order-ux-order-course_card_img f-fl&quot;&gt;</span><br><span class="line">                    &lt;a class=&quot;&quot;&gt;</span><br><span class="line">                      &lt;img width=&quot;150px&quot; height=&quot;80px&quot; :src=&quot;order.contentCover&quot;&gt;</span><br><span class="line">                    &lt;/a&gt;</span><br><span class="line">                  &lt;/div&gt;</span><br><span class="line">                  &lt;div class=&quot;um-order-ux-order-course_card_body f-fl&quot;&gt;</span><br><span class="line">                    &lt;a class=&quot;title&quot;&gt;</span><br><span class="line">                      &lt;span&gt;&#123;&#123; order.contentTitle &#125;&#125;&lt;/span&gt;</span><br><span class="line">                    &lt;/a&gt;</span><br><span class="line">                    &lt;div class=&quot;time&quot;&gt;永久可看&lt;/div&gt;</span><br><span class="line">                    &lt;div class=&quot;promotion&quot;&gt;&lt;/div&gt;</span><br><span class="line">                  &lt;/div&gt;</span><br><span class="line">                  &lt;div class=&quot;um-order-ux-order-course_card_price f-fr&quot;&gt;￥&#123;&#123; order.totalFee &#125;&#125;&lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;um-order-ux-order-v2-ct-bottom um-order-ux-order-v2-ct-bottom_fixed&quot; style=&quot;left: 471.5px;&quot;&gt;</span><br><span class="line">      &lt;!--Regular if47--&gt;</span><br><span class="line">      &lt;div class=&quot;um-order-ux-order-v2-go-pay f-cb f-pr&quot;&gt;</span><br><span class="line">        &lt;form action=&quot;/pay/orderRedirectPage.htm&quot; name=&quot;payForm&quot;&gt;</span><br><span class="line">          &lt;input type=&quot;hidden&quot; name=&quot;orderUrl&quot;&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">        &lt;div class=&quot;um-order-ux-order-v2-go-pay_protocol f-pa&quot;&gt;</span><br><span class="line">          提交订单则表示您同意</span><br><span class="line">          &lt;span class=&quot;um-order-ux-order-v2-go-pay_protocol_btn&quot;&gt;《BNTang 用户服务协议》&lt;/span&gt;、</span><br><span class="line">          &lt;span class=&quot;um-order-ux-order-v2-go-pay_protocol_btn&quot;&gt;《BNTang 售后政策》&lt;/span&gt;等</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;um-order-ux-order-v2-go-pay_content f-fr&quot;&gt;</span><br><span class="line">          &lt;div class=&quot;um-order-ux-order-v2-go-pay_content_price&quot;&gt;</span><br><span class="line">            &lt;span class=&quot;v2-go-pay_content_price_title&quot;&gt;实付:&lt;/span&gt;</span><br><span class="line">            &lt;span class=&quot;v2-go-pay_content_price_account&quot;&gt;</span><br><span class="line">                &lt;span class=&quot;v2-go-pay_content_price_account_icon&quot;&gt;￥&lt;/span&gt;&#123;&#123; order.totalFee &#125;&#125;</span><br><span class="line">            &lt;/span&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;a class=&quot;um-order-ux-order-v2-go-pay_content_btn&quot; @click=&quot;payClick&quot;&gt;立即支付&lt;/a&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#x27;assets/css/order.css&#x27;</span><br><span class="line">import cookie from &quot;js-cookie&quot;;</span><br><span class="line">import order from &quot;@/api/order&quot;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  layout: &#x27;default&#x27;,</span><br><span class="line">  asyncData(&#123;params, error&#125;) &#123;</span><br><span class="line">    return order.getOrdersInfo(params.oid).then(response =&gt; &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        order: response.data.item</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    this.showInfo();</span><br><span class="line">  &#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      loginInfo: &#123;</span><br><span class="line">        avatar: &#x27;&#x27;,</span><br><span class="line">        nickname: &#x27;&#x27;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    showInfo() &#123;</span><br><span class="line">      let jsonStr = cookie.get(&quot;portal_user&quot;);</span><br><span class="line">      if (jsonStr) &#123;</span><br><span class="line">        this.loginInfo = JSON.parse(jsonStr);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    payClick() &#123;</span><br><span class="line">      order.aliPay(this.order.orderNo).then(response =&gt; &#123;</span><br><span class="line">        // 支付的时候, 支付宝会给我们返回支付页面</span><br><span class="line">        $(&#x27;body&#x27;).html(response.data.form);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="订单页加载数据"><a href="#订单页加载数据" class="headerlink" title="订单页加载数据"></a>订单页加载数据</h3><p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606150215832-448727924.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606150215832-448727924.png" alt="img"></a></p>
<h2 id="60-支付操作-支付与支付日志接口"><a href="#60-支付操作-支付与支付日志接口" class="headerlink" title="60-支付操作-支付与支付日志接口"></a>60-支付操作-支付与支付日志接口</h2><h3 id="Java-中支付宝准备工作"><a href="#Java-中支付宝准备工作" class="headerlink" title="Java 中支付宝准备工作"></a>Java 中支付宝准备工作</h3><p>支付宝加密处理与回调方式</p>
<h4 id="加密处理"><a href="#加密处理" class="headerlink" title="加密处理"></a>加密处理</h4><ul>
<li>网站以 POST 请求的方式提交参数给支付宝接口，在支付宝端进行支付处理</li>
<li>POST 请求方式一定程度下保证了安全性，即在 url 上看不到参数，但可以在浏览器开发者工具中可以看到参数，为防止篡改，则可以采用一些加密协议，如：HTTPS、加签名、加密手段 (MD5 加盐、base64、DES、sha1) 等</li>
<li>在加密中又可以分为对称加密 (base64、des 等) 与非对称加密 (RSA 公钥与私钥的互换)</li>
<li>在支付宝中主要使用加签名和 RSA 非对称加密</li>
</ul>
<h4 id="回调"><a href="#回调" class="headerlink" title="回调"></a>回调</h4><p>在支付宝接口中，把支付的结果通知给网站 (成功 &#x2F; 失败) 以便更新订单的状态信息, 两种回调方式</p>
<h4 id="同步回调"><a href="#同步回调" class="headerlink" title="同步回调"></a>同步回调</h4><ul>
<li>当 A 网站以 POST 请求方式将参数提交给支付宝接口，支付宝会同步返回通知给 A 网站</li>
<li>同步通知实际上是：本地浏览器的重定向操作，告知 A 网站支付成功还是失败，跳转到指定结果页面 &#x2F; 不做订单处理</li>
<li>因为有可能用户刚支付完, 不等待, 就关闭掉页面, 此方法可能调用不到</li>
</ul>
<h4 id="异步回调"><a href="#异步回调" class="headerlink" title="异步回调"></a>异步回调</h4><ul>
<li>为了安全性考虑，一般需要进行订单状态的更改时，使用异步通知</li>
<li>此回调是支付宝服务器发送过来的请求</li>
<li>支付宝服务器使用 httpclient 技术调用网站的接口进行通知，网站解析报文，判断到底是支付成功还是支付失败</li>
<li>异步通知包含补偿机制，即：支付宝把结果异步通知给 A 网站，若 A 网站未及时响应给支付宝，则支付宝会进行补偿重发</li>
<li>要返回 success 后, 支付宝才不会继续发送</li>
</ul>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ul>
<li>同步回调: 整个支付流程完毕，使用同步方式将参数重定向给商户平台，一般场景用于展示结果</li>
<li>异步回调: 第三方支付接口发一个后台通知给商户平台，一般场景用户修改订单信息</li>
</ul>
<h3 id="支付宝开发环境"><a href="#支付宝开发环境" class="headerlink" title="支付宝开发环境"></a>支付宝开发环境</h3><h4 id="使用支付宝沙箱"><a href="#使用支付宝沙箱" class="headerlink" title="使用支付宝沙箱"></a>使用支付宝沙箱</h4><p><a target="_blank" rel="noopener" href="https://open.alipay.com/platform/home.htm">https://open.alipay.com/platform/home.htm</a></p>
<p>初次访问需要进行认证，选择自研开发者，自行入驻</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606151657258-823790811.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606151657258-823790811.png" alt="img"></a></p>
<p>找到开发服务中的沙箱，进入到沙箱环境中，配置相应的信息</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606152001530-1263380232.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606152001530-1263380232.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606152019588-2142711972.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606152019588-2142711972.png" alt="img"></a></p>
<p>下载支付宝官方的签名验签工具，下载地址：<a target="_blank" rel="noopener" href="https://docs.open.alipay.com/291/105971">https://docs.open.alipay.com/291/105971</a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606152225762-943662152.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606152225762-943662152.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606152925828-1954884465.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606152925828-1954884465.png" alt="img"></a></p>
<p>安装完成后, 进入到该应用当中生成密钥，密钥长度选择 <code>RSA2</code>，密钥格式选择 <code>PKCS8</code> (Java 适用) 保存应用私钥, 代码当中需要填写应用 <code>应用私钥</code></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606154827580-1219145899.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606154827580-1219145899.png" alt="img"></a></p>
<p>复制应用公钥上传到沙盒环境中, 使用应用公钥换取支付宝公钥</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606165053684-1385693373.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606165053684-1385693373.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606165029062-588335346.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606165029062-588335346.png" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606165114348-1152412556.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606165114348-1152412556.png" alt="img"></a></p>
<h4 id="加密方式"><a href="#加密方式" class="headerlink" title="加密方式"></a>加密方式</h4><p>在支付领域，数据安全肯定是首要的任务，加密种类可分为：单向加密、对称加密、非对称加密</p>
<p>最安全的肯定是 <code>RSA</code>：公钥与私钥的互换，效率不如 <code>单向加密</code> 和 <code>对称加密高</code>，但安全性很好，要想破解，必须知道公钥和私钥两把密钥，属于非对称加密</p>
<h5 id="单向加密"><a href="#单向加密" class="headerlink" title="单向加密"></a>单向加密</h5><p>如 MD5、SHA 等不可逆【不能解密，只能加密】主要用来验证数据传输的过程中，是否被篡改过</p>
<h6 id="对称加密"><a href="#对称加密" class="headerlink" title="对称加密"></a>对称加密</h6><ul>
<li>一方通过密钥将信息加密后，把密文传给另一方，另一方通过这个相同的密钥将密文解密，转换成可以理解的明文</li>
<li>明文 ←→ 密钥 ←→ 密文【可以加密，又可以解密】</li>
<li>常用对称加密方案 DES、AES、Base64</li>
</ul>
<h6 id="非对称加密"><a href="#非对称加密" class="headerlink" title="非对称加密"></a>非对称加密</h6><ul>
<li>在支付领域一般都使用 RSA 非对称加密</li>
</ul>
<p>在通信双方，如果使用非对称加密，一般遵从这样的原则：</p>
<ul>
<li>公钥加密，私钥解密。同时，一般一个密钥加密，另一个密钥就可以解密</li>
<li>因为公钥是公开的，如果用来解密，那么就很容易被人解密消息。因此，私钥也可以认为是个人身份的证明</li>
</ul>
<h4 id="配置文件准备"><a href="#配置文件准备" class="headerlink" title="配置文件准备"></a>配置文件准备</h4><p>修改 service_pay 工程当中的 application.yml</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606180749357-1426374722.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606180749357-1426374722.png" alt="img"></a></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">pay:</span></span><br><span class="line">  <span class="attr">alibaba:</span></span><br><span class="line">    <span class="comment"># appid</span></span><br><span class="line">    <span class="attr">APPID:</span> <span class="number">2021000116684996</span></span><br><span class="line">    <span class="comment"># 私有秘钥</span></span><br><span class="line">    <span class="attr">privateKey:</span> <span class="string">MIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSiAgEAAoIBAQDK5cQ70nCqc5tmqHmBetBaDqj0VKo3s5cJMlCKWVE5ijeQdD7QBUEWoH+IFPSLqIK675njKsC+5WZOgOsqru4Ofh4s3pw7Pi598K0qEIjMxtRSm9P0q4c/CcvDpqApHcqO5NaLY1q7TWxm0RG3Hd7wf9ZNIxezvVbWOrSJiGmS76gDMPQKisyc7wZnxPHzBmFEp1oWY0e4MKlii2BBMmJrIx4vm8g1ufUksD4ymlp8kgP8vArEvdVNo1F2HVXTJ5g1YKWnp5dQqEO3rkAOsChMr7R4YLpXg+q9topCFXJiXh0RR3NnNGKfnGkNOt0WoF2uELz4zgtt0hbwzRCk1vsrAgMBAAECggEAcPbL8qKPp9cFxno2bCh8qCdRWfdpbenHRY+F2AEyf968YOjXr+m8+2QQnStNnBQN9RZBj4DWH3KJK1wLkpAial89Xa3zPei46dV+E9Vw1NI+lF+9+pMlkataj2vN8BZuGHDAIosGkRHiMLxmKJWw8iW6oufO4nugRVYZ/hi87tkR4IYm7mz1HGKbK0osuhCoeXfzT5wLhC7o/1EbQEMj+m+/iHhMhszuqu7rl6jKdwsXSNdeEK7d7IL0btLJ1SUTku8u4WMstTn5zd1F3d2TRcsJBJJv8fiBoWzbnzMsYsAV7sv1KkaZ0awMvRQm3ngzaWnR4wfXUjcPOsBkfjRwgQKBgQDlgeZ+SVvR7sEz9bSLEXdS2hOcmTqegawgkuqpps1eIGiejxuv7HQ2M+0OKWN1kHkhhZD/xsMJEhW2zVB+AMrPRG31fz7oASX4NkVr+2OXIvzn7md5O9DybMZQ4dzL7HFn++QoU3xQT2WBsx9SLUBJIW9RIAtM1dSjilzjHZ0zSQKBgQDiUYaTseOvy9ELp6D801IVXHxp3HgBDT8fshb1AgSr2eKPZbxJAv1qIcd2tg7cKt2Rq27MEnzpkFtAKyKLxMl/+YQoxePJdqOyq4MR9mzVKpu9G0PRGhF23xCv1WzS/BhtIp7t+RaBnQM4j7Qgh9TQOu1znU8ar3aCQulrcoIG0wKBgDaYbiJAhS0tZJxdqLMkVoRJCD1KXh1yr2WYTWZKHbR0dS6y0F1LHGIAfDXQNq6yzX3h7hpKR/8SZEP2F13CBnzDxHyP5oD+NPAUyPLk/E3prsvldIvsZMomgg6fjAyelGOuEhpdscbQ/E6cM6kyxoYfBAICY23FuC2nLm2Aj/KxAoGAFT6h62tffDkdvoJV0mXj5q1v4GAZw7+ClW8aSJWP6rHhWqSqMBBfyX6yQqqEapZ7hhkZpX52y1YJutRRwd0PLTw287zfzSGd7D+9ZgpD3R7Kz82naBGSYh4+asMWHBgeEuCVGrGvMyuSCdUzi3o0t/dQIvI5Yr/l2AR/9N4i5pECgYADoJF6TQbk6w/GxQt9bl7NXv6UjiPslEpeBJOQz6+njXvf/ByDgGM//dpUK5VTUo7dyzBnSefVvr63PdhNjwS4FBcjTXTWSuyhvXG84XMM7he2R4OlbkDdYLe3byDUT5Go1K9h3juXahiejexiwcTKOhZnk/5aFr/Cvtdm69cKMw==</span></span><br><span class="line">    <span class="comment"># 支付宝公有密钥</span></span><br><span class="line">    <span class="attr">publvicKey:</span> <span class="string">MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAgvMKvBii086mbtIhCAa8fMYGchJMrosUP6gCUKEFYz27BHGyGY5Rbmakl+l6mk2UilOuqNNqdy/evOLD05j46ro0QXo8q0IG7/0KW7ndd344JhlfUJP5OaT1bI6gwy2lalXMK605/DsjyK9mWWj5Wfxuyjz26mjFTd6OWXUMD0MF/F77sMb3o0kF0MeJP7rQYivYunaPvP985PO4zwYlnwGC9FX7jIpGRS3wrYG20Jcq0nLlzyTaqSNvP2Fk0z6jsFvo7loSAtrIa9ux+/zcXsrQquUidEoRxeb5X2tCDkfFgrQVM6YmAxj80Q2VksiOvk4sZhkdoc0273wnKlgfDQIDAQAB</span></span><br><span class="line">    <span class="comment"># 支付宝服务地址</span></span><br><span class="line">    <span class="attr">serverUrl:</span> <span class="string">https://openapi.alipaydev.com/gateway.do</span></span><br><span class="line">    <span class="comment"># 回调地址, 注意这里服务器回调一定要公网ip</span></span><br><span class="line">    <span class="attr">returnUrl:</span> <span class="string">http://it6666.viphk.ngrok.org/callback/returnUrl</span></span><br><span class="line">    <span class="attr">notyfyUrl:</span> <span class="string">http://it6666.viphk.ngrok.org/callback/notifyUrl</span></span><br></pre></td></tr></table></figure>

<p>APPID</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606191120045-1281196203.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606191120045-1281196203.png" alt="img"></a></p>
<p>privateKey</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606191246749-1486394025.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606191246749-1486394025.png" alt="img"></a></p>
<p>publvicKey</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606191341658-71722528.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606191341658-71722528.png" alt="img"></a></p>
<p>serverUrl</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606191353854-701182748.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606191353854-701182748.png" alt="img"></a></p>
<p>创建 common 包在该包中创建 config 包和 properties 包，在每个包中创建对应的类分别如下</p>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606181816837-550660427.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606181816837-550660427.png" alt="img"></a></p>
<p>创建 AliPayProperties.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@project</span> video_parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> Created in 2021/6/6 006 18:14</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;pay.alibaba&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AliPayProperties</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String appId;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 私钥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String privateKey;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 公钥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String publvicKey;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 支付宝服务地址</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String serverUrl;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 回调地址</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String returnUrl;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 异步回调</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String notyfyUrl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建 AliPayApiConfig.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@project</span> video_parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 阿里支付Api配置</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> Created in 2021/6/6 006 18:08</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AliPayApiConfig</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AliPayProperties aliPayProperties;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">JSON</span> <span class="operator">=</span> <span class="string">&quot;json&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">RSA2</span> <span class="operator">=</span> <span class="string">&quot;RSA2&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CHARSET</span> <span class="operator">=</span> <span class="string">&quot;UTF-8&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取阿里支付客户端</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> AlipayClient <span class="title function_">getAliPayClient</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DefaultAlipayClient</span>(aliPayProperties.getServerUrl(), aliPayProperties.getAppId(),</span><br><span class="line">            aliPayProperties.getPrivateKey(), JSON, CHARSET, aliPayProperties.getPublvicKey(), RSA2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="内网穿透"><a href="#内网穿透" class="headerlink" title="内网穿透"></a>内网穿透</h3><p><a target="_blank" rel="noopener" href="http://www.ngrok.cc/">http://www.ngrok.cc</a></p>
<h4 id="什么是内网穿透"><a href="#什么是内网穿透" class="headerlink" title="什么是内网穿透"></a>什么是内网穿透</h4><ul>
<li>通常个人电脑无论是连接 WIFI 上网还是用网线上网，都是属于局域网里边的，外网无法直接访问到你的电脑</li>
<li>内网穿透可以让你的局域网中的电脑实现外网访问功能, 针对上面这句话中出现的内网和外网</li>
</ul>
<h3 id="支付接口业务"><a href="#支付接口业务" class="headerlink" title="支付接口业务"></a>支付接口业务</h3><h4 id="支付接口"><a href="#支付接口" class="headerlink" title="支付接口"></a>支付接口</h4><p>PayLogController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 支付日志表 前端控制器</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2021-06-05</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/service_pay/pay-log&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PayLogController</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> PayLogService payService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 订单支付</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> orderNo</span></span><br><span class="line"><span class="comment">     *            订单号</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 支付页面</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/aliPay/&#123;orderNo&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">aliPay</span><span class="params">(<span class="meta">@PathVariable</span> String orderNo)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.ok().data(<span class="string">&quot;form&quot;</span>, payService.aliPay(orderNo));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>PayLogService.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 支付日志表 服务实现类</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2021-06-05</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PayLogServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;PayLogMapper, PayLog&gt; <span class="keyword">implements</span> <span class="title class_">PayLogService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 编码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CHARSET</span> <span class="operator">=</span> <span class="string">&quot;UTF-8&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 交易多长时间后关闭</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">EXPIRE</span> <span class="operator">=</span> <span class="string">&quot;30m&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AliPayProperties aliPayProperties;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AliPayApiConfig aliPayApiConfig;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> PayOrderService payOrderService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">aliPay</span><span class="params">(String orderNo)</span> &#123;</span><br><span class="line">        <span class="comment">// 1 根据订单号查询订单信息</span></span><br><span class="line">        QueryWrapper&lt;PayOrder&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.eq(<span class="string">&quot;order_no&quot;</span>, orderNo);</span><br><span class="line">        <span class="type">PayOrder</span> <span class="variable">order</span> <span class="operator">=</span> payOrderService.getOne(wrapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 支付内容参数</span></span><br><span class="line">        <span class="type">AlipayTradePagePayModel</span> <span class="variable">model</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AlipayTradePagePayModel</span>();</span><br><span class="line">        model.setOutTradeNo(order.getOrderNo());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 销售产品码 电脑网站支付固定为 FAST_INSTANT_TRADE_PAY</span></span><br><span class="line">        model.setProductCode(<span class="string">&quot;FAST_INSTANT_TRADE_PAY&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 商品金额</span></span><br><span class="line">        model.setTotalAmount(order.getTotalFee().toString());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 商品标题</span></span><br><span class="line">        model.setSubject(order.getContentTitle());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 商品描述</span></span><br><span class="line">        model.setBody(<span class="string">&quot;支付宝支付，共&quot;</span> + order.getTotalFee() + <span class="string">&quot;元&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置订单最晚付款时间 过期交易将关闭</span></span><br><span class="line">        model.setTimeoutExpress(EXPIRE);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 构建请求</span></span><br><span class="line">        <span class="type">AlipayTradePagePayRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AlipayTradePagePayRequest</span>();</span><br><span class="line">        request.setReturnUrl(aliPayProperties.getReturnUrl());</span><br><span class="line">        request.setNotifyUrl(aliPayProperties.getNotyfyUrl());</span><br><span class="line">        request.setBizModel(model);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 发起请求</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">form</span> <span class="operator">=</span> aliPayApiConfig.getAliPayClient().pageExecute(request).getBody();</span><br><span class="line">            <span class="type">HttpServletResponse</span> <span class="variable">response</span> <span class="operator">=</span> ServletUtils.getResponse();</span><br><span class="line">            response.setContentType(<span class="string">&quot;text/html;charset=&quot;</span> + CHARSET);</span><br><span class="line">            <span class="keyword">return</span> form;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (AlipayApiException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BnTangException</span>(<span class="number">20001</span>, <span class="string">&quot;支付宝电脑网站支付失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="回调接口"><a href="#回调接口" class="headerlink" title="回调接口"></a>回调接口</h4><p>创建 AliPayCallBackUrl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> BNTang</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@project</span> video_parent</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 支付宝回调控制器</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> Created in 2021/6/6 006 18:27</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/callback&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;支付&quot;)</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AliPayCallBackUrl</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 编码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CHARSET</span> <span class="operator">=</span> <span class="string">&quot;UTF-8&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 支付日志</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> PayLogService payLogService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 订单</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> PayOrderService payOrderService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 配置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AliPayProperties aliPayProperties;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 只有付款成功才会跳转到这里且只跳转一次 浏览器调用 重定向形式,不做跟订单相关的事 页面跳转</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;只有付款成功才会跳转到这里且只跳转一次 浏览器调用 重定向形式&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/returnUrl&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">returnUrl</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">HttpServletResponse</span> <span class="variable">response</span> <span class="operator">=</span> ServletUtils.getResponse();</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> ServletUtils.getRequest();</span><br><span class="line"></span><br><span class="line">        response.setContentType(<span class="string">&quot;text/html;charset=&quot;</span> + CHARSET);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 获取支付宝GET过来反馈信息</span></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">signVerified</span> <span class="operator">=</span> checkSignature(request);</span><br><span class="line">            <span class="keyword">if</span> (signVerified) &#123;</span><br><span class="line">                <span class="comment">// 跳转到作品详情页 哪一个作品?</span></span><br><span class="line">                <span class="comment">// 商户订单号</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">outTradeNo</span> <span class="operator">=</span></span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">String</span>(request.getParameter(<span class="string">&quot;out_trade_no&quot;</span>).getBytes(StandardCharsets.ISO_8859_1), CHARSET);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 获取订单</span></span><br><span class="line">                <span class="type">PayOrder</span> <span class="variable">payOrder</span> <span class="operator">=</span> payOrderService.getOrderByOrderNo(outTradeNo);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 获取作品id</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://localhost:3000/video/&quot;</span> + payOrder.getContentId();</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;redirect:&quot;</span> + url;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (AlipayApiException | IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 服务器通知 : 1. ip地址一定是公网的，私有地址支付宝无法通知到客户端 2. 请求方式是POST请求</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/notifyUrl&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notifyUrl</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 支付宝调用 return success 如果没有返回 还会继续调用</span></span><br><span class="line">        <span class="type">HttpServletResponse</span> <span class="variable">response</span> <span class="operator">=</span> ServletUtils.getResponse();</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> ServletUtils.getRequest();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> response.getWriter();</span><br><span class="line"></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">signVerified</span> <span class="operator">=</span> <span class="built_in">this</span>.checkSignature(request);</span><br><span class="line">            <span class="keyword">if</span> (signVerified) &#123;</span><br><span class="line">                <span class="comment">// 以下信息是支付定在请求当中写入信息</span></span><br><span class="line">                <span class="comment">// 商户订单号</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">outTradeNo</span> <span class="operator">=</span></span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">String</span>(request.getParameter(<span class="string">&quot;out_trade_no&quot;</span>).getBytes(StandardCharsets.ISO_8859_1), CHARSET);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 支付宝交易号</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">transactionId</span> <span class="operator">=</span></span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">String</span>(request.getParameter(<span class="string">&quot;trade_no&quot;</span>).getBytes(StandardCharsets.ISO_8859_1), CHARSET);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 交易状态</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">tradeStatus</span> <span class="operator">=</span></span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">String</span>(request.getParameter(<span class="string">&quot;trade_status&quot;</span>).getBytes(StandardCharsets.ISO_8859_1), CHARSET);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 更新订单</span></span><br><span class="line">                HashMap&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">                map.put(<span class="string">&quot;out_trade_no&quot;</span>, outTradeNo);</span><br><span class="line">                map.put(<span class="string">&quot;trade_state&quot;</span>, tradeStatus);</span><br><span class="line">                map.put(<span class="string">&quot;transaction_id&quot;</span>, transactionId);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (<span class="string">&quot;TRADE_FINISHED&quot;</span>.equals(tradeStatus)) &#123;</span><br><span class="line">                    <span class="comment">// 判断该笔订单是否在商户网站中已经做过处理</span></span><br><span class="line">                    <span class="comment">// 如果没有做过处理，根据订单号（out_trade_no）在商户网站的订单系统中查到该笔订单的详细，</span></span><br><span class="line">                    <span class="comment">// 并执行商户的业务程序</span></span><br><span class="line">                    <span class="comment">// 如果有做过处理，不执行商户的业务程序</span></span><br><span class="line">                    <span class="type">PayOrder</span> <span class="variable">payOrder</span> <span class="operator">=</span> payOrderService.getOrderByOrderNo(outTradeNo);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (payOrder.getStatus() != <span class="number">1</span>) &#123;</span><br><span class="line">                        payLogService.updateOrdersStatus(map);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;TRADE_SUCCESS&quot;</span>.equals(tradeStatus)) &#123;</span><br><span class="line">                    payLogService.updateOrdersStatus(map);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                out.println(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                out.println(<span class="string">&quot;fail&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (AlipayApiException | IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 校验签名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">checkSignature</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> AlipayApiException &#123;</span><br><span class="line">        Map&lt;String, String&gt; params = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        Map&lt;String, String[]&gt; requestParams = request.getParameterMap();</span><br><span class="line"></span><br><span class="line">        requestParams.keySet().forEach(name -&gt; &#123;</span><br><span class="line">            String[] values = requestParams.get(name);</span><br><span class="line">            <span class="type">String</span> <span class="variable">valueStr</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; values.length; i++) &#123;</span><br><span class="line">                valueStr = (i == values.length - <span class="number">1</span>) ? valueStr + values[i] : valueStr + values[i] + <span class="string">&quot;,&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 乱码解决，这段代码在出现乱码时使用</span></span><br><span class="line">            <span class="comment">// valueStr = new String(valueStr.getBytes(&quot;ISO-8859-1&quot;), &quot;utf-8&quot;);</span></span><br><span class="line">            params.put(name, valueStr);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> AlipaySignature.rsaCheckV1(params, aliPayProperties.getPublvicKey(), CHARSET, <span class="string">&quot;RSA2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改 PayLogService.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 更新订单状态</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> map</span></span><br><span class="line"><span class="comment"> *            订单属性Map</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">updateOrdersStatus</span><span class="params">(HashMap&lt;String, String&gt; map)</span>;</span><br></pre></td></tr></table></figure>

<p>修改 PayLogServiceImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateOrdersStatus</span><span class="params">(HashMap&lt;String, String&gt; map)</span> &#123;</span><br><span class="line">    <span class="comment">// 从map获取订单号</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">orderNo</span> <span class="operator">=</span> map.get(<span class="string">&quot;out_trade_no&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据订单号查询订单信息</span></span><br><span class="line">    QueryWrapper&lt;PayOrder&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    wrapper.eq(<span class="string">&quot;order_no&quot;</span>, orderNo);</span><br><span class="line">    <span class="type">PayOrder</span> <span class="variable">order</span> <span class="operator">=</span> payOrderService.getOne(wrapper);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新订单表订单状态</span></span><br><span class="line">    <span class="keyword">if</span> (order.getStatus() == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1代表已经支付</span></span><br><span class="line">    order.setStatus(<span class="number">1</span>);</span><br><span class="line">    payOrderService.updateById(order);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 向支付表添加支付记录</span></span><br><span class="line">    <span class="type">PayLog</span> <span class="variable">payLog</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PayLog</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 订单号</span></span><br><span class="line">    payLog.setOrderNo(orderNo);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 订单完成时间</span></span><br><span class="line">    payLog.setPayTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 支付类型 1微信</span></span><br><span class="line">    payLog.setPayType(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 总金额(分)</span></span><br><span class="line">    payLog.setTotalFee(order.getTotalFee());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 支付状态</span></span><br><span class="line">    payLog.setTradeState(map.get(<span class="string">&quot;trade_state&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 流水号</span></span><br><span class="line">    payLog.setTransactionId(map.get(<span class="string">&quot;transaction_id&quot;</span>));</span><br><span class="line">    payLog.setAttr(JSONObject.toJSONString(map));</span><br><span class="line"></span><br><span class="line">    baseMapper.insert(payLog);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 common_utils 工程当中创建 ServletUtils.java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @author BNTang</span><br><span class="line"> * @version 1.0</span><br><span class="line"> * @project video_parent</span><br><span class="line"> * @description servlet工具类</span><br><span class="line"> * @since Created in 2021/6/6 006 18:25</span><br><span class="line"> **/</span><br><span class="line">public class ServletUtils &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 获取RequestAttributes对象</span><br><span class="line">     */</span><br><span class="line">    public static ServletRequestAttributes getRequestAttributes() &#123;</span><br><span class="line">        RequestAttributes attributes = RequestContextHolder.getRequestAttributes();</span><br><span class="line">        return (ServletRequestAttributes)attributes;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取 HttpServletRequest 对象</span><br><span class="line">     */</span><br><span class="line">    public static HttpServletRequest getRequest() &#123;</span><br><span class="line">        return getRequestAttributes().getRequest();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取response对象</span><br><span class="line">     */</span><br><span class="line">    public static HttpServletResponse getResponse() &#123;</span><br><span class="line">        return getRequestAttributes().getResponse();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取session对象</span><br><span class="line">     */</span><br><span class="line">    public static HttpSession getSession() &#123;</span><br><span class="line">        return getRequest().getSession();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 把字符串打印到客户端</span><br><span class="line">     */</span><br><span class="line">    public static String sendString(HttpServletResponse response, String string) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            response.setStatus(200);</span><br><span class="line">            response.setContentType(&quot;application/json&quot;);</span><br><span class="line">            response.setCharacterEncoding(&quot;utf-8&quot;);</span><br><span class="line">            response.getWriter().print(string);</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="支付宝账户与密码"><a href="#支付宝账户与密码" class="headerlink" title="支付宝账户与密码"></a>支付宝账户与密码</h3><blockquote>
<ul>
<li>账户：<a href="mailto:&#99;&#120;&#115;&#105;&#x6d;&#114;&#x36;&#52;&#x39;&#55;&#64;&#x73;&#x61;&#x6e;&#100;&#x62;&#x6f;&#120;&#46;&#99;&#x6f;&#109;">&#99;&#120;&#115;&#105;&#x6d;&#114;&#x36;&#52;&#x39;&#55;&#64;&#x73;&#x61;&#x6e;&#100;&#x62;&#x6f;&#120;&#46;&#99;&#x6f;&#109;</a></li>
<li>密码：111111</li>
</ul>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606201003077-344199073.png"><img src="https://img2020.cnblogs.com/blog/2105804/202106/2105804-20210606201003077-344199073.png" alt="img"></a></p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        Author:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">John Doe</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        Link:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://example.com/2022/09/01/SpringCloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE/">http://example.com/2022/09/01/SpringCloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        Reprint policy:
                    </i>
                </span>
                <span class="reprint-info">
                    All articles in this blog are used except for special statements
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    reprint polocy. If reproduced, please indicate source
                    <a href="/about" target="_blank">John Doe</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>Copied successfully, please follow the reprint policy of this article</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">more</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            <span class="chip bg-color">No tag</span>
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;Previous</div>
            <div class="card">
                <a href="/2022/09/04/MongoDB%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/0.jpg" class="responsive-img" alt="MongoDB安装教程">
                        
                        <span class="card-title">MongoDB安装教程</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2022-09-04
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            John Doe
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                Next&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2022/09/01/uniAPP%E5%BC%80%E5%8F%91-%E5%85%A8%E6%95%99%E7%A8%8B/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/20.jpg" class="responsive-img" alt="uniAPP开发 全教程">
                        
                        <span class="card-title">uniAPP开发 全教程</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2022-09-01
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            John Doe
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;TOC</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2022</span>
            
            <span id="year">2019</span>
            <a href="/about" target="_blank">John Doe</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/lilinzhi666/lilinzhi666.github.io" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:3427562614@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=3427562614" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 3427562614" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;Search</span>
            <input type="search" id="searchInput" name="s" placeholder="Please enter a search keyword"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

	
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>

</html>
